"use strict";

// Copyright 2022-2024, University of Colorado Boulder

/**
 * Reports a (delayed) page load (or error) to the parent frame for Aqua continuous testing.
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

(function () {
  var hasErrored = false;
  window.addEventListener('error', function (data) {
    if (!hasErrored) {
      hasErrored = true;
      var message = '';
      var stack = '';
      if (data && data.message) {
        message = data.message;
      }
      if (data && data.error && data.error.stack) {
        stack = data.error.stack;
      }
      window.parent !== window && window.parent.postMessage(JSON.stringify({
        type: 'pageload-error',
        url: window.location.href,
        message: message,
        stack: stack
      }), '*');
      console.log('error');
    }
  });
  window.addEventListener('load', function (event) {
    // Wait 4 seconds before reporting load, to see if it errors first
    setTimeout(function () {
      if (!hasErrored) {
        window.parent !== window && window.parent.postMessage(JSON.stringify({
          type: 'pageload-load',
          url: window.location.href
        }), '*');
        console.log('load');
      }
    }, 4000);
  }, false);
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoYXNFcnJvcmVkIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImRhdGEiLCJtZXNzYWdlIiwic3RhY2siLCJlcnJvciIsInBhcmVudCIsInBvc3RNZXNzYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsInR5cGUiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJjb25zb2xlIiwibG9nIiwiZXZlbnQiLCJzZXRUaW1lb3V0Il0sInNvdXJjZXMiOlsicGFnZWxvYWQtY29ubmVjdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJlcG9ydHMgYSAoZGVsYXllZCkgcGFnZSBsb2FkIChvciBlcnJvcikgdG8gdGhlIHBhcmVudCBmcmFtZSBmb3IgQXF1YSBjb250aW51b3VzIHRlc3RpbmcuXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5cclxuKCBmdW5jdGlvbigpIHtcclxuXHJcbiAgbGV0IGhhc0Vycm9yZWQgPSBmYWxzZTtcclxuXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICdlcnJvcicsIGRhdGEgPT4ge1xyXG4gICAgaWYgKCAhaGFzRXJyb3JlZCApIHtcclxuICAgICAgaGFzRXJyb3JlZCA9IHRydWU7XHJcblxyXG4gICAgICBsZXQgbWVzc2FnZSA9ICcnO1xyXG4gICAgICBsZXQgc3RhY2sgPSAnJztcclxuICAgICAgaWYgKCBkYXRhICYmIGRhdGEubWVzc2FnZSApIHtcclxuICAgICAgICBtZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggZGF0YSAmJiBkYXRhLmVycm9yICYmIGRhdGEuZXJyb3Iuc3RhY2sgKSB7XHJcbiAgICAgICAgc3RhY2sgPSBkYXRhLmVycm9yLnN0YWNrO1xyXG4gICAgICB9XHJcbiAgICAgICggd2luZG93LnBhcmVudCAhPT0gd2luZG93ICkgJiYgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSggSlNPTi5zdHJpbmdpZnkoIHtcclxuICAgICAgICB0eXBlOiAncGFnZWxvYWQtZXJyb3InLFxyXG4gICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsXHJcbiAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcclxuICAgICAgICBzdGFjazogc3RhY2tcclxuICAgICAgfSApLCAnKicgKTtcclxuICAgICAgY29uc29sZS5sb2coICdlcnJvcicgKTtcclxuICAgIH1cclxuICB9ICk7XHJcblxyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAnbG9hZCcsIGV2ZW50ID0+IHtcclxuICAgIC8vIFdhaXQgNCBzZWNvbmRzIGJlZm9yZSByZXBvcnRpbmcgbG9hZCwgdG8gc2VlIGlmIGl0IGVycm9ycyBmaXJzdFxyXG4gICAgc2V0VGltZW91dCggKCkgPT4ge1xyXG4gICAgICBpZiAoICFoYXNFcnJvcmVkICkge1xyXG4gICAgICAgICggd2luZG93LnBhcmVudCAhPT0gd2luZG93ICkgJiYgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSggSlNPTi5zdHJpbmdpZnkoIHtcclxuICAgICAgICAgIHR5cGU6ICdwYWdlbG9hZC1sb2FkJyxcclxuICAgICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWZcclxuICAgICAgICB9ICksICcqJyApO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyggJ2xvYWQnICk7XHJcbiAgICAgIH1cclxuICAgIH0sIDQwMDAgKTtcclxuICB9LCBmYWxzZSApO1xyXG59ICkoKTsiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsQ0FBRSxZQUFXO0VBRVgsSUFBSUEsVUFBVSxHQUFHLEtBQUs7RUFFdEJDLE1BQU0sQ0FBQ0MsZ0JBQWdCLENBQUUsT0FBTyxFQUFFLFVBQUFDLElBQUksRUFBSTtJQUN4QyxJQUFLLENBQUNILFVBQVUsRUFBRztNQUNqQkEsVUFBVSxHQUFHLElBQUk7TUFFakIsSUFBSUksT0FBTyxHQUFHLEVBQUU7TUFDaEIsSUFBSUMsS0FBSyxHQUFHLEVBQUU7TUFDZCxJQUFLRixJQUFJLElBQUlBLElBQUksQ0FBQ0MsT0FBTyxFQUFHO1FBQzFCQSxPQUFPLEdBQUdELElBQUksQ0FBQ0MsT0FBTztNQUN4QjtNQUNBLElBQUtELElBQUksSUFBSUEsSUFBSSxDQUFDRyxLQUFLLElBQUlILElBQUksQ0FBQ0csS0FBSyxDQUFDRCxLQUFLLEVBQUc7UUFDNUNBLEtBQUssR0FBR0YsSUFBSSxDQUFDRyxLQUFLLENBQUNELEtBQUs7TUFDMUI7TUFDRUosTUFBTSxDQUFDTSxNQUFNLEtBQUtOLE1BQU0sSUFBTUEsTUFBTSxDQUFDTSxNQUFNLENBQUNDLFdBQVcsQ0FBRUMsSUFBSSxDQUFDQyxTQUFTLENBQUU7UUFDekVDLElBQUksRUFBRSxnQkFBZ0I7UUFDdEJDLEdBQUcsRUFBRVgsTUFBTSxDQUFDWSxRQUFRLENBQUNDLElBQUk7UUFDekJWLE9BQU8sRUFBRUEsT0FBTztRQUNoQkMsS0FBSyxFQUFFQTtNQUNULENBQUUsQ0FBQyxFQUFFLEdBQUksQ0FBQztNQUNWVSxPQUFPLENBQUNDLEdBQUcsQ0FBRSxPQUFRLENBQUM7SUFDeEI7RUFDRixDQUFFLENBQUM7RUFFSGYsTUFBTSxDQUFDQyxnQkFBZ0IsQ0FBRSxNQUFNLEVBQUUsVUFBQWUsS0FBSyxFQUFJO0lBQ3hDO0lBQ0FDLFVBQVUsQ0FBRSxZQUFNO01BQ2hCLElBQUssQ0FBQ2xCLFVBQVUsRUFBRztRQUNmQyxNQUFNLENBQUNNLE1BQU0sS0FBS04sTUFBTSxJQUFNQSxNQUFNLENBQUNNLE1BQU0sQ0FBQ0MsV0FBVyxDQUFFQyxJQUFJLENBQUNDLFNBQVMsQ0FBRTtVQUN6RUMsSUFBSSxFQUFFLGVBQWU7VUFDckJDLEdBQUcsRUFBRVgsTUFBTSxDQUFDWSxRQUFRLENBQUNDO1FBQ3ZCLENBQUUsQ0FBQyxFQUFFLEdBQUksQ0FBQztRQUVWQyxPQUFPLENBQUNDLEdBQUcsQ0FBRSxNQUFPLENBQUM7TUFDdkI7SUFDRixDQUFDLEVBQUUsSUFBSyxDQUFDO0VBQ1gsQ0FBQyxFQUFFLEtBQU0sQ0FBQztBQUNaLENBQUMsRUFBRyxDQUFDIiwiaWdub3JlTGlzdCI6W119