"use strict";

// Copyright 2021, University of Colorado Boulder

var fs = require('fs');
// eslint-disable-next-line require-statement-match
var csv = require('csv-parser');
var filePath = process.argv[2];

/**
 * Read in the CSV export from the locales spreadsheet ("Final(dev)" format) and parse it into a localeJSON format.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

var parseCSV = function parseCSV(filePath, callback) {
  var rows = [];
  fs.createReadStream(filePath).pipe(csv()).on('data', function (row) {
    var values = Object.values(row);
    rows.push(values);
  }).on('end', function () {
    callback(null, rows);
  }).on('error', function (error) {
    callback(error, null);
  });
};
parseCSV(filePath, function (error, data) {
  if (error) {
    console.error('Error parsing CSV:', error);
  } else {
    var localeMainData = data.map(function (row) {
      var locale = row[1];
      var threeLetterLocale = row[2];
      var englishName = row[3];
      var localizedName = row[4];
      var direction = row[5];
      var fallback = row[6];
      locale = locale.trim();
      if (locale.length !== 2 && locale.length !== 5) {
        throw new Error("Invalid locale: ".concat(JSON.stringify(locale)));
      }
      if (!locale[0].match(/[a-z]/)) {
        throw new Error("Invalid locale: ".concat(locale));
      }
      if (!locale[1].match(/[a-z]/)) {
        throw new Error("Invalid locale: ".concat(locale));
      }
      if (locale.length === 5) {
        if (locale[2] !== '_') {
          throw new Error("Invalid locale: ".concat(locale));
        }
        if (!locale[3].match(/[A-Z]/)) {
          throw new Error("Invalid locale: ".concat(locale));
        }
        if (!locale[4].match(/[A-Z]/)) {
          throw new Error("Invalid locale: ".concat(locale));
        }
      }
      threeLetterLocale = threeLetterLocale.trim(); // remove tab

      if (threeLetterLocale.length === 5 && locale === threeLetterLocale) {
        threeLetterLocale = null;
      } else if (threeLetterLocale.length === 0) {
        threeLetterLocale = null;
      }
      if (threeLetterLocale !== null) {
        if (threeLetterLocale.length !== 3) {
          throw new Error("Invalid three-letter locale: ".concat(JSON.stringify(row)));
        }
        if (!threeLetterLocale.match(/^[a-z]{3}$/)) {
          throw new Error("Invalid three-letter locale: ".concat(JSON.stringify(row)));
        }
      }
      englishName = englishName.trim().replace(/\u00A0/g, ' ');
      if (englishName.length < 1) {
        throw new Error("Invalid English name: ".concat(JSON.stringify(row)));
      }
      localizedName = localizedName.trim().replace(/\u00A0/g, ' ');
      if (localizedName.length < 1) {
        throw new Error("Invalid localized name: ".concat(JSON.stringify(row)));
      }

      // patch in
      if (locale === 'pt_ST') {
        direction = 'ltr';
      }
      if (direction !== 'ltr' && direction !== 'rtl') {
        throw new Error("Invalid direction: ".concat(JSON.stringify(row)));
      }
      var fallbackLocales = fallback.trim().split(',').map(function (x) {
        return x.trim();
      }).filter(function (l) {
        return l !== 'en';
      });
      var result = {
        locale: locale
      };
      if (threeLetterLocale) {
        result.locale3 = threeLetterLocale;
      }
      result.englishName = englishName;
      result.localizedName = localizedName;
      result.direction = direction;
      if (fallbackLocales.length) {
        result.fallbackLocales = fallbackLocales;
      }
      return result;
    });
    localeMainData.forEach(function (localeData) {
      localeData.fallbackLocales && localeData.fallbackLocales.forEach(function (fallbackLocale) {
        if (!localeMainData.find(function (x) {
          return x.locale === fallbackLocale;
        })) {
          throw new Error("Invalid fallback locale: ".concat(JSON.stringify(localeData)));
        }
      });
    });
    localeMainData.sort(function (a, b) {
      return a.locale.localeCompare(b.locale);
    });
    var localeInfo = {};
    localeMainData.forEach(function (localeData) {
      var locale = localeData.locale;
      delete localeData.locale;
      localeInfo[locale] = localeData;
    });
    var localeInfoString = JSON.stringify(localeInfo, null, 2);
    console.log(localeInfoString);

    // legacy localeInfo.js, that will be propagated to the other copies
    {
      var legacyLocaleInfoPrimaryFilename = '../chipper/js/data/localeInfo.js';
      if (!fs.existsSync(legacyLocaleInfoPrimaryFilename)) {
        throw new Error("Expected to find ".concat(legacyLocaleInfoPrimaryFilename));
      }
      var legacyLocaleInfoPrimary = fs.readFileSync(legacyLocaleInfoPrimaryFilename, 'utf8');
      var startIndex = legacyLocaleInfoPrimary.indexOf('const locales = {');
      var endIndex = legacyLocaleInfoPrimary.indexOf('module.exports = locales;', startIndex);
      if (startIndex === -1 || endIndex === -1) {
        throw new Error('Failed to find localeInfo.js locales object');
      }
      var replacement = 'const locales = {\n';
      for (var locale in localeInfo) {
        replacement += "  ".concat(locale, ": {\n");
        replacement += "    name: '".concat(localeInfo[locale].englishName.replace(/'/g, '\\\''), "',\n");
        replacement += "    localizedName: '".concat(localeInfo[locale].localizedName.replace(/'/g, '\\\''), "',\n");
        replacement += "    direction: '".concat(localeInfo[locale].direction, "'\n");
        replacement += '  },\n';
      }
      replacement += '};\n\n';
      var newLocaleInfoPrimary = legacyLocaleInfoPrimary.substring(0, startIndex) + replacement + legacyLocaleInfoPrimary.substring(endIndex);
      fs.writeFileSync(legacyLocaleInfoPrimaryFilename, newLocaleInfoPrimary, 'utf8');
    }

    // New babel localeData
    {
      var babelExtendedLocaleInfoFilename = '../babel/localeData.json';
      fs.writeFileSync(babelExtendedLocaleInfoFilename, localeInfoString);
    }
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJjc3YiLCJmaWxlUGF0aCIsInByb2Nlc3MiLCJhcmd2IiwicGFyc2VDU1YiLCJjYWxsYmFjayIsInJvd3MiLCJjcmVhdGVSZWFkU3RyZWFtIiwicGlwZSIsIm9uIiwicm93IiwidmFsdWVzIiwiT2JqZWN0IiwicHVzaCIsImVycm9yIiwiZGF0YSIsImNvbnNvbGUiLCJsb2NhbGVNYWluRGF0YSIsIm1hcCIsImxvY2FsZSIsInRocmVlTGV0dGVyTG9jYWxlIiwiZW5nbGlzaE5hbWUiLCJsb2NhbGl6ZWROYW1lIiwiZGlyZWN0aW9uIiwiZmFsbGJhY2siLCJ0cmltIiwibGVuZ3RoIiwiRXJyb3IiLCJjb25jYXQiLCJKU09OIiwic3RyaW5naWZ5IiwibWF0Y2giLCJyZXBsYWNlIiwiZmFsbGJhY2tMb2NhbGVzIiwic3BsaXQiLCJ4IiwiZmlsdGVyIiwibCIsInJlc3VsdCIsImxvY2FsZTMiLCJmb3JFYWNoIiwibG9jYWxlRGF0YSIsImZhbGxiYWNrTG9jYWxlIiwiZmluZCIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJsb2NhbGVJbmZvIiwibG9jYWxlSW5mb1N0cmluZyIsImxvZyIsImxlZ2FjeUxvY2FsZUluZm9QcmltYXJ5RmlsZW5hbWUiLCJleGlzdHNTeW5jIiwibGVnYWN5TG9jYWxlSW5mb1ByaW1hcnkiLCJyZWFkRmlsZVN5bmMiLCJzdGFydEluZGV4IiwiaW5kZXhPZiIsImVuZEluZGV4IiwicmVwbGFjZW1lbnQiLCJuZXdMb2NhbGVJbmZvUHJpbWFyeSIsInN1YnN0cmluZyIsIndyaXRlRmlsZVN5bmMiLCJiYWJlbEV4dGVuZGVkTG9jYWxlSW5mb0ZpbGVuYW1lIl0sInNvdXJjZXMiOlsiaW5pdGlhbC1wYXJzZS1sb2NhbGVzLWNzdi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG5jb25zdCBmcyA9IHJlcXVpcmUoICdmcycgKTtcclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlcXVpcmUtc3RhdGVtZW50LW1hdGNoXHJcbmNvbnN0IGNzdiA9IHJlcXVpcmUoICdjc3YtcGFyc2VyJyApO1xyXG5cclxuY29uc3QgZmlsZVBhdGggPSBwcm9jZXNzLmFyZ3ZbIDIgXTtcclxuXHJcbi8qKlxyXG4gKiBSZWFkIGluIHRoZSBDU1YgZXhwb3J0IGZyb20gdGhlIGxvY2FsZXMgc3ByZWFkc2hlZXQgKFwiRmluYWwoZGV2KVwiIGZvcm1hdCkgYW5kIHBhcnNlIGl0IGludG8gYSBsb2NhbGVKU09OIGZvcm1hdC5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmNvbnN0IHBhcnNlQ1NWID0gKCBmaWxlUGF0aCwgY2FsbGJhY2sgKSA9PiB7XHJcbiAgY29uc3Qgcm93cyA9IFtdO1xyXG5cclxuICBmcy5jcmVhdGVSZWFkU3RyZWFtKCBmaWxlUGF0aCApXHJcbiAgICAucGlwZSggY3N2KCkgKVxyXG4gICAgLm9uKCAnZGF0YScsIHJvdyA9PiB7XHJcbiAgICAgIGNvbnN0IHZhbHVlcyA9IE9iamVjdC52YWx1ZXMoIHJvdyApO1xyXG4gICAgICByb3dzLnB1c2goIHZhbHVlcyApO1xyXG4gICAgfSApXHJcbiAgICAub24oICdlbmQnLCAoKSA9PiB7XHJcbiAgICAgIGNhbGxiYWNrKCBudWxsLCByb3dzICk7XHJcbiAgICB9IClcclxuICAgIC5vbiggJ2Vycm9yJywgZXJyb3IgPT4ge1xyXG4gICAgICBjYWxsYmFjayggZXJyb3IsIG51bGwgKTtcclxuICAgIH0gKTtcclxufTtcclxuXHJcbnBhcnNlQ1NWKCBmaWxlUGF0aCwgKCBlcnJvciwgZGF0YSApID0+IHtcclxuICBpZiAoIGVycm9yICkge1xyXG4gICAgY29uc29sZS5lcnJvciggJ0Vycm9yIHBhcnNpbmcgQ1NWOicsIGVycm9yICk7XHJcbiAgfVxyXG4gIGVsc2Uge1xyXG4gICAgY29uc3QgbG9jYWxlTWFpbkRhdGEgPSBkYXRhLm1hcCggcm93ID0+IHtcclxuICAgICAgbGV0IGxvY2FsZSA9IHJvd1sgMSBdO1xyXG4gICAgICBsZXQgdGhyZWVMZXR0ZXJMb2NhbGUgPSByb3dbIDIgXTtcclxuICAgICAgbGV0IGVuZ2xpc2hOYW1lID0gcm93WyAzIF07XHJcbiAgICAgIGxldCBsb2NhbGl6ZWROYW1lID0gcm93WyA0IF07XHJcbiAgICAgIGxldCBkaXJlY3Rpb24gPSByb3dbIDUgXTtcclxuICAgICAgY29uc3QgZmFsbGJhY2sgPSByb3dbIDYgXTtcclxuICAgICAgXHJcbiAgICAgIGxvY2FsZSA9IGxvY2FsZS50cmltKCk7XHJcblxyXG4gICAgICBpZiAoIGxvY2FsZS5sZW5ndGggIT09IDIgJiYgbG9jYWxlLmxlbmd0aCAhPT0gNSApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGBJbnZhbGlkIGxvY2FsZTogJHtKU09OLnN0cmluZ2lmeSggbG9jYWxlICl9YCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoICFsb2NhbGVbIDAgXS5tYXRjaCggL1thLXpdLyApICkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvciggYEludmFsaWQgbG9jYWxlOiAke2xvY2FsZX1gICk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCAhbG9jYWxlWyAxIF0ubWF0Y2goIC9bYS16XS8gKSApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGBJbnZhbGlkIGxvY2FsZTogJHtsb2NhbGV9YCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIGxvY2FsZS5sZW5ndGggPT09IDUgKSB7XHJcbiAgICAgICAgaWYgKCBsb2NhbGVbIDIgXSAhPT0gJ18nICkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBgSW52YWxpZCBsb2NhbGU6ICR7bG9jYWxlfWAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCAhbG9jYWxlWyAzIF0ubWF0Y2goIC9bQS1aXS8gKSApIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvciggYEludmFsaWQgbG9jYWxlOiAke2xvY2FsZX1gICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICggIWxvY2FsZVsgNCBdLm1hdGNoKCAvW0EtWl0vICkgKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGBJbnZhbGlkIGxvY2FsZTogJHtsb2NhbGV9YCApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgdGhyZWVMZXR0ZXJMb2NhbGUgPSB0aHJlZUxldHRlckxvY2FsZS50cmltKCk7IC8vIHJlbW92ZSB0YWJcclxuXHJcbiAgICAgIGlmICggdGhyZWVMZXR0ZXJMb2NhbGUubGVuZ3RoID09PSA1ICYmIGxvY2FsZSA9PT0gdGhyZWVMZXR0ZXJMb2NhbGUgKSB7XHJcbiAgICAgICAgdGhyZWVMZXR0ZXJMb2NhbGUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCB0aHJlZUxldHRlckxvY2FsZS5sZW5ndGggPT09IDAgKSB7XHJcbiAgICAgICAgdGhyZWVMZXR0ZXJMb2NhbGUgPSBudWxsO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIHRocmVlTGV0dGVyTG9jYWxlICE9PSBudWxsICkge1xyXG4gICAgICAgIGlmICggdGhyZWVMZXR0ZXJMb2NhbGUubGVuZ3RoICE9PSAzICkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBgSW52YWxpZCB0aHJlZS1sZXR0ZXIgbG9jYWxlOiAke0pTT04uc3RyaW5naWZ5KCByb3cgKX1gICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoICF0aHJlZUxldHRlckxvY2FsZS5tYXRjaCggL15bYS16XXszfSQvICkgKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGBJbnZhbGlkIHRocmVlLWxldHRlciBsb2NhbGU6ICR7SlNPTi5zdHJpbmdpZnkoIHJvdyApfWAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGVuZ2xpc2hOYW1lID0gZW5nbGlzaE5hbWUudHJpbSgpLnJlcGxhY2UoIC9cXHUwMEEwL2csICcgJyApO1xyXG5cclxuICAgICAgaWYgKCBlbmdsaXNoTmFtZS5sZW5ndGggPCAxICkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvciggYEludmFsaWQgRW5nbGlzaCBuYW1lOiAke0pTT04uc3RyaW5naWZ5KCByb3cgKX1gICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxvY2FsaXplZE5hbWUgPSBsb2NhbGl6ZWROYW1lLnRyaW0oKS5yZXBsYWNlKCAvXFx1MDBBMC9nLCAnICcgKTtcclxuXHJcbiAgICAgIGlmICggbG9jYWxpemVkTmFtZS5sZW5ndGggPCAxICkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvciggYEludmFsaWQgbG9jYWxpemVkIG5hbWU6ICR7SlNPTi5zdHJpbmdpZnkoIHJvdyApfWAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gcGF0Y2ggaW5cclxuICAgICAgaWYgKCBsb2NhbGUgPT09ICdwdF9TVCcgKSB7XHJcbiAgICAgICAgZGlyZWN0aW9uID0gJ2x0cic7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICggZGlyZWN0aW9uICE9PSAnbHRyJyAmJiBkaXJlY3Rpb24gIT09ICdydGwnICkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvciggYEludmFsaWQgZGlyZWN0aW9uOiAke0pTT04uc3RyaW5naWZ5KCByb3cgKX1gICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGZhbGxiYWNrTG9jYWxlcyA9IGZhbGxiYWNrLnRyaW0oKS5zcGxpdCggJywnICkubWFwKCB4ID0+IHgudHJpbSgpICkuZmlsdGVyKCBsID0+IGwgIT09ICdlbicgKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHtcclxuICAgICAgICBsb2NhbGU6IGxvY2FsZVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWYgKCB0aHJlZUxldHRlckxvY2FsZSApIHtcclxuICAgICAgICByZXN1bHQubG9jYWxlMyA9IHRocmVlTGV0dGVyTG9jYWxlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXN1bHQuZW5nbGlzaE5hbWUgPSBlbmdsaXNoTmFtZTtcclxuICAgICAgcmVzdWx0LmxvY2FsaXplZE5hbWUgPSBsb2NhbGl6ZWROYW1lO1xyXG4gICAgICByZXN1bHQuZGlyZWN0aW9uID0gZGlyZWN0aW9uO1xyXG5cclxuICAgICAgaWYgKCBmYWxsYmFja0xvY2FsZXMubGVuZ3RoICkge1xyXG4gICAgICAgIHJlc3VsdC5mYWxsYmFja0xvY2FsZXMgPSBmYWxsYmFja0xvY2FsZXM7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgbG9jYWxlTWFpbkRhdGEuZm9yRWFjaCggbG9jYWxlRGF0YSA9PiB7XHJcbiAgICAgIGxvY2FsZURhdGEuZmFsbGJhY2tMb2NhbGVzICYmIGxvY2FsZURhdGEuZmFsbGJhY2tMb2NhbGVzLmZvckVhY2goIGZhbGxiYWNrTG9jYWxlID0+IHtcclxuICAgICAgICBpZiAoICFsb2NhbGVNYWluRGF0YS5maW5kKCB4ID0+IHgubG9jYWxlID09PSBmYWxsYmFja0xvY2FsZSApICkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBgSW52YWxpZCBmYWxsYmFjayBsb2NhbGU6ICR7SlNPTi5zdHJpbmdpZnkoIGxvY2FsZURhdGEgKX1gICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgbG9jYWxlTWFpbkRhdGEuc29ydCggKCBhLCBiICkgPT4ge1xyXG4gICAgICByZXR1cm4gYS5sb2NhbGUubG9jYWxlQ29tcGFyZSggYi5sb2NhbGUgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBsb2NhbGVJbmZvID0ge307XHJcblxyXG4gICAgbG9jYWxlTWFpbkRhdGEuZm9yRWFjaCggbG9jYWxlRGF0YSA9PiB7XHJcbiAgICAgIGNvbnN0IGxvY2FsZSA9IGxvY2FsZURhdGEubG9jYWxlO1xyXG4gICAgICBkZWxldGUgbG9jYWxlRGF0YS5sb2NhbGU7XHJcbiAgICAgIGxvY2FsZUluZm9bIGxvY2FsZSBdID0gbG9jYWxlRGF0YTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBsb2NhbGVJbmZvU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoIGxvY2FsZUluZm8sIG51bGwsIDIgKTtcclxuICAgIGNvbnNvbGUubG9nKCBsb2NhbGVJbmZvU3RyaW5nICk7XHJcblxyXG4gICAgLy8gbGVnYWN5IGxvY2FsZUluZm8uanMsIHRoYXQgd2lsbCBiZSBwcm9wYWdhdGVkIHRvIHRoZSBvdGhlciBjb3BpZXNcclxuICAgIHtcclxuICAgICAgY29uc3QgbGVnYWN5TG9jYWxlSW5mb1ByaW1hcnlGaWxlbmFtZSA9ICcuLi9jaGlwcGVyL2pzL2RhdGEvbG9jYWxlSW5mby5qcyc7XHJcblxyXG4gICAgICBpZiAoICFmcy5leGlzdHNTeW5jKCBsZWdhY3lMb2NhbGVJbmZvUHJpbWFyeUZpbGVuYW1lICkgKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBgRXhwZWN0ZWQgdG8gZmluZCAke2xlZ2FjeUxvY2FsZUluZm9QcmltYXJ5RmlsZW5hbWV9YCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBsZWdhY3lMb2NhbGVJbmZvUHJpbWFyeSA9IGZzLnJlYWRGaWxlU3luYyggbGVnYWN5TG9jYWxlSW5mb1ByaW1hcnlGaWxlbmFtZSwgJ3V0ZjgnICk7XHJcblxyXG4gICAgICBjb25zdCBzdGFydEluZGV4ID0gbGVnYWN5TG9jYWxlSW5mb1ByaW1hcnkuaW5kZXhPZiggJ2NvbnN0IGxvY2FsZXMgPSB7JyApO1xyXG4gICAgICBjb25zdCBlbmRJbmRleCA9IGxlZ2FjeUxvY2FsZUluZm9QcmltYXJ5LmluZGV4T2YoICdtb2R1bGUuZXhwb3J0cyA9IGxvY2FsZXM7Jywgc3RhcnRJbmRleCApO1xyXG5cclxuICAgICAgaWYgKCBzdGFydEluZGV4ID09PSAtMSB8fCBlbmRJbmRleCA9PT0gLTEgKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAnRmFpbGVkIHRvIGZpbmQgbG9jYWxlSW5mby5qcyBsb2NhbGVzIG9iamVjdCcgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IHJlcGxhY2VtZW50ID0gJ2NvbnN0IGxvY2FsZXMgPSB7XFxuJztcclxuXHJcbiAgICAgIGZvciAoIGNvbnN0IGxvY2FsZSBpbiBsb2NhbGVJbmZvICkge1xyXG4gICAgICAgIHJlcGxhY2VtZW50ICs9IGAgICR7bG9jYWxlfToge1xcbmA7XHJcbiAgICAgICAgcmVwbGFjZW1lbnQgKz0gYCAgICBuYW1lOiAnJHtsb2NhbGVJbmZvWyBsb2NhbGUgXS5lbmdsaXNoTmFtZS5yZXBsYWNlKCAvJy9nLCAnXFxcXFxcJycgKX0nLFxcbmA7XHJcbiAgICAgICAgcmVwbGFjZW1lbnQgKz0gYCAgICBsb2NhbGl6ZWROYW1lOiAnJHtsb2NhbGVJbmZvWyBsb2NhbGUgXS5sb2NhbGl6ZWROYW1lLnJlcGxhY2UoIC8nL2csICdcXFxcXFwnJyApfScsXFxuYDtcclxuICAgICAgICByZXBsYWNlbWVudCArPSBgICAgIGRpcmVjdGlvbjogJyR7bG9jYWxlSW5mb1sgbG9jYWxlIF0uZGlyZWN0aW9ufSdcXG5gO1xyXG4gICAgICAgIHJlcGxhY2VtZW50ICs9ICcgIH0sXFxuJztcclxuICAgICAgfVxyXG5cclxuICAgICAgcmVwbGFjZW1lbnQgKz0gJ307XFxuXFxuJztcclxuXHJcbiAgICAgIGNvbnN0IG5ld0xvY2FsZUluZm9QcmltYXJ5ID0gbGVnYWN5TG9jYWxlSW5mb1ByaW1hcnkuc3Vic3RyaW5nKCAwLCBzdGFydEluZGV4ICkgKyByZXBsYWNlbWVudCArIGxlZ2FjeUxvY2FsZUluZm9QcmltYXJ5LnN1YnN0cmluZyggZW5kSW5kZXggKTtcclxuXHJcbiAgICAgIGZzLndyaXRlRmlsZVN5bmMoIGxlZ2FjeUxvY2FsZUluZm9QcmltYXJ5RmlsZW5hbWUsIG5ld0xvY2FsZUluZm9QcmltYXJ5LCAndXRmOCcgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBOZXcgYmFiZWwgbG9jYWxlRGF0YVxyXG4gICAge1xyXG4gICAgICBjb25zdCBiYWJlbEV4dGVuZGVkTG9jYWxlSW5mb0ZpbGVuYW1lID0gJy4uL2JhYmVsL2xvY2FsZURhdGEuanNvbic7XHJcblxyXG4gICAgICBmcy53cml0ZUZpbGVTeW5jKCBiYWJlbEV4dGVuZGVkTG9jYWxlSW5mb0ZpbGVuYW1lLCBsb2NhbGVJbmZvU3RyaW5nICk7XHJcbiAgICB9XHJcbiAgfVxyXG59ICk7Il0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUVBLElBQU1BLEVBQUUsR0FBR0MsT0FBTyxDQUFFLElBQUssQ0FBQztBQUMxQjtBQUNBLElBQU1DLEdBQUcsR0FBR0QsT0FBTyxDQUFFLFlBQWEsQ0FBQztBQUVuQyxJQUFNRSxRQUFRLEdBQUdDLE9BQU8sQ0FBQ0MsSUFBSSxDQUFFLENBQUMsQ0FBRTs7QUFFbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxJQUFNQyxRQUFRLEdBQUcsU0FBWEEsUUFBUUEsQ0FBS0gsUUFBUSxFQUFFSSxRQUFRLEVBQU07RUFDekMsSUFBTUMsSUFBSSxHQUFHLEVBQUU7RUFFZlIsRUFBRSxDQUFDUyxnQkFBZ0IsQ0FBRU4sUUFBUyxDQUFDLENBQzVCTyxJQUFJLENBQUVSLEdBQUcsQ0FBQyxDQUFFLENBQUMsQ0FDYlMsRUFBRSxDQUFFLE1BQU0sRUFBRSxVQUFBQyxHQUFHLEVBQUk7SUFDbEIsSUFBTUMsTUFBTSxHQUFHQyxNQUFNLENBQUNELE1BQU0sQ0FBRUQsR0FBSSxDQUFDO0lBQ25DSixJQUFJLENBQUNPLElBQUksQ0FBRUYsTUFBTyxDQUFDO0VBQ3JCLENBQUUsQ0FBQyxDQUNGRixFQUFFLENBQUUsS0FBSyxFQUFFLFlBQU07SUFDaEJKLFFBQVEsQ0FBRSxJQUFJLEVBQUVDLElBQUssQ0FBQztFQUN4QixDQUFFLENBQUMsQ0FDRkcsRUFBRSxDQUFFLE9BQU8sRUFBRSxV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