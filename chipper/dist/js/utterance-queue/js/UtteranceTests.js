// Copyright 2019-2024, University of Colorado Boulder

/**
 * QUnit tests for Utterance and UtteranceQueue that use AriaLiveAnnouncer as the Announcer.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import stepTimer from '../../axon/js/stepTimer.js';
import AriaLiveAnnouncer from './AriaLiveAnnouncer.js';
import responseCollector from './responseCollector.js';
import ResponsePacket from './ResponsePacket.js';
import Utterance from './Utterance.js';
import UtteranceQueue from './UtteranceQueue.js';
import UtteranceQueueTestUtils from './UtteranceQueueTestUtils.js';
let sleepTiming = 0;
const ariaLiveAnnouncer = new AriaLiveAnnouncer({
  respectResponseCollectorProperties: true
});
const utteranceQueue = new UtteranceQueue(ariaLiveAnnouncer);

// helper es6 functions from  https://stackoverflow.com/questions/33289726/combination-of-async-function-await-settimeout/33292942
function timeout(ms) {
  return new Promise(resolve => setTimeout(resolve, ms)); // eslint-disable-line bad-sim-text
}
let alerts = [];
let intervalID;
QUnit.module('Utterance', {
  before() {
    // timer step in seconds, stepped 60 times per second
    const timerInterval = 1 / 60;

    // step the timer, because utteranceQueue runs on timer
    let previousTime = Date.now(); // in ms

    intervalID = window.setInterval(() => {
      // eslint-disable-line bad-sim-text

      // in ms
      const currentTime = Date.now();
      const elapsedTime = currentTime - previousTime;
      stepTimer.emit(elapsedTime / 1000); // step timer in seconds

      previousTime = currentTime;
    }, timerInterval * 1000);

    // whenever announcing, get a callback and populate the alerts array
    ariaLiveAnnouncer.announcementCompleteEmitter.addListener(utterance => {
      alerts.unshift(utterance['previousAlertText'] + '');
    });

    // slightly slower than the interval that the utteranceQueue will wait so we don't have a race condition
    sleepTiming = AriaLiveAnnouncer.ARIA_LIVE_DELAY * 1.5;
  },
  async beforeEach() {
    // clear the alerts before each new test
    alerts = [];
    utteranceQueue.clear();
    responseCollector.reset();

    // Apply some workarounds that will hopefully make the tests more consistent when running on CT,
    // see https://github.com/phetsims/utterance-queue/issues/115.
    await UtteranceQueueTestUtils.beforeEachTimingWorkarounds();

    // A workaround for unit tests, we want to be able to test the queue without the 'announceImmediately' feature
    // (which is necessary for browser compatability).
    ariaLiveAnnouncer.hasSpoken = true;

    // wait for the Announcer to be ready to speak again
    await timeout(sleepTiming);
  },
  after() {
    clearInterval(intervalID);
  }
});
QUnit.test('Basic Utterance testing', async assert => {
  // for this test, we just want to verify that the alert makes it through to ariaLiveAnnouncer
  const alertContent = 'hi';
  const utterance = new Utterance({
    alert: alertContent,
    alertStableDelay: 0 // alert as fast as possible
  });
  utteranceQueue.addToBack(utterance);
  await timeout(sleepTiming);
  assert.ok(alerts[0] === alertContent, 'first alert made it to ariaLiveAnnouncer');
  const otherAlert = 'alert';
  utterance.alert = otherAlert;
  utteranceQueue.addToBack(utterance);
  await timeout(sleepTiming);
  assert.ok(alerts[0] === otherAlert, 'second alert made it to ariaLiveAnnouncer');
  utterance.reset();
  assert.ok(utterance['previousAlertText'] === null, 'previousAlertText reset');
});
QUnit.test('alertStable and alertStableDelay tests', async assert => {
  const highFrequencyUtterance = new Utterance({
    alert: 'Rapidly Changing',
    alertStableDelay: 0 // we want to hear the utterance every time it is added to the queue
  });
  const numAlerts = 4;

  // add the utterance to the back many times, by default they should collapse
  for (let i = 0; i < numAlerts; i++) {
    utteranceQueue.addToBack(highFrequencyUtterance);
  }
  assert.ok(utteranceQueue['queue'].length === 1, 'utterances should collapse by default after addToBack');
  await timeout(sleepTiming);

  // cleanup step
  assert.ok(utteranceQueue['queue'].length === 0, 'cleared queue');

  /////////////////////////////////////////

  alerts = [];
  const stableDelay = sleepTiming * 3.1; // slightly longer than 3x
  const myUtterance = new Utterance({
    alert: 'hi',
    alertStableDelay: stableDelay
  });
  for (let i = 0; i < 100; i++) {
    utteranceQueue.addToBack(myUtterance);
  }
  assert.ok(utteranceQueue['queue'].length === 1, 'same Utterance should override in queue');
  await timeout(sleepTiming);

  // The wrapper has the timing variables
  const utteranceWrapper = utteranceQueue['queue'][0];

  // It is a bit dependent on the system running as to if this sleep time will be too long to flush this one too.
  if (utteranceWrapper) {
    assert.ok(utteranceWrapper.stableTime >= utteranceWrapper.timeInQueue, 'utterance should be in queue for at least stableDelay');
    assert.ok(utteranceQueue['queue'].length === 1, 'Alert still in queue after waiting less than alertStableDelay but more than stepInterval.');
  }
  await timeout(stableDelay);
  assert.ok(utteranceQueue['queue'].length === 0, 'Utterance alerted after alertStableDelay time passed');
  assert.ok(alerts.length === 1, 'utterance ended up in alerts list');
  assert.ok(alerts[0] === myUtterance.alert, 'utterance text matches that which is expected');
});
QUnit.test('alertMaximumDelay tests', async assert => {
  const rapidlyChanging = 'Rapidly Changing';
  const highFrequencyUtterance = new Utterance({
    alert: rapidlyChanging,
    alertStableDelay: 200,
    alertMaximumDelay: 300
  });
  utteranceQueue.addToBack(highFrequencyUtterance);
  assert.ok(utteranceQueue['queue'].length === 1, 'sanity 1');
  await timeout(100);
  assert.ok(utteranceQueue['queue'].length === 1, 'still has it, not stable, not max');
  utteranceQueue.addToBack(highFrequencyUtterance);
  assert.ok(utteranceQueue['queue'].length === 1, 'sanity 2');
  await timeout(100);
  assert.ok(utteranceQueue['queue'].length === 1, 'still has it, not stable, not max, 2');
  utteranceQueue.addToBack(highFrequencyUtterance);
  assert.ok(utteranceQueue['queue'].length === 1, 'sanity 2');
  await timeout(150);
  assert.ok(utteranceQueue['queue'].length === 0, 'not stable, but past max');
  assert.ok(alerts[0] === rapidlyChanging, 'it was announced');
});
QUnit.test('announceImmediately', async assert => {
  const myUtteranceText = 'This is my utterance text';
  const myUtterance = new Utterance({
    alert: myUtteranceText
  });
  utteranceQueue.announceImmediately(myUtterance);
  assert.ok(utteranceQueue['queue'].length === 0, 'should not be added to the queue');
  assert.ok(alerts[0] === myUtteranceText, 'should be immediately alerted');
  utteranceQueue.addToBack(myUtterance);
  assert.ok(utteranceQueue['queue'].length === 1, 'one added to the queue');
  assert.ok(alerts.length === 1, 'still just one alert occurred');
  utteranceQueue.announceImmediately(myUtterance);

  // We expect myUtterance to still be in the queue because the announcer is not ready to announce yet.
  assert.ok(utteranceQueue['queue'].length === 1, 'announceImmediately removed duplicates, but myUtterance still in queue');

  ////////////////////
  // NOTE: Commented out because this final test was not working well with a very laggy browser when testing on CT. It
  // isn't too important anyways.
  //
  // // Give the utteranceQueue and announcer a moment to become ready to announce again to move the final utterance
  // // through the queue.
  // await timeout( sleepTiming + 100 );
  //
  // assert.ok( alerts.length === 2, 'myUtterance announced immediately when Announcer was ready' + JSON.stringify( alerts ) );
  // assert.ok( alerts[ 0 ] === myUtteranceText, 'announceImmediately Utterance was last alert' );
});
QUnit.test('ResponsePacket tests', async assert => {
  responseCollector.nameResponsesEnabledProperty.value = true;
  responseCollector.objectResponsesEnabledProperty.value = true;
  responseCollector.contextResponsesEnabledProperty.value = true;
  responseCollector.hintResponsesEnabledProperty.value = true;
  const NAME = 'name';
  const OBJECT = 'object';
  const CONTEXT = 'context';
  const HINT = 'hint';
  const utterance = new Utterance({
    alertStableDelay: 0,
    alert: new ResponsePacket({
      nameResponse: NAME,
      objectResponse: OBJECT,
      contextResponse: CONTEXT,
      hintResponse: HINT
    })
  });
  utteranceQueue.addToBack(utterance);
  await timeout(sleepTiming);
  assert.ok(alerts[0].includes(NAME), 'name expected');
  assert.ok(alerts[0].includes(OBJECT), 'object expected');
  assert.ok(alerts[0].includes(CONTEXT), 'context expected');
  assert.ok(alerts[0].includes(HINT), 'hint expected');
  responseCollector.nameResponsesEnabledProperty.value = false;
  utteranceQueue.addToBack(utterance);
  await timeout(sleepTiming);
  assert.ok(!alerts[0].includes(NAME), 'name expected');
  assert.ok(alerts[0].includes(OBJECT), 'object expected');
  assert.ok(alerts[0].includes(CONTEXT), 'context expected');
  assert.ok(alerts[0].includes(HINT), 'hint expected');
  responseCollector.nameResponsesEnabledProperty.value = false;
  responseCollector.objectResponsesEnabledProperty.value = false;
  responseCollector.contextResponsesEnabledProperty.value = false;
  responseCollector.hintResponsesEnabledProperty.value = true; // need something in order to alert

  utteranceQueue.addToBack(utterance);
  await timeout(sleepTiming);
  assert.ok(!alerts[0].includes(NAME), 'name not expected');
  assert.ok(!alerts[0].includes(OBJECT), 'object not expected');
  assert.ok(!alerts[0].includes(CONTEXT), 'context not expected');
  assert.ok(alerts[0] === HINT, 'hint expected');
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzdGVwVGltZXIiLCJBcmlhTGl2ZUFubm91bmNlciIsInJlc3BvbnNlQ29sbGVjdG9yIiwiUmVzcG9uc2VQYWNrZXQiLCJVdHRlcmFuY2UiLCJVdHRlcmFuY2VRdWV1ZSIsIlV0dGVyYW5jZVF1ZXVlVGVzdFV0aWxzIiwic2xlZXBUaW1pbmciLCJhcmlhTGl2ZUFubm91bmNlciIsInJlc3BlY3RSZXNwb25zZUNvbGxlY3RvclByb3BlcnRpZXMiLCJ1dHRlcmFuY2VRdWV1ZSIsInRpbWVvdXQiLCJtcyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImFsZXJ0cyIsImludGVydmFsSUQiLCJRVW5pdCIsIm1vZHVsZSIsImJlZm9yZSIsInRpbWVySW50ZXJ2YWwiLCJwcmV2aW91c1RpbWUiLCJEYXRlIiwibm93Iiwid2luZG93Iiwic2V0SW50ZXJ2YWwiLCJjdXJyZW50VGltZSIsImVsYXBzZWRUaW1lIiwiZW1pdCIsImFubm91bmNlbWVudENvbXBsZXRlRW1pdHRlciIsImFkZExpc3RlbmVyIiwidXR0ZXJhbmNlIiwidW5zaGlmdCIsIkFSSUFfTElWRV9ERUxBWSIsImJlZm9yZUVhY2giLCJjbGVhciIsInJlc2V0IiwiYmVmb3JlRWFjaFRpbWluZ1dvcmthcm91bmRzIiwiaGFzU3Bva2VuIiwiYWZ0ZXIiLCJjbGVhckludGVydmFsIiwidGVzdCIsImFzc2VydCIsImFsZXJ0Q29udGVudCIsImFsZXJ0IiwiYWxlcnRTdGFibGVEZWxheSIsImFkZFRvQmFjayIsIm9rIiwib3RoZXJBbGVydCIsImhpZ2hGcmVxdWVuY3lVdHRlcmFuY2UiLCJudW1BbGVydHMiLCJpIiwibGVuZ3RoIiwic3RhYmxlRGVsYXkiLCJteVV0dGVyYW5jZSIsInV0dGVyYW5jZVdyYXBwZXIiLCJzdGFibGVUaW1lIiwidGltZUluUXVldWUiLCJyYXBpZGx5Q2hhbmdpbmciLCJhbGVydE1heGltdW1EZWxheSIsIm15VXR0ZXJhbmNlVGV4dCIsImFubm91bmNlSW1tZWRpYXRlbHkiLCJuYW1lUmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5IiwidmFsdWUiLCJvYmplY3RSZXNwb25zZXNFbmFibGVkUHJvcGVydHkiLCJjb250ZXh0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5IiwiaGludFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eSIsIk5BTUUiLCJPQkpFQ1QiLCJDT05URVhUIiwiSElOVCIsIm5hbWVSZXNwb25zZSIsIm9iamVjdFJlc3BvbnNlIiwiY29udGV4dFJlc3BvbnNlIiwiaGludFJlc3BvbnNlIiwiaW5jbHVkZXMiXSwic291cmNlcyI6WyJVdHRlcmFuY2VUZXN0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBRVW5pdCB0ZXN0cyBmb3IgVXR0ZXJhbmNlIGFuZCBVdHRlcmFuY2VRdWV1ZSB0aGF0IHVzZSBBcmlhTGl2ZUFubm91bmNlciBhcyB0aGUgQW5ub3VuY2VyLlxyXG4gKlxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHN0ZXBUaW1lciBmcm9tICcuLi8uLi9heG9uL2pzL3N0ZXBUaW1lci5qcyc7XHJcbmltcG9ydCBBcmlhTGl2ZUFubm91bmNlciBmcm9tICcuL0FyaWFMaXZlQW5ub3VuY2VyLmpzJztcclxuaW1wb3J0IHJlc3BvbnNlQ29sbGVjdG9yIGZyb20gJy4vcmVzcG9uc2VDb2xsZWN0b3IuanMnO1xyXG5pbXBvcnQgUmVzcG9uc2VQYWNrZXQgZnJvbSAnLi9SZXNwb25zZVBhY2tldC5qcyc7XHJcbmltcG9ydCBVdHRlcmFuY2UgZnJvbSAnLi9VdHRlcmFuY2UuanMnO1xyXG5pbXBvcnQgVXR0ZXJhbmNlUXVldWUgZnJvbSAnLi9VdHRlcmFuY2VRdWV1ZS5qcyc7XHJcbmltcG9ydCBVdHRlcmFuY2VRdWV1ZVRlc3RVdGlscyBmcm9tICcuL1V0dGVyYW5jZVF1ZXVlVGVzdFV0aWxzLmpzJztcclxuXHJcbmxldCBzbGVlcFRpbWluZyA9IDA7XHJcblxyXG5jb25zdCBhcmlhTGl2ZUFubm91bmNlciA9IG5ldyBBcmlhTGl2ZUFubm91bmNlciggeyByZXNwZWN0UmVzcG9uc2VDb2xsZWN0b3JQcm9wZXJ0aWVzOiB0cnVlIH0gKTtcclxuY29uc3QgdXR0ZXJhbmNlUXVldWUgPSBuZXcgVXR0ZXJhbmNlUXVldWUoIGFyaWFMaXZlQW5ub3VuY2VyICk7XHJcblxyXG4vLyBoZWxwZXIgZXM2IGZ1bmN0aW9ucyBmcm9tICBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMzI4OTcyNi9jb21iaW5hdGlvbi1vZi1hc3luYy1mdW5jdGlvbi1hd2FpdC1zZXR0aW1lb3V0LzMzMjkyOTQyXHJcbmZ1bmN0aW9uIHRpbWVvdXQoIG1zOiBudW1iZXIgKTogUHJvbWlzZTx1bmtub3duPiB7XHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKCByZXNvbHZlID0+IHNldFRpbWVvdXQoIHJlc29sdmUsIG1zICkgKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBiYWQtc2ltLXRleHRcclxufVxyXG5cclxubGV0IGFsZXJ0czogc3RyaW5nW10gPSBbXTtcclxuXHJcbmxldCBpbnRlcnZhbElEOiBudW1iZXI7XHJcblFVbml0Lm1vZHVsZSggJ1V0dGVyYW5jZScsIHtcclxuICBiZWZvcmUoKSB7XHJcblxyXG4gICAgLy8gdGltZXIgc3RlcCBpbiBzZWNvbmRzLCBzdGVwcGVkIDYwIHRpbWVzIHBlciBzZWNvbmRcclxuICAgIGNvbnN0IHRpbWVySW50ZXJ2YWwgPSAxIC8gNjA7XHJcblxyXG4gICAgLy8gc3RlcCB0aGUgdGltZXIsIGJlY2F1c2UgdXR0ZXJhbmNlUXVldWUgcnVucyBvbiB0aW1lclxyXG4gICAgbGV0IHByZXZpb3VzVGltZSA9IERhdGUubm93KCk7IC8vIGluIG1zXHJcblxyXG4gICAgaW50ZXJ2YWxJRCA9IHdpbmRvdy5zZXRJbnRlcnZhbCggKCkgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGJhZC1zaW0tdGV4dFxyXG5cclxuICAgICAgLy8gaW4gbXNcclxuICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgICBjb25zdCBlbGFwc2VkVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xyXG5cclxuICAgICAgc3RlcFRpbWVyLmVtaXQoIGVsYXBzZWRUaW1lIC8gMTAwMCApOyAvLyBzdGVwIHRpbWVyIGluIHNlY29uZHNcclxuXHJcbiAgICAgIHByZXZpb3VzVGltZSA9IGN1cnJlbnRUaW1lO1xyXG4gICAgfSwgdGltZXJJbnRlcnZhbCAqIDEwMDAgKTtcclxuXHJcbiAgICAvLyB3aGVuZXZlciBhbm5vdW5jaW5nLCBnZXQgYSBjYWxsYmFjayBhbmQgcG9wdWxhdGUgdGhlIGFsZXJ0cyBhcnJheVxyXG4gICAgYXJpYUxpdmVBbm5vdW5jZXIuYW5ub3VuY2VtZW50Q29tcGxldGVFbWl0dGVyLmFkZExpc3RlbmVyKCB1dHRlcmFuY2UgPT4ge1xyXG4gICAgICBhbGVydHMudW5zaGlmdCggdXR0ZXJhbmNlWyAncHJldmlvdXNBbGVydFRleHQnIF0gKyAnJyApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHNsaWdodGx5IHNsb3dlciB0aGFuIHRoZSBpbnRlcnZhbCB0aGF0IHRoZSB1dHRlcmFuY2VRdWV1ZSB3aWxsIHdhaXQgc28gd2UgZG9uJ3QgaGF2ZSBhIHJhY2UgY29uZGl0aW9uXHJcbiAgICBzbGVlcFRpbWluZyA9IEFyaWFMaXZlQW5ub3VuY2VyLkFSSUFfTElWRV9ERUxBWSAqIDEuNTtcclxuICB9LFxyXG4gIGFzeW5jIGJlZm9yZUVhY2goKSB7XHJcblxyXG4gICAgLy8gY2xlYXIgdGhlIGFsZXJ0cyBiZWZvcmUgZWFjaCBuZXcgdGVzdFxyXG4gICAgYWxlcnRzID0gW107XHJcbiAgICB1dHRlcmFuY2VRdWV1ZS5jbGVhcigpO1xyXG4gICAgcmVzcG9uc2VDb2xsZWN0b3IucmVzZXQoKTtcclxuXHJcbiAgICAvLyBBcHBseSBzb21lIHdvcmthcm91bmRzIHRoYXQgd2lsbCBob3BlZnVsbHkgbWFrZSB0aGUgdGVzdHMgbW9yZSBjb25zaXN0ZW50IHdoZW4gcnVubmluZyBvbiBDVCxcclxuICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdXR0ZXJhbmNlLXF1ZXVlL2lzc3Vlcy8xMTUuXHJcbiAgICBhd2FpdCBVdHRlcmFuY2VRdWV1ZVRlc3RVdGlscy5iZWZvcmVFYWNoVGltaW5nV29ya2Fyb3VuZHMoKTtcclxuXHJcbiAgICAvLyBBIHdvcmthcm91bmQgZm9yIHVuaXQgdGVzdHMsIHdlIHdhbnQgdG8gYmUgYWJsZSB0byB0ZXN0IHRoZSBxdWV1ZSB3aXRob3V0IHRoZSAnYW5ub3VuY2VJbW1lZGlhdGVseScgZmVhdHVyZVxyXG4gICAgLy8gKHdoaWNoIGlzIG5lY2Vzc2FyeSBmb3IgYnJvd3NlciBjb21wYXRhYmlsaXR5KS5cclxuICAgIGFyaWFMaXZlQW5ub3VuY2VyLmhhc1Nwb2tlbiA9IHRydWU7XHJcblxyXG4gICAgLy8gd2FpdCBmb3IgdGhlIEFubm91bmNlciB0byBiZSByZWFkeSB0byBzcGVhayBhZ2FpblxyXG4gICAgYXdhaXQgdGltZW91dCggc2xlZXBUaW1pbmcgKTtcclxuICB9LFxyXG4gIGFmdGVyKCkge1xyXG4gICAgY2xlYXJJbnRlcnZhbCggaW50ZXJ2YWxJRCEgKTtcclxuICB9XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdCYXNpYyBVdHRlcmFuY2UgdGVzdGluZycsIGFzeW5jIGFzc2VydCA9PiB7XHJcblxyXG4gIC8vIGZvciB0aGlzIHRlc3QsIHdlIGp1c3Qgd2FudCB0byB2ZXJpZnkgdGhhdCB0aGUgYWxlcnQgbWFrZXMgaXQgdGhyb3VnaCB0byBhcmlhTGl2ZUFubm91bmNlclxyXG4gIGNvbnN0IGFsZXJ0Q29udGVudCA9ICdoaSc7XHJcbiAgY29uc3QgdXR0ZXJhbmNlID0gbmV3IFV0dGVyYW5jZSgge1xyXG4gICAgYWxlcnQ6IGFsZXJ0Q29udGVudCxcclxuICAgIGFsZXJ0U3RhYmxlRGVsYXk6IDAgLy8gYWxlcnQgYXMgZmFzdCBhcyBwb3NzaWJsZVxyXG4gIH0gKTtcclxuICB1dHRlcmFuY2VRdWV1ZS5hZGRUb0JhY2soIHV0dGVyYW5jZSApO1xyXG5cclxuICBhd2FpdCB0aW1lb3V0KCBzbGVlcFRpbWluZyApO1xyXG4gIGFzc2VydC5vayggYWxlcnRzWyAwIF0gPT09IGFsZXJ0Q29udGVudCwgJ2ZpcnN0IGFsZXJ0IG1hZGUgaXQgdG8gYXJpYUxpdmVBbm5vdW5jZXInICk7XHJcblxyXG4gIGNvbnN0IG90aGVyQWxlcnQgPSAnYWxlcnQnO1xyXG4gIHV0dGVyYW5jZS5hbGVydCA9IG90aGVyQWxlcnQ7XHJcbiAgdXR0ZXJhbmNlUXVldWUuYWRkVG9CYWNrKCB1dHRlcmFuY2UgKTtcclxuICBhd2FpdCB0aW1lb3V0KCBzbGVlcFRpbWluZyApO1xyXG4gIGFzc2VydC5vayggYWxlcnRzWyAwIF0gPT09IG90aGVyQWxlcnQsICdzZWNvbmQgYWxlcnQgbWFkZSBpdCB0byBhcmlhTGl2ZUFubm91bmNlcicgKTtcclxuXHJcbiAgdXR0ZXJhbmNlLnJlc2V0KCk7XHJcbiAgYXNzZXJ0Lm9rKCB1dHRlcmFuY2VbICdwcmV2aW91c0FsZXJ0VGV4dCcgXSA9PT0gbnVsbCwgJ3ByZXZpb3VzQWxlcnRUZXh0IHJlc2V0JyApO1xyXG59ICk7XHJcblxyXG5RVW5pdC50ZXN0KCAnYWxlcnRTdGFibGUgYW5kIGFsZXJ0U3RhYmxlRGVsYXkgdGVzdHMnLCBhc3luYyBhc3NlcnQgPT4ge1xyXG4gIGNvbnN0IGhpZ2hGcmVxdWVuY3lVdHRlcmFuY2UgPSBuZXcgVXR0ZXJhbmNlKCB7XHJcbiAgICBhbGVydDogJ1JhcGlkbHkgQ2hhbmdpbmcnLFxyXG4gICAgYWxlcnRTdGFibGVEZWxheTogMCAvLyB3ZSB3YW50IHRvIGhlYXIgdGhlIHV0dGVyYW5jZSBldmVyeSB0aW1lIGl0IGlzIGFkZGVkIHRvIHRoZSBxdWV1ZVxyXG4gIH0gKTtcclxuXHJcbiAgY29uc3QgbnVtQWxlcnRzID0gNDtcclxuXHJcbiAgLy8gYWRkIHRoZSB1dHRlcmFuY2UgdG8gdGhlIGJhY2sgbWFueSB0aW1lcywgYnkgZGVmYXVsdCB0aGV5IHNob3VsZCBjb2xsYXBzZVxyXG4gIGZvciAoIGxldCBpID0gMDsgaSA8IG51bUFsZXJ0czsgaSsrICkge1xyXG4gICAgdXR0ZXJhbmNlUXVldWUuYWRkVG9CYWNrKCBoaWdoRnJlcXVlbmN5VXR0ZXJhbmNlICk7XHJcbiAgfVxyXG4gIGFzc2VydC5vayggdXR0ZXJhbmNlUXVldWVbICdxdWV1ZScgXS5sZW5ndGggPT09IDEsICd1dHRlcmFuY2VzIHNob3VsZCBjb2xsYXBzZSBieSBkZWZhdWx0IGFmdGVyIGFkZFRvQmFjaycgKTtcclxuXHJcbiAgYXdhaXQgdGltZW91dCggc2xlZXBUaW1pbmcgKTtcclxuXHJcbiAgLy8gY2xlYW51cCBzdGVwXHJcbiAgYXNzZXJ0Lm9rKCB1dHRlcmFuY2VRdWV1ZVsgJ3F1ZXVlJyBdLmxlbmd0aCA9PT0gMCwgJ2NsZWFyZWQgcXVldWUnICk7XHJcblxyXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gIGFsZXJ0cyA9IFtdO1xyXG4gIGNvbnN0IHN0YWJsZURlbGF5ID0gc2xlZXBUaW1pbmcgKiAzLjE7IC8vIHNsaWdodGx5IGxvbmdlciB0aGFuIDN4XHJcbiAgY29uc3QgbXlVdHRlcmFuY2UgPSBuZXcgVXR0ZXJhbmNlKCB7XHJcbiAgICBhbGVydDogJ2hpJyxcclxuICAgIGFsZXJ0U3RhYmxlRGVsYXk6IHN0YWJsZURlbGF5XHJcbiAgfSApO1xyXG5cclxuICBmb3IgKCBsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKyApIHtcclxuICAgIHV0dGVyYW5jZVF1ZXVlLmFkZFRvQmFjayggbXlVdHRlcmFuY2UgKTtcclxuICB9XHJcblxyXG4gIGFzc2VydC5vayggdXR0ZXJhbmNlUXVldWVbICdxdWV1ZScgXS5sZW5ndGggPT09IDEsICdzYW1lIFV0dGVyYW5jZSBzaG91bGQgb3ZlcnJpZGUgaW4gcXVldWUnICk7XHJcbiAgYXdhaXQgdGltZW91dCggc2xlZXBUaW1pbmcgKTtcclxuXHJcbiAgLy8gVGhlIHdyYXBwZXIgaGFzIHRoZSB0aW1pbmcgdmFyaWFibGVzXHJcbiAgY29uc3QgdXR0ZXJhbmNlV3JhcHBlciA9IHV0dGVyYW5jZVF1ZXVlWyAncXVldWUnIF1bIDAgXTtcclxuXHJcbiAgLy8gSXQgaXMgYSBiaXQgZGVwZW5kZW50IG9uIHRoZSBzeXN0ZW0gcnVubmluZyBhcyB0byBpZiB0aGlzIHNsZWVwIHRpbWUgd2lsbCBiZSB0b28gbG9uZyB0byBmbHVzaCB0aGlzIG9uZSB0b28uXHJcbiAgaWYgKCB1dHRlcmFuY2VXcmFwcGVyICkge1xyXG4gICAgYXNzZXJ0Lm9rKCB1dHRlcmFuY2VXcmFwcGVyLnN0YWJsZVRpbWUgPj0gdXR0ZXJhbmNlV3JhcHBlci50aW1lSW5RdWV1ZSwgJ3V0dGVyYW5jZSBzaG91bGQgYmUgaW4gcXVldWUgZm9yIGF0IGxlYXN0IHN0YWJsZURlbGF5JyApO1xyXG5cclxuICAgIGFzc2VydC5vayggdXR0ZXJhbmNlUXVldWVbICdxdWV1ZScgXS5sZW5ndGggPT09IDEsICdBbGVydCBzdGlsbCBpbiBxdWV1ZSBhZnRlciB3YWl0aW5nIGxlc3MgdGhhbiBhbGVydFN0YWJsZURlbGF5IGJ1dCBtb3JlIHRoYW4gc3RlcEludGVydmFsLicgKTtcclxuICB9XHJcbiAgYXdhaXQgdGltZW91dCggc3RhYmxlRGVsYXkgKTtcclxuXHJcbiAgYXNzZXJ0Lm9rKCB1dHRlcmFuY2VRdWV1ZVsgJ3F1ZXVlJyBdLmxlbmd0aCA9PT0gMCwgJ1V0dGVyYW5jZSBhbGVydGVkIGFmdGVyIGFsZXJ0U3RhYmxlRGVsYXkgdGltZSBwYXNzZWQnICk7XHJcbiAgYXNzZXJ0Lm9rKCBhbGVydHMubGVuZ3RoID09PSAxLCAndXR0ZXJhbmNlIGVuZGVkIHVwIGluIGFsZXJ0cyBsaXN0JyApO1xyXG4gIGFzc2VydC5vayggYWxlcnRzWyAwIF0gPT09IG15VXR0ZXJhbmNlLmFsZXJ0LCAndXR0ZXJhbmNlIHRleHQgbWF0Y2hlcyB0aGF0IHdoaWNoIGlzIGV4cGVjdGVkJyApO1xyXG59ICk7XHJcblxyXG5RVW5pdC50ZXN0KCAnYWxlcnRNYXhpbXVtRGVsYXkgdGVzdHMnLCBhc3luYyBhc3NlcnQgPT4ge1xyXG4gIGNvbnN0IHJhcGlkbHlDaGFuZ2luZyA9ICdSYXBpZGx5IENoYW5naW5nJztcclxuICBjb25zdCBoaWdoRnJlcXVlbmN5VXR0ZXJhbmNlID0gbmV3IFV0dGVyYW5jZSgge1xyXG4gICAgYWxlcnQ6IHJhcGlkbHlDaGFuZ2luZyxcclxuICAgIGFsZXJ0U3RhYmxlRGVsYXk6IDIwMCxcclxuICAgIGFsZXJ0TWF4aW11bURlbGF5OiAzMDBcclxuICB9ICk7XHJcblxyXG4gIHV0dGVyYW5jZVF1ZXVlLmFkZFRvQmFjayggaGlnaEZyZXF1ZW5jeVV0dGVyYW5jZSApO1xyXG4gIGFzc2VydC5vayggdXR0ZXJhbmNlUXVldWVbICdxdWV1ZScgXS5sZW5ndGggPT09IDEsICdzYW5pdHkgMScgKTtcclxuICBhd2FpdCB0aW1lb3V0KCAxMDAgKTtcclxuICBhc3NlcnQub2soIHV0dGVyYW5jZVF1ZXVlWyAncXVldWUnIF0ubGVuZ3RoID09PSAxLCAnc3RpbGwgaGFzIGl0LCBub3Qgc3RhYmxlLCBub3QgbWF4JyApO1xyXG4gIHV0dGVyYW5jZVF1ZXVlLmFkZFRvQmFjayggaGlnaEZyZXF1ZW5jeVV0dGVyYW5jZSApO1xyXG4gIGFzc2VydC5vayggdXR0ZXJhbmNlUXVldWVbICdxdWV1ZScgXS5sZW5ndGggPT09IDEsICdzYW5pdHkgMicgKTtcclxuICBhd2FpdCB0aW1lb3V0KCAxMDAgKTtcclxuICBhc3NlcnQub2soIHV0dGVyYW5jZVF1ZXVlWyAncXVldWUnIF0ubGVuZ3RoID09PSAxLCAnc3RpbGwgaGFzIGl0LCBub3Qgc3RhYmxlLCBub3QgbWF4LCAyJyApO1xyXG4gIHV0dGVyYW5jZVF1ZXVlLmFkZFRvQmFjayggaGlnaEZyZXF1ZW5jeVV0dGVyYW5jZSApO1xyXG4gIGFzc2VydC5vayggdXR0ZXJhbmNlUXVldWVbICdxdWV1ZScgXS5sZW5ndGggPT09IDEsICdzYW5pdHkgMicgKTtcclxuICBhd2FpdCB0aW1lb3V0KCAxNTAgKTtcclxuICBhc3NlcnQub2soIHV0dGVyYW5jZVF1ZXVlWyAncXVldWUnIF0ubGVuZ3RoID09PSAwLCAnbm90IHN0YWJsZSwgYnV0IHBhc3QgbWF4JyApO1xyXG4gIGFzc2VydC5vayggYWxlcnRzWyAwIF0gPT09IHJhcGlkbHlDaGFuZ2luZywgJ2l0IHdhcyBhbm5vdW5jZWQnICk7XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdhbm5vdW5jZUltbWVkaWF0ZWx5JywgYXN5bmMgYXNzZXJ0ID0+IHtcclxuICBjb25zdCBteVV0dGVyYW5jZVRleHQgPSAnVGhpcyBpcyBteSB1dHRlcmFuY2UgdGV4dCc7XHJcbiAgY29uc3QgbXlVdHRlcmFuY2UgPSBuZXcgVXR0ZXJhbmNlKCB7IGFsZXJ0OiBteVV0dGVyYW5jZVRleHQgfSApO1xyXG5cclxuICB1dHRlcmFuY2VRdWV1ZS5hbm5vdW5jZUltbWVkaWF0ZWx5KCBteVV0dGVyYW5jZSApO1xyXG4gIGFzc2VydC5vayggdXR0ZXJhbmNlUXVldWVbICdxdWV1ZScgXS5sZW5ndGggPT09IDAsICdzaG91bGQgbm90IGJlIGFkZGVkIHRvIHRoZSBxdWV1ZScgKTtcclxuICBhc3NlcnQub2soIGFsZXJ0c1sgMCBdID09PSBteVV0dGVyYW5jZVRleHQsICdzaG91bGQgYmUgaW1tZWRpYXRlbHkgYWxlcnRlZCcgKTtcclxuXHJcbiAgdXR0ZXJhbmNlUXVldWUuYWRkVG9CYWNrKCBteVV0dGVyYW5jZSApO1xyXG4gIGFzc2VydC5vayggdXR0ZXJhbmNlUXVldWVbICdxdWV1ZScgXS5sZW5ndGggPT09IDEsICdvbmUgYWRkZWQgdG8gdGhlIHF1ZXVlJyApO1xyXG4gIGFzc2VydC5vayggYWxlcnRzLmxlbmd0aCA9PT0gMSwgJ3N0aWxsIGp1c3Qgb25lIGFsZXJ0IG9jY3VycmVkJyApO1xyXG4gIHV0dGVyYW5jZVF1ZXVlLmFubm91bmNlSW1tZWRpYXRlbHkoIG15VXR0ZXJhbmNlICk7XHJcblxyXG4gIC8vIFdlIGV4cGVjdCBteVV0dGVyYW5jZSB0byBzdGlsbCBiZSBpbiB0aGUgcXVldWUgYmVjYXVzZSB0aGUgYW5ub3VuY2VyIGlzIG5vdCByZWFkeSB0byBhbm5vdW5jZSB5ZXQuXHJcbiAgYXNzZXJ0Lm9rKCB1dHRlcmFuY2VRdWV1ZVsgJ3F1ZXVlJyBdLmxlbmd0aCA9PT0gMSwgJ2Fubm91bmNlSW1tZWRpYXRlbHkgcmVtb3ZlZCBkdXBsaWNhdGVzLCBidXQgbXlVdHRlcmFuY2Ugc3RpbGwgaW4gcXVldWUnICk7XHJcblxyXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgLy8gTk9URTogQ29tbWVudGVkIG91dCBiZWNhdXNlIHRoaXMgZmluYWwgdGVzdCB3YXMgbm90IHdvcmtpbmcgd2VsbCB3aXRoIGEgdmVyeSBsYWdneSBicm93c2VyIHdoZW4gdGVzdGluZyBvbiBDVC4gSXRcclxuICAvLyBpc24ndCB0b28gaW1wb3J0YW50IGFueXdheXMuXHJcbiAgLy9cclxuICAvLyAvLyBHaXZlIHRoZSB1dHRlcmFuY2VRdWV1ZSBhbmQgYW5ub3VuY2VyIGEgbW9tZW50IHRvIGJlY29tZSByZWFkeSB0byBhbm5vdW5jZSBhZ2FpbiB0byBtb3ZlIHRoZSBmaW5hbCB1dHRlcmFuY2VcclxuICAvLyAvLyB0aHJvdWdoIHRoZSBxdWV1ZS5cclxuICAvLyBhd2FpdCB0aW1lb3V0KCBzbGVlcFRpbWluZyArIDEwMCApO1xyXG4gIC8vXHJcbiAgLy8gYXNzZXJ0Lm9rKCBhbGVydHMubGVuZ3RoID09PSAyLCAnbXlVdHRlcmFuY2UgYW5ub3VuY2VkIGltbWVkaWF0ZWx5IHdoZW4gQW5ub3VuY2VyIHdhcyByZWFkeScgKyBKU09OLnN0cmluZ2lmeSggYWxlcnRzICkgKTtcclxuICAvLyBhc3NlcnQub2soIGFsZXJ0c1sgMCBdID09PSBteVV0dGVyYW5jZVRleHQsICdhbm5vdW5jZUltbWVkaWF0ZWx5IFV0dGVyYW5jZSB3YXMgbGFzdCBhbGVydCcgKTtcclxufSApO1xyXG5cclxuXHJcblFVbml0LnRlc3QoICdSZXNwb25zZVBhY2tldCB0ZXN0cycsIGFzeW5jIGFzc2VydCA9PiB7XHJcbiAgcmVzcG9uc2VDb2xsZWN0b3IubmFtZVJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcbiAgcmVzcG9uc2VDb2xsZWN0b3Iub2JqZWN0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICByZXNwb25zZUNvbGxlY3Rvci5jb250ZXh0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICByZXNwb25zZUNvbGxlY3Rvci5oaW50UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuXHJcbiAgY29uc3QgTkFNRSA9ICduYW1lJztcclxuICBjb25zdCBPQkpFQ1QgPSAnb2JqZWN0JztcclxuICBjb25zdCBDT05URVhUID0gJ2NvbnRleHQnO1xyXG4gIGNvbnN0IEhJTlQgPSAnaGludCc7XHJcbiAgY29uc3QgdXR0ZXJhbmNlID0gbmV3IFV0dGVyYW5jZSgge1xyXG4gICAgYWxlcnRTdGFibGVEZWxheTogMCxcclxuICAgIGFsZXJ0OiBuZXcgUmVzcG9uc2VQYWNrZXQoIHtcclxuICAgICAgbmFtZVJlc3BvbnNlOiBOQU1FLFxyXG4gICAgICBvYmplY3RSZXNwb25zZTogT0JKRUNULFxyXG4gICAgICBjb250ZXh0UmVzcG9uc2U6IENPTlRFWFQsXHJcbiAgICAgIGhpbnRSZXNwb25zZTogSElOVFxyXG4gICAgfSApXHJcbiAgfSApO1xyXG5cclxuICB1dHRlcmFuY2VRdWV1ZS5hZGRUb0JhY2soIHV0dGVyYW5jZSApO1xyXG4gIGF3YWl0IHRpbWVvdXQoIHNsZWVwVGltaW5nICk7XHJcblxyXG4gIGFzc2VydC5vayggYWxlcnRzWyAwIF0uaW5jbHVkZXMoIE5BTUUgKSwgJ25hbWUgZXhwZWN0ZWQnICk7XHJcbiAgYXNzZXJ0Lm9rKCBhbGVydHNbIDAgXS5pbmNsdWRlcyggT0JKRUNUICksICdvYmplY3QgZXhwZWN0ZWQnICk7XHJcbiAgYXNzZXJ0Lm9rKCBhbGVydHNbIDAgXS5pbmNsdWRlcyggQ09OVEVYVCApLCAnY29udGV4dCBleHBlY3RlZCcgKTtcclxuICBhc3NlcnQub2soIGFsZXJ0c1sgMCBdLmluY2x1ZGVzKCBISU5UICksICdoaW50IGV4cGVjdGVkJyApO1xyXG5cclxuICByZXNwb25zZUNvbGxlY3Rvci5uYW1lUmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcblxyXG4gIHV0dGVyYW5jZVF1ZXVlLmFkZFRvQmFjayggdXR0ZXJhbmNlICk7XHJcbiAgYXdhaXQgdGltZW91dCggc2xlZXBUaW1pbmcgKTtcclxuXHJcbiAgYXNzZXJ0Lm9rKCAhYWxlcnRzWyAwIF0uaW5jbHVkZXMoIE5BTUUgKSwgJ25hbWUgZXhwZWN0ZWQnICk7XHJcbiAgYXNzZXJ0Lm9rKCBhbGVydHNbIDAgXS5pbmNsdWRlcyggT0JKRUNUICksICdvYmplY3QgZXhwZWN0ZWQnICk7XHJcbiAgYXNzZXJ0Lm9rKCBhbGVydHNbIDAgXS5pbmNsdWRlcyggQ09OVEVYVCApLCAnY29udGV4dCBleHBlY3RlZCcgKTtcclxuICBhc3NlcnQub2soIGFsZXJ0c1sgMCBdLmluY2x1ZGVzKCBISU5UICksICdoaW50IGV4cGVjdGVkJyApO1xyXG5cclxuICByZXNwb25zZUNvbGxlY3Rvci5uYW1lUmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgcmVzcG9uc2VDb2xsZWN0b3Iub2JqZWN0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgcmVzcG9uc2VDb2xsZWN0b3IuY29udGV4dFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eS52YWx1ZSA9IGZhbHNlO1xyXG4gIHJlc3BvbnNlQ29sbGVjdG9yLmhpbnRSZXNwb25zZXNFbmFibGVkUHJvcGVydHkudmFsdWUgPSB0cnVlOyAvLyBuZWVkIHNvbWV0aGluZyBpbiBvcmRlciB0byBhbGVydFxyXG5cclxuICB1dHRlcmFuY2VRdWV1ZS5hZGRUb0JhY2soIHV0dGVyYW5jZSApO1xyXG4gIGF3YWl0IHRpbWVvdXQoIHNsZWVwVGltaW5nICk7XHJcblxyXG4gIGFzc2VydC5vayggIWFsZXJ0c1sgMCBdLmluY2x1ZGVzKCBOQU1FICksICduYW1lIG5vdCBleHBlY3RlZCcgKTtcclxuICBhc3NlcnQub2soICFhbGVydHNbIDAgXS5pbmNsdWRlcyggT0JKRUNUICksICdvYmplY3Qgbm90IGV4cGVjdGVkJyApO1xyXG4gIGFzc2VydC5vayggIWFsZXJ0c1sgMCBdLmluY2x1ZGVzKCBDT05URVhUICksICdjb250ZXh0IG5vdCBleHBlY3RlZCcgKTtcclxuICBhc3NlcnQub2soIGFsZXJ0c1sgMCBdID09PSBISU5ULCAnaGludCBleHBlY3RlZCcgKTtcclxufSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0sNEJBQTRCO0FBQ2xELE9BQU9DLGlCQUFpQixNQUFNLHdCQUF3QjtBQUN0RCxPQUFPQyxpQkFBaUIsTUFBTSx3QkFBd0I7QUFDdEQsT0FBT0MsY0FBYyxNQUFNLHFCQUFxQjtBQUNoRCxPQUFPQyxTQUFTLE1BQU0sZ0JBQWdCO0FBQ3RDLE9BQU9DLGNBQWMsTUFBTSxxQkFBcUI7QUFDaEQsT0FBT0MsdUJBQXVCLE1BQU0sOEJBQThCO0FBRWxFLElBQUlDLFdBQVcsR0FBRyxDQUFDO0FBRW5CLE1BQU1DLGlCQUFpQixHQUFHLElBQUlQLGlCQUFpQixDQUFFO0VBQUVRLGtDQUFrQyxFQUFFO0FBQUssQ0FBRSxDQUFDO0FBQy9GLE1BQU1DLGNBQWMsR0FBRyxJQUFJTCxjQUFjLENBQUVHLGlCQUFrQixDQUFDOztBQUU5RDtBQUNBLFNBQVNHLE9BQU9BLENBQUVDLEVBQVUsRUFBcUI7RUFDL0MsT0FBTyxJQUFJQyxPQUFPLENBQUVDLE9BQU8sSUFBSUMsVUFBVSxD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LE1BQU1yQixPQUFPLENBQUVKLFdBQVksQ0FBQztFQUU1Qm9DLE1BQU0sQ0FBQ0ssRUFBRSxDQUFFLENBQUNoQyxNQUFNLENBQUUsQ0FBQyxDQUFFLENBQUM0RCxRQUFRLENBQUVSLElBQUssQ0FBQyxFQUFFLGVBQWdCLENBQUM7RUFDM0R6QixNQUFNLENBQUNLLEVBQUUsQ0FBRWhDLE1BQU0sQ0FBRSxDQUFDLENBQUUsQ0FBQzRELFFBQVEsQ0FBRVAsTUFBTyxDQUFDLEVBQUUsaUJBQWtCLENBQUM7RUFDOUQxQixNQUFNLENBQUNLLEVBQUUsQ0FBRWhDLE1BQU0sQ0FBRSxDQUFDLENBQUUsQ0FBQzRELFFBQVEsQ0FBRU4sT0FBUSxDQUFDLEVBQUUsa0JBQW1CLENBQUM7RUFDaEUzQixNQUFNLENBQUNLLEVBQUUsQ0FBRWhDLE1BQU0sQ0FBRSxDQUFDLENBQUUsQ0FBQzRELFFBQVEsQ0FBRUwsSUFBSyxDQUFDLEVBQUUsZUFBZ0IsQ0FBQztFQUUxRHJFLGlCQUFpQixDQUFDNkQsNEJBQTRCLENBQUNDLEtBQUssR0FBRyxLQUFLO0VBQzVEOUQsaUJBQWlCLENBQUMrRCw4QkFBOEIsQ0FBQ0QsS0FBSyxHQUFHLEtBQUs7RUFDOUQ5RCxpQkFBaUIsQ0FBQ2dFLCtCQUErQixDQUFDRixLQUFLLEdBQUcsS0FBSztFQUMvRDlELGlCQUFpQixDQUFDaUUsNEJBQTRCLENBQUNILEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQzs7RUFFN0R0RCxjQUFjLENBQUNxQyxTQUFTLENBQUVmLFNBQVUsQ0FBQztFQUNyQyxNQUFNckIsT0FBTyxDQUFFSixXQUFZLENBQUM7RUFFNUJvQyxNQUFNLENBQUNLLEVBQUUsQ0FBRSxDQUFDaEMsTUFBTSxDQUFFLENBQUMsQ0FBRSxDQUFDNEQsUUFBUSxDQUFFUixJQUFLLENBQUMsRUFBRSxtQkFBb0IsQ0FBQztFQUMvRHpCLE1BQU0sQ0FBQ0ssRUFBRSxDQUFFLENBQUNoQyxNQUFNLENBQUUsQ0FBQyxDQUFFLENBQUM0RCxRQUFRLENBQUVQLE1BQU8sQ0FBQyxFQUFFLHFCQUFzQixDQUFDO0VBQ25FMUIsTUFBTSxDQUFDSyxFQUFFLENBQUUsQ0FBQ2hDLE1BQU0sQ0FBRSxDQUFDLENBQUUsQ0FBQzRELFFBQVEsQ0FBRU4sT0FBUSxDQUFDLEVBQUUsc0JBQXVCLENBQUM7RUFDckUzQixNQUFNLENBQUNLLEVBQUUsQ0FBRWhDLE1BQU0sQ0FBRSxDQUFDLENBQUUsS0FBS3VELElBQUksRUFBRSxlQUFnQixDQUFDO0FBQ3BELENBQUUsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==