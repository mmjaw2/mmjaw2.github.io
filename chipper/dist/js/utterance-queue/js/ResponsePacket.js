// Copyright 2021-2024, University of Colorado Boulder

/**
 * The ResponsePacket collects the categories of a single "response" into the following sections:
 * "Name Response" - A response that labels (names) some element to describe.
 * "Object Response" - A response directly describing the state of the named element.
 * "Context Response" - A response that describes surrounding context related to the named element or changes to it.
 * "Hint Response" - A response that gives a hint about what en element is for or how to interact with it.
 *
 * A response is most often tied to an element, or an object that is being described/voiced.
 *
 * Individual categories of responses can be enabled or disabled. The ResponsePacket keeps track of all these
 * responses. When it is time to alert the responses of this ResponsePacket, the ResponseCollector will assemble
 * a final string depending on which categories of responses are enabled.
 *
 * @author Jesse Greenberg
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import { isTReadOnlyProperty } from '../../axon/js/TReadOnlyProperty.js';
import { optionize3 } from '../../phet-core/js/optionize.js';
import ResponsePatternCollection from './ResponsePatternCollection.js';
import utteranceQueueNamespace from './utteranceQueueNamespace.js';

// The text sent to an Announcer technology, after resolving it from potentially more complicated structures holding a response

// No function creator because we don't want to support the execution of that function.

// Add null support for certain cases

// Defaults can't be functions, it makes it easier for certain cases, like in responseCollector.
const DEFAULT_OPTIONS = {
  nameResponse: null,
  objectResponse: null,
  contextResponse: null,
  hintResponse: null,
  ignoreProperties: false,
  // The collection of string patterns to use when assembling responses based on which
  // responses are provided and which responseCollector Properties are true. See ResponsePatternCollection
  // if you do not want to use the default.
  responsePatternCollection: ResponsePatternCollection.DEFAULT_RESPONSE_PATTERNS
};
class ResponsePacket {
  static DEFAULT_OPTIONS = DEFAULT_OPTIONS;
  constructor(providedOptions) {
    const options = optionize3()({}, DEFAULT_OPTIONS, providedOptions);
    assert && assert(options.responsePatternCollection instanceof ResponsePatternCollection);

    // The response to be spoken for this packet when speaking names. This is usually
    // the same as the description accessible name, typically spoken on focus and on interaction, labelling what the
    // object is. Mutate as needed until time to alert.
    this._nameResponse = options.nameResponse;

    // The response to be spoken for this packet when speaking about object changes. This
    // is usually the state information, such as the current input value. Mutate as needed until time to alert.
    this._objectResponse = options.objectResponse;

    // The response to be spoken for this packet when speaking about context changes.
    // This is usually a response that describes the surrounding changes that have occurred after interacting
    // with the object. Mutate as needed until time to alert.
    this._contextResponse = options.contextResponse;

    // The response to be spoken for this packet when speaking hints. This is usually the response
    // that guides the user toward further interaction with this object if it is important to do so to use
    // the application. Mutate as needed until time to alert.
    this._hintResponse = options.hintResponse;

    // Controls whether or not the name, object, context, and hint responses are controlled
    // by responseCollector Properties. If true, all responses will be spoken when requested, regardless
    // of these Properties. This is often useful for surrounding UI components where it is important
    // that information be heard even when certain responses have been disabled. Mutate as needed until time to alert.
    this.ignoreProperties = options.ignoreProperties;

    // A collection of response patterns that are used when consolidating
    // each response with responseCollector. Controls the order of the Voicing responses and also punctuation
    // used when responses are assembled into final content for the UtteranceQueue. See ResponsePatternCollection for
    // more details. Mutate as needed until time to alert.
    this.responsePatternCollection = options.responsePatternCollection;
  }
  getNameResponse() {
    return ResponsePacket.getResponseText(this._nameResponse);
  }
  get nameResponse() {
    return this.getNameResponse();
  }
  set nameResponse(nameResponse) {
    this.setNameResponse(nameResponse);
  }
  setNameResponse(nameResponse) {
    this._nameResponse = nameResponse;
  }
  getObjectResponse() {
    return ResponsePacket.getResponseText(this._objectResponse);
  }
  get objectResponse() {
    return this.getObjectResponse();
  }
  set objectResponse(objectResponse) {
    this.setObjectResponse(objectResponse);
  }
  setObjectResponse(objectResponse) {
    this._objectResponse = objectResponse;
  }
  getContextResponse() {
    return ResponsePacket.getResponseText(this._contextResponse);
  }
  get contextResponse() {
    return this.getContextResponse();
  }
  set contextResponse(contextResponse) {
    this.setContextResponse(contextResponse);
  }
  setContextResponse(contextResponse) {
    this._contextResponse = contextResponse;
  }
  getHintResponse() {
    return ResponsePacket.getResponseText(this._hintResponse);
  }
  get hintResponse() {
    return this.getHintResponse();
  }
  set hintResponse(hintResponse) {
    this.setHintResponse(hintResponse);
  }
  setHintResponse(hintResponse) {
    this._hintResponse = hintResponse;
  }

  // Map VoicingResponse -> ResolvedResponse (resolve functions and Properties to their values)
  static getResponseText(response) {
    return isTReadOnlyProperty(response) ? response.value : typeof response === 'function' ? response() : response;
  }
  copy() {
    return new ResponsePacket(this.serialize());
  }
  serialize() {
    return {
      nameResponse: this.nameResponse,
      objectResponse: this.objectResponse,
      contextResponse: this.contextResponse,
      hintResponse: this.hintResponse,
      ignoreProperties: this.ignoreProperties,
      responsePatternCollection: this.responsePatternCollection
    };
  }
}
utteranceQueueNamespace.register('ResponsePacket', ResponsePacket);
export default ResponsePacket;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpc1RSZWFkT25seVByb3BlcnR5Iiwib3B0aW9uaXplMyIsIlJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24iLCJ1dHRlcmFuY2VRdWV1ZU5hbWVzcGFjZSIsIkRFRkFVTFRfT1BUSU9OUyIsIm5hbWVSZXNwb25zZSIsIm9iamVjdFJlc3BvbnNlIiwiY29udGV4dFJlc3BvbnNlIiwiaGludFJlc3BvbnNlIiwiaWdub3JlUHJvcGVydGllcyIsInJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24iLCJERUZBVUxUX1JFU1BPTlNFX1BBVFRFUk5TIiwiUmVzcG9uc2VQYWNrZXQiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJhc3NlcnQiLCJfbmFtZVJlc3BvbnNlIiwiX29iamVjdFJlc3BvbnNlIiwiX2NvbnRleHRSZXNwb25zZSIsIl9oaW50UmVzcG9uc2UiLCJnZXROYW1lUmVzcG9uc2UiLCJnZXRSZXNwb25zZVRleHQiLCJzZXROYW1lUmVzcG9uc2UiLCJnZXRPYmplY3RSZXNwb25zZSIsInNldE9iamVjdFJlc3BvbnNlIiwiZ2V0Q29udGV4dFJlc3BvbnNlIiwic2V0Q29udGV4dFJlc3BvbnNlIiwiZ2V0SGludFJlc3BvbnNlIiwic2V0SGludFJlc3BvbnNlIiwicmVzcG9uc2UiLCJ2YWx1ZSIsImNvcHkiLCJzZXJpYWxpemUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlJlc3BvbnNlUGFja2V0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoZSBSZXNwb25zZVBhY2tldCBjb2xsZWN0cyB0aGUgY2F0ZWdvcmllcyBvZiBhIHNpbmdsZSBcInJlc3BvbnNlXCIgaW50byB0aGUgZm9sbG93aW5nIHNlY3Rpb25zOlxyXG4gKiBcIk5hbWUgUmVzcG9uc2VcIiAtIEEgcmVzcG9uc2UgdGhhdCBsYWJlbHMgKG5hbWVzKSBzb21lIGVsZW1lbnQgdG8gZGVzY3JpYmUuXHJcbiAqIFwiT2JqZWN0IFJlc3BvbnNlXCIgLSBBIHJlc3BvbnNlIGRpcmVjdGx5IGRlc2NyaWJpbmcgdGhlIHN0YXRlIG9mIHRoZSBuYW1lZCBlbGVtZW50LlxyXG4gKiBcIkNvbnRleHQgUmVzcG9uc2VcIiAtIEEgcmVzcG9uc2UgdGhhdCBkZXNjcmliZXMgc3Vycm91bmRpbmcgY29udGV4dCByZWxhdGVkIHRvIHRoZSBuYW1lZCBlbGVtZW50IG9yIGNoYW5nZXMgdG8gaXQuXHJcbiAqIFwiSGludCBSZXNwb25zZVwiIC0gQSByZXNwb25zZSB0aGF0IGdpdmVzIGEgaGludCBhYm91dCB3aGF0IGVuIGVsZW1lbnQgaXMgZm9yIG9yIGhvdyB0byBpbnRlcmFjdCB3aXRoIGl0LlxyXG4gKlxyXG4gKiBBIHJlc3BvbnNlIGlzIG1vc3Qgb2Z0ZW4gdGllZCB0byBhbiBlbGVtZW50LCBvciBhbiBvYmplY3QgdGhhdCBpcyBiZWluZyBkZXNjcmliZWQvdm9pY2VkLlxyXG4gKlxyXG4gKiBJbmRpdmlkdWFsIGNhdGVnb3JpZXMgb2YgcmVzcG9uc2VzIGNhbiBiZSBlbmFibGVkIG9yIGRpc2FibGVkLiBUaGUgUmVzcG9uc2VQYWNrZXQga2VlcHMgdHJhY2sgb2YgYWxsIHRoZXNlXHJcbiAqIHJlc3BvbnNlcy4gV2hlbiBpdCBpcyB0aW1lIHRvIGFsZXJ0IHRoZSByZXNwb25zZXMgb2YgdGhpcyBSZXNwb25zZVBhY2tldCwgdGhlIFJlc3BvbnNlQ29sbGVjdG9yIHdpbGwgYXNzZW1ibGVcclxuICogYSBmaW5hbCBzdHJpbmcgZGVwZW5kaW5nIG9uIHdoaWNoIGNhdGVnb3JpZXMgb2YgcmVzcG9uc2VzIGFyZSBlbmFibGVkLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5LCB7IGlzVFJlYWRPbmx5UHJvcGVydHkgfSBmcm9tICcuLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgb3B0aW9uaXplMywgT3B0aW9uaXplRGVmYXVsdHMgfSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24gZnJvbSAnLi9SZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uLmpzJztcclxuaW1wb3J0IHV0dGVyYW5jZVF1ZXVlTmFtZXNwYWNlIGZyb20gJy4vdXR0ZXJhbmNlUXVldWVOYW1lc3BhY2UuanMnO1xyXG5cclxuLy8gVGhlIHRleHQgc2VudCB0byBhbiBBbm5vdW5jZXIgdGVjaG5vbG9neSwgYWZ0ZXIgcmVzb2x2aW5nIGl0IGZyb20gcG90ZW50aWFsbHkgbW9yZSBjb21wbGljYXRlZCBzdHJ1Y3R1cmVzIGhvbGRpbmcgYSByZXNwb25zZVxyXG5leHBvcnQgdHlwZSBSZXNvbHZlZFJlc3BvbnNlID0gc3RyaW5nIHwgbnVtYmVyIHwgbnVsbCB8IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz47XHJcblxyXG50eXBlIFJlc3BvbnNlQ3JlYXRvciA9IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4gfCAoICgpID0+IFJlc29sdmVkUmVzcG9uc2UgKTtcclxuZXhwb3J0IHR5cGUgVm9pY2luZ1Jlc3BvbnNlID0gUmVzcG9uc2VDcmVhdG9yIHwgUmVzb2x2ZWRSZXNwb25zZTtcclxuXHJcbi8vIE5vIGZ1bmN0aW9uIGNyZWF0b3IgYmVjYXVzZSB3ZSBkb24ndCB3YW50IHRvIHN1cHBvcnQgdGhlIGV4ZWN1dGlvbiBvZiB0aGF0IGZ1bmN0aW9uLlxyXG5leHBvcnQgdHlwZSBTcGVha2FibGVSZXNvbHZlZFJlc3BvbnNlID0gUmVzb2x2ZWRSZXNwb25zZSB8IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz47XHJcblxyXG5leHBvcnQgdHlwZSBSZXNwb25zZVBhY2tldE9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIHNwb2tlbiB3aGVuIG5hbWUgcmVzcG9uc2VzIGFyZSBlbmFibGVkXHJcbiAgbmFtZVJlc3BvbnNlPzogVm9pY2luZ1Jlc3BvbnNlO1xyXG5cclxuICAvLyBzcG9rZW4gd2hlbiBvYmplY3QgcmVzcG9uc2VzIGFyZSBlbmFibGVkXHJcbiAgb2JqZWN0UmVzcG9uc2U/OiBWb2ljaW5nUmVzcG9uc2U7XHJcblxyXG4gIC8vIHNwb2tlbiB3aGVuIGNvbnRleHQgcmVzcG9uc2VzIGFyZSBlbmFibGVkXHJcbiAgY29udGV4dFJlc3BvbnNlPzogVm9pY2luZ1Jlc3BvbnNlO1xyXG5cclxuICAvLyBzcG9rZW4gd2hlbiBpbnRlcmFjdGlvbiBoaW50cyBhcmUgZW5hYmxlZFxyXG4gIGhpbnRSZXNwb25zZT86IFZvaWNpbmdSZXNwb25zZTtcclxuXHJcbiAgLy8gV2hldGhlciB0aGlzIHJlc3BvbnNlIHNob3VsZCBpZ25vcmUgdGhlIFByb3BlcnRpZXMgb2YgcmVzcG9uc2VDb2xsZWN0b3IuIElmIHRydWUsIHRoZSBuYW1lUmVzcG9uc2UsIG9iamVjdFJlc3BvbnNlLFxyXG4gIC8vIGNvbnRleHRSZXNwb25zZSwgYW5kIGludGVyYWN0aW9uSGludCB3aWxsIGFsbCBiZSBzcG9rZW4gcmVnYXJkbGVzcyBvZiB0aGUgdmFsdWVzIG9mIHRoZSBQcm9wZXJ0aWVzIG9mIHJlc3BvbnNlQ29sbGVjdG9yXHJcbiAgaWdub3JlUHJvcGVydGllcz86IGJvb2xlYW47XHJcblxyXG4gIC8vIENvbGxlY3Rpb24gb2Ygc3RyaW5nIHBhdHRlcm5zIHRvIHVzZSB3aXRoIHJlc3BvbnNlQ29sbGVjdG9yLmNvbGxlY3RSZXNwb25zZXMsIHNlZSBSZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uIGZvclxyXG4gIC8vIG1vcmUgaW5mb3JtYXRpb24uXHJcbiAgcmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbj86IFJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb247XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBTcGVha2FibGVSZXNvbHZlZE9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIEluIHNwZWFraW5nIG9wdGlvbnMsIHdlIGRvbid0IGFsbG93IGEgUmVzcG9uc2VDcmVhdG9yIGZ1bmN0aW9uLCBidXQganVzdCBhIHN0cmluZ3xudWxsLiBUaGUgYHVuZGVmaW5lZGAgaXMgdG9cclxuICAvLyBtYXRjaCBvbiB0aGUgcHJvcGVydGllcyBiZWNhdXNlIHRoZXkgYXJlIG9wdGlvbmFsIChtYXJrZWQgd2l0aCBgP2ApXHJcbiAgW1Byb3BlcnR5TmFtZSBpbiBrZXlvZiBSZXNwb25zZVBhY2tldE9wdGlvbnNdOiBSZXNwb25zZVBhY2tldE9wdGlvbnNbUHJvcGVydHlOYW1lXSBleHRlbmRzICggVm9pY2luZ1Jlc3BvbnNlIHwgdW5kZWZpbmVkICkgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BlYWthYmxlUmVzb2x2ZWRSZXNwb25zZSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXNwb25zZVBhY2tldE9wdGlvbnNbUHJvcGVydHlOYW1lXTtcclxufTtcclxuXHJcbi8vIEFkZCBudWxsIHN1cHBvcnQgZm9yIGNlcnRhaW4gY2FzZXNcclxuZXhwb3J0IHR5cGUgU3BlYWthYmxlTnVsbGFibGVSZXNvbHZlZE9wdGlvbnMgPSB7XHJcbiAgW1Byb3BlcnR5TmFtZSBpbiBrZXlvZiBTcGVha2FibGVSZXNvbHZlZE9wdGlvbnNdOiBTcGVha2FibGVSZXNvbHZlZE9wdGlvbnNbUHJvcGVydHlOYW1lXSBleHRlbmRzIFNwZWFrYWJsZVJlc29sdmVkUmVzcG9uc2UgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BlYWthYmxlUmVzb2x2ZWRSZXNwb25zZSB8IG51bGwgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BlYWthYmxlUmVzb2x2ZWRPcHRpb25zW1Byb3BlcnR5TmFtZV07XHJcbn07XHJcblxyXG4vLyBEZWZhdWx0cyBjYW4ndCBiZSBmdW5jdGlvbnMsIGl0IG1ha2VzIGl0IGVhc2llciBmb3IgY2VydGFpbiBjYXNlcywgbGlrZSBpbiByZXNwb25zZUNvbGxlY3Rvci5cclxuY29uc3QgREVGQVVMVF9PUFRJT05TOiBPcHRpb25pemVEZWZhdWx0czxTcGVha2FibGVOdWxsYWJsZVJlc29sdmVkT3B0aW9ucz4gPSB7XHJcbiAgbmFtZVJlc3BvbnNlOiBudWxsLFxyXG4gIG9iamVjdFJlc3BvbnNlOiBudWxsLFxyXG4gIGNvbnRleHRSZXNwb25zZTogbnVsbCxcclxuICBoaW50UmVzcG9uc2U6IG51bGwsXHJcbiAgaWdub3JlUHJvcGVydGllczogZmFsc2UsXHJcblxyXG4gIC8vIFRoZSBjb2xsZWN0aW9uIG9mIHN0cmluZyBwYXR0ZXJucyB0byB1c2Ugd2hlbiBhc3NlbWJsaW5nIHJlc3BvbnNlcyBiYXNlZCBvbiB3aGljaFxyXG4gIC8vIHJlc3BvbnNlcyBhcmUgcHJvdmlkZWQgYW5kIHdoaWNoIHJlc3BvbnNlQ29sbGVjdG9yIFByb3BlcnRpZXMgYXJlIHRydWUuIFNlZSBSZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uXHJcbiAgLy8gaWYgeW91IGRvIG5vdCB3YW50IHRvIHVzZSB0aGUgZGVmYXVsdC5cclxuICByZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uOiBSZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uLkRFRkFVTFRfUkVTUE9OU0VfUEFUVEVSTlNcclxufTtcclxuXHJcbmNsYXNzIFJlc3BvbnNlUGFja2V0IHtcclxuICBwcml2YXRlIF9uYW1lUmVzcG9uc2U6IFZvaWNpbmdSZXNwb25zZTtcclxuICBwcml2YXRlIF9vYmplY3RSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlO1xyXG4gIHByaXZhdGUgX2NvbnRleHRSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlO1xyXG4gIHByaXZhdGUgX2hpbnRSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlO1xyXG5cclxuICBwdWJsaWMgaWdub3JlUHJvcGVydGllczogYm9vbGVhbjtcclxuICBwdWJsaWMgcmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbjogUmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbjtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IERFRkFVTFRfT1BUSU9OUyA9IERFRkFVTFRfT1BUSU9OUztcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBSZXNwb25zZVBhY2tldE9wdGlvbnMgKSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplMzxSZXNwb25zZVBhY2tldE9wdGlvbnM+KCkoIHt9LCBERUZBVUxUX09QVElPTlMsIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMucmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbiBpbnN0YW5jZW9mIFJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24gKTtcclxuXHJcbiAgICAvLyBUaGUgcmVzcG9uc2UgdG8gYmUgc3Bva2VuIGZvciB0aGlzIHBhY2tldCB3aGVuIHNwZWFraW5nIG5hbWVzLiBUaGlzIGlzIHVzdWFsbHlcclxuICAgIC8vIHRoZSBzYW1lIGFzIHRoZSBkZXNjcmlwdGlvbiBhY2Nlc3NpYmxlIG5hbWUsIHR5cGljYWxseSBzcG9rZW4gb24gZm9jdXMgYW5kIG9uIGludGVyYWN0aW9uLCBsYWJlbGxpbmcgd2hhdCB0aGVcclxuICAgIC8vIG9iamVjdCBpcy4gTXV0YXRlIGFzIG5lZWRlZCB1bnRpbCB0aW1lIHRvIGFsZXJ0LlxyXG4gICAgdGhpcy5fbmFtZVJlc3BvbnNlID0gb3B0aW9ucy5uYW1lUmVzcG9uc2U7XHJcblxyXG4gICAgLy8gVGhlIHJlc3BvbnNlIHRvIGJlIHNwb2tlbiBmb3IgdGhpcyBwYWNrZXQgd2hlbiBzcGVha2luZyBhYm91dCBvYmplY3QgY2hhbmdlcy4gVGhpc1xyXG4gICAgLy8gaXMgdXN1YWxseSB0aGUgc3RhdGUgaW5mb3JtYXRpb24sIHN1Y2ggYXMgdGhlIGN1cnJlbnQgaW5wdXQgdmFsdWUuIE11dGF0ZSBhcyBuZWVkZWQgdW50aWwgdGltZSB0byBhbGVydC5cclxuICAgIHRoaXMuX29iamVjdFJlc3BvbnNlID0gb3B0aW9ucy5vYmplY3RSZXNwb25zZTtcclxuXHJcbiAgICAvLyBUaGUgcmVzcG9uc2UgdG8gYmUgc3Bva2VuIGZvciB0aGlzIHBhY2tldCB3aGVuIHNwZWFraW5nIGFib3V0IGNvbnRleHQgY2hhbmdlcy5cclxuICAgIC8vIFRoaXMgaXMgdXN1YWxseSBhIHJlc3BvbnNlIHRoYXQgZGVzY3JpYmVzIHRoZSBzdXJyb3VuZGluZyBjaGFuZ2VzIHRoYXQgaGF2ZSBvY2N1cnJlZCBhZnRlciBpbnRlcmFjdGluZ1xyXG4gICAgLy8gd2l0aCB0aGUgb2JqZWN0LiBNdXRhdGUgYXMgbmVlZGVkIHVudGlsIHRpbWUgdG8gYWxlcnQuXHJcbiAgICB0aGlzLl9jb250ZXh0UmVzcG9uc2UgPSBvcHRpb25zLmNvbnRleHRSZXNwb25zZTtcclxuXHJcbiAgICAvLyBUaGUgcmVzcG9uc2UgdG8gYmUgc3Bva2VuIGZvciB0aGlzIHBhY2tldCB3aGVuIHNwZWFraW5nIGhpbnRzLiBUaGlzIGlzIHVzdWFsbHkgdGhlIHJlc3BvbnNlXHJcbiAgICAvLyB0aGF0IGd1aWRlcyB0aGUgdXNlciB0b3dhcmQgZnVydGhlciBpbnRlcmFjdGlvbiB3aXRoIHRoaXMgb2JqZWN0IGlmIGl0IGlzIGltcG9ydGFudCB0byBkbyBzbyB0byB1c2VcclxuICAgIC8vIHRoZSBhcHBsaWNhdGlvbi4gTXV0YXRlIGFzIG5lZWRlZCB1bnRpbCB0aW1lIHRvIGFsZXJ0LlxyXG4gICAgdGhpcy5faGludFJlc3BvbnNlID0gb3B0aW9ucy5oaW50UmVzcG9uc2U7XHJcblxyXG4gICAgLy8gQ29udHJvbHMgd2hldGhlciBvciBub3QgdGhlIG5hbWUsIG9iamVjdCwgY29udGV4dCwgYW5kIGhpbnQgcmVzcG9uc2VzIGFyZSBjb250cm9sbGVkXHJcbiAgICAvLyBieSByZXNwb25zZUNvbGxlY3RvciBQcm9wZXJ0aWVzLiBJZiB0cnVlLCBhbGwgcmVzcG9uc2VzIHdpbGwgYmUgc3Bva2VuIHdoZW4gcmVxdWVzdGVkLCByZWdhcmRsZXNzXHJcbiAgICAvLyBvZiB0aGVzZSBQcm9wZXJ0aWVzLiBUaGlzIGlzIG9mdGVuIHVzZWZ1bCBmb3Igc3Vycm91bmRpbmcgVUkgY29tcG9uZW50cyB3aGVyZSBpdCBpcyBpbXBvcnRhbnRcclxuICAgIC8vIHRoYXQgaW5mb3JtYXRpb24gYmUgaGVhcmQgZXZlbiB3aGVuIGNlcnRhaW4gcmVzcG9uc2VzIGhhdmUgYmVlbiBkaXNhYmxlZC4gTXV0YXRlIGFzIG5lZWRlZCB1bnRpbCB0aW1lIHRvIGFsZXJ0LlxyXG4gICAgdGhpcy5pZ25vcmVQcm9wZXJ0aWVzID0gb3B0aW9ucy5pZ25vcmVQcm9wZXJ0aWVzO1xyXG5cclxuICAgIC8vIEEgY29sbGVjdGlvbiBvZiByZXNwb25zZSBwYXR0ZXJucyB0aGF0IGFyZSB1c2VkIHdoZW4gY29uc29saWRhdGluZ1xyXG4gICAgLy8gZWFjaCByZXNwb25zZSB3aXRoIHJlc3BvbnNlQ29sbGVjdG9yLiBDb250cm9scyB0aGUgb3JkZXIgb2YgdGhlIFZvaWNpbmcgcmVzcG9uc2VzIGFuZCBhbHNvIHB1bmN0dWF0aW9uXHJcbiAgICAvLyB1c2VkIHdoZW4gcmVzcG9uc2VzIGFyZSBhc3NlbWJsZWQgaW50byBmaW5hbCBjb250ZW50IGZvciB0aGUgVXR0ZXJhbmNlUXVldWUuIFNlZSBSZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uIGZvclxyXG4gICAgLy8gbW9yZSBkZXRhaWxzLiBNdXRhdGUgYXMgbmVlZGVkIHVudGlsIHRpbWUgdG8gYWxlcnQuXHJcbiAgICB0aGlzLnJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24gPSBvcHRpb25zLnJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb247XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0TmFtZVJlc3BvbnNlKCk6IFJlc29sdmVkUmVzcG9uc2Uge1xyXG4gICAgcmV0dXJuIFJlc3BvbnNlUGFja2V0LmdldFJlc3BvbnNlVGV4dCggdGhpcy5fbmFtZVJlc3BvbnNlICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG5hbWVSZXNwb25zZSgpOiBSZXNvbHZlZFJlc3BvbnNlIHsgcmV0dXJuIHRoaXMuZ2V0TmFtZVJlc3BvbnNlKCk7IH1cclxuXHJcbiAgcHVibGljIHNldCBuYW1lUmVzcG9uc2UoIG5hbWVSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlICkgeyB0aGlzLnNldE5hbWVSZXNwb25zZSggbmFtZVJlc3BvbnNlICk7IH1cclxuXHJcbiAgcHVibGljIHNldE5hbWVSZXNwb25zZSggbmFtZVJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2UgKTogdm9pZCB7XHJcbiAgICB0aGlzLl9uYW1lUmVzcG9uc2UgPSBuYW1lUmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0T2JqZWN0UmVzcG9uc2UoKTogUmVzb2x2ZWRSZXNwb25zZSB7XHJcbiAgICByZXR1cm4gUmVzcG9uc2VQYWNrZXQuZ2V0UmVzcG9uc2VUZXh0KCB0aGlzLl9vYmplY3RSZXNwb25zZSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBvYmplY3RSZXNwb25zZSgpOiBSZXNvbHZlZFJlc3BvbnNlIHsgcmV0dXJuIHRoaXMuZ2V0T2JqZWN0UmVzcG9uc2UoKTsgfVxyXG5cclxuICBwdWJsaWMgc2V0IG9iamVjdFJlc3BvbnNlKCBvYmplY3RSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlICkgeyB0aGlzLnNldE9iamVjdFJlc3BvbnNlKCBvYmplY3RSZXNwb25zZSApOyB9XHJcblxyXG4gIHB1YmxpYyBzZXRPYmplY3RSZXNwb25zZSggb2JqZWN0UmVzcG9uc2U6IFZvaWNpbmdSZXNwb25zZSApOiB2b2lkIHtcclxuICAgIHRoaXMuX29iamVjdFJlc3BvbnNlID0gb2JqZWN0UmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0Q29udGV4dFJlc3BvbnNlKCk6IFJlc29sdmVkUmVzcG9uc2Uge1xyXG4gICAgcmV0dXJuIFJlc3BvbnNlUGFja2V0LmdldFJlc3BvbnNlVGV4dCggdGhpcy5fY29udGV4dFJlc3BvbnNlICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGNvbnRleHRSZXNwb25zZSgpOiBSZXNvbHZlZFJlc3BvbnNlIHsgcmV0dXJuIHRoaXMuZ2V0Q29udGV4dFJlc3BvbnNlKCk7IH1cclxuXHJcbiAgcHVibGljIHNldCBjb250ZXh0UmVzcG9uc2UoIGNvbnRleHRSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlICkgeyB0aGlzLnNldENvbnRleHRSZXNwb25zZSggY29udGV4dFJlc3BvbnNlICk7IH1cclxuXHJcbiAgcHVibGljIHNldENvbnRleHRSZXNwb25zZSggY29udGV4dFJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2UgKTogdm9pZCB7XHJcbiAgICB0aGlzLl9jb250ZXh0UmVzcG9uc2UgPSBjb250ZXh0UmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0SGludFJlc3BvbnNlKCk6IFJlc29sdmVkUmVzcG9uc2Uge1xyXG4gICAgcmV0dXJuIFJlc3BvbnNlUGFja2V0LmdldFJlc3BvbnNlVGV4dCggdGhpcy5faGludFJlc3BvbnNlICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGhpbnRSZXNwb25zZSgpOiBSZXNvbHZlZFJlc3BvbnNlIHsgcmV0dXJuIHRoaXMuZ2V0SGludFJlc3BvbnNlKCk7IH1cclxuXHJcbiAgcHVibGljIHNldCBoaW50UmVzcG9uc2UoIGhpbnRSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlICkgeyB0aGlzLnNldEhpbnRSZXNwb25zZSggaGludFJlc3BvbnNlICk7IH1cclxuXHJcbiAgcHVibGljIHNldEhpbnRSZXNwb25zZSggaGludFJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2UgKTogdm9pZCB7XHJcbiAgICB0aGlzLl9oaW50UmVzcG9uc2UgPSBoaW50UmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICAvLyBNYXAgVm9pY2luZ1Jlc3BvbnNlIC0+IFJlc29sdmVkUmVzcG9uc2UgKHJlc29sdmUgZnVuY3Rpb25zIGFuZCBQcm9wZXJ0aWVzIHRvIHRoZWlyIHZhbHVlcylcclxuICBwdWJsaWMgc3RhdGljIGdldFJlc3BvbnNlVGV4dCggcmVzcG9uc2U6IFZvaWNpbmdSZXNwb25zZSApOiBSZXNvbHZlZFJlc3BvbnNlIHtcclxuICAgIHJldHVybiBpc1RSZWFkT25seVByb3BlcnR5KCByZXNwb25zZSApID8gcmVzcG9uc2UudmFsdWUgOlxyXG4gICAgICAgICAgIHR5cGVvZiByZXNwb25zZSA9PT0gJ2Z1bmN0aW9uJyA/IHJlc3BvbnNlKCkgOiByZXNwb25zZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjb3B5KCk6IFJlc3BvbnNlUGFja2V0IHtcclxuICAgIHJldHVybiBuZXcgUmVzcG9uc2VQYWNrZXQoIHRoaXMuc2VyaWFsaXplKCkgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXJpYWxpemUoKTogUmVxdWlyZWQ8U3BlYWthYmxlTnVsbGFibGVSZXNvbHZlZE9wdGlvbnM+IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWVSZXNwb25zZTogdGhpcy5uYW1lUmVzcG9uc2UsXHJcbiAgICAgIG9iamVjdFJlc3BvbnNlOiB0aGlzLm9iamVjdFJlc3BvbnNlLFxyXG4gICAgICBjb250ZXh0UmVzcG9uc2U6IHRoaXMuY29udGV4dFJlc3BvbnNlLFxyXG4gICAgICBoaW50UmVzcG9uc2U6IHRoaXMuaGludFJlc3BvbnNlLFxyXG4gICAgICBpZ25vcmVQcm9wZXJ0aWVzOiB0aGlzLmlnbm9yZVByb3BlcnRpZXMsXHJcbiAgICAgIHJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb246IHRoaXMucmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvblxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbnV0dGVyYW5jZVF1ZXVlTmFtZXNwYWNlLnJlZ2lzdGVyKCAnUmVzcG9uc2VQYWNrZXQnLCBSZXNwb25zZVBhY2tldCApO1xyXG5leHBvcnQgZGVmYXVsdCBSZXNwb25zZVBhY2tldDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQTRCQSxtQkFBbUIsUUFBUSxvQ0FBb0M7QUFDM0YsU0FBU0MsVUFBVSxRQUEyQixpQ0FBaUM7QUFDL0UsT0FBT0MseUJBQXlCLE1BQU0sZ0NBQWdDO0FBQ3RFLE9BQU9DLHVCQUF1QixNQUFNLDhCQUE4Qjs7QUFFbEU7O0FBTUE7O0FBbUNBOztBQU9BO0FBQ0EsTUFBTUMsZUFBb0UsR0FBRztFQUMzRUMsWUFBWSxFQUFFLElBQUk7RUFDbEJDLGNBQWMsRUFBRSxJQUFJO0VBQ3BCQyxlQUFlLEVBQUUsSUFBSTtFQUNyQkMsWUFBWSxFQUFFLElBQUk7RUFDbEJDLGdCQUFnQixFQUFFLEtBQUs7RUFFdkI7RUFDQTtFQUNBO0VBQ0FDLHlCQUF5QixFQUFFUix5QkFBeUIsQ0FBQ1M7QUFDdkQsQ0FBQztBQUVELE1BQU1DLGNBQWMsQ0FBQztFQVFuQixPQUF1QlIsZUFBZSxHQUFHQSxlQUFlO0VBRWpEUyxXQUFXQSxDQUFFQyxlQUF1QyxFQUFHO0lBQzVELE1BQU1DLE9BQU8sR0FBR2QsVUFBVSxDQUF3QixDQUFDLENBQUUsQ0FBQyxDQUFDLEVBQUVHLGVBQWUsRUFBRVUsZUFBZ0IsQ0FBQztJQUUzRkUsTUFBTSxJQUFJQSxNQUFNLENBQUVELE9BQU8sQ0FBQ0wseUJBQXlCLFlBQVlSLHlCQUEwQixDQUFDOztJQUUxRjtJQUNBO0lBQ0E7SUFDQSxJQUFJLENBQUNlLGFBQWEsR0FBR0YsT0FBTyxDQUFDVixZQUFZOztJQUV6QztJQUNBO0lBQ0EsSUFBSSxDQUFDYSxlQUFlLEdBQUdILE9BQU8sQ0FBQ1QsY0FBYzs7SUFFN0M7SUFDQTtJQUNBO0lBQ0EsSUFBSSxDQUFDYSxnQkFBZ0IsR0FBR0osT0FB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