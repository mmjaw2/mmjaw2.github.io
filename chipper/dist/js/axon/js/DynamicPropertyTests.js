// Copyright 2017-2024, University of Colorado Boulder

/**
 * QUnit tests for DynamicProperty
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import DynamicProperty from './DynamicProperty.js';
import Property from './Property.js';
QUnit.module('DynamicProperty');
QUnit.test('Basics', assert => {
  const aProperty = new Property(5);
  const bProperty = new Property(2);
  const propertyProperty = new Property(aProperty);
  const dynamicProperty = new DynamicProperty(propertyProperty);
  assert.equal(dynamicProperty.value, aProperty.value);
  propertyProperty.value = bProperty;
  assert.equal(dynamicProperty.value, bProperty.value);
  bProperty.value = 7;
  assert.equal(dynamicProperty.value, bProperty.value);
  aProperty.value = 10;
  propertyProperty.value = aProperty;
  assert.equal(dynamicProperty.value, aProperty.value);
});
QUnit.test('Derive (string)', assert => {
  const a = {
    property: new Property(5)
  };
  const b = {
    property: new Property(2)
  };
  const mainProperty = new Property(a);
  const dynamicProperty = new DynamicProperty(mainProperty, {
    derive: 'property'
  });
  assert.equal(dynamicProperty.value, a.property.value);
  mainProperty.value = b;
  assert.equal(dynamicProperty.value, b.property.value);
  b.property.value = 7;
  assert.equal(dynamicProperty.value, b.property.value);
  a.property.value = 10;
  mainProperty.value = a;
  assert.equal(dynamicProperty.value, a.property.value);
});
QUnit.test('Derive (function)', assert => {
  const a = {
    property: new Property(5)
  };
  const b = {
    property: new Property(2)
  };
  const mainProperty = new Property(a);
  const dynamicProperty = new DynamicProperty(mainProperty, {
    derive: function (ob) {
      return ob.property;
    }
  });
  assert.equal(dynamicProperty.value, a.property.value);
  mainProperty.value = b;
  assert.equal(dynamicProperty.value, b.property.value);
  b.property.value = 7;
  assert.equal(dynamicProperty.value, b.property.value);
  a.property.value = 10;
  mainProperty.value = a;
  assert.equal(dynamicProperty.value, a.property.value);
});
QUnit.test('Bidirectional', assert => {
  const firstProperty = new Property(5);
  const secondProperty = new Property(10);
  const numberPropertyProperty = new Property(firstProperty);
  const dynamicProperty = new DynamicProperty(numberPropertyProperty, {
    bidirectional: true
  });
  dynamicProperty.value = 2; // allowed now that it is bidirectional, otherwise prohibited
  assert.equal(firstProperty.value, 2);
  numberPropertyProperty.value = secondProperty; // change which property is active
  assert.equal(dynamicProperty.value, 10);
  dynamicProperty.value = 0;
  assert.equal(secondProperty.value, 0);
  assert.equal(firstProperty.value, 2);
});
QUnit.test('Mapping (with bidirectional)', assert => {
  const firstProperty = new Property(5);
  const secondProperty = new Property(10);
  const numberPropertyProperty = new Property(firstProperty);
  const dynamicProperty = new DynamicProperty(numberPropertyProperty, {
    bidirectional: true,
    map: function (number) {
      return `${number}`;
    },
    inverseMap: function (string) {
      return Number.parseFloat(string);
    }
  });
  assert.equal(typeof dynamicProperty.value, 'string');
  assert.equal(dynamicProperty.value, '5');
  dynamicProperty.value = '2';
  assert.equal(firstProperty.value, 2);
  numberPropertyProperty.value = secondProperty; // change which property is active
  assert.equal(dynamicProperty.value, '10');
  dynamicProperty.value = '0';
  assert.equal(secondProperty.value, 0);
  assert.equal(firstProperty.value, 2);
});
QUnit.test('Attempted setters to nonbidirectional', assert => {
  const property = new Property(5);
  const propertyProperty = new Property(property);
  const dynamicProperty = new DynamicProperty(propertyProperty);
  window.assert && assert.throws(() => {
    dynamicProperty.value = 10;
  }, /bidirectional/, 'Should not be able to set a non-bidirectional DynamicProperty');
  window.assert && assert.throws(() => {
    dynamicProperty.reset();
  }, /bidirectional/, 'Should not be able to reset a non-bidirectional DynamicProperty');
  assert.expect(window.assert ? 2 : 0);
});
QUnit.test('Bidirectional prevention of pingponging', assert => {
  let callbackCount = 0;
  const sourceProperty = new Property(0);
  sourceProperty.link(() => {
    if (callbackCount++ > 500) {
      throw new Error('Infinite loop detected');
    }
  });
  const wrapperProperty = new Property(sourceProperty);
  const dynamicProperty = new DynamicProperty(wrapperProperty, {
    bidirectional: true,
    // NOT a true inverse
    map: n => n + 2,
    inverseMap: n => n - 1
  });
  dynamicProperty.link(() => {
    if (callbackCount++ > 500) {
      throw new Error('Infinite loop detected');
    }
  });
  assert.equal(sourceProperty.value, 0);
  assert.equal(dynamicProperty.value, 2);
  dynamicProperty.value = 3;
  assert.equal(sourceProperty.value, 2);
  assert.equal(dynamicProperty.value, 3);
  sourceProperty.value = 5;
  assert.equal(sourceProperty.value, 5);
  assert.equal(dynamicProperty.value, 7);
  dynamicProperty.value = -10;
  assert.equal(sourceProperty.value, -11);
  assert.equal(dynamicProperty.value, -10);
  sourceProperty.value = 12;
  assert.equal(sourceProperty.value, 12);
  assert.equal(dynamicProperty.value, 14);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEeW5hbWljUHJvcGVydHkiLCJQcm9wZXJ0eSIsIlFVbml0IiwibW9kdWxlIiwidGVzdCIsImFzc2VydCIsImFQcm9wZXJ0eSIsImJQcm9wZXJ0eSIsInByb3BlcnR5UHJvcGVydHkiLCJkeW5hbWljUHJvcGVydHkiLCJlcXVhbCIsInZhbHVlIiwiYSIsInByb3BlcnR5IiwiYiIsIm1haW5Qcm9wZXJ0eSIsImRlcml2ZSIsIm9iIiwiZmlyc3RQcm9wZXJ0eSIsInNlY29uZFByb3BlcnR5IiwibnVtYmVyUHJvcGVydHlQcm9wZXJ0eSIsImJpZGlyZWN0aW9uYWwiLCJtYXAiLCJudW1iZXIiLCJpbnZlcnNlTWFwIiwic3RyaW5nIiwiTnVtYmVyIiwicGFyc2VGbG9hdCIsIndpbmRvdyIsInRocm93cyIsInJlc2V0IiwiZXhwZWN0IiwiY2FsbGJhY2tDb3VudCIsInNvdXJjZVByb3BlcnR5IiwibGluayIsIkVycm9yIiwid3JhcHBlclByb3BlcnR5IiwibiJdLCJzb3VyY2VzIjpbIkR5bmFtaWNQcm9wZXJ0eVRlc3RzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFFVbml0IHRlc3RzIGZvciBEeW5hbWljUHJvcGVydHlcclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRHluYW1pY1Byb3BlcnR5IGZyb20gJy4vRHluYW1pY1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4vUHJvcGVydHkuanMnO1xyXG5cclxuUVVuaXQubW9kdWxlKCAnRHluYW1pY1Byb3BlcnR5JyApO1xyXG5cclxuUVVuaXQudGVzdCggJ0Jhc2ljcycsIGFzc2VydCA9PiB7XHJcbiAgY29uc3QgYVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCA1ICk7XHJcbiAgY29uc3QgYlByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCAyICk7XHJcbiAgY29uc3QgcHJvcGVydHlQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggYVByb3BlcnR5ICk7XHJcbiAgY29uc3QgZHluYW1pY1Byb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggcHJvcGVydHlQcm9wZXJ0eSApO1xyXG5cclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYVByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gIHByb3BlcnR5UHJvcGVydHkudmFsdWUgPSBiUHJvcGVydHk7XHJcbiAgYXNzZXJ0LmVxdWFsKCBkeW5hbWljUHJvcGVydHkudmFsdWUsIGJQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICBiUHJvcGVydHkudmFsdWUgPSA3O1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCBiUHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgYVByb3BlcnR5LnZhbHVlID0gMTA7XHJcbiAgcHJvcGVydHlQcm9wZXJ0eS52YWx1ZSA9IGFQcm9wZXJ0eTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYVByb3BlcnR5LnZhbHVlICk7XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdEZXJpdmUgKHN0cmluZyknLCBhc3NlcnQgPT4ge1xyXG4gIGNvbnN0IGEgPSB7XHJcbiAgICBwcm9wZXJ0eTogbmV3IFByb3BlcnR5KCA1IClcclxuICB9O1xyXG4gIGNvbnN0IGIgPSB7XHJcbiAgICBwcm9wZXJ0eTogbmV3IFByb3BlcnR5KCAyIClcclxuICB9O1xyXG4gIGNvbnN0IG1haW5Qcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggYSApO1xyXG4gIGNvbnN0IGR5bmFtaWNQcm9wZXJ0eSA9IG5ldyBEeW5hbWljUHJvcGVydHkoIG1haW5Qcm9wZXJ0eSwge1xyXG4gICAgZGVyaXZlOiAncHJvcGVydHknXHJcbiAgfSApO1xyXG5cclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYS5wcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICBtYWluUHJvcGVydHkudmFsdWUgPSBiO1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCBiLnByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gIGIucHJvcGVydHkudmFsdWUgPSA3O1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCBiLnByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gIGEucHJvcGVydHkudmFsdWUgPSAxMDtcclxuICBtYWluUHJvcGVydHkudmFsdWUgPSBhO1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCBhLnByb3BlcnR5LnZhbHVlICk7XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdEZXJpdmUgKGZ1bmN0aW9uKScsIGFzc2VydCA9PiB7XHJcbiAgY29uc3QgYSA9IHtcclxuICAgIHByb3BlcnR5OiBuZXcgUHJvcGVydHkoIDUgKVxyXG4gIH07XHJcbiAgY29uc3QgYiA9IHtcclxuICAgIHByb3BlcnR5OiBuZXcgUHJvcGVydHkoIDIgKVxyXG4gIH07XHJcbiAgY29uc3QgbWFpblByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBhICk7XHJcbiAgY29uc3QgZHluYW1pY1Byb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggbWFpblByb3BlcnR5LCB7XHJcbiAgICBkZXJpdmU6IGZ1bmN0aW9uKCBvYiApIHtcclxuICAgICAgcmV0dXJuIG9iLnByb3BlcnR5O1xyXG4gICAgfVxyXG4gIH0gKTtcclxuXHJcbiAgYXNzZXJ0LmVxdWFsKCBkeW5hbWljUHJvcGVydHkudmFsdWUsIGEucHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgbWFpblByb3BlcnR5LnZhbHVlID0gYjtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYi5wcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICBiLnByb3BlcnR5LnZhbHVlID0gNztcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYi5wcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICBhLnByb3BlcnR5LnZhbHVlID0gMTA7XHJcbiAgbWFpblByb3BlcnR5LnZhbHVlID0gYTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYS5wcm9wZXJ0eS52YWx1ZSApO1xyXG59ICk7XHJcblxyXG5RVW5pdC50ZXN0KCAnQmlkaXJlY3Rpb25hbCcsIGFzc2VydCA9PiB7XHJcbiAgY29uc3QgZmlyc3RQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggNSApO1xyXG4gIGNvbnN0IHNlY29uZFByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCAxMCApO1xyXG4gIGNvbnN0IG51bWJlclByb3BlcnR5UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIGZpcnN0UHJvcGVydHkgKTtcclxuICBjb25zdCBkeW5hbWljUHJvcGVydHkgPSBuZXcgRHluYW1pY1Byb3BlcnR5KCBudW1iZXJQcm9wZXJ0eVByb3BlcnR5LCB7IGJpZGlyZWN0aW9uYWw6IHRydWUgfSApO1xyXG5cclxuICBkeW5hbWljUHJvcGVydHkudmFsdWUgPSAyOyAvLyBhbGxvd2VkIG5vdyB0aGF0IGl0IGlzIGJpZGlyZWN0aW9uYWwsIG90aGVyd2lzZSBwcm9oaWJpdGVkXHJcbiAgYXNzZXJ0LmVxdWFsKCBmaXJzdFByb3BlcnR5LnZhbHVlLCAyICk7XHJcblxyXG4gIG51bWJlclByb3BlcnR5UHJvcGVydHkudmFsdWUgPSBzZWNvbmRQcm9wZXJ0eTsgLy8gY2hhbmdlIHdoaWNoIHByb3BlcnR5IGlzIGFjdGl2ZVxyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCAxMCApO1xyXG5cclxuICBkeW5hbWljUHJvcGVydHkudmFsdWUgPSAwO1xyXG4gIGFzc2VydC5lcXVhbCggc2Vjb25kUHJvcGVydHkudmFsdWUsIDAgKTtcclxuICBhc3NlcnQuZXF1YWwoIGZpcnN0UHJvcGVydHkudmFsdWUsIDIgKTtcclxufSApO1xyXG5cclxuUVVuaXQudGVzdCggJ01hcHBpbmcgKHdpdGggYmlkaXJlY3Rpb25hbCknLCBhc3NlcnQgPT4ge1xyXG4gIGNvbnN0IGZpcnN0UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIDUgKTtcclxuICBjb25zdCBzZWNvbmRQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggMTAgKTtcclxuICBjb25zdCBudW1iZXJQcm9wZXJ0eVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBmaXJzdFByb3BlcnR5ICk7XHJcbiAgY29uc3QgZHluYW1pY1Byb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggbnVtYmVyUHJvcGVydHlQcm9wZXJ0eSwge1xyXG4gICAgYmlkaXJlY3Rpb25hbDogdHJ1ZSxcclxuICAgIG1hcDogZnVuY3Rpb24oIG51bWJlciApIHtcclxuICAgICAgcmV0dXJuIGAke251bWJlcn1gO1xyXG4gICAgfSxcclxuICAgIGludmVyc2VNYXA6IGZ1bmN0aW9uKCBzdHJpbmcgKSB7XHJcbiAgICAgIHJldHVybiBOdW1iZXIucGFyc2VGbG9hdCggc3RyaW5nICk7XHJcbiAgICB9XHJcbiAgfSApO1xyXG5cclxuICBhc3NlcnQuZXF1YWwoIHR5cGVvZiBkeW5hbWljUHJvcGVydHkudmFsdWUsICdzdHJpbmcnICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCBkeW5hbWljUHJvcGVydHkudmFsdWUsICc1JyApO1xyXG5cclxuICBkeW5hbWljUHJvcGVydHkudmFsdWUgPSAnMic7XHJcbiAgYXNzZXJ0LmVxdWFsKCBmaXJzdFByb3BlcnR5LnZhbHVlLCAyICk7XHJcblxyXG4gIG51bWJlclByb3BlcnR5UHJvcGVydHkudmFsdWUgPSBzZWNvbmRQcm9wZXJ0eTsgLy8gY2hhbmdlIHdoaWNoIHByb3BlcnR5IGlzIGFjdGl2ZVxyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCAnMTAnICk7XHJcblxyXG4gIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSA9ICcwJztcclxuICBhc3NlcnQuZXF1YWwoIHNlY29uZFByb3BlcnR5LnZhbHVlLCAwICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCBmaXJzdFByb3BlcnR5LnZhbHVlLCAyICk7XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdBdHRlbXB0ZWQgc2V0dGVycyB0byBub25iaWRpcmVjdGlvbmFsJywgYXNzZXJ0ID0+IHtcclxuICBjb25zdCBwcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggNSApO1xyXG4gIGNvbnN0IHByb3BlcnR5UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIHByb3BlcnR5ICk7XHJcbiAgY29uc3QgZHluYW1pY1Byb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggcHJvcGVydHlQcm9wZXJ0eSApO1xyXG5cclxuICB3aW5kb3cuYXNzZXJ0ICYmIGFzc2VydC50aHJvd3MoICgpID0+IHtcclxuICAgIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSA9IDEwO1xyXG4gIH0sIC9iaWRpcmVjdGlvbmFsLywgJ1Nob3VsZCBub3QgYmUgYWJsZSB0byBzZXQgYSBub24tYmlkaXJlY3Rpb25hbCBEeW5hbWljUHJvcGVydHknICk7XHJcblxyXG4gIHdpbmRvdy5hc3NlcnQgJiYgYXNzZXJ0LnRocm93cyggKCkgPT4ge1xyXG4gICAgZHluYW1pY1Byb3BlcnR5LnJlc2V0KCk7XHJcbiAgfSwgL2JpZGlyZWN0aW9uYWwvLCAnU2hvdWxkIG5vdCBiZSBhYmxlIHRvIHJlc2V0IGEgbm9uLWJpZGlyZWN0aW9uYWwgRHluYW1pY1Byb3BlcnR5JyApO1xyXG5cclxuICBhc3NlcnQuZXhwZWN0KCB3aW5kb3cuYXNzZXJ0ID8gMiA6IDAgKTtcclxufSApO1xyXG5cclxuUVVuaXQudGVzdCggJ0JpZGlyZWN0aW9uYWwgcHJldmVudGlvbiBvZiBwaW5ncG9uZ2luZycsIGFzc2VydCA9PiB7XHJcbiAgbGV0IGNhbGxiYWNrQ291bnQgPSAwO1xyXG5cclxuICBjb25zdCBzb3VyY2VQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggMCApO1xyXG4gIHNvdXJjZVByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgIGlmICggY2FsbGJhY2tDb3VudCsrID4gNTAwICkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoICdJbmZpbml0ZSBsb29wIGRldGVjdGVkJyApO1xyXG4gICAgfVxyXG4gIH0gKTtcclxuXHJcbiAgY29uc3Qgd3JhcHBlclByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBzb3VyY2VQcm9wZXJ0eSApO1xyXG4gIGNvbnN0IGR5bmFtaWNQcm9wZXJ0eSA9IG5ldyBEeW5hbWljUHJvcGVydHkoIHdyYXBwZXJQcm9wZXJ0eSwge1xyXG4gICAgYmlkaXJlY3Rpb25hbDogdHJ1ZSxcclxuICAgIC8vIE5PVCBhIHRydWUgaW52ZXJzZVxyXG4gICAgbWFwOiAoIG46IG51bWJlciApID0+IG4gKyAyLFxyXG4gICAgaW52ZXJzZU1hcDogKCBuOiBudW1iZXIgKSA9PiBuIC0gMVxyXG4gIH0gKTtcclxuICBkeW5hbWljUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgaWYgKCBjYWxsYmFja0NvdW50KysgPiA1MDAgKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvciggJ0luZmluaXRlIGxvb3AgZGV0ZWN0ZWQnICk7XHJcbiAgICB9XHJcbiAgfSApO1xyXG4gIGFzc2VydC5lcXVhbCggc291cmNlUHJvcGVydHkudmFsdWUsIDAgKTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgMiApO1xyXG5cclxuICBkeW5hbWljUHJvcGVydHkudmFsdWUgPSAzO1xyXG4gIGFzc2VydC5lcXVhbCggc291cmNlUHJvcGVydHkudmFsdWUsIDIgKTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgMyApO1xyXG5cclxuICBzb3VyY2VQcm9wZXJ0eS52YWx1ZSA9IDU7XHJcbiAgYXNzZXJ0LmVxdWFsKCBzb3VyY2VQcm9wZXJ0eS52YWx1ZSwgNSApO1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCA3ICk7XHJcblxyXG4gIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSA9IC0xMDtcclxuICBhc3NlcnQuZXF1YWwoIHNvdXJjZVByb3BlcnR5LnZhbHVlLCAtMTEgKTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgLTEwICk7XHJcblxyXG4gIHNvdXJjZVByb3BlcnR5LnZhbHVlID0gMTI7XHJcbiAgYXNzZXJ0LmVxdWFsKCBzb3VyY2VQcm9wZXJ0eS52YWx1ZSwgMTIgKTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgMTQgKTtcclxufSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sc0JBQXNCO0FBQ2xELE9BQU9DLFFBQVEsTUFBTSxlQUFlO0FBRXBDQyxLQUFLLENBQUNDLE1BQU0sQ0FBRSxpQkFBa0IsQ0FBQztBQUVqQ0QsS0FBSyxDQUFDRSxJQUFJLENBQUUsUUFBUSxFQUFFQyxNQUFNLElBQUk7RUFDOUIsTUFBTUMsU0FBUyxHQUFHLElBQUlMLFFBQVEsQ0FBRSxDQUFFLENBQUM7RUFDbkMsTUFBTU0sU0FBUyxHQUFHLElBQUlOLFFBQVEsQ0FBRSxDQUFFLENBQUM7RUFDbkMsTUFBTU8sZ0JBQWdCLEdBQUcsSUFBSVAsUUFBUSxDQUFFSyxTQUFVLENBQUM7RUFDbEQsTUFBTUcsZUFBZSxHQUFHLElBQUlULGVBQWUsQ0FBRVEsZ0JBQWlCLENBQUM7RUFFL0RILE1BQU0sQ0FBQ0ssS0FBSyxDQUFFRCxlQUFlLENBQUNFLEtBQUssRUFBRUwsU0FBUyxDQUFDSyxLQUFNLENBQUM7RUFFdERILGdCQUFnQixDQUFDRyxLQUFLLEdBQUdKLFNBQVM7RUFDbENGLE1BQU0sQ0FBQ0ssS0FBSyxDQUFFRCxlQUFlLENBQUNFLEtBQUssRUFBRUosU0FBUyxDQUFDSSxLQUFNLENBQUM7RUFFdERKLFNB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