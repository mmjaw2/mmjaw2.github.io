// Copyright 2020-2024, University of Colorado Boulder

/**
 * A lightweight version of Property (that satisfies some of the interface), meant for high-performance applications
 * where validation, phet-io support and other things are not needed. This includes additional logic for conditionally
 * forwarding to/from another Property.
 *
 * Please note that TinyForwardingProperty exclusively supports settable Properties
 * via its TypeScript implementation. If you want to use a read-only Property as the target, please type cast as settable
 * and use runtime assertions to ensure that the target (or this forwarding Property) are not set. See examples like
 * Node.setVisibleProperty.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import axon from './axon.js';
import Property from './Property.js';
import ReadOnlyProperty from './ReadOnlyProperty.js';
import TinyProperty from './TinyProperty.js';
import { isTReadOnlyProperty } from './TReadOnlyProperty.js';
export default class TinyForwardingProperty extends TinyProperty {
  // Set in setTargetProperty().

  // Set lazily in setTargetProperty()

  // TinyProperty is not instrumented for PhET-iO, so when a Node is instrumented, by default, an instrumented
  // `Property` can be forwarded to. This field stores the default instrumented Property when
  // targetPropertyInstrumented is true. - Public for NodeTests

  // when true, automatically set up a PhET-iO instrumented forwarded Property for this TinyProperty, see
  // this.initializePhetioObject() for usage.

  // Guard against double initialization

  /**
   * @param value
   * @param [targetPropertyInstrumented] - For phet-io support only, set to false if the target Property is not instrumented
   * @param [onBeforeNotify]
   */
  constructor(value, targetPropertyInstrumented = false, onBeforeNotify) {
    super(value, onBeforeNotify);
    if (targetPropertyInstrumented) {
      this.targetPropertyInstrumented = targetPropertyInstrumented;
    }
    if (assert) {
      this.phetioInitialized = false;
    }
  }

  // API support for setting a Property|ValueType onto the forwarding Property
  setValueOrTargetProperty(node, tandemName, newValueOrTargetProperty) {
    if (isTReadOnlyProperty(newValueOrTargetProperty)) {
      // As a new Property
      this.setTargetProperty(newValueOrTargetProperty, node, tandemName);
    } else {
      // as a ValueType
      const oldValue = this.get();
      this.clearTargetProperty();
      assert && assert(!this.targetProperty, 'just cleared');

      // If we're switching away from a targetProperty, prefer no notification (so set our value to the last value)
      this.setPropertyValue(newValueOrTargetProperty);

      // Changing forwarding target COULD change the value, so send notifications if this is the case.
      if (!this.areValuesEqual(oldValue, newValueOrTargetProperty)) {
        this.notifyListeners(oldValue);
      }
    }
  }

  /**
   * Sets (or unsets if `null` is provided) the Property that we use for forwarding changes.
   *
   * @param newTargetProperty - null to "unset" forwarding.
   * @param node - (For phet-io support only):
   *               The container of TinyForwardingProperty which supports updateLinkedElementForProperty()
   * @param tandemName - null if the Property does not support PhET-iO instrumentation
   * @returns the passed in Node, for chaining.
   */
  setTargetProperty(newTargetProperty, node = null, tandemName = null) {
    assert && node && tandemName === null && this.targetPropertyInstrumented && assert(!node.isPhetioInstrumented(), 'tandemName must be provided for instrumented Nodes');

    // no-op if we are already forwarding to that property OR if we still aren't forwarding
    if (this.targetProperty === newTargetProperty) {
      return node; // for chaining
    }
    const currentForwardingPropertyInstrumented = this.targetProperty && this.targetProperty instanceof ReadOnlyProperty && this.targetProperty.isPhetioInstrumented();
    assert && currentForwardingPropertyInstrumented && assert(newTargetProperty && newTargetProperty instanceof ReadOnlyProperty && newTargetProperty.isPhetioInstrumented(), 'Cannot set swap out a PhET-iO instrumented targetProperty for an uninstrumented one');

    // We need this information eagerly for later on in the function
    const previousTarget = this.targetProperty;

    // If we had the "default instrumented" Property, we'll remove that and then link our new Property. Guard on the fact
    // that ownedPhetioProperty is added via this exact method, see this.initializePhetio() for details
    // Do this before adding a PhET-iO LinkedElement because ownedPhetioProperty has the same phetioID as the LinkedElement
    if (this.ownedPhetioProperty && newTargetProperty !== this.ownedPhetioProperty) {
      this.disposeOwnedPhetioProperty();
    }
    node && tandemName !== null && node.updateLinkedElementForProperty(tandemName, previousTarget, newTargetProperty);
    const oldValue = this.get();
    this.clearTargetProperty();
    this.targetProperty = newTargetProperty;
    if (this.targetProperty) {
      assert && assert(this.forwardingListener, 'forwardingListener is not set yet');
      this.targetProperty.lazyLink(this.forwardingListener);
      this.setPropertyValue(this.targetProperty.value);
    } else {
      // If we're switching away from a targetProperty, prefer no notification (so set our value to the last value)
      this.setPropertyValue(oldValue);
    }

    // Changing forwarding target COULD change the value, so send notifications if this is the case.
    if (!this.areValuesEqual(oldValue, this.get())) {
      this.notifyListeners(oldValue);
    }
    return node; // for chaining
  }
  clearTargetProperty() {
    // Lazily set this value, it will be added as a listener to any targetProperty we have.
    this.forwardingListener = this.forwardingListener || this.onTargetPropertyChange.bind(this);
    if (this.targetProperty) {
      this.targetProperty.unlink(this.forwardingListener);
    }
    this.targetProperty = null;
  }

  /**
   * Notify this Property's listeners when the targetProperty changes.
   * For performance, keep this listener on the prototype.
   */
  onTargetPropertyChange(value) {
    super.set(value);
  }

  /**
   * Sets the value and notifies listeners, unless deferred or disposed. You can also use the es5 getter
   * (property.value) but this means is provided for inner loops or internal code that must be fast. If the value
   * hasn't changed, this is a no-op.
   */
  set(value) {
    if (this.targetProperty) {
      assert && assert(this.targetProperty.isSettable(), 'targetProperty must be settable');
      this.targetProperty.set(value);
    } else {
      super.set(value);
    }
    return this;
  }

  /**
   * Use this to automatically create a forwarded, PhET-iO instrumented Property owned by this TinyForwardingProperty.
   */
  setTargetPropertyInstrumented(targetPropertyInstrumented, node) {
    // See Node.initializePhetioObject for more details on this assertion
    assert && assert(!node.isPhetioInstrumented(), 'this option only works if it is passed in before this Node is instrumented');
    this.targetPropertyInstrumented = targetPropertyInstrumented;
    return node;
  }
  getTargetPropertyInstrumented() {
    return this.targetPropertyInstrumented || false;
  }

  /**
   * @param node - the parent container that supports updateLinkedElementForProperty()
   * @param tandemName
   * @param createProperty - creates an "owned" Property
   */
  initializePhetio(node, tandemName, createProperty) {
    assert && assert(!this.phetioInitialized, 'already initialized');
    assert && assert(!this.ownedPhetioProperty, 'Already created the ownedPhetioProperty');
    if (!this.targetProperty && this.targetPropertyInstrumented) {
      this.ownedPhetioProperty = createProperty();
      assert && assert(this.ownedPhetioProperty instanceof Property, 'The owned property should be an AXON/Property');
      assert && assert(this.ownedPhetioProperty instanceof ReadOnlyProperty && this.ownedPhetioProperty.isPhetioInstrumented(), 'The owned property should be PhET-iO instrumented');
      this.setTargetProperty(this.ownedPhetioProperty, node, tandemName);
    } else if (this.targetProperty && this.targetProperty instanceof ReadOnlyProperty && this.targetProperty.isPhetioInstrumented()) {
      // If the Property was already set, now that it is instrumented, add a LinkedElement for it.
      node.updateLinkedElementForProperty(tandemName, null, this.targetProperty);
    }
    if (assert) {
      this.phetioInitialized = true;
    }
  }

  /**
   * Get the target property, if any. Use sparingly! Internal use only.
   */
  getTargetProperty() {
    return this.targetProperty || null;
  }

  /**
   * This currently also involves deleting the field.
   */
  disposeOwnedPhetioProperty() {
    if (this.ownedPhetioProperty) {
      this.ownedPhetioProperty.dispose();
      delete this.ownedPhetioProperty; // back to original value
    }
  }
  dispose() {
    this.clearTargetProperty();
    this.disposeOwnedPhetioProperty();
    super.dispose();
  }
}
axon.register('TinyForwardingProperty', TinyForwardingProperty);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJheG9uIiwiUHJvcGVydHkiLCJSZWFkT25seVByb3BlcnR5IiwiVGlueVByb3BlcnR5IiwiaXNUUmVhZE9ubHlQcm9wZXJ0eSIsIlRpbnlGb3J3YXJkaW5nUHJvcGVydHkiLCJjb25zdHJ1Y3RvciIsInZhbHVlIiwidGFyZ2V0UHJvcGVydHlJbnN0cnVtZW50ZWQiLCJvbkJlZm9yZU5vdGlmeSIsImFzc2VydCIsInBoZXRpb0luaXRpYWxpemVkIiwic2V0VmFsdWVPclRhcmdldFByb3BlcnR5Iiwibm9kZSIsInRhbmRlbU5hbWUiLCJuZXdWYWx1ZU9yVGFyZ2V0UHJvcGVydHkiLCJzZXRUYXJnZXRQcm9wZXJ0eSIsIm9sZFZhbHVlIiwiZ2V0IiwiY2xlYXJUYXJnZXRQcm9wZXJ0eSIsInRhcmdldFByb3BlcnR5Iiwic2V0UHJvcGVydHlWYWx1ZSIsImFyZVZhbHVlc0VxdWFsIiwibm90aWZ5TGlzdGVuZXJzIiwibmV3VGFyZ2V0UHJvcGVydHkiLCJpc1BoZXRpb0luc3RydW1lbnRlZCIsImN1cnJlbnRGb3J3YXJkaW5nUHJvcGVydHlJbnN0cnVtZW50ZWQiLCJwcmV2aW91c1RhcmdldCIsIm93bmVkUGhldGlvUHJvcGVydHkiLCJkaXNwb3NlT3duZWRQaGV0aW9Qcm9wZXJ0eSIsInVwZGF0ZUxpbmtlZEVsZW1lbnRGb3JQcm9wZXJ0eSIsImZvcndhcmRpbmdMaXN0ZW5lciIsImxhenlMaW5rIiwib25UYXJnZXRQcm9wZXJ0eUNoYW5nZSIsImJpbmQiLCJ1bmxpbmsiLCJzZXQiLCJpc1NldHRhYmxlIiwic2V0VGFyZ2V0UHJvcGVydHlJbnN0cnVtZW50ZWQiLCJnZXRUYXJnZXRQcm9wZXJ0eUluc3RydW1lbnRlZCIsImluaXRpYWxpemVQaGV0aW8iLCJjcmVhdGVQcm9wZXJ0eSIsImdldFRhcmdldFByb3BlcnR5IiwiZGlzcG9zZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVGlueUZvcndhcmRpbmdQcm9wZXJ0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIGxpZ2h0d2VpZ2h0IHZlcnNpb24gb2YgUHJvcGVydHkgKHRoYXQgc2F0aXNmaWVzIHNvbWUgb2YgdGhlIGludGVyZmFjZSksIG1lYW50IGZvciBoaWdoLXBlcmZvcm1hbmNlIGFwcGxpY2F0aW9uc1xyXG4gKiB3aGVyZSB2YWxpZGF0aW9uLCBwaGV0LWlvIHN1cHBvcnQgYW5kIG90aGVyIHRoaW5ncyBhcmUgbm90IG5lZWRlZC4gVGhpcyBpbmNsdWRlcyBhZGRpdGlvbmFsIGxvZ2ljIGZvciBjb25kaXRpb25hbGx5XHJcbiAqIGZvcndhcmRpbmcgdG8vZnJvbSBhbm90aGVyIFByb3BlcnR5LlxyXG4gKlxyXG4gKiBQbGVhc2Ugbm90ZSB0aGF0IFRpbnlGb3J3YXJkaW5nUHJvcGVydHkgZXhjbHVzaXZlbHkgc3VwcG9ydHMgc2V0dGFibGUgUHJvcGVydGllc1xyXG4gKiB2aWEgaXRzIFR5cGVTY3JpcHQgaW1wbGVtZW50YXRpb24uIElmIHlvdSB3YW50IHRvIHVzZSBhIHJlYWQtb25seSBQcm9wZXJ0eSBhcyB0aGUgdGFyZ2V0LCBwbGVhc2UgdHlwZSBjYXN0IGFzIHNldHRhYmxlXHJcbiAqIGFuZCB1c2UgcnVudGltZSBhc3NlcnRpb25zIHRvIGVuc3VyZSB0aGF0IHRoZSB0YXJnZXQgKG9yIHRoaXMgZm9yd2FyZGluZyBQcm9wZXJ0eSkgYXJlIG5vdCBzZXQuIFNlZSBleGFtcGxlcyBsaWtlXHJcbiAqIE5vZGUuc2V0VmlzaWJsZVByb3BlcnR5LlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgYXhvbiBmcm9tICcuL2F4b24uanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSZWFkT25seVByb3BlcnR5IGZyb20gJy4vUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUaW55UHJvcGVydHksIHsgVGlueVByb3BlcnR5T25CZWZvcmVOb3RpZnkgfSBmcm9tICcuL1RpbnlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHksIHsgaXNUUmVhZE9ubHlQcm9wZXJ0eSwgUHJvcGVydHlMYXp5TGlua0xpc3RlbmVyIH0gZnJvbSAnLi9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcblxyXG50eXBlIE5vZGVMaWtlID0ge1xyXG4gIHVwZGF0ZUxpbmtlZEVsZW1lbnRGb3JQcm9wZXJ0eTogPFZhbHVlVHlwZT4oIHRhbmRlbU5hbWU6IHN0cmluZywgb2xkUHJvcGVydHk/OiBUUmVhZE9ubHlQcm9wZXJ0eTxWYWx1ZVR5cGU+IHwgbnVsbCwgbmV3UHJvcGVydHk/OiBUUmVhZE9ubHlQcm9wZXJ0eTxWYWx1ZVR5cGU+IHwgbnVsbCApID0+IHZvaWQ7XHJcbiAgaXNQaGV0aW9JbnN0cnVtZW50ZWQ6ICgpID0+IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaW55Rm9yd2FyZGluZ1Byb3BlcnR5PFZhbHVlVHlwZT4gZXh0ZW5kcyBUaW55UHJvcGVydHk8VmFsdWVUeXBlPiB7XHJcblxyXG4gIC8vIFNldCBpbiBzZXRUYXJnZXRQcm9wZXJ0eSgpLlxyXG4gIHByaXZhdGUgdGFyZ2V0UHJvcGVydHk/OiBUUmVhZE9ubHlQcm9wZXJ0eTxWYWx1ZVR5cGU+IHwgbnVsbDtcclxuXHJcbiAgLy8gU2V0IGxhemlseSBpbiBzZXRUYXJnZXRQcm9wZXJ0eSgpXHJcbiAgcHJvdGVjdGVkIGZvcndhcmRpbmdMaXN0ZW5lcj86IFByb3BlcnR5TGF6eUxpbmtMaXN0ZW5lcjxWYWx1ZVR5cGU+O1xyXG5cclxuICAvLyBUaW55UHJvcGVydHkgaXMgbm90IGluc3RydW1lbnRlZCBmb3IgUGhFVC1pTywgc28gd2hlbiBhIE5vZGUgaXMgaW5zdHJ1bWVudGVkLCBieSBkZWZhdWx0LCBhbiBpbnN0cnVtZW50ZWRcclxuICAvLyBgUHJvcGVydHlgIGNhbiBiZSBmb3J3YXJkZWQgdG8uIFRoaXMgZmllbGQgc3RvcmVzIHRoZSBkZWZhdWx0IGluc3RydW1lbnRlZCBQcm9wZXJ0eSB3aGVuXHJcbiAgLy8gdGFyZ2V0UHJvcGVydHlJbnN0cnVtZW50ZWQgaXMgdHJ1ZS4gLSBQdWJsaWMgZm9yIE5vZGVUZXN0c1xyXG4gIHByaXZhdGUgb3duZWRQaGV0aW9Qcm9wZXJ0eT86IFRQcm9wZXJ0eTxWYWx1ZVR5cGU+O1xyXG5cclxuICAvLyB3aGVuIHRydWUsIGF1dG9tYXRpY2FsbHkgc2V0IHVwIGEgUGhFVC1pTyBpbnN0cnVtZW50ZWQgZm9yd2FyZGVkIFByb3BlcnR5IGZvciB0aGlzIFRpbnlQcm9wZXJ0eSwgc2VlXHJcbiAgLy8gdGhpcy5pbml0aWFsaXplUGhldGlvT2JqZWN0KCkgZm9yIHVzYWdlLlxyXG4gIHByaXZhdGUgdGFyZ2V0UHJvcGVydHlJbnN0cnVtZW50ZWQ/OiBib29sZWFuO1xyXG5cclxuICAvLyBHdWFyZCBhZ2FpbnN0IGRvdWJsZSBpbml0aWFsaXphdGlvblxyXG4gIHByaXZhdGUgcGhldGlvSW5pdGlhbGl6ZWQ/OiBib29sZWFuO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gdmFsdWVcclxuICAgKiBAcGFyYW0gW3RhcmdldFByb3BlcnR5SW5zdHJ1bWVudGVkXSAtIEZvciBwaGV0LWlvIHN1cHBvcnQgb25seSwgc2V0IHRvIGZhbHNlIGlmIHRoZSB0YXJnZXQgUHJvcGVydHkgaXMgbm90IGluc3RydW1lbnRlZFxyXG4gICAqIEBwYXJhbSBbb25CZWZvcmVOb3RpZnldXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCB2YWx1ZTogVmFsdWVUeXBlLCB0YXJnZXRQcm9wZXJ0eUluc3RydW1lbnRlZCA9IGZhbHNlLCBvbkJlZm9yZU5vdGlmeT86IFRpbnlQcm9wZXJ0eU9uQmVmb3JlTm90aWZ5PFZhbHVlVHlwZT4gKSB7XHJcbiAgICBzdXBlciggdmFsdWUsIG9uQmVmb3JlTm90aWZ5ICk7XHJcblxyXG4gICAgaWYgKCB0YXJnZXRQcm9wZXJ0eUluc3RydW1lbnRlZCApIHtcclxuICAgICAgdGhpcy50YXJnZXRQcm9wZXJ0eUluc3RydW1lbnRlZCA9IHRhcmdldFByb3BlcnR5SW5zdHJ1bWVudGVkO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggYXNzZXJ0ICkge1xyXG4gICAgICB0aGlzLnBoZXRpb0luaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBBUEkgc3VwcG9ydCBmb3Igc2V0dGluZyBhIFByb3BlcnR5fFZhbHVlVHlwZSBvbnRvIHRoZSBmb3J3YXJkaW5nIFByb3BlcnR5XHJcbiAgcHVibGljIHNldFZhbHVlT3JUYXJnZXRQcm9wZXJ0eTxOb2RlVHlwZSBleHRlbmRzIE5vZGVMaWtlLCBOb2RlUGFyYW0gZXh0ZW5kcyAoIE5vZGVUeXBlIHwgbnVsbCApPihcclxuICAgIG5vZGU6IE5vZGVQYXJhbSwgdGFuZGVtTmFtZTogc3RyaW5nIHwgbnVsbCwgbmV3VmFsdWVPclRhcmdldFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxWYWx1ZVR5cGU+IHwgVmFsdWVUeXBlICk6IHZvaWQge1xyXG5cclxuICAgIGlmICggKCBpc1RSZWFkT25seVByb3BlcnR5KCBuZXdWYWx1ZU9yVGFyZ2V0UHJvcGVydHkgKSApICkge1xyXG5cclxuICAgICAgLy8gQXMgYSBuZXcgUHJvcGVydHlcclxuICAgICAgdGhpcy5zZXRUYXJnZXRQcm9wZXJ0eSggbmV3VmFsdWVPclRhcmdldFByb3BlcnR5IGFzIFRQcm9wZXJ0eTxWYWx1ZVR5cGU+LCBub2RlLCB0YW5kZW1OYW1lICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHsgLy8gYXMgYSBWYWx1ZVR5cGVcclxuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLmdldCgpO1xyXG5cclxuICAgICAgdGhpcy5jbGVhclRhcmdldFByb3BlcnR5KCk7XHJcblxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhdGhpcy50YXJnZXRQcm9wZXJ0eSwgJ2p1c3QgY2xlYXJlZCcgKTtcclxuXHJcbiAgICAgIC8vIElmIHdlJ3JlIHN3aXRjaGluZyBhd2F5IGZyb20gYSB0YXJnZXRQcm9wZXJ0eSwgcHJlZmVyIG5vIG5vdGlmaWNhdGlvbiAoc28gc2V0IG91ciB2YWx1ZSB0byB0aGUgbGFzdCB2YWx1ZSlcclxuICAgICAgdGhpcy5zZXRQcm9wZXJ0eVZhbHVlKCBuZXdWYWx1ZU9yVGFyZ2V0UHJvcGVydHkgKTtcclxuXHJcbiAgICAgIC8vIENoYW5naW5nIGZvcndhcmRpbmcgdGFyZ2V0IENPVUxEIGNoYW5nZSB0aGUgdmFsdWUsIHNvIHNlbmQgbm90aWZpY2F0aW9ucyBpZiB0aGlzIGlzIHRoZSBjYXNlLlxyXG4gICAgICBpZiAoICF0aGlzLmFyZVZhbHVlc0VxdWFsKCBvbGRWYWx1ZSwgbmV3VmFsdWVPclRhcmdldFByb3BlcnR5ICkgKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoIG9sZFZhbHVlICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgKG9yIHVuc2V0cyBpZiBgbnVsbGAgaXMgcHJvdmlkZWQpIHRoZSBQcm9wZXJ0eSB0aGF0IHdlIHVzZSBmb3IgZm9yd2FyZGluZyBjaGFuZ2VzLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIG5ld1RhcmdldFByb3BlcnR5IC0gbnVsbCB0byBcInVuc2V0XCIgZm9yd2FyZGluZy5cclxuICAgKiBAcGFyYW0gbm9kZSAtIChGb3IgcGhldC1pbyBzdXBwb3J0IG9ubHkpOlxyXG4gICAqICAgICAgICAgICAgICAgVGhlIGNvbnRhaW5lciBvZiBUaW55Rm9yd2FyZGluZ1Byb3BlcnR5IHdoaWNoIHN1cHBvcnRzIHVwZGF0ZUxpbmtlZEVsZW1lbnRGb3JQcm9wZXJ0eSgpXHJcbiAgICogQHBhcmFtIHRhbmRlbU5hbWUgLSBudWxsIGlmIHRoZSBQcm9wZXJ0eSBkb2VzIG5vdCBzdXBwb3J0IFBoRVQtaU8gaW5zdHJ1bWVudGF0aW9uXHJcbiAgICogQHJldHVybnMgdGhlIHBhc3NlZCBpbiBOb2RlLCBmb3IgY2hhaW5pbmcuXHJcbiAgICovXHJcbiAgcHVibGljIHNldFRhcmdldFByb3BlcnR5PE5vZGVUeXBlIGV4dGVuZHMgTm9kZUxpa2UsIE5vZGVQYXJhbSBleHRlbmRzICggTm9kZVR5cGUgfCBudWxsICk+KFxyXG4gICAgbmV3VGFyZ2V0UHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PFZhbHVlVHlwZT4gfCBudWxsLFxyXG4gICAgbm9kZTogTm9kZVBhcmFtID0gbnVsbCBhcyBOb2RlUGFyYW0sXHJcbiAgICB0YW5kZW1OYW1lOiBzdHJpbmcgfCBudWxsID0gbnVsbFxyXG4gICk6IE5vZGVQYXJhbSB7XHJcbiAgICBhc3NlcnQgJiYgbm9kZSAmJiB0YW5kZW1OYW1lID09PSBudWxsICYmIHRoaXMudGFyZ2V0UHJvcGVydHlJbnN0cnVtZW50ZWQgJiYgYXNzZXJ0KCAhbm9kZS5pc1BoZXRpb0luc3RydW1lbnRlZCgpLCAndGFuZGVtTmFtZSBtdXN0IGJlIHByb3ZpZGVkIGZvciBpbnN0cnVtZW50ZWQgTm9kZXMnICk7XHJcblxyXG4gICAgLy8gbm8tb3AgaWYgd2UgYXJlIGFscmVhZHkgZm9yd2FyZGluZyB0byB0aGF0IHByb3BlcnR5IE9SIGlmIHdlIHN0aWxsIGFyZW4ndCBmb3J3YXJkaW5nXHJcbiAgICBpZiAoIHRoaXMudGFyZ2V0UHJvcGVydHkgPT09IG5ld1RhcmdldFByb3BlcnR5ICkge1xyXG4gICAgICByZXR1cm4gbm9kZTsgLy8gZm9yIGNoYWluaW5nXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY3VycmVudEZvcndhcmRpbmdQcm9wZXJ0eUluc3RydW1lbnRlZCA9IHRoaXMudGFyZ2V0UHJvcGVydHkgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFByb3BlcnR5IGluc3RhbmNlb2YgUmVhZE9ubHlQcm9wZXJ0eSAmJiB0aGlzLnRhcmdldFByb3BlcnR5LmlzUGhldGlvSW5zdHJ1bWVudGVkKCk7XHJcbiAgICBhc3NlcnQgJiYgY3VycmVudEZvcndhcmRpbmdQcm9wZXJ0eUluc3RydW1lbnRlZCAmJiBhc3NlcnQoIG5ld1RhcmdldFByb3BlcnR5ICYmIG5ld1RhcmdldFByb3BlcnR5IGluc3RhbmNlb2YgUmVhZE9ubHlQcm9wZXJ0eSAmJiBuZXdUYXJnZXRQcm9wZXJ0eS5pc1BoZXRpb0luc3RydW1lbnRlZCgpLFxyXG4gICAgICAnQ2Fubm90IHNldCBzd2FwIG91dCBhIFBoRVQtaU8gaW5zdHJ1bWVudGVkIHRhcmdldFByb3BlcnR5IGZvciBhbiB1bmluc3RydW1lbnRlZCBvbmUnICk7XHJcblxyXG4gICAgLy8gV2UgbmVlZCB0aGlzIGluZm9ybWF0aW9uIGVhZ2VybHkgZm9yIGxhdGVyIG9uIGluIHRoZSBmdW5jdGlvblxyXG4gICAgY29uc3QgcHJldmlvdXNUYXJnZXQgPSB0aGlzLnRhcmdldFByb3BlcnR5O1xyXG5cclxuICAgIC8vIElmIHdlIGhhZCB0aGUgXCJkZWZhdWx0IGluc3RydW1lbnRlZFwiIFByb3BlcnR5LCB3ZSdsbCByZW1vdmUgdGhhdCBhbmQgdGhlbiBsaW5rIG91ciBuZXcgUHJvcGVydHkuIEd1YXJkIG9uIHRoZSBmYWN0XHJcbiAgICAvLyB0aGF0IG93bmVkUGhldGlvUHJvcGVydHkgaXMgYWRkZWQgdmlhIHRoaXMgZXhhY3QgbWV0aG9kLCBzZWUgdGhpcy5pbml0aWFsaXplUGhldGlvKCkgZm9yIGRldGFpbHNcclxuICAgIC8vIERvIHRoaXMgYmVmb3JlIGFkZGluZyBhIFBoRVQtaU8gTGlua2VkRWxlbWVudCBiZWNhdXNlIG93bmVkUGhldGlvUHJvcGVydHkgaGFzIHRoZSBzYW1lIHBoZXRpb0lEIGFzIHRoZSBMaW5rZWRFbGVtZW50XHJcbiAgICBpZiAoIHRoaXMub3duZWRQaGV0aW9Qcm9wZXJ0eSAmJiBuZXdUYXJnZXRQcm9wZXJ0eSAhPT0gdGhpcy5vd25lZFBoZXRpb1Byb3BlcnR5ICkge1xyXG4gICAgICB0aGlzLmRpc3Bvc2VPd25lZFBoZXRpb1Byb3BlcnR5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbm9kZSAmJiB0YW5kZW1OYW1lICE9PSBudWxsICYmIG5vZGUudXBkYXRlTGlua2VkRWxlbWVudEZvclByb3BlcnR5KCB0YW5kZW1OYW1lLCBwcmV2aW91c1RhcmdldCwgbmV3VGFyZ2V0UHJvcGVydHkgKTtcclxuXHJcbiAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuZ2V0KCk7XHJcblxyXG4gICAgdGhpcy5jbGVhclRhcmdldFByb3BlcnR5KCk7XHJcblxyXG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IG5ld1RhcmdldFByb3BlcnR5O1xyXG5cclxuICAgIGlmICggdGhpcy50YXJnZXRQcm9wZXJ0eSApIHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5mb3J3YXJkaW5nTGlzdGVuZXIsICdmb3J3YXJkaW5nTGlzdGVuZXIgaXMgbm90IHNldCB5ZXQnICk7XHJcbiAgICAgIHRoaXMudGFyZ2V0UHJvcGVydHkubGF6eUxpbmsoIHRoaXMuZm9yd2FyZGluZ0xpc3RlbmVyISApO1xyXG4gICAgICB0aGlzLnNldFByb3BlcnR5VmFsdWUoIHRoaXMudGFyZ2V0UHJvcGVydHkudmFsdWUgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBJZiB3ZSdyZSBzd2l0Y2hpbmcgYXdheSBmcm9tIGEgdGFyZ2V0UHJvcGVydHksIHByZWZlciBubyBub3RpZmljYXRpb24gKHNvIHNldCBvdXIgdmFsdWUgdG8gdGhlIGxhc3QgdmFsdWUpXHJcbiAgICAgIHRoaXMuc2V0UHJvcGVydHlWYWx1ZSggb2xkVmFsdWUgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGFuZ2luZyBmb3J3YXJkaW5nIHRhcmdldCBDT1VMRCBjaGFuZ2UgdGhlIHZhbHVlLCBzbyBzZW5kIG5vdGlmaWNhdGlvbnMgaWYgdGhpcyBpcyB0aGUgY2FzZS5cclxuICAgIGlmICggIXRoaXMuYXJlVmFsdWVzRXF1YWwoIG9sZFZhbHVlLCB0aGlzLmdldCgpICkgKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKCBvbGRWYWx1ZSApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBub2RlOyAvLyBmb3IgY2hhaW5pbmdcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xlYXJUYXJnZXRQcm9wZXJ0eSgpOiB2b2lkIHtcclxuXHJcbiAgICAvLyBMYXppbHkgc2V0IHRoaXMgdmFsdWUsIGl0IHdpbGwgYmUgYWRkZWQgYXMgYSBsaXN0ZW5lciB0byBhbnkgdGFyZ2V0UHJvcGVydHkgd2UgaGF2ZS5cclxuICAgIHRoaXMuZm9yd2FyZGluZ0xpc3RlbmVyID0gdGhpcy5mb3J3YXJkaW5nTGlzdGVuZXIgfHwgdGhpcy5vblRhcmdldFByb3BlcnR5Q2hhbmdlLmJpbmQoIHRoaXMgKTtcclxuXHJcbiAgICBpZiAoIHRoaXMudGFyZ2V0UHJvcGVydHkgKSB7XHJcbiAgICAgIHRoaXMudGFyZ2V0UHJvcGVydHkudW5saW5rKCB0aGlzLmZvcndhcmRpbmdMaXN0ZW5lciApO1xyXG4gICAgfVxyXG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBOb3RpZnkgdGhpcyBQcm9wZXJ0eSdzIGxpc3RlbmVycyB3aGVuIHRoZSB0YXJnZXRQcm9wZXJ0eSBjaGFuZ2VzLlxyXG4gICAqIEZvciBwZXJmb3JtYW5jZSwga2VlcCB0aGlzIGxpc3RlbmVyIG9uIHRoZSBwcm90b3R5cGUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvblRhcmdldFByb3BlcnR5Q2hhbmdlKCB2YWx1ZTogVmFsdWVUeXBlICk6IHZvaWQge1xyXG4gICAgc3VwZXIuc2V0KCB2YWx1ZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgdmFsdWUgYW5kIG5vdGlmaWVzIGxpc3RlbmVycywgdW5sZXNzIGRlZmVycmVkIG9yIGRpc3Bvc2VkLiBZb3UgY2FuIGFsc28gdXNlIHRoZSBlczUgZ2V0dGVyXHJcbiAgICogKHByb3BlcnR5LnZhbHVlKSBidXQgdGhpcyBtZWFucyBpcyBwcm92aWRlZCBmb3IgaW5uZXIgbG9vcHMgb3IgaW50ZXJuYWwgY29kZSB0aGF0IG11c3QgYmUgZmFzdC4gSWYgdGhlIHZhbHVlXHJcbiAgICogaGFzbid0IGNoYW5nZWQsIHRoaXMgaXMgYSBuby1vcC5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgc2V0KCB2YWx1ZTogVmFsdWVUeXBlICk6IHRoaXMge1xyXG4gICAgaWYgKCB0aGlzLnRhcmdldFByb3BlcnR5ICkge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnRhcmdldFByb3BlcnR5LmlzU2V0dGFibGUoKSwgJ3RhcmdldFByb3BlcnR5IG11c3QgYmUgc2V0dGFibGUnICk7XHJcbiAgICAgICggdGhpcy50YXJnZXRQcm9wZXJ0eSBhcyBUUHJvcGVydHk8VmFsdWVUeXBlPiApLnNldCggdmFsdWUgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBzdXBlci5zZXQoIHZhbHVlICk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVzZSB0aGlzIHRvIGF1dG9tYXRpY2FsbHkgY3JlYXRlIGEgZm9yd2FyZGVkLCBQaEVULWlPIGluc3RydW1lbnRlZCBQcm9wZXJ0eSBvd25lZCBieSB0aGlzIFRpbnlGb3J3YXJkaW5nUHJvcGVydHkuXHJcbiAgICovXHJcbiAgcHVibGljIHNldFRhcmdldFByb3BlcnR5SW5zdHJ1bWVudGVkPE5vZGVUeXBlIGV4dGVuZHMgTm9kZUxpa2U+KCB0YXJnZXRQcm9wZXJ0eUluc3RydW1lbnRlZDogYm9vbGVhbiwgbm9kZTogTm9kZVR5cGUgKTogTm9kZVR5cGUge1xyXG5cclxuICAgIC8vIFNlZSBOb2RlLmluaXRpYWxpemVQaGV0aW9PYmplY3QgZm9yIG1vcmUgZGV0YWlscyBvbiB0aGlzIGFzc2VydGlvblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIW5vZGUuaXNQaGV0aW9JbnN0cnVtZW50ZWQoKSwgJ3RoaXMgb3B0aW9uIG9ubHkgd29ya3MgaWYgaXQgaXMgcGFzc2VkIGluIGJlZm9yZSB0aGlzIE5vZGUgaXMgaW5zdHJ1bWVudGVkJyApO1xyXG5cclxuICAgIHRoaXMudGFyZ2V0UHJvcGVydHlJbnN0cnVtZW50ZWQgPSB0YXJnZXRQcm9wZXJ0eUluc3RydW1lbnRlZDtcclxuXHJcbiAgICByZXR1cm4gbm9kZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRUYXJnZXRQcm9wZXJ0eUluc3RydW1lbnRlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnRhcmdldFByb3BlcnR5SW5zdHJ1bWVudGVkIHx8IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIG5vZGUgLSB0aGUgcGFyZW50IGNvbnRhaW5lciB0aGF0IHN1cHBvcnRzIHVwZGF0ZUxpbmtlZEVsZW1lbnRGb3JQcm9wZXJ0eSgpXHJcbiAgICogQHBhcmFtIHRhbmRlbU5hbWVcclxuICAgKiBAcGFyYW0gY3JlYXRlUHJvcGVydHkgLSBjcmVhdGVzIGFuIFwib3duZWRcIiBQcm9wZXJ0eVxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0aWFsaXplUGhldGlvKCBub2RlOiBOb2RlTGlrZSwgdGFuZGVtTmFtZTogc3RyaW5nLCBjcmVhdGVQcm9wZXJ0eTogKCkgPT4gVFByb3BlcnR5PFZhbHVlVHlwZT4gKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhdGhpcy5waGV0aW9Jbml0aWFsaXplZCwgJ2FscmVhZHkgaW5pdGlhbGl6ZWQnICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhdGhpcy5vd25lZFBoZXRpb1Byb3BlcnR5LCAnQWxyZWFkeSBjcmVhdGVkIHRoZSBvd25lZFBoZXRpb1Byb3BlcnR5JyApO1xyXG5cclxuICAgIGlmICggIXRoaXMudGFyZ2V0UHJvcGVydHkgJiYgdGhpcy50YXJnZXRQcm9wZXJ0eUluc3RydW1lbnRlZCApIHtcclxuXHJcbiAgICAgIHRoaXMub3duZWRQaGV0aW9Qcm9wZXJ0eSA9IGNyZWF0ZVByb3BlcnR5KCk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMub3duZWRQaGV0aW9Qcm9wZXJ0eSBpbnN0YW5jZW9mIFByb3BlcnR5LCAnVGhlIG93bmVkIHByb3BlcnR5IHNob3VsZCBiZSBhbiBBWE9OL1Byb3BlcnR5JyApO1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLm93bmVkUGhldGlvUHJvcGVydHkgaW5zdGFuY2VvZiBSZWFkT25seVByb3BlcnR5ICYmIHRoaXMub3duZWRQaGV0aW9Qcm9wZXJ0eS5pc1BoZXRpb0luc3RydW1lbnRlZCgpLCAnVGhlIG93bmVkIHByb3BlcnR5IHNob3VsZCBiZSBQaEVULWlPIGluc3RydW1lbnRlZCcgKTtcclxuXHJcbiAgICAgIHRoaXMuc2V0VGFyZ2V0UHJvcGVydHkoIHRoaXMub3duZWRQaGV0aW9Qcm9wZXJ0eSwgbm9kZSwgdGFuZGVtTmFtZSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHRoaXMudGFyZ2V0UHJvcGVydHkgJiYgdGhpcy50YXJnZXRQcm9wZXJ0eSBpbnN0YW5jZW9mIFJlYWRPbmx5UHJvcGVydHkgJiYgdGhpcy50YXJnZXRQcm9wZXJ0eS5pc1BoZXRpb0luc3RydW1lbnRlZCgpICkge1xyXG5cclxuICAgICAgLy8gSWYgdGhlIFByb3BlcnR5IHdhcyBhbHJlYWR5IHNldCwgbm93IHRoYXQgaXQgaXMgaW5zdHJ1bWVudGVkLCBhZGQgYSBMaW5rZWRFbGVtZW50IGZvciBpdC5cclxuICAgICAgbm9kZS51cGRhdGVMaW5rZWRFbGVtZW50Rm9yUHJvcGVydHkoIHRhbmRlbU5hbWUsIG51bGwsIHRoaXMudGFyZ2V0UHJvcGVydHkgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIGFzc2VydCApIHtcclxuICAgICAgdGhpcy5waGV0aW9Jbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIHRhcmdldCBwcm9wZXJ0eSwgaWYgYW55LiBVc2Ugc3BhcmluZ2x5ISBJbnRlcm5hbCB1c2Ugb25seS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0VGFyZ2V0UHJvcGVydHkoKTogVFJlYWRPbmx5UHJvcGVydHk8VmFsdWVUeXBlPiB8IG51bGwge1xyXG4gICAgcmV0dXJuIHRoaXMudGFyZ2V0UHJvcGVydHkgfHwgbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgY3VycmVudGx5IGFsc28gaW52b2x2ZXMgZGVsZXRpbmcgdGhlIGZpZWxkLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZGlzcG9zZU93bmVkUGhldGlvUHJvcGVydHkoKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMub3duZWRQaGV0aW9Qcm9wZXJ0eSApIHtcclxuICAgICAgdGhpcy5vd25lZFBoZXRpb1Byb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgZGVsZXRlIHRoaXMub3duZWRQaGV0aW9Qcm9wZXJ0eTsgLy8gYmFjayB0byBvcmlnaW5hbCB2YWx1ZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNsZWFyVGFyZ2V0UHJvcGVydHkoKTtcclxuICAgIHRoaXMuZGlzcG9zZU93bmVkUGhldGlvUHJvcGVydHkoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbmF4b24ucmVnaXN0ZXIoICdUaW55Rm9yd2FyZGluZ1Byb3BlcnR5JywgVGlueUZvcndh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