// Copyright 2016-2024, University of Colorado Boulder

/**
 * Property whose value must be a number.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Range from '../../dot/js/Range.js';
import optionize from '../../phet-core/js/optionize.js';
import Tandem from '../../tandem/js/Tandem.js';
import IOType from '../../tandem/js/types/IOType.js';
import NullableIO from '../../tandem/js/types/NullableIO.js';
import NumberIO from '../../tandem/js/types/NumberIO.js';
import StringIO from '../../tandem/js/types/StringIO.js';
import axon from './axon.js';
import ReadOnlyProperty from './ReadOnlyProperty.js';
import Property from './Property.js';
import validate from './validate.js';
import assertMutuallyExclusiveOptions from '../../phet-core/js/assertMutuallyExclusiveOptions.js';
const VALID_INTEGER = {
  valueType: 'number',
  isValidValue: v => v % 1 === 0,
  validationMessage: 'Should be a valid integer'
};
const VALID_NON_NAN = {
  isValidValue: v => !isNaN(v),
  validationMessage: 'Should not be NaN'
};
const VALIDATE_OPTIONS_FALSE = {
  validateValidator: false
};

// valid values for options.numberType to convey whether it is continuous or discrete with step size 1
const VALID_NUMBER_TYPES = ['FloatingPoint', 'Integer'];
// standardized tandem name for rangeProperty
const RANGE_PROPERTY_TANDEM_NAME = 'rangeProperty';
export const DEFAULT_RANGE = Range.EVERYTHING;
// For the IOType
const PropertyIOImpl = Property.PropertyIO(NumberIO);
export default class NumberProperty extends Property {
  // Used by PhET-iO in NumberPropertyIO as metadata passed to the wrapper.
  // @readonly, but cannot set as such because it is set by PhET-iO state.

  // validation for NumberProperty and its rangeProperty, undefined if assertions are disabled

  constructor(value, providedOptions) {
    // Please feel free to remove this if you have a reasonable case!
    assert && providedOptions && assertMutuallyExclusiveOptions(['range'], ['validValues']);
    const options = optionize()({
      // NumberPropertyOptions
      numberType: 'FloatingPoint',
      range: DEFAULT_RANGE,
      // PropertyOptions
      validators: [],
      phetioOuterType: () => NumberProperty.NumberPropertyIO
    }, providedOptions);
    options.rangePropertyOptions = optionize()({
      phetioDocumentation: 'Provides the range of possible values for the parent NumberPropertyIO',
      phetioValueType: Range.RangeIO,
      phetioReadOnly: true,
      // If provided range is the default, don't instrument the PhET-iO RangeProperty
      tandem: options.range !== DEFAULT_RANGE ? options.tandem?.createTandem(RANGE_PROPERTY_TANDEM_NAME) : Tandem.OPT_OUT
    }, options.rangePropertyOptions);
    if (assert && Tandem.VALIDATION && options.rangePropertyOptions.tandem && options.rangePropertyOptions.tandem.supplied) {
      assert && assert(options.rangePropertyOptions.tandem.name === RANGE_PROPERTY_TANDEM_NAME, `rangePropertyOptions.tandem.name must be ${RANGE_PROPERTY_TANDEM_NAME}: ${options.rangePropertyOptions.tandem.name}`);
    }

    // client cannot specify superclass options that are controlled by NumberProperty
    options.valueType = 'number';
    options.phetioValueType = NumberIO; // not actually used, but for completeness, don't have ReadOnlyProperty storing the wrong default.

    const rangePropertyProvided = options.range && options.range instanceof ReadOnlyProperty;
    const ownsRangeProperty = !rangePropertyProvided;
    const rangeProperty = options.range instanceof ReadOnlyProperty ? options.range : new Property(options.range, options.rangePropertyOptions);
    options.validators.push(VALID_NON_NAN); // seems right for this to run first
    if (options.numberType === 'Integer') {
      options.validators.push(VALID_INTEGER);
    }
    let calledSuper = false; // We cannot use this.value until after the super() call
    options.validators.push({
      isValidValue: v => rangeProperty.value.contains(v),
      validationMessage: () => `Number value ${calledSuper ? this.value : value} must be within rangeProperty value: ${rangeProperty.value}`
    });
    super(value, options);
    calledSuper = true;
    this.numberType = options.numberType;
    this.rangeProperty = rangeProperty;
    if (assert && Tandem.VALIDATION && this.rangeProperty.isPhetioInstrumented()) {
      assert && assert(this.isPhetioInstrumented(), 'NumberProperty must be phet-io instrumented if the range is');
    }
    const rangePropertyObserver = () => {
      validate(this.value, this.valueValidator, VALIDATE_OPTIONS_FALSE);
    };
    assert && this.rangeProperty.link(rangePropertyObserver);

    // For PhET-iO State, make sure that both the range and this value are correct before firing notifications (where the assertions are).
    this.rangeProperty.addPhetioStateDependencies([this]);
    this.addPhetioStateDependencies([this.rangeProperty]);

    // verify that validValues meet other NumberProperty-specific validation criteria
    if (options.validValues && this.validateNumberAndRangeProperty) {
      for (let i = 0; i < options.validValues.length; i++) {
        const validValue = options.validValues[i];
        this.validateNumberAndRangeProperty(validValue);
      }
    }
    this.disposeNumberProperty = () => {
      if (ownsRangeProperty) {
        this.rangeProperty.dispose();
      } else if (assert) {
        this.rangeProperty.unlink(rangePropertyObserver);
      }
    };
    this.resetNumberProperty = () => {
      ownsRangeProperty && this.rangeProperty.reset();
    };
  }
  get range() {
    return this.rangeProperty.value;
  }

  /**
   * Convenience function for setting the rangeProperty. Note: be careful using this function, as validation will occur
   * immediately, and if the value is outside of this new Range an error will occur. See this.setValueAndRange() for
   *  way to set both at once without assertion errors.
   */
  set range(range) {
    this.rangeProperty.value = range;
  }
  reset() {
    this.resetValueAndRange(); // even if we don't own the range, reset them together to prevent assertions, https://github.com/phetsims/axon/issues/427
    super.reset();
  }
  dispose() {
    this.disposeNumberProperty();
    super.dispose();
  }

  /**
   * An atomic setting function that will set a range and a value at the same time, to make sure that validation does
   * not fail after one but has been set not the other.
   */
  setValueAndRange(value, range) {
    assert && assert(range.contains(value), `value ${value} is not in range [${range.min},${range.max}]`);

    // defer notification of listeners
    this.setDeferred(true);
    this.rangeProperty.setDeferred(true);

    // set values
    this.set(value);
    this.rangeProperty.set(range);

    // notify listeners if the values have changed
    const notifyValueListeners = this.setDeferred(false);
    const notifyRangeListeners = this.rangeProperty.setDeferred(false);
    notifyValueListeners && notifyValueListeners();
    notifyRangeListeners && notifyRangeListeners();
  }

  /**
   * Resets the value and range atomically.
   * If you use setValueAndRange, you'll likely need to use this instead of reset.
   */
  resetValueAndRange() {
    this.setValueAndRange(this.initialValue, this.rangeProperty.initialValue);
  }

  /**
   * Get parent state and append NumberProperty-specific metadata to it.
   */
  toStateObject() {
    const parentStateObject = PropertyIOImpl.toStateObject(this);
    parentStateObject.numberType = this.numberType;
    parentStateObject.range = Range.RangeIO.toStateObject(this.rangeProperty.value);
    const hasRangePhetioID = this.rangeProperty && this.rangeProperty.isPhetioInstrumented();
    parentStateObject.rangePhetioID = hasRangePhetioID ? this.rangeProperty.tandem.phetioID : null;
    return parentStateObject;
  }
  static NumberPropertyIO = new IOType('NumberPropertyIO', {
    valueType: NumberProperty,
    supertype: PropertyIOImpl,
    parameterTypes: [NumberIO],
    documentation: `Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '${VALID_NUMBER_TYPES.join('\' | \'')}' )`,
    toStateObject: numberProperty => {
      return numberProperty.toStateObject();
    },
    applyState: (numberProperty, stateObject) => {
      // nothing to do here for range, because in order to support range, this NumberProperty's rangeProperty must be instrumented.

      PropertyIOImpl.applyState(numberProperty, stateObject);
    },
    stateSchema: {
      numberType: StringIO,
      range: Range.RangeIO,
      rangePhetioID: NullableIO(StringIO)
    }
  });
}
axon.register('NumberProperty', NumberProperty);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSYW5nZSIsIm9wdGlvbml6ZSIsIlRhbmRlbSIsIklPVHlwZSIsIk51bGxhYmxlSU8iLCJOdW1iZXJJTyIsIlN0cmluZ0lPIiwiYXhvbiIsIlJlYWRPbmx5UHJvcGVydHkiLCJQcm9wZXJ0eSIsInZhbGlkYXRlIiwiYXNzZXJ0TXV0dWFsbHlFeGNsdXNpdmVPcHRpb25zIiwiVkFMSURfSU5URUdFUiIsInZhbHVlVHlwZSIsImlzVmFsaWRWYWx1ZSIsInYiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIlZBTElEX05PTl9OQU4iLCJpc05hTiIsIlZBTElEQVRFX09QVElPTlNfRkFMU0UiLCJ2YWxpZGF0ZVZhbGlkYXRvciIsIlZBTElEX05VTUJFUl9UWVBFUyIsIlJBTkdFX1BST1BFUlRZX1RBTkRFTV9OQU1FIiwiREVGQVVMVF9SQU5HRSIsIkVWRVJZVEhJTkciLCJQcm9wZXJ0eUlPSW1wbCIsIlByb3BlcnR5SU8iLCJOdW1iZXJQcm9wZXJ0eSIsImNvbnN0cnVjdG9yIiwidmFsdWUiLCJwcm92aWRlZE9wdGlvbnMiLCJhc3NlcnQiLCJvcHRpb25zIiwibnVtYmVyVHlwZSIsInJhbmdlIiwidmFsaWRhdG9ycyIsInBoZXRpb091dGVyVHlwZSIsIk51bWJlclByb3BlcnR5SU8iLCJyYW5nZVByb3BlcnR5T3B0aW9ucyIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJwaGV0aW9WYWx1ZVR5cGUiLCJSYW5nZUlPIiwicGhldGlvUmVhZE9ubHkiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJPUFRfT1VUIiwiVkFMSURBVElPTiIsInN1cHBsaWVkIiwibmFtZSIsInJhbmdlUHJvcGVydHlQcm92aWRlZCIsIm93bnNSYW5nZVByb3BlcnR5IiwicmFuZ2VQcm9wZXJ0eSIsInB1c2giLCJjYWxsZWRTdXBlciIsImNvbnRhaW5zIiwiaXNQaGV0aW9JbnN0cnVtZW50ZWQiLCJyYW5nZVByb3BlcnR5T2JzZXJ2ZXIiLCJ2YWx1ZVZhbGlkYXRvciIsImxpbmsiLCJhZGRQaGV0aW9TdGF0ZURlcGVuZGVuY2llcyIsInZhbGlkVmFsdWVzIiwidmFsaWRhdGVOdW1iZXJBbmRSYW5nZVByb3BlcnR5IiwiaSIsImxlbmd0aCIsInZhbGlkVmFsdWUiLCJkaXNwb3NlTnVtYmVyUHJvcGVydHkiLCJkaXNwb3NlIiwidW5saW5rIiwicmVzZXROdW1iZXJQcm9wZXJ0eSIsInJlc2V0IiwicmVzZXRWYWx1ZUFuZFJhbmdlIiwic2V0VmFsdWVBbmRSYW5nZSIsIm1pbiIsIm1heCIsInNldERlZmVycmVkIiwic2V0Iiwibm90aWZ5VmFsdWVMaXN0ZW5lcnMiLCJub3RpZnlSYW5nZUxpc3RlbmVycyIsImluaXRpYWxWYWx1ZSIsInRvU3RhdGVPYmplY3QiLCJwYXJlbnRTdGF0ZU9iamVjdCIsImhhc1JhbmdlUGhldGlvSUQiLCJyYW5nZVBoZXRpb0lEIiwicGhldGlvSUQiLCJzdXBlcnR5cGUiLCJwYXJhbWV0ZXJUeXBlcyIsImRvY3VtZW50YXRpb24iLCJqb2luIiwibnVtYmVyUHJvcGVydHkiLCJhcHBseVN0YXRlIiwic3RhdGVPYmplY3QiLCJzdGF0ZVNjaGVtYSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTnVtYmVyUHJvcGVydHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUHJvcGVydHkgd2hvc2UgdmFsdWUgbXVzdCBiZSBhIG51bWJlci5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgUmFuZ2UsIHsgUmFuZ2VTdGF0ZU9iamVjdCB9IGZyb20gJy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBTdHJpbmdJTyBmcm9tICcuLi8uLi90YW5kZW0vanMvdHlwZXMvU3RyaW5nSU8uanMnO1xyXG5pbXBvcnQgYXhvbiBmcm9tICcuL2F4b24uanMnO1xyXG5pbXBvcnQgUmVhZE9ubHlQcm9wZXJ0eSwgeyBSZWFkT25seVByb3BlcnR5U3RhdGUgfSBmcm9tICcuL1JlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHksIHsgUHJvcGVydHlPcHRpb25zIH0gZnJvbSAnLi9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCB2YWxpZGF0ZSBmcm9tICcuL3ZhbGlkYXRlLmpzJztcclxuaW1wb3J0IFRSYW5nZWRQcm9wZXJ0eSBmcm9tICcuL1RSYW5nZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBhc3NlcnRNdXR1YWxseUV4Y2x1c2l2ZU9wdGlvbnMgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL2Fzc2VydE11dHVhbGx5RXhjbHVzaXZlT3B0aW9ucy5qcyc7XHJcbmltcG9ydCB7IFBoZXRpb0lEIH0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbUNvbnN0YW50cy5qcyc7XHJcblxyXG5jb25zdCBWQUxJRF9JTlRFR0VSID0geyB2YWx1ZVR5cGU6ICdudW1iZXInLCBpc1ZhbGlkVmFsdWU6ICggdjogbnVtYmVyICkgPT4gdiAlIDEgPT09IDAsIHZhbGlkYXRpb25NZXNzYWdlOiAnU2hvdWxkIGJlIGEgdmFsaWQgaW50ZWdlcicgfTtcclxuY29uc3QgVkFMSURfTk9OX05BTiA9IHsgaXNWYWxpZFZhbHVlOiAoIHY6IG51bWJlciApID0+ICFpc05hTiggdiApLCB2YWxpZGF0aW9uTWVzc2FnZTogJ1Nob3VsZCBub3QgYmUgTmFOJyB9O1xyXG5jb25zdCBWQUxJREFURV9PUFRJT05TX0ZBTFNFID0geyB2YWxpZGF0ZVZhbGlkYXRvcjogZmFsc2UgfTtcclxuXHJcbi8vIHZhbGlkIHZhbHVlcyBmb3Igb3B0aW9ucy5udW1iZXJUeXBlIHRvIGNvbnZleSB3aGV0aGVyIGl0IGlzIGNvbnRpbnVvdXMgb3IgZGlzY3JldGUgd2l0aCBzdGVwIHNpemUgMVxyXG5jb25zdCBWQUxJRF9OVU1CRVJfVFlQRVMgPSBbICdGbG9hdGluZ1BvaW50JywgJ0ludGVnZXInIF0gYXMgY29uc3Q7XHJcbnR5cGUgTnVtYmVyVHlwZSA9IHR5cGVvZiBWQUxJRF9OVU1CRVJfVFlQRVNbbnVtYmVyXTtcclxuXHJcbi8vIHN0YW5kYXJkaXplZCB0YW5kZW0gbmFtZSBmb3IgcmFuZ2VQcm9wZXJ0eVxyXG5jb25zdCBSQU5HRV9QUk9QRVJUWV9UQU5ERU1fTkFNRSA9ICdyYW5nZVByb3BlcnR5JztcclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1JBTkdFID0gUmFuZ2UuRVZFUllUSElORztcclxuXHJcbnR5cGUgTnVtYmVyUHJvcGVydHlTZWxmU3RhdGUgPSB7XHJcbiAgbnVtYmVyVHlwZTogc3RyaW5nO1xyXG4gIHJhbmdlOiBSYW5nZVN0YXRlT2JqZWN0O1xyXG4gIHJhbmdlUGhldGlvSUQ6IFBoZXRpb0lEIHwgbnVsbDtcclxufTtcclxuZXhwb3J0IHR5cGUgTnVtYmVyUHJvcGVydHlTdGF0ZSA9IE51bWJlclByb3BlcnR5U2VsZlN0YXRlICYgUmVhZE9ubHlQcm9wZXJ0eVN0YXRlPG51bWJlcj47XHJcblxyXG4vLyBGb3IgdGhlIElPVHlwZVxyXG5jb25zdCBQcm9wZXJ0eUlPSW1wbCA9IFByb3BlcnR5LlByb3BlcnR5SU8oIE51bWJlcklPICk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIG51bWJlclR5cGU/OiBOdW1iZXJUeXBlO1xyXG4gIHJhbmdlPzogUmFuZ2UgfCBQcm9wZXJ0eTxSYW5nZT47XHJcblxyXG4gIC8vIFBhc3NlZCB0byB0aGlzLnJhbmdlUHJvcGVydHkgaWYgTnVtYmVyUHJvcGVydHkgY3JlYXRlcyBpdC4gSWdub3JlZCBpZiBhIFByb3BlcnR5IGlzIHByb3ZpZGVkIHZpYSBvcHRpb25zLnJhbmdlLlxyXG4gIHJhbmdlUHJvcGVydHlPcHRpb25zPzogUHJvcGVydHlPcHRpb25zPFJhbmdlPjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIE51bWJlclByb3BlcnR5T3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxQcm9wZXJ0eU9wdGlvbnM8bnVtYmVyPiwgJ3BoZXRpb1ZhbHVlVHlwZScgfCAndmFsdWVUeXBlJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOdW1iZXJQcm9wZXJ0eSBleHRlbmRzIFByb3BlcnR5PG51bWJlcj4gaW1wbGVtZW50cyBUUmFuZ2VkUHJvcGVydHkge1xyXG5cclxuICAvLyBVc2VkIGJ5IFBoRVQtaU8gaW4gTnVtYmVyUHJvcGVydHlJTyBhcyBtZXRhZGF0YSBwYXNzZWQgdG8gdGhlIHdyYXBwZXIuXHJcbiAgLy8gQHJlYWRvbmx5LCBidXQgY2Fubm90IHNldCBhcyBzdWNoIGJlY2F1c2UgaXQgaXMgc2V0IGJ5IFBoRVQtaU8gc3RhdGUuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBudW1iZXJUeXBlOiBOdW1iZXJUeXBlO1xyXG5cclxuICAvLyB2YWxpZGF0aW9uIGZvciBOdW1iZXJQcm9wZXJ0eSBhbmQgaXRzIHJhbmdlUHJvcGVydHksIHVuZGVmaW5lZCBpZiBhc3NlcnRpb25zIGFyZSBkaXNhYmxlZFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgdmFsaWRhdGVOdW1iZXJBbmRSYW5nZVByb3BlcnR5OiAoICggdmFsdWU6IG51bWJlciApID0+IHZvaWQgKSB8IHVuZGVmaW5lZDtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IHJhbmdlUHJvcGVydHk6IFByb3BlcnR5PFJhbmdlPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VOdW1iZXJQcm9wZXJ0eTogKCkgPT4gdm9pZDtcclxuICBwcml2YXRlIHJlYWRvbmx5IHJlc2V0TnVtYmVyUHJvcGVydHk6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggdmFsdWU6IG51bWJlciwgcHJvdmlkZWRPcHRpb25zPzogTnVtYmVyUHJvcGVydHlPcHRpb25zICkge1xyXG5cclxuICAgIC8vIFBsZWFzZSBmZWVsIGZyZWUgdG8gcmVtb3ZlIHRoaXMgaWYgeW91IGhhdmUgYSByZWFzb25hYmxlIGNhc2UhXHJcbiAgICBhc3NlcnQgJiYgcHJvdmlkZWRPcHRpb25zICYmIGFzc2VydE11dHVhbGx5RXhjbHVzaXZlT3B0aW9ucyggWyAncmFuZ2UnIF0sIFsgJ3ZhbGlkVmFsdWVzJyBdICk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxOdW1iZXJQcm9wZXJ0eU9wdGlvbnMsIFN0cmljdE9taXQ8U2VsZk9wdGlvbnMsICdyYW5nZVByb3BlcnR5T3B0aW9ucyc+LCBQcm9wZXJ0eU9wdGlvbnM8bnVtYmVyPj4oKSgge1xyXG5cclxuICAgICAgLy8gTnVtYmVyUHJvcGVydHlPcHRpb25zXHJcbiAgICAgIG51bWJlclR5cGU6ICdGbG9hdGluZ1BvaW50JyxcclxuICAgICAgcmFuZ2U6IERFRkFVTFRfUkFOR0UsXHJcblxyXG4gICAgICAvLyBQcm9wZXJ0eU9wdGlvbnNcclxuICAgICAgdmFsaWRhdG9yczogW10sXHJcblxyXG4gICAgICBwaGV0aW9PdXRlclR5cGU6ICgpID0+IE51bWJlclByb3BlcnR5Lk51bWJlclByb3BlcnR5SU9cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIG9wdGlvbnMucmFuZ2VQcm9wZXJ0eU9wdGlvbnMgPSBvcHRpb25pemU8UHJvcGVydHlPcHRpb25zPFJhbmdlPiwgRW1wdHlTZWxmT3B0aW9ucywgUHJvcGVydHlPcHRpb25zPFJhbmdlPj4oKSgge1xyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnUHJvdmlkZXMgdGhlIHJhbmdlIG9mIHBvc3NpYmxlIHZhbHVlcyBmb3IgdGhlIHBhcmVudCBOdW1iZXJQcm9wZXJ0eUlPJyxcclxuICAgICAgcGhldGlvVmFsdWVUeXBlOiBSYW5nZS5SYW5nZUlPLFxyXG4gICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZSxcclxuXHJcbiAgICAgIC8vIElmIHByb3ZpZGVkIHJhbmdlIGlzIHRoZSBkZWZhdWx0LCBkb24ndCBpbnN0cnVtZW50IHRoZSBQaEVULWlPIFJhbmdlUHJvcGVydHlcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnJhbmdlICE9PSBERUZBVUxUX1JBTkdFID8gb3B0aW9ucy50YW5kZW0/LmNyZWF0ZVRhbmRlbSggUkFOR0VfUFJPUEVSVFlfVEFOREVNX05BTUUgKSA6IFRhbmRlbS5PUFRfT1VUXHJcbiAgICB9LCBvcHRpb25zLnJhbmdlUHJvcGVydHlPcHRpb25zICk7XHJcblxyXG4gICAgaWYgKCBhc3NlcnQgJiYgVGFuZGVtLlZBTElEQVRJT04gJiYgb3B0aW9ucy5yYW5nZVByb3BlcnR5T3B0aW9ucy50YW5kZW0gJiYgb3B0aW9ucy5yYW5nZVByb3BlcnR5T3B0aW9ucy50YW5kZW0uc3VwcGxpZWQgKSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMucmFuZ2VQcm9wZXJ0eU9wdGlvbnMudGFuZGVtLm5hbWUgPT09IFJBTkdFX1BST1BFUlRZX1RBTkRFTV9OQU1FLFxyXG4gICAgICAgIGByYW5nZVByb3BlcnR5T3B0aW9ucy50YW5kZW0ubmFtZSBtdXN0IGJlICR7UkFOR0VfUFJPUEVSVFlfVEFOREVNX05BTUV9OiAke29wdGlvbnMucmFuZ2VQcm9wZXJ0eU9wdGlvbnMudGFuZGVtLm5hbWV9YCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGNsaWVudCBjYW5ub3Qgc3BlY2lmeSBzdXBlcmNsYXNzIG9wdGlvbnMgdGhhdCBhcmUgY29udHJvbGxlZCBieSBOdW1iZXJQcm9wZXJ0eVxyXG4gICAgb3B0aW9ucy52YWx1ZVR5cGUgPSAnbnVtYmVyJztcclxuICAgIG9wdGlvbnMucGhldGlvVmFsdWVUeXBlID0gTnVtYmVySU87IC8vIG5vdCBhY3R1YWxseSB1c2VkLCBidXQgZm9yIGNvbXBsZXRlbmVzcywgZG9uJ3QgaGF2ZSBSZWFkT25seVByb3BlcnR5IHN0b3JpbmcgdGhlIHdyb25nIGRlZmF1bHQuXHJcblxyXG4gICAgY29uc3QgcmFuZ2VQcm9wZXJ0eVByb3ZpZGVkID0gb3B0aW9ucy5yYW5nZSAmJiBvcHRpb25zLnJhbmdlIGluc3RhbmNlb2YgUmVhZE9ubHlQcm9wZXJ0eTtcclxuICAgIGNvbnN0IG93bnNSYW5nZVByb3BlcnR5ID0gIXJhbmdlUHJvcGVydHlQcm92aWRlZDtcclxuXHJcbiAgICBjb25zdCByYW5nZVByb3BlcnR5ID0gb3B0aW9ucy5yYW5nZSBpbnN0YW5jZW9mIFJlYWRPbmx5UHJvcGVydHkgPyBvcHRpb25zLnJhbmdlIDogbmV3IFByb3BlcnR5KCBvcHRpb25zLnJhbmdlLCBvcHRpb25zLnJhbmdlUHJvcGVydHlPcHRpb25zICk7XHJcblxyXG4gICAgb3B0aW9ucy52YWxpZGF0b3JzLnB1c2goIFZBTElEX05PTl9OQU4gKTsgLy8gc2VlbXMgcmlnaHQgZm9yIHRoaXMgdG8gcnVuIGZpcnN0XHJcbiAgICBpZiAoIG9wdGlvbnMubnVtYmVyVHlwZSA9PT0gJ0ludGVnZXInICkge1xyXG4gICAgICBvcHRpb25zLnZhbGlkYXRvcnMucHVzaCggVkFMSURfSU5URUdFUiApO1xyXG4gICAgfVxyXG4gICAgbGV0IGNhbGxlZFN1cGVyID0gZmFsc2U7IC8vIFdlIGNhbm5vdCB1c2UgdGhpcy52YWx1ZSB1bnRpbCBhZnRlciB0aGUgc3VwZXIoKSBjYWxsXHJcbiAgICBvcHRpb25zLnZhbGlkYXRvcnMucHVzaCgge1xyXG4gICAgICBpc1ZhbGlkVmFsdWU6IHYgPT4gcmFuZ2VQcm9wZXJ0eS52YWx1ZS5jb250YWlucyggdiApLFxyXG4gICAgICB2YWxpZGF0aW9uTWVzc2FnZTogKCkgPT4gYE51bWJlciB2YWx1ZSAke2NhbGxlZFN1cGVyID8gdGhpcy52YWx1ZSA6IHZhbHVlfSBtdXN0IGJlIHdpdGhpbiByYW5nZVByb3BlcnR5IHZhbHVlOiAke3JhbmdlUHJvcGVydHkudmFsdWV9YFxyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCB2YWx1ZSwgb3B0aW9ucyApO1xyXG4gICAgY2FsbGVkU3VwZXIgPSB0cnVlO1xyXG5cclxuICAgIHRoaXMubnVtYmVyVHlwZSA9IG9wdGlvbnMubnVtYmVyVHlwZTtcclxuICAgIHRoaXMucmFuZ2VQcm9wZXJ0eSA9IHJhbmdlUHJvcGVydHk7XHJcblxyXG4gICAgaWYgKCBhc3NlcnQgJiYgVGFuZGVtLlZBTElEQVRJT04gJiYgdGhpcy5yYW5nZVByb3BlcnR5LmlzUGhldGlvSW5zdHJ1bWVudGVkKCkgKSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuaXNQaGV0aW9JbnN0cnVtZW50ZWQoKSwgJ051bWJlclByb3BlcnR5IG11c3QgYmUgcGhldC1pbyBpbnN0cnVtZW50ZWQgaWYgdGhlIHJhbmdlIGlzJyApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJhbmdlUHJvcGVydHlPYnNlcnZlciA9ICgpID0+IHtcclxuICAgICAgdmFsaWRhdGUoIHRoaXMudmFsdWUsIHRoaXMudmFsdWVWYWxpZGF0b3IsIFZBTElEQVRFX09QVElPTlNfRkFMU0UgKTtcclxuICAgIH07XHJcbiAgICBhc3NlcnQgJiYgdGhpcy5yYW5nZVByb3BlcnR5LmxpbmsoIHJhbmdlUHJvcGVydHlPYnNlcnZlciApO1xyXG5cclxuICAgIC8vIEZvciBQaEVULWlPIFN0YXRlLCBtYWtlIHN1cmUgdGhhdCBib3RoIHRoZSByYW5nZSBhbmQgdGhpcyB2YWx1ZSBhcmUgY29ycmVjdCBiZWZvcmUgZmlyaW5nIG5vdGlmaWNhdGlvbnMgKHdoZXJlIHRoZSBhc3NlcnRpb25zIGFyZSkuXHJcbiAgICB0aGlzLnJhbmdlUHJvcGVydHkuYWRkUGhldGlvU3RhdGVEZXBlbmRlbmNpZXMoIFsgdGhpcyBdICk7XHJcbiAgICB0aGlzLmFkZFBoZXRpb1N0YXRlRGVwZW5kZW5jaWVzKCBbIHRoaXMucmFuZ2VQcm9wZXJ0eSBdICk7XHJcblxyXG4gICAgLy8gdmVyaWZ5IHRoYXQgdmFsaWRWYWx1ZXMgbWVldCBvdGhlciBOdW1iZXJQcm9wZXJ0eS1zcGVjaWZpYyB2YWxpZGF0aW9uIGNyaXRlcmlhXHJcbiAgICBpZiAoIG9wdGlvbnMudmFsaWRWYWx1ZXMgJiYgdGhpcy52YWxpZGF0ZU51bWJlckFuZFJhbmdlUHJvcGVydHkgKSB7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG9wdGlvbnMudmFsaWRWYWx1ZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgY29uc3QgdmFsaWRWYWx1ZSA9IG9wdGlvbnMudmFsaWRWYWx1ZXNbIGkgXTtcclxuICAgICAgICB0aGlzLnZhbGlkYXRlTnVtYmVyQW5kUmFuZ2VQcm9wZXJ0eSggdmFsaWRWYWx1ZSApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlTnVtYmVyUHJvcGVydHkgPSAoKSA9PiB7XHJcbiAgICAgIGlmICggb3duc1JhbmdlUHJvcGVydHkgKSB7XHJcbiAgICAgICAgdGhpcy5yYW5nZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggYXNzZXJ0ICkge1xyXG4gICAgICAgIHRoaXMucmFuZ2VQcm9wZXJ0eS51bmxpbmsoIHJhbmdlUHJvcGVydHlPYnNlcnZlciApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucmVzZXROdW1iZXJQcm9wZXJ0eSA9ICgpID0+IHtcclxuICAgICAgb3duc1JhbmdlUHJvcGVydHkgJiYgdGhpcy5yYW5nZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCByYW5nZSgpOiBSYW5nZSB7XHJcbiAgICByZXR1cm4gdGhpcy5yYW5nZVByb3BlcnR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIHNldHRpbmcgdGhlIHJhbmdlUHJvcGVydHkuIE5vdGU6IGJlIGNhcmVmdWwgdXNpbmcgdGhpcyBmdW5jdGlvbiwgYXMgdmFsaWRhdGlvbiB3aWxsIG9jY3VyXHJcbiAgICogaW1tZWRpYXRlbHksIGFuZCBpZiB0aGUgdmFsdWUgaXMgb3V0c2lkZSBvZiB0aGlzIG5ldyBSYW5nZSBhbiBlcnJvciB3aWxsIG9jY3VyLiBTZWUgdGhpcy5zZXRWYWx1ZUFuZFJhbmdlKCkgZm9yXHJcbiAgICogIHdheSB0byBzZXQgYm90aCBhdCBvbmNlIHdpdGhvdXQgYXNzZXJ0aW9uIGVycm9ycy5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0IHJhbmdlKCByYW5nZTogUmFuZ2UgKSB7XHJcbiAgICB0aGlzLnJhbmdlUHJvcGVydHkudmFsdWUgPSByYW5nZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMucmVzZXRWYWx1ZUFuZFJhbmdlKCk7IC8vIGV2ZW4gaWYgd2UgZG9uJ3Qgb3duIHRoZSByYW5nZSwgcmVzZXQgdGhlbSB0b2dldGhlciB0byBwcmV2ZW50IGFzc2VydGlvbnMsIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9heG9uL2lzc3Vlcy80MjdcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZU51bWJlclByb3BlcnR5KCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBbiBhdG9taWMgc2V0dGluZyBmdW5jdGlvbiB0aGF0IHdpbGwgc2V0IGEgcmFuZ2UgYW5kIGEgdmFsdWUgYXQgdGhlIHNhbWUgdGltZSwgdG8gbWFrZSBzdXJlIHRoYXQgdmFsaWRhdGlvbiBkb2VzXHJcbiAgICogbm90IGZhaWwgYWZ0ZXIgb25lIGJ1dCBoYXMgYmVlbiBzZXQgbm90IHRoZSBvdGhlci5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0VmFsdWVBbmRSYW5nZSggdmFsdWU6IG51bWJlciwgcmFuZ2U6IFJhbmdlICk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggcmFuZ2UuY29udGFpbnMoIHZhbHVlICksIGB2YWx1ZSAke3ZhbHVlfSBpcyBub3QgaW4gcmFuZ2UgWyR7cmFuZ2UubWlufSwke3JhbmdlLm1heH1dYCApO1xyXG5cclxuICAgIC8vIGRlZmVyIG5vdGlmaWNhdGlvbiBvZiBsaXN0ZW5lcnNcclxuICAgIHRoaXMuc2V0RGVmZXJyZWQoIHRydWUgKTtcclxuICAgIHRoaXMucmFuZ2VQcm9wZXJ0eS5zZXREZWZlcnJlZCggdHJ1ZSApO1xyXG5cclxuICAgIC8vIHNldCB2YWx1ZXNcclxuICAgIHRoaXMuc2V0KCB2YWx1ZSApO1xyXG4gICAgdGhpcy5yYW5nZVByb3BlcnR5LnNldCggcmFuZ2UgKTtcclxuXHJcbiAgICAvLyBub3RpZnkgbGlzdGVuZXJzIGlmIHRoZSB2YWx1ZXMgaGF2ZSBjaGFuZ2VkXHJcbiAgICBjb25zdCBub3RpZnlWYWx1ZUxpc3RlbmVycyA9IHRoaXMuc2V0RGVmZXJyZWQoIGZhbHNlICk7XHJcbiAgICBjb25zdCBub3RpZnlSYW5nZUxpc3RlbmVycyA9IHRoaXMucmFuZ2VQcm9wZXJ0eS5zZXREZWZlcnJlZCggZmFsc2UgKTtcclxuICAgIG5vdGlmeVZhbHVlTGlzdGVuZXJzICYmIG5vdGlmeVZhbHVlTGlzdGVuZXJzKCk7XHJcbiAgICBub3RpZnlSYW5nZUxpc3RlbmVycyAmJiBub3RpZnlSYW5nZUxpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXRzIHRoZSB2YWx1ZSBhbmQgcmFuZ2UgYXRvbWljYWxseS5cclxuICAgKiBJZiB5b3UgdXNlIHNldFZhbHVlQW5kUmFuZ2UsIHlvdSdsbCBsaWtlbHkgbmVlZCB0byB1c2UgdGhpcyBpbnN0ZWFkIG9mIHJlc2V0LlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldFZhbHVlQW5kUmFuZ2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNldFZhbHVlQW5kUmFuZ2UoIHRoaXMuaW5pdGlhbFZhbHVlLCB0aGlzLnJhbmdlUHJvcGVydHkuaW5pdGlhbFZhbHVlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgcGFyZW50IHN0YXRlIGFuZCBhcHBlbmQgTnVtYmVyUHJvcGVydHktc3BlY2lmaWMgbWV0YWRhdGEgdG8gaXQuXHJcbiAgICovXHJcbiAgcHVibGljIHRvU3RhdGVPYmplY3QoKTogTnVtYmVyUHJvcGVydHlTdGF0ZSB7XHJcbiAgICBjb25zdCBwYXJlbnRTdGF0ZU9iamVjdCA9IFByb3BlcnR5SU9JbXBsLnRvU3RhdGVPYmplY3QoIHRoaXMgKTtcclxuXHJcbiAgICBwYXJlbnRTdGF0ZU9iamVjdC5udW1iZXJUeXBlID0gdGhpcy5udW1iZXJUeXBlO1xyXG4gICAgcGFyZW50U3RhdGVPYmplY3QucmFuZ2UgPSBSYW5nZS5SYW5nZUlPLnRvU3RhdGVPYmplY3QoIHRoaXMucmFuZ2VQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICAgIGNvbnN0IGhhc1JhbmdlUGhldGlvSUQgPSB0aGlzLnJhbmdlUHJvcGVydHkgJiYgdGhpcy5yYW5nZVByb3BlcnR5LmlzUGhldGlvSW5zdHJ1bWVudGVkKCk7XHJcbiAgICBwYXJlbnRTdGF0ZU9iamVjdC5yYW5nZVBoZXRpb0lEID0gaGFzUmFuZ2VQaGV0aW9JRCA/IHRoaXMucmFuZ2VQcm9wZXJ0eS50YW5kZW0ucGhldGlvSUQgOiBudWxsO1xyXG5cclxuICAgIHJldHVybiBwYXJlbnRTdGF0ZU9iamVjdDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgTnVtYmVyUHJvcGVydHlJTyA9IG5ldyBJT1R5cGU8TnVtYmVyUHJvcGVydHksIE51bWJlclByb3BlcnR5U3RhdGUsIE51bWJlclByb3BlcnR5U2VsZlN0YXRlPiggJ051bWJlclByb3BlcnR5SU8nLCB7XHJcbiAgICB2YWx1ZVR5cGU6IE51bWJlclByb3BlcnR5LFxyXG4gICAgc3VwZXJ0eXBlOiBQcm9wZXJ0eUlPSW1wbCxcclxuXHJcbiAgICBwYXJhbWV0ZXJUeXBlczogWyBOdW1iZXJJTyBdLFxyXG4gICAgZG9jdW1lbnRhdGlvbjogYEV4dGVuZHMgUHJvcGVydHlJTyB0byBhZGQgdmFsdWVzIGZvciB0aGUgbnVtZXJpYyByYW5nZSAoIG1pbiwgbWF4ICkgYW5kIG51bWJlclR5cGUgKCAnJHtcclxuICAgICAgVkFMSURfTlVNQkVSX1RZUEVTLmpvaW4oICdcXCcgfCBcXCcnICl9JyApYCxcclxuICAgIHRvU3RhdGVPYmplY3Q6IG51bWJlclByb3BlcnR5ID0+IHtcclxuICAgICAgcmV0dXJuIG51bWJlclByb3BlcnR5LnRvU3RhdGVPYmplY3QoKTtcclxuICAgIH0sXHJcbiAgICBhcHBseVN0YXRlOiAoIG51bWJlclByb3BlcnR5LCBzdGF0ZU9iamVjdCApID0+IHtcclxuICAgICAgLy8gbm90aGluZyB0byBkbyBoZXJlIGZvciByYW5nZSwgYmVjYXVzZSBpbiBvcmRlciB0byBzdXBwb3J0IHJhbmdlLCB0aGlzIE51bWJlclByb3BlcnR5J3MgcmFuZ2VQcm9wZXJ0eSBtdXN0IGJlIGluc3RydW1lbnRlZC5cclxuXHJcbiAgICAgIFByb3BlcnR5SU9JbXBsLmFwcGx5U3RhdGUoIG51bWJlclByb3BlcnR5LCBzdGF0ZU9iamVjdCApO1xyXG4gICAgfSxcclxuICAgIHN0YXRlU2NoZW1hOiB7XHJcbiAgICAgIG51bWJlclR5cGU6IFN0cmluZ0lPLFxyXG4gICAgICByYW5nZTogUmFuZ2UuUmFuZ2VJTyxcclxuICAgICAgcmFuZ2VQaGV0aW9JRDogTnVsbGFibGVJTyggU3RyaW5nSU8gKVxyXG4gICAgfVxyXG4gIH0gKTtcclxufVxyXG5cclxuYXhvbi5yZWdpc3RlciggJ051bWJlclByb3BlcnR5JywgTnVtYmVyUHJvcGVydHkgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxLQUFLLE1BQTRCLHVCQUF1QjtBQUUvRCxPQUFPQyxTQUFTLE1BQTRCLGlDQUFpQztBQUM3RSxPQUFPQyxNQUFNLE1BQU0sMkJBQTJCO0FBQzlDLE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MsVUFBVSxNQUFNLHFDQUFxQztBQUM1RCxPQUFPQyxRQUFRLE1BQU0sbUNBQW1DO0FBQ3hELE9BQU9DLFFBQVEsTUFBTSxtQ0FBbUM7QUFDeEQsT0FBT0MsSUFBSSxNQUFNLFdBQVc7QUFDNUIsT0FBT0MsZ0JBQWdCLE1BQWlDLHVCQUF1QjtBQUMvRSxPQUFPQyxRQUFRLE1BQTJCLGVBQWU7QUFDekQsT0FBT0MsUUFBUSxNQUFNLGVBQWU7QUFFcEMsT0FBT0MsOEJBQThCLE1BQU0sc0RBQXNEO0FBR2pHLE1BQU1DLGFBQWEsR0FBRztFQUFFQyxTQUFTLEVBQUUsUUFBUTtFQUFFQyxZQUFZLEVBQUlDLENBQVMsSUFBTUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO0VBQUVDLGlCQUFpQixFQUFFO0FBQTRCLENBQUM7QUFDekksTUFBTUMsYUFBYSxHQUFHO0VBQUVILFlBQVksRUFBSUMsQ0FBUyxJQUFNLENBQUNHLEtBQUssQ0FBRUgsQ0FBRSxDQUFDO0VBQUVDLGlCQUFpQixFQUFFO0FBQW9CLENBQUM7QUFDNUcsTUFBTUcsc0JBQXNCLEdBQUc7RUFBRUMsaUJBQWlCLEVBQUU7QUFBTSxDQUFDOztBQUUzRDtBQUNBLE1BQU1DLGtCQUFrQixHQUFHLENBQUUsZUFBZSxFQUFFLFNBQVMsQ0FBVztBQUdsRTtBQUNBLE1BQU1DLDBCQUEwQixHQUFHLGVBQWU7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