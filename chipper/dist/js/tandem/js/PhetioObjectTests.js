// Copyright 2017-2023, University of Colorado Boulder

/**
 * Unit tests for PhetioObject
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import PhetioObject from './PhetioObject.js';
import Tandem from './Tandem.js';
import IOType from './types/IOType.js';
QUnit.module('PhetioObject');
const MockTypeIO = new IOType('MockTypeIO', {
  isValidValue: () => true,
  documentation: 'mock type',
  events: ['hello']
});
QUnit.test('PhetioObject start/start', assert => {
  assert.ok(true, 'initial test');
  const obj = new PhetioObject({
    tandem: Tandem.ROOT_TEST,
    phetioType: MockTypeIO,
    phetioState: false
  });
  obj.phetioStartEvent('hello');
});
QUnit.test('PhetioObject start/end', assert => {
  assert.ok(true, 'initial test');
  const obj = new PhetioObject({
    tandem: Tandem.ROOT_TEST.createTandem('test1'),
    phetioType: MockTypeIO,
    phetioState: false
  });
  obj.phetioStartEvent('hello');
  obj.phetioEndEvent();
});
QUnit.test('PhetioObject end without start', assert => {
  assert.ok(true, 'initial test');
  const obj = new PhetioObject({
    tandem: Tandem.ROOT_TEST.createTandem('test2'),
    phetioType: MockTypeIO,
    phetioState: false
  });
  if (Tandem.PHET_IO_ENABLED) {
    window.assert && assert.throws(() => {
      obj.phetioEndEvent();
    }, 'Should throw an assertion error when Ending an unstarted event');
  }
});
QUnit.test('PhetioObject is a Disposable', assert => {
  const object1 = new PhetioObject();
  assert.ok(!!object1.disposeEmitter, 'disposeEmitter needed');
  const object2 = new PhetioObject();
  object1.disposeEmitter.addListener(() => object2.dispose());
  assert.ok(!object1.isDisposed, '1 is not disposed');
  assert.ok(!object2.isDisposed, '2 is not disposed');
  object1.dispose();
  assert.ok(object1.isDisposed, '1 is disposed');
  assert.ok(object2.isDisposed, '2 is disposed');
  const object3 = new PhetioObject({
    isDisposable: false
  });
  const object4 = new PhetioObject();
  object4['initializePhetioObject']({}, {
    isDisposable: false
  });
  if (window.assert) {
    assert.throws(() => object3.dispose(), 'should throw if isDisposable is false1');
    assert.throws(() => object4.dispose(), 'should throw if isDisposable is false2');
  }
});
Tandem.PHET_IO_ENABLED && QUnit.test('no calling addLinkedElement before instrumentation', assert => {
  assert.ok(true, 'always run one test');
  const obj = new PhetioObject();
  obj.addLinkedElement(new PhetioObject());
  window.assert && assert.throws(() => {
    obj['initializePhetioObject']({}, {
      tandem: Tandem.ROOT_TEST.createTandem('myObject')
    });
  }, 'Should throw an assertion because you should not link elements before instrumentation');
});
if (Tandem.PHET_IO_ENABLED) {
  QUnit.test('archetype bugginess when Tandem is not launched yet', assert => {
    // reset Tandem launch status to make sure that nothing goes through to phetioEngine in this test until launched again.
    Tandem.unlaunch();
    assert.ok(true, 'initial test');
    const object1Tandem = Tandem.ROOT_TEST.createTandem('object1');
    const phetioObject1 = new PhetioObject({
      tandem: object1Tandem
    });
    assert.ok(!phetioObject1.phetioIsArchetype, 'should not be an archetype before marking');
    const phetioObject1Child = new PhetioObject({
      tandem: object1Tandem.createTandem('child')
    });
    phetioObject1.markDynamicElementArchetype();
    assert.ok(phetioObject1.phetioIsArchetype, 'should be an archetype after marking');

    // This should actually automatically take effect when we hit markDynamicElementArchetype!
    assert.ok(phetioObject1Child.phetioIsArchetype, 'should look in the tandem buffered elements when it is not in the map');

    // launch to make sure tandem registration fires listeners
    Tandem.launch();
    assert.ok(phetioObject1.phetioIsArchetype, 'phetioIsArchetype should not have changed after launching');
    assert.ok(phetioObject1Child.phetioIsArchetype, 'phetioIsArchetype should not have changed after launching for child');
  });

  // isDynamicElement is not set in phet brand
  QUnit.test('PhetioObject.isDynamicElement', assert => {
    const test1 = Tandem.ROOT_TEST.createTandem('test1');
    const parentTandem = test1.createTandem('parent');
    const child1Tandem = parentTandem.createTandem('child1');
    const child2Tandem = parentTandem.createTandem('child2');
    const child1 = new PhetioObject({
      tandem: child1Tandem
    });
    const grandChild1 = new PhetioObject({
      tandem: child1Tandem.createTandem('grandChild')
    });
    assert.ok(!child1.phetioDynamicElement, 'direct child not dynamic before parent created');
    assert.ok(!grandChild1.phetioDynamicElement, 'grandchild not dynamic before parent created');
    const parent = new PhetioObject({
      tandem: parentTandem,
      phetioDynamicElement: true
    });
    assert.ok(parent.phetioDynamicElement, 'parent should be dynamic when marked dynamic');

    // This will only happen in phet-io brand
    if (Tandem.PHET_IO_ENABLED) {
      assert.ok(child1.phetioDynamicElement, 'direct child before parent creation');
      assert.ok(grandChild1.phetioDynamicElement, 'descendant child before parent creation');
      const child2 = new PhetioObject({
        tandem: parentTandem.createTandem('child2')
      });
      const grandChild2 = new PhetioObject({
        tandem: child2Tandem.createTandem('grandChild')
      });
      assert.ok(child2.phetioDynamicElement, 'direct child after parent creation');
      assert.ok(grandChild2.phetioDynamicElement, 'descendant child after parent creation');
      child2.markDynamicElementArchetype();
      assert.ok(!child2.phetioDynamicElement, 'Not dynamic if archetype: direct child after parent creation');
      assert.ok(!grandChild2.phetioDynamicElement, 'Not dynamic if archetype: descendant child after parent creation');
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQaGV0aW9PYmplY3QiLCJUYW5kZW0iLCJJT1R5cGUiLCJRVW5pdCIsIm1vZHVsZSIsIk1vY2tUeXBlSU8iLCJpc1ZhbGlkVmFsdWUiLCJkb2N1bWVudGF0aW9uIiwiZXZlbnRzIiwidGVzdCIsImFzc2VydCIsIm9rIiwib2JqIiwidGFuZGVtIiwiUk9PVF9URVNUIiwicGhldGlvVHlwZSIsInBoZXRpb1N0YXRlIiwicGhldGlvU3RhcnRFdmVudCIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb0VuZEV2ZW50IiwiUEhFVF9JT19FTkFCTEVEIiwid2luZG93IiwidGhyb3dzIiwib2JqZWN0MSIsImRpc3Bvc2VFbWl0dGVyIiwib2JqZWN0MiIsImFkZExpc3RlbmVyIiwiZGlzcG9zZSIsImlzRGlzcG9zZWQiLCJvYmplY3QzIiwiaXNEaXNwb3NhYmxlIiwib2JqZWN0NCIsImFkZExpbmtlZEVsZW1lbnQiLCJ1bmxhdW5jaCIsIm9iamVjdDFUYW5kZW0iLCJwaGV0aW9PYmplY3QxIiwicGhldGlvSXNBcmNoZXR5cGUiLCJwaGV0aW9PYmplY3QxQ2hpbGQiLCJtYXJrRHluYW1pY0VsZW1lbnRBcmNoZXR5cGUiLCJsYXVuY2giLCJ0ZXN0MSIsInBhcmVudFRhbmRlbSIsImNoaWxkMVRhbmRlbSIsImNoaWxkMlRhbmRlbSIsImNoaWxkMSIsImdyYW5kQ2hpbGQxIiwicGhldGlvRHluYW1pY0VsZW1lbnQiLCJwYXJlbnQiLCJjaGlsZDIiLCJncmFuZENoaWxkMiJdLCJzb3VyY2VzIjpbIlBoZXRpb09iamVjdFRlc3RzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFVuaXQgdGVzdHMgZm9yIFBoZXRpb09iamVjdFxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQaGV0aW9PYmplY3QgZnJvbSAnLi9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4vVGFuZGVtLmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuL3R5cGVzL0lPVHlwZS5qcyc7XHJcblxyXG5RVW5pdC5tb2R1bGUoICdQaGV0aW9PYmplY3QnICk7XHJcblxyXG5jb25zdCBNb2NrVHlwZUlPID0gbmV3IElPVHlwZSggJ01vY2tUeXBlSU8nLCB7XHJcbiAgaXNWYWxpZFZhbHVlOiAoKSA9PiB0cnVlLFxyXG4gIGRvY3VtZW50YXRpb246ICdtb2NrIHR5cGUnLFxyXG4gIGV2ZW50czogWyAnaGVsbG8nIF1cclxufSApO1xyXG5cclxuUVVuaXQudGVzdCggJ1BoZXRpb09iamVjdCBzdGFydC9zdGFydCcsIGFzc2VydCA9PiB7XHJcbiAgYXNzZXJ0Lm9rKCB0cnVlLCAnaW5pdGlhbCB0ZXN0JyApO1xyXG5cclxuICBjb25zdCBvYmogPSBuZXcgUGhldGlvT2JqZWN0KCB7XHJcbiAgICB0YW5kZW06IFRhbmRlbS5ST09UX1RFU1QsXHJcbiAgICBwaGV0aW9UeXBlOiBNb2NrVHlwZUlPLFxyXG4gICAgcGhldGlvU3RhdGU6IGZhbHNlXHJcbiAgfSApO1xyXG4gIG9iai5waGV0aW9TdGFydEV2ZW50KCAnaGVsbG8nICk7XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdQaGV0aW9PYmplY3Qgc3RhcnQvZW5kJywgYXNzZXJ0ID0+IHtcclxuICBhc3NlcnQub2soIHRydWUsICdpbml0aWFsIHRlc3QnICk7XHJcblxyXG4gIGNvbnN0IG9iaiA9IG5ldyBQaGV0aW9PYmplY3QoIHtcclxuICAgIHRhbmRlbTogVGFuZGVtLlJPT1RfVEVTVC5jcmVhdGVUYW5kZW0oICd0ZXN0MScgKSxcclxuICAgIHBoZXRpb1R5cGU6IE1vY2tUeXBlSU8sXHJcbiAgICBwaGV0aW9TdGF0ZTogZmFsc2VcclxuICB9ICk7XHJcbiAgb2JqLnBoZXRpb1N0YXJ0RXZlbnQoICdoZWxsbycgKTtcclxuICBvYmoucGhldGlvRW5kRXZlbnQoKTtcclxufSApO1xyXG5cclxuUVVuaXQudGVzdCggJ1BoZXRpb09iamVjdCBlbmQgd2l0aG91dCBzdGFydCcsIGFzc2VydCA9PiB7XHJcbiAgYXNzZXJ0Lm9rKCB0cnVlLCAnaW5pdGlhbCB0ZXN0JyApO1xyXG5cclxuICBjb25zdCBvYmogPSBuZXcgUGhldGlvT2JqZWN0KCB7XHJcbiAgICB0YW5kZW06IFRhbmRlbS5ST09UX1RFU1QuY3JlYXRlVGFuZGVtKCAndGVzdDInICksXHJcbiAgICBwaGV0aW9UeXBlOiBNb2NrVHlwZUlPLFxyXG4gICAgcGhldGlvU3RhdGU6IGZhbHNlXHJcbiAgfSApO1xyXG5cclxuICBpZiAoIFRhbmRlbS5QSEVUX0lPX0VOQUJMRUQgKSB7XHJcbiAgICB3aW5kb3cuYXNzZXJ0ICYmIGFzc2VydC50aHJvd3MoICgpID0+IHtcclxuICAgICAgb2JqLnBoZXRpb0VuZEV2ZW50KCk7XHJcbiAgICB9LCAnU2hvdWxkIHRocm93IGFuIGFzc2VydGlvbiBlcnJvciB3aGVuIEVuZGluZyBhbiB1bnN0YXJ0ZWQgZXZlbnQnICk7XHJcbiAgfVxyXG59ICk7XHJcblxyXG5RVW5pdC50ZXN0KCAnUGhldGlvT2JqZWN0IGlzIGEgRGlzcG9zYWJsZScsIGFzc2VydCA9PiB7XHJcbiAgY29uc3Qgb2JqZWN0MSA9IG5ldyBQaGV0aW9PYmplY3QoKTtcclxuXHJcbiAgYXNzZXJ0Lm9rKCAhIW9iamVjdDEuZGlzcG9zZUVtaXR0ZXIsICdkaXNwb3NlRW1pdHRlciBuZWVkZWQnICk7XHJcblxyXG4gIGNvbnN0IG9iamVjdDIgPSBuZXcgUGhldGlvT2JqZWN0KCk7XHJcblxyXG4gIG9iamVjdDEuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IG9iamVjdDIuZGlzcG9zZSgpICk7XHJcblxyXG4gIGFzc2VydC5vayggIW9iamVjdDEuaXNEaXNwb3NlZCwgJzEgaXMgbm90IGRpc3Bvc2VkJyApO1xyXG4gIGFzc2VydC5vayggIW9iamVjdDIuaXNEaXNwb3NlZCwgJzIgaXMgbm90IGRpc3Bvc2VkJyApO1xyXG5cclxuICBvYmplY3QxLmRpc3Bvc2UoKTtcclxuICBhc3NlcnQub2soIG9iamVjdDEuaXNEaXNwb3NlZCwgJzEgaXMgZGlzcG9zZWQnICk7XHJcbiAgYXNzZXJ0Lm9rKCBvYmplY3QyLmlzRGlzcG9zZWQsICcyIGlzIGRpc3Bvc2VkJyApO1xyXG5cclxuICBjb25zdCBvYmplY3QzID0gbmV3IFBoZXRpb09iamVjdCggeyBpc0Rpc3Bvc2FibGU6IGZhbHNlIH0gKTtcclxuICBjb25zdCBvYmplY3Q0ID0gbmV3IFBoZXRpb09iamVjdCgpO1xyXG4gIG9iamVjdDRbICdpbml0aWFsaXplUGhldGlvT2JqZWN0JyBdKCB7fSwgeyBpc0Rpc3Bvc2FibGU6IGZhbHNlIH0gKTtcclxuXHJcbiAgaWYgKCB3aW5kb3cuYXNzZXJ0ICkge1xyXG4gICAgYXNzZXJ0LnRocm93cyggKCkgPT4gb2JqZWN0My5kaXNwb3NlKCksICdzaG91bGQgdGhyb3cgaWYgaXNEaXNwb3NhYmxlIGlzIGZhbHNlMScgKTtcclxuICAgIGFzc2VydC50aHJvd3MoICgpID0+IG9iamVjdDQuZGlzcG9zZSgpLCAnc2hvdWxkIHRocm93IGlmIGlzRGlzcG9zYWJsZSBpcyBmYWxzZTInICk7XHJcbiAgfVxyXG59ICk7XHJcblxyXG5UYW5kZW0uUEhFVF9JT19FTkFCTEVEICYmIFFVbml0LnRlc3QoICdubyBjYWxsaW5nIGFkZExpbmtlZEVsZW1lbnQgYmVmb3JlIGluc3RydW1lbnRhdGlvbicsIGFzc2VydCA9PiB7XHJcbiAgYXNzZXJ0Lm9rKCB0cnVlLCAnYWx3YXlzIHJ1biBvbmUgdGVzdCcgKTtcclxuXHJcbiAgY29uc3Qgb2JqID0gbmV3IFBoZXRpb09iamVjdCgpO1xyXG4gIG9iai5hZGRMaW5rZWRFbGVtZW50KCBuZXcgUGhldGlvT2JqZWN0KCkgKTtcclxuXHJcbiAgd2luZG93LmFzc2VydCAmJiBhc3NlcnQudGhyb3dzKCAoKSA9PiB7XHJcbiAgICBvYmpbICdpbml0aWFsaXplUGhldGlvT2JqZWN0JyBdKCB7fSwge1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5ST09UX1RFU1QuY3JlYXRlVGFuZGVtKCAnbXlPYmplY3QnIClcclxuICAgIH0gKTtcclxuICB9LCAnU2hvdWxkIHRocm93IGFuIGFzc2VydGlvbiBiZWNhdXNlIHlvdSBzaG91bGQgbm90IGxpbmsgZWxlbWVudHMgYmVmb3JlIGluc3RydW1lbnRhdGlvbicgKTtcclxufSApO1xyXG5cclxuaWYgKCBUYW5kZW0uUEhFVF9JT19FTkFCTEVEICkge1xyXG5cclxuICBRVW5pdC50ZXN0KCAnYXJjaGV0eXBlIGJ1Z2dpbmVzcyB3aGVuIFRhbmRlbSBpcyBub3QgbGF1bmNoZWQgeWV0JywgYXNzZXJ0ID0+IHtcclxuXHJcbiAgICAvLyByZXNldCBUYW5kZW0gbGF1bmNoIHN0YXR1cyB0byBtYWtlIHN1cmUgdGhhdCBub3RoaW5nIGdvZXMgdGhyb3VnaCB0byBwaGV0aW9FbmdpbmUgaW4gdGhpcyB0ZXN0IHVudGlsIGxhdW5jaGVkIGFnYWluLlxyXG4gICAgVGFuZGVtLnVubGF1bmNoKCk7XHJcblxyXG4gICAgYXNzZXJ0Lm9rKCB0cnVlLCAnaW5pdGlhbCB0ZXN0JyApO1xyXG5cclxuICAgIGNvbnN0IG9iamVjdDFUYW5kZW0gPSBUYW5kZW0uUk9PVF9URVNULmNyZWF0ZVRhbmRlbSggJ29iamVjdDEnICk7XHJcbiAgICBjb25zdCBwaGV0aW9PYmplY3QxID0gbmV3IFBoZXRpb09iamVjdCggeyB0YW5kZW06IG9iamVjdDFUYW5kZW0gfSApO1xyXG4gICAgYXNzZXJ0Lm9rKCAhcGhldGlvT2JqZWN0MS5waGV0aW9Jc0FyY2hldHlwZSwgJ3Nob3VsZCBub3QgYmUgYW4gYXJjaGV0eXBlIGJlZm9yZSBtYXJraW5nJyApO1xyXG5cclxuICAgIGNvbnN0IHBoZXRpb09iamVjdDFDaGlsZCA9IG5ldyBQaGV0aW9PYmplY3QoIHsgdGFuZGVtOiBvYmplY3QxVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NoaWxkJyApIH0gKTtcclxuXHJcbiAgICBwaGV0aW9PYmplY3QxLm1hcmtEeW5hbWljRWxlbWVudEFyY2hldHlwZSgpO1xyXG5cclxuICAgIGFzc2VydC5vayggcGhldGlvT2JqZWN0MS5waGV0aW9Jc0FyY2hldHlwZSwgJ3Nob3VsZCBiZSBhbiBhcmNoZXR5cGUgYWZ0ZXIgbWFya2luZycgKTtcclxuXHJcbiAgICAvLyBUaGlzIHNob3VsZCBhY3R1YWxseSBhdXRvbWF0aWNhbGx5IHRha2UgZWZmZWN0IHdoZW4gd2UgaGl0IG1hcmtEeW5hbWljRWxlbWVudEFyY2hldHlwZSFcclxuICAgIGFzc2VydC5vayggcGhldGlvT2JqZWN0MUNoaWxkLnBoZXRpb0lzQXJjaGV0eXBlLCAnc2hvdWxkIGxvb2sgaW4gdGhlIHRhbmRlbSBidWZmZXJlZCBlbGVtZW50cyB3aGVuIGl0IGlzIG5vdCBpbiB0aGUgbWFwJyApO1xyXG5cclxuICAgIC8vIGxhdW5jaCB0byBtYWtlIHN1cmUgdGFuZGVtIHJlZ2lzdHJhdGlvbiBmaXJlcyBsaXN0ZW5lcnNcclxuICAgIFRhbmRlbS5sYXVuY2goKTtcclxuXHJcbiAgICBhc3NlcnQub2soIHBoZXRpb09iamVjdDEucGhldGlvSXNBcmNoZXR5cGUsICdwaGV0aW9Jc0FyY2hldHlwZSBzaG91bGQgbm90IGhhdmUgY2hhbmdlZCBhZnRlciBsYXVuY2hpbmcnICk7XHJcbiAgICBhc3NlcnQub2soIHBoZXRpb09iamVjdDFDaGlsZC5waGV0aW9Jc0FyY2hldHlwZSwgJ3BoZXRpb0lzQXJjaGV0eXBlIHNob3VsZCBub3QgaGF2ZSBjaGFuZ2VkIGFmdGVyIGxhdW5jaGluZyBmb3IgY2hpbGQnICk7XHJcbiAgfSApO1xyXG5cclxuICAvLyBpc0R5bmFtaWNFbGVtZW50IGlzIG5vdCBzZXQgaW4gcGhldCBicmFuZFxyXG4gIFFVbml0LnRlc3QoICdQaGV0aW9PYmplY3QuaXNEeW5hbWljRWxlbWVudCcsIGFzc2VydCA9PiB7XHJcbiAgICBjb25zdCB0ZXN0MSA9IFRhbmRlbS5ST09UX1RFU1QuY3JlYXRlVGFuZGVtKCAndGVzdDEnICk7XHJcbiAgICBjb25zdCBwYXJlbnRUYW5kZW0gPSB0ZXN0MS5jcmVhdGVUYW5kZW0oICdwYXJlbnQnICk7XHJcbiAgICBjb25zdCBjaGlsZDFUYW5kZW0gPSBwYXJlbnRUYW5kZW0uY3JlYXRlVGFuZGVtKCAnY2hpbGQxJyApO1xyXG4gICAgY29uc3QgY2hpbGQyVGFuZGVtID0gcGFyZW50VGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NoaWxkMicgKTtcclxuICAgIGNvbnN0IGNoaWxkMSA9IG5ldyBQaGV0aW9PYmplY3QoIHtcclxuICAgICAgdGFuZGVtOiBjaGlsZDFUYW5kZW1cclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGdyYW5kQ2hpbGQxID0gbmV3IFBoZXRpb09iamVjdCgge1xyXG4gICAgICB0YW5kZW06IGNoaWxkMVRhbmRlbS5jcmVhdGVUYW5kZW0oICdncmFuZENoaWxkJyApXHJcbiAgICB9ICk7XHJcbiAgICBhc3NlcnQub2soICFjaGlsZDEucGhldGlvRHluYW1pY0VsZW1lbnQsICdkaXJlY3QgY2hpbGQgbm90IGR5bmFtaWMgYmVmb3JlIHBhcmVudCBjcmVhdGVkJyApO1xyXG4gICAgYXNzZXJ0Lm9rKCAhZ3JhbmRDaGlsZDEucGhldGlvRHluYW1pY0VsZW1lbnQsICdncmFuZGNoaWxkIG5vdCBkeW5hbWljIGJlZm9yZSBwYXJlbnQgY3JlYXRlZCcgKTtcclxuXHJcbiAgICBjb25zdCBwYXJlbnQgPSBuZXcgUGhldGlvT2JqZWN0KCB7XHJcbiAgICAgIHRhbmRlbTogcGFyZW50VGFuZGVtLFxyXG4gICAgICBwaGV0aW9EeW5hbWljRWxlbWVudDogdHJ1ZVxyXG4gICAgfSApO1xyXG4gICAgYXNzZXJ0Lm9rKCBwYXJlbnQucGhldGlvRHluYW1pY0VsZW1lbnQsICdwYXJlbnQgc2hvdWxkIGJlIGR5bmFtaWMgd2hlbiBtYXJrZWQgZHluYW1pYycgKTtcclxuXHJcbiAgICAvLyBUaGlzIHdpbGwgb25seSBoYXBwZW4gaW4gcGhldC1pbyBicmFuZFxyXG4gICAgaWYgKCBUYW5kZW0uUEhFVF9JT19FTkFCTEVEICkge1xyXG5cclxuICAgICAgYXNzZXJ0Lm9rKCBjaGlsZDEucGhldGlvRHluYW1pY0VsZW1lbnQsICdkaXJlY3QgY2hpbGQgYmVmb3JlIHBhcmVudCBjcmVhdGlvbicgKTtcclxuICAgICAgYXNzZXJ0Lm9rKCBncmFuZENoaWxkMS5waGV0aW9EeW5hbWljRWxlbWVudCwgJ2Rlc2NlbmRhbnQgY2hpbGQgYmVmb3JlIHBhcmVudCBjcmVhdGlvbicgKTtcclxuXHJcbiAgICAgIGNvbnN0IGNoaWxkMiA9IG5ldyBQaGV0aW9PYmplY3QoIHtcclxuICAgICAgICB0YW5kZW06IHBhcmVudFRhbmRlbS5jcmVhdGVUYW5kZW0oICdjaGlsZDInIClcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgY29uc3QgZ3JhbmRDaGlsZDIgPSBuZXcgUGhldGlvT2JqZWN0KCB7XHJcbiAgICAgICAgdGFuZGVtOiBjaGlsZDJUYW5kZW0uY3JlYXRlVGFuZGVtKCAnZ3JhbmRDaGlsZCcgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBhc3NlcnQub2soIGNoaWxkMi5waGV0aW9EeW5hbWljRWxlbWVudCwgJ2RpcmVjdCBjaGlsZCBhZnRlciBwYXJlbnQgY3JlYXRpb24nICk7XHJcbiAgICAgIGFzc2VydC5vayggZ3JhbmRDaGlsZDIucGhldGlvRHluYW1pY0VsZW1lbnQsICdkZXNjZW5kYW50IGNoaWxkIGFmdGVyIHBhcmVudCBjcmVhdGlvbicgKTtcclxuXHJcbiAgICAgIGNoaWxkMi5tYXJrRHluYW1pY0VsZW1lbnRBcmNoZXR5cGUoKTtcclxuXHJcbiAgICAgIGFzc2VydC5vayggIWNoaWxkMi5waGV0aW9EeW5hbWljRWxlbWVudCwgJ05vdCBkeW5hbWljIGlmIGFyY2hldHlwZTogZGlyZWN0IGNoaWxkIGFmdGVyIHBhcmVudCBjcmVhdGlvbicgKTtcclxuICAgICAgYXNzZXJ0Lm9rKCAhZ3JhbmRDaGlsZDIucGhldGlvRHluYW1pY0VsZW1lbnQsICdOb3QgZHluYW1pYyBpZiBhcmNoZXR5cGU6IGRlc2NlbmRhbnQgY2hpbGQgYWZ0ZXIgcGFyZW50IGNyZWF0aW9uJyApO1xyXG4gICAgfVxyXG4gIH0gKTtcclxufSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxZQUFZLE1BQU0sbUJBQW1CO0FBQzVDLE9BQU9DLE1BQU0sTUFBTSxhQUFhO0FBQ2hDLE9BQU9DLE1BQU0sTUFBTSxtQkFBbUI7QUFFdENDLEtBQUssQ0FBQ0MsTUFBTSxDQUFFLGNBQWUsQ0FBQztBQUU5QixNQUFNQyxVQUFVLEdBQUcsSUFBSUgsTUFBTSxDQUFFLFlBQVksRUFBRTtFQUMzQ0ksWUFBWSxFQUFFQSxDQUFBLEtBQU0sSUFBSTtFQUN4QkMsYUFBYSxFQUFFLFdBQVc7RUFDMUJDLE1BQU0sRUFBRSxDQUFFLE9BQU87QUFDbkIsQ0FBRSxDQUFDO0FBRUhMLEtBQUssQ0FBQ00sSUFBSSxDQUFFLDBCQUEwQixFQUFFQyxNQUFNLElBQUk7RUFDaERBLE1BQU0sQ0FBQ0MsRUFBRSxDQUFFLElBQUksRUFBRSxjQUFlLENBQUM7RUFFakMsTUFBTUMsR0FBRyxHQUFHLElBQUlaLFlBQVksQ0FBRTtJQUM1QmEsTUFBTSxFQUFFWixNQUFNLENBQUNhLFNBQVM7SUFDeEJDLFVBQVUsRUFBRVYsVUFBVTtJQUN0QlcsV0FBVyxFQUFFO0VBQ2YsQ0FBRSxDQUFDO0VBQ0hKLEdBQUcsQ0FBQ0ssZ0JBQWdCLENBQUUsT0FBUSxDQUFDO0FBQ2pDLENBQUUsQ0FBQztBQUVIZCxLQUFLLENBQUNNLElBQUksQ0FBRSx3QkFBd0IsRUFBRUMsTUFBTSxJQUFJO0VBQzlDQSxNQUFNLENBQUNDLEVBQUUsQ0FBRSxJQUFJLEVBQUUsY0FBZSxDQUFDO0VBRWpDLE1BQU1DLEdBQUcsR0FBRyxJQUFJWixZQUFZLENBQUU7SUFDNUJhLE1BQU0sRUFBRVosTUFBTSxDQUFDYSxTQUFTLENBQUNJLFlBQVksQ0FBRSxPQUFRLENBQUM7SUFDaERILFVBQVUsRUFBRVYsVUFBVTtJQUN0Qlcs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