// Copyright 2019-2024, University of Colorado Boulder

/**
 * A PhET-iO class that encapsulates a PhetioObject that is not created during sim startup to provide PhET-iO API
 * validation, API communication (like to view in studio before creation), and to support PhET-iO state if applicable.
 *
 * Constructing a PhetioCapsule creates a container encapsulating a wrapped element that can be of any type.
 *
 * Clients should use myCapsule.getElement() instead of storing the element value itself.
 *
 * NOTE: Be careful about treating the dynamic element as a singleton. When creating the archetype, problems can arise
 * because the capsule creates two instances of the element: one as the archetype and one as the instance. This can
 * result in trouble like in https://github.com/phetsims/joist/issues/821.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chris Klusendorf (PhET Interactive Simulations)
 */

import PhetioDynamicElementContainer from './PhetioDynamicElementContainer.js';
import Tandem from './Tandem.js';
import tandemNamespace from './tandemNamespace.js';
import IOType from './types/IOType.js';
import optionize from '../../phet-core/js/optionize.js';
import isSettingPhetioStateProperty from './isSettingPhetioStateProperty.js';
import IOTypeCache from './IOTypeCache.js';

// constants
const DEFAULT_CONTAINER_SUFFIX = phetio.PhetioIDUtils.CAPSULE_SUFFIX;

// cache each parameterized IOType so that it is only created once.
const cache = new IOTypeCache();

// The container suffix has to be "Capsule" or we need to change some logic in PhetioIDUtils.getArchetypalPhetioID

class PhetioCapsule extends PhetioDynamicElementContainer {
  /**
   * @param createElement - function that creates the encapsulated element
   * @param defaultArguments - arguments passed to createElement when creating the archetype
   * @param [providedOptions]
   */
  constructor(createElement, defaultArguments, providedOptions) {
    const options = optionize()({
      // The capsule's tandem name must have this suffix, and the base tandem name for its wrapped element
      // will consist of the capsule's tandem name with this suffix stripped off.
      containerSuffix: DEFAULT_CONTAINER_SUFFIX,
      disposeOnClear: true,
      disposeCreatedOnStateSet: false
    }, providedOptions);
    super(createElement, defaultArguments, options);
    this.element = null;
    this.disposeOnClear = options.disposeOnClear;
    this.disposeCreatedOnStateSet = options.disposeCreatedOnStateSet;
  }

  /**
   * Dispose the underlying element.  Called by the PhetioStateEngine so the capsule element can be recreated with the
   * correct state.
   */
  disposeElement() {
    assert && assert(this.element, 'cannot dispose if element is not defined');
    assert && assert(this.disposeOnClear, 'cannot dispose if element is not disposable');
    super.disposeElement(this.element);
    this.element = null;
  }
  hasElement() {
    return this.element !== null;
  }

  /**
   * Creates the element if it has not been created yet, and returns it.
   */
  getElement(...argsForCreateFunction) {
    if (!this.element) {
      this.create(argsForCreateFunction);
    }
    assert && assert(this.element !== null);
    return this.element;
  }

  /**
   * PhetioCapsule will dispose its element, clearing things up and getting ready for setState, unless
   * this.disposeOnClear opts out of this behavior, in which case the element should fully support mutating itself
   * during state setting.
   */
  clear(providedOptions) {
    const options = optionize()({
      phetioState: null
    }, providedOptions);
    if (this.element && this.disposeOnClear) {
      const appearsInState = options.phetioState && (options.phetioState.hasOwnProperty(this.element.phetioID) ?? false);

      // This option forces disposal on clear, otherwise we don't clear if the element exists in state
      if (this.disposeCreatedOnStateSet || !appearsInState) {
        this.disposeElement();
      }
    }
  }

  /**
   * Primarily for internal use, clients should usually use getElement().
   * @param argsForCreateFunction
   * @param [fromStateSetting] - used for validation during state setting, see PhetioDynamicElementContainer.disposeElement() for documentation
   * (phet-io)
   */
  create(argsForCreateFunction, fromStateSetting = false) {
    assert && assert(this.isPhetioInstrumented(), 'TODO: support uninstrumented PhetioCapsules? see https://github.com/phetsims/tandem/issues/184');
    assert && this.supportsDynamicState && _.hasIn(window, 'phet.joist.sim.') && isSettingPhetioStateProperty.value && assert(fromStateSetting, 'dynamic elements should only be created by the state engine when setting state.');

    // create with default state and substructure, details will need to be set by setter methods.
    this.element = this.createDynamicElement(this.phetioDynamicElementName, argsForCreateFunction, Tandem.PHET_IO_ENABLED ? this.phetioType.parameterTypes[0] : null // Don't access phetioType in PhET brand
    );
    this.notifyElementCreated(this.element);
    return this.element;
  }

  /**
   * Parametric IOType constructor.  Given an element type, this function returns a PhetioCapsule IOType.
   * This caching implementation should be kept in sync with the other parametric IOType caching implementations.
   * @param parameterType
   * @constructor
   */
  static PhetioCapsuleIO = parameterType => {
    if (!cache.has(parameterType)) {
      cache.set(parameterType, new IOType(`PhetioCapsuleIO<${parameterType.typeName}>`, {
        valueType: PhetioCapsule,
        documentation: 'An array that sends notifications when its values have changed.',
        parameterTypes: [parameterType],
        // This is always specified by PhetioCapsule, and will never be this value. Yes, it is odd to have a default value
        // that can never be the actual value, but we thought it would be simplest to reuse the "options" pipeline
        // rather than inventing a new "required" pipeline.
        metadataDefaults: {
          phetioDynamicElementName: null
        },
        // @ts-expect-error The group is a group, not just a PhetioDynamicElementContainer
        addChildElement(capsule, componentName, stateObject) {
          // should throw CouldNotYetDeserializeError if it can't be created yet. Likely that would be because another
          // element in the state needs to be created first, so we will try again on the next iteration of the state
          // setting engine.
          const args = parameterType.stateObjectToCreateElementArguments(stateObject);

          // @ts-expect-error args is of type P, but we can't really communicate that here
          return capsule.create(args, true);
        }
      }));
    }
    return cache.get(parameterType);
  };
}
tandemNamespace.register('PhetioCapsule', PhetioCapsule);
export default PhetioCapsule;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQaGV0aW9EeW5hbWljRWxlbWVudENvbnRhaW5lciIsIlRhbmRlbSIsInRhbmRlbU5hbWVzcGFjZSIsIklPVHlwZSIsIm9wdGlvbml6ZSIsImlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkiLCJJT1R5cGVDYWNoZSIsIkRFRkFVTFRfQ09OVEFJTkVSX1NVRkZJWCIsInBoZXRpbyIsIlBoZXRpb0lEVXRpbHMiLCJDQVBTVUxFX1NVRkZJWCIsImNhY2hlIiwiUGhldGlvQ2Fwc3VsZSIsImNvbnN0cnVjdG9yIiwiY3JlYXRlRWxlbWVudCIsImRlZmF1bHRBcmd1bWVudHMiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiY29udGFpbmVyU3VmZml4IiwiZGlzcG9zZU9uQ2xlYXIiLCJkaXNwb3NlQ3JlYXRlZE9uU3RhdGVTZXQiLCJlbGVtZW50IiwiZGlzcG9zZUVsZW1lbnQiLCJhc3NlcnQiLCJoYXNFbGVtZW50IiwiZ2V0RWxlbWVudCIsImFyZ3NGb3JDcmVhdGVGdW5jdGlvbiIsImNyZWF0ZSIsImNsZWFyIiwicGhldGlvU3RhdGUiLCJhcHBlYXJzSW5TdGF0ZSIsImhhc093blByb3BlcnR5IiwicGhldGlvSUQiLCJmcm9tU3RhdGVTZXR0aW5nIiwiaXNQaGV0aW9JbnN0cnVtZW50ZWQiLCJzdXBwb3J0c0R5bmFtaWNTdGF0ZSIsIl8iLCJoYXNJbiIsIndpbmRvdyIsInZhbHVlIiwiY3JlYXRlRHluYW1pY0VsZW1lbnQiLCJwaGV0aW9EeW5hbWljRWxlbWVudE5hbWUiLCJQSEVUX0lPX0VOQUJMRUQiLCJwaGV0aW9UeXBlIiwicGFyYW1ldGVyVHlwZXMiLCJub3RpZnlFbGVtZW50Q3JlYXRlZCIsIlBoZXRpb0NhcHN1bGVJTyIsInBhcmFtZXRlclR5cGUiLCJoYXMiLCJzZXQiLCJ0eXBlTmFtZSIsInZhbHVlVHlwZSIsImRvY3VtZW50YXRpb24iLCJtZXRhZGF0YURlZmF1bHRzIiwiYWRkQ2hpbGRFbGVtZW50IiwiY2Fwc3VsZSIsImNvbXBvbmVudE5hbWUiLCJzdGF0ZU9iamVjdCIsImFyZ3MiLCJzdGF0ZU9iamVjdFRvQ3JlYXRlRWxlbWVudEFyZ3VtZW50cyIsImdldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGhldGlvQ2Fwc3VsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIFBoRVQtaU8gY2xhc3MgdGhhdCBlbmNhcHN1bGF0ZXMgYSBQaGV0aW9PYmplY3QgdGhhdCBpcyBub3QgY3JlYXRlZCBkdXJpbmcgc2ltIHN0YXJ0dXAgdG8gcHJvdmlkZSBQaEVULWlPIEFQSVxyXG4gKiB2YWxpZGF0aW9uLCBBUEkgY29tbXVuaWNhdGlvbiAobGlrZSB0byB2aWV3IGluIHN0dWRpbyBiZWZvcmUgY3JlYXRpb24pLCBhbmQgdG8gc3VwcG9ydCBQaEVULWlPIHN0YXRlIGlmIGFwcGxpY2FibGUuXHJcbiAqXHJcbiAqIENvbnN0cnVjdGluZyBhIFBoZXRpb0NhcHN1bGUgY3JlYXRlcyBhIGNvbnRhaW5lciBlbmNhcHN1bGF0aW5nIGEgd3JhcHBlZCBlbGVtZW50IHRoYXQgY2FuIGJlIG9mIGFueSB0eXBlLlxyXG4gKlxyXG4gKiBDbGllbnRzIHNob3VsZCB1c2UgbXlDYXBzdWxlLmdldEVsZW1lbnQoKSBpbnN0ZWFkIG9mIHN0b3JpbmcgdGhlIGVsZW1lbnQgdmFsdWUgaXRzZWxmLlxyXG4gKlxyXG4gKiBOT1RFOiBCZSBjYXJlZnVsIGFib3V0IHRyZWF0aW5nIHRoZSBkeW5hbWljIGVsZW1lbnQgYXMgYSBzaW5nbGV0b24uIFdoZW4gY3JlYXRpbmcgdGhlIGFyY2hldHlwZSwgcHJvYmxlbXMgY2FuIGFyaXNlXHJcbiAqIGJlY2F1c2UgdGhlIGNhcHN1bGUgY3JlYXRlcyB0d28gaW5zdGFuY2VzIG9mIHRoZSBlbGVtZW50OiBvbmUgYXMgdGhlIGFyY2hldHlwZSBhbmQgb25lIGFzIHRoZSBpbnN0YW5jZS4gVGhpcyBjYW5cclxuICogcmVzdWx0IGluIHRyb3VibGUgbGlrZSBpbiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvam9pc3QvaXNzdWVzLzgyMS5cclxuICpcclxuICogQGF1dGhvciBNaWNoYWVsIEthdXptYW5uIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIENocmlzIEtsdXNlbmRvcmYgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFBoZXRpb0R5bmFtaWNFbGVtZW50Q29udGFpbmVyLCB7IENsZWFyT3B0aW9ucywgUGhldGlvRHluYW1pY0VsZW1lbnRDb250YWluZXJPcHRpb25zIH0gZnJvbSAnLi9QaGV0aW9EeW5hbWljRWxlbWVudENvbnRhaW5lci5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi9UYW5kZW0uanMnO1xyXG5pbXBvcnQgdGFuZGVtTmFtZXNwYWNlIGZyb20gJy4vdGFuZGVtTmFtZXNwYWNlLmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBQaGV0aW9PYmplY3QgZnJvbSAnLi9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgSW50ZW50aW9uYWxBbnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL0ludGVudGlvbmFsQW55LmpzJztcclxuaW1wb3J0IGlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkgZnJvbSAnLi9pc1NldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xyXG5pbXBvcnQgSU9UeXBlQ2FjaGUgZnJvbSAnLi9JT1R5cGVDYWNoZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgREVGQVVMVF9DT05UQUlORVJfU1VGRklYID0gcGhldGlvLlBoZXRpb0lEVXRpbHMuQ0FQU1VMRV9TVUZGSVg7XHJcblxyXG4vLyBjYWNoZSBlYWNoIHBhcmFtZXRlcml6ZWQgSU9UeXBlIHNvIHRoYXQgaXQgaXMgb25seSBjcmVhdGVkIG9uY2UuXHJcbmNvbnN0IGNhY2hlID0gbmV3IElPVHlwZUNhY2hlKCk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBTb21lIGVsZW1lbnRzIGxpa2UgQWJvdXREaWFsb2cgYW5kIFByZWZlcmVuY2VzRGlhbG9nIHBlcnNpc3QgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltLCBhbmQgb25jZSBjcmVhdGVkXHJcbiAgLy8gYXJlIG5ldmVyIGRpc3Bvc2VkLiBUaGlzIGFsbG93cyB1cyB0byBhdm9pZCBleHRlbnNpdmUgdW5uZWNlc3Nhcnkgd29yayBpbXBsZW1lbnRpbmcgZGlzcG9zZSBmb3IgdGhlc2UgZWxlbWVudHMuXHJcbiAgLy8gSWYgdHJ1ZSwgZGlzcG9zZSB0aGUgZWxlbWVudCB3aGVuIGNsZWFyZWQuIElmIHNldCB0byBmYWxzZSwgY2xlYXIoKSB3aWxsIGJhc2ljYWxseSBiZSBhIG5vLW9wLCB3aGljaCBjYW4gYmVcclxuICAvLyB1c2VmdWwgaWYgeW91IHdhbnQgdG8gc3VwcG9ydCBsYXp5IGNyZWF0aW9uLCBidXQgaWYgdGhpcyBpcyBub3QgYSB0cnVlIFwiZHluYW1pYyBlbGVtZW50XCIuIFRoaXMgd2lsbCBhbHNvIGNhdXNlIGFuXHJcbiAgLy8gYXNzZXJ0aW9uIGlmIGV2ZXIgdHJ5aW5nIHRvIGNhbGwgZGlzcG9zZUVsZW1lbnQgb24gdGhpcy4gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3BoZXQtaW8vaXNzdWVzLzE4MTBcclxuICBkaXNwb3NlT25DbGVhcj86IGJvb2xlYW47XHJcblxyXG4gIC8vIE9ubHkgYXBwbGljYWJsZSBpZiBkaXNwb3NpbmcgZHVyaW5nIGNsZWFyLiBUaGlzIGlzIGFuIG9wdGltaXphdGlvbiB0byBwcmV2ZW50IHRoZSBuZWVkIHRvIHJlY3JlYXRlIHRoZSBlbGVtZW50IGVhY2hcclxuICAvLyB0aW1lIFBoRVQtaU8gc3RhdGUgaXMgc2V0LiBEZWZhdWx0cyB0byBmYWxzZS4gVGhpcyBzaG91bGQgb25seSBiZSB0cnVlIGlmIHlvdXIgZHluYW1pYyBlbGVtZW50IGNhbiBiZSBtdXRhdGVkXHJcbiAgLy8gd2l0aCBzdGF0ZSwgYW5kIGRvZXNuJ3QgbmVlZCBjb25zdHJ1Y3Rpb24gdG8gYmUgcnVuIGR1cmluZyBzdGF0ZSBzZXQuIFRoaXMgc2hvdWxkIGJlIHNldCB0byB0cnVlIHdoZW4gc3VwcG9ydGluZ1xyXG4gIC8vIGhldGVyb2dlbmVvdXMgY2Fwc3VsZXMuIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9waGV0LWlvL2lzc3Vlcy8xODEwXHJcbiAgZGlzcG9zZUNyZWF0ZWRPblN0YXRlU2V0PzogYm9vbGVhbjtcclxufTtcclxuXHJcbi8vIFRoZSBjb250YWluZXIgc3VmZml4IGhhcyB0byBiZSBcIkNhcHN1bGVcIiBvciB3ZSBuZWVkIHRvIGNoYW5nZSBzb21lIGxvZ2ljIGluIFBoZXRpb0lEVXRpbHMuZ2V0QXJjaGV0eXBhbFBoZXRpb0lEXHJcbmV4cG9ydCB0eXBlIFBoZXRpb0NhcHN1bGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PFBoZXRpb0R5bmFtaWNFbGVtZW50Q29udGFpbmVyT3B0aW9ucywgJ2NvbnRhaW5lclN1ZmZpeCc+O1xyXG5cclxuY2xhc3MgUGhldGlvQ2Fwc3VsZTxUIGV4dGVuZHMgUGhldGlvT2JqZWN0LCBQIGV4dGVuZHMgSW50ZW50aW9uYWxBbnlbXSA9IFtdPiBleHRlbmRzIFBoZXRpb0R5bmFtaWNFbGVtZW50Q29udGFpbmVyPFQsIFA+IHtcclxuICBwcml2YXRlIGVsZW1lbnQ6IFQgfCBudWxsO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZU9uQ2xlYXI6IGJvb2xlYW47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlQ3JlYXRlZE9uU3RhdGVTZXQ6IGJvb2xlYW47XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBjcmVhdGVFbGVtZW50IC0gZnVuY3Rpb24gdGhhdCBjcmVhdGVzIHRoZSBlbmNhcHN1bGF0ZWQgZWxlbWVudFxyXG4gICAqIEBwYXJhbSBkZWZhdWx0QXJndW1lbnRzIC0gYXJndW1lbnRzIHBhc3NlZCB0byBjcmVhdGVFbGVtZW50IHdoZW4gY3JlYXRpbmcgdGhlIGFyY2hldHlwZVxyXG4gICAqIEBwYXJhbSBbcHJvdmlkZWRPcHRpb25zXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggY3JlYXRlRWxlbWVudDogKCB0OiBUYW5kZW0sIC4uLnA6IFAgKSA9PiBULCBkZWZhdWx0QXJndW1lbnRzOiBQIHwgKCAoKSA9PiBQICksIHByb3ZpZGVkT3B0aW9ucz86IFBoZXRpb0NhcHN1bGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UGhldGlvQ2Fwc3VsZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBQaGV0aW9EeW5hbWljRWxlbWVudENvbnRhaW5lck9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFRoZSBjYXBzdWxlJ3MgdGFuZGVtIG5hbWUgbXVzdCBoYXZlIHRoaXMgc3VmZml4LCBhbmQgdGhlIGJhc2UgdGFuZGVtIG5hbWUgZm9yIGl0cyB3cmFwcGVkIGVsZW1lbnRcclxuICAgICAgLy8gd2lsbCBjb25zaXN0IG9mIHRoZSBjYXBzdWxlJ3MgdGFuZGVtIG5hbWUgd2l0aCB0aGlzIHN1ZmZpeCBzdHJpcHBlZCBvZmYuXHJcbiAgICAgIGNvbnRhaW5lclN1ZmZpeDogREVGQVVMVF9DT05UQUlORVJfU1VGRklYLFxyXG4gICAgICBkaXNwb3NlT25DbGVhcjogdHJ1ZSxcclxuICAgICAgZGlzcG9zZUNyZWF0ZWRPblN0YXRlU2V0OiBmYWxzZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIGNyZWF0ZUVsZW1lbnQsIGRlZmF1bHRBcmd1bWVudHMsIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5kaXNwb3NlT25DbGVhciA9IG9wdGlvbnMuZGlzcG9zZU9uQ2xlYXI7XHJcbiAgICB0aGlzLmRpc3Bvc2VDcmVhdGVkT25TdGF0ZVNldCA9IG9wdGlvbnMuZGlzcG9zZUNyZWF0ZWRPblN0YXRlU2V0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGlzcG9zZSB0aGUgdW5kZXJseWluZyBlbGVtZW50LiAgQ2FsbGVkIGJ5IHRoZSBQaGV0aW9TdGF0ZUVuZ2luZSBzbyB0aGUgY2Fwc3VsZSBlbGVtZW50IGNhbiBiZSByZWNyZWF0ZWQgd2l0aCB0aGVcclxuICAgKiBjb3JyZWN0IHN0YXRlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlRWxlbWVudCgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZWxlbWVudCwgJ2Nhbm5vdCBkaXNwb3NlIGlmIGVsZW1lbnQgaXMgbm90IGRlZmluZWQnICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmRpc3Bvc2VPbkNsZWFyLCAnY2Fubm90IGRpc3Bvc2UgaWYgZWxlbWVudCBpcyBub3QgZGlzcG9zYWJsZScgKTtcclxuICAgIHN1cGVyLmRpc3Bvc2VFbGVtZW50KCB0aGlzLmVsZW1lbnQhICk7XHJcbiAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGhhc0VsZW1lbnQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50ICE9PSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyB0aGUgZWxlbWVudCBpZiBpdCBoYXMgbm90IGJlZW4gY3JlYXRlZCB5ZXQsIGFuZCByZXR1cm5zIGl0LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRFbGVtZW50KCAuLi5hcmdzRm9yQ3JlYXRlRnVuY3Rpb246IFAgKTogVCB7XHJcbiAgICBpZiAoICF0aGlzLmVsZW1lbnQgKSB7XHJcbiAgICAgIHRoaXMuY3JlYXRlKCBhcmdzRm9yQ3JlYXRlRnVuY3Rpb24gKTtcclxuICAgIH1cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZWxlbWVudCAhPT0gbnVsbCApO1xyXG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudCE7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQaGV0aW9DYXBzdWxlIHdpbGwgZGlzcG9zZSBpdHMgZWxlbWVudCwgY2xlYXJpbmcgdGhpbmdzIHVwIGFuZCBnZXR0aW5nIHJlYWR5IGZvciBzZXRTdGF0ZSwgdW5sZXNzXHJcbiAgICogdGhpcy5kaXNwb3NlT25DbGVhciBvcHRzIG91dCBvZiB0aGlzIGJlaGF2aW9yLCBpbiB3aGljaCBjYXNlIHRoZSBlbGVtZW50IHNob3VsZCBmdWxseSBzdXBwb3J0IG11dGF0aW5nIGl0c2VsZlxyXG4gICAqIGR1cmluZyBzdGF0ZSBzZXR0aW5nLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBjbGVhciggcHJvdmlkZWRPcHRpb25zPzogQ2xlYXJPcHRpb25zICk6IHZvaWQge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8Q2xlYXJPcHRpb25zPigpKCB7XHJcbiAgICAgIHBoZXRpb1N0YXRlOiBudWxsXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBpZiAoIHRoaXMuZWxlbWVudCAmJiB0aGlzLmRpc3Bvc2VPbkNsZWFyICkge1xyXG4gICAgICBjb25zdCBhcHBlYXJzSW5TdGF0ZSA9IG9wdGlvbnMucGhldGlvU3RhdGUgJiYgKCBvcHRpb25zLnBoZXRpb1N0YXRlLmhhc093blByb3BlcnR5KCB0aGlzLmVsZW1lbnQucGhldGlvSUQgKSA/PyBmYWxzZSApO1xyXG5cclxuICAgICAgLy8gVGhpcyBvcHRpb24gZm9yY2VzIGRpc3Bvc2FsIG9uIGNsZWFyLCBvdGhlcndpc2Ugd2UgZG9uJ3QgY2xlYXIgaWYgdGhlIGVsZW1lbnQgZXhpc3RzIGluIHN0YXRlXHJcbiAgICAgIGlmICggdGhpcy5kaXNwb3NlQ3JlYXRlZE9uU3RhdGVTZXQgfHwgIWFwcGVhcnNJblN0YXRlICkge1xyXG4gICAgICAgIHRoaXMuZGlzcG9zZUVsZW1lbnQoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUHJpbWFyaWx5IGZvciBpbnRlcm5hbCB1c2UsIGNsaWVudHMgc2hvdWxkIHVzdWFsbHkgdXNlIGdldEVsZW1lbnQoKS5cclxuICAgKiBAcGFyYW0gYXJnc0ZvckNyZWF0ZUZ1bmN0aW9uXHJcbiAgICogQHBhcmFtIFtmcm9tU3RhdGVTZXR0aW5nXSAtIHVzZWQgZm9yIHZhbGlkYXRpb24gZHVyaW5nIHN0YXRlIHNldHRpbmcsIHNlZSBQaGV0aW9EeW5hbWljRWxlbWVudENvbnRhaW5lci5kaXNwb3NlRWxlbWVudCgpIGZvciBkb2N1bWVudGF0aW9uXHJcbiAgICogKHBoZXQtaW8pXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZSggYXJnc0ZvckNyZWF0ZUZ1bmN0aW9uOiBQLCBmcm9tU3RhdGVTZXR0aW5nID0gZmFsc2UgKTogVCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmlzUGhldGlvSW5zdHJ1bWVudGVkKCksICdUT0RPOiBzdXBwb3J0IHVuaW5zdHJ1bWVudGVkIFBoZXRpb0NhcHN1bGVzPyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3RhbmRlbS9pc3N1ZXMvMTg0JyApO1xyXG5cclxuICAgIGFzc2VydCAmJiB0aGlzLnN1cHBvcnRzRHluYW1pY1N0YXRlICYmIF8uaGFzSW4oIHdpbmRvdywgJ3BoZXQuam9pc3Quc2ltLicgKSAmJlxyXG4gICAgaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eS52YWx1ZSAmJiBhc3NlcnQoIGZyb21TdGF0ZVNldHRpbmcsXHJcbiAgICAgICdkeW5hbWljIGVsZW1lbnRzIHNob3VsZCBvbmx5IGJlIGNyZWF0ZWQgYnkgdGhlIHN0YXRlIGVuZ2luZSB3aGVuIHNldHRpbmcgc3RhdGUuJyApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSB3aXRoIGRlZmF1bHQgc3RhdGUgYW5kIHN1YnN0cnVjdHVyZSwgZGV0YWlscyB3aWxsIG5lZWQgdG8gYmUgc2V0IGJ5IHNldHRlciBtZXRob2RzLlxyXG4gICAgdGhpcy5lbGVtZW50ID0gdGhpcy5jcmVhdGVEeW5hbWljRWxlbWVudChcclxuICAgICAgdGhpcy5waGV0aW9EeW5hbWljRWxlbWVudE5hbWUsXHJcbiAgICAgIGFyZ3NGb3JDcmVhdGVGdW5jdGlvbixcclxuICAgICAgVGFuZGVtLlBIRVRfSU9fRU5BQkxFRCA/IHRoaXMucGhldGlvVHlwZS5wYXJhbWV0ZXJUeXBlcyFbIDAgXSA6IG51bGwgLy8gRG9uJ3QgYWNjZXNzIHBoZXRpb1R5cGUgaW4gUGhFVCBicmFuZFxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLm5vdGlmeUVsZW1lbnRDcmVhdGVkKCB0aGlzLmVsZW1lbnQgKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGFyYW1ldHJpYyBJT1R5cGUgY29uc3RydWN0b3IuICBHaXZlbiBhbiBlbGVtZW50IHR5cGUsIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBhIFBoZXRpb0NhcHN1bGUgSU9UeXBlLlxyXG4gICAqIFRoaXMgY2FjaGluZyBpbXBsZW1lbnRhdGlvbiBzaG91bGQgYmUga2VwdCBpbiBzeW5jIHdpdGggdGhlIG90aGVyIHBhcmFtZXRyaWMgSU9UeXBlIGNhY2hpbmcgaW1wbGVtZW50YXRpb25zLlxyXG4gICAqIEBwYXJhbSBwYXJhbWV0ZXJUeXBlXHJcbiAgICogQGNvbnN0cnVjdG9yXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBQaGV0aW9DYXBzdWxlSU8gPSA8UGFyYW1ldGVyVHlwZSBleHRlbmRzIFBoZXRpb09iamVjdCwgUGFyYW1ldGVyU3RhdGVUeXBlPiggcGFyYW1ldGVyVHlwZTogSU9UeXBlPFBhcmFtZXRlclR5cGUsIFBhcmFtZXRlclN0YXRlVHlwZT4gKTogSU9UeXBlID0+IHtcclxuXHJcbiAgICBpZiAoICFjYWNoZS5oYXMoIHBhcmFtZXRlclR5cGUgKSApIHtcclxuICAgICAgY2FjaGUuc2V0KCBwYXJhbWV0ZXJUeXBlLCBuZXcgSU9UeXBlPFBoZXRpb0NhcHN1bGU8UGFyYW1ldGVyVHlwZT4sIEludGVudGlvbmFsQW55PiggYFBoZXRpb0NhcHN1bGVJTzwke3BhcmFtZXRlclR5cGUudHlwZU5hbWV9PmAsIHtcclxuICAgICAgICB2YWx1ZVR5cGU6IFBoZXRpb0NhcHN1bGUsXHJcbiAgICAgICAgZG9jdW1lbnRhdGlvbjogJ0FuIGFycmF5IHRoYXQgc2VuZHMgbm90aWZpY2F0aW9ucyB3aGVuIGl0cyB2YWx1ZXMgaGF2ZSBjaGFuZ2VkLicsXHJcbiAgICAgICAgcGFyYW1ldGVyVHlwZXM6IFsgcGFyYW1ldGVyVHlwZSBdLFxyXG5cclxuICAgICAgICAvLyBUaGlzIGlzIGFsd2F5cyBzcGVjaWZpZWQgYnkgUGhldGlvQ2Fwc3VsZSwgYW5kIHdpbGwgbmV2ZXIgYmUgdGhpcyB2YWx1ZS4gWWVzLCBpdCBpcyBvZGQgdG8gaGF2ZSBhIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAvLyB0aGF0IGNhbiBuZXZlciBiZSB0aGUgYWN0dWFsIHZhbHVlLCBidXQgd2UgdGhvdWdodCBpdCB3b3VsZCBiZSBzaW1wbGVzdCB0byByZXVzZSB0aGUgXCJvcHRpb25zXCIgcGlwZWxpbmVcclxuICAgICAgICAvLyByYXRoZXIgdGhhbiBpbnZlbnRpbmcgYSBuZXcgXCJyZXF1aXJlZFwiIHBpcGVsaW5lLlxyXG4gICAgICAgIG1ldGFkYXRhRGVmYXVsdHM6IHsgcGhldGlvRHluYW1pY0VsZW1lbnROYW1lOiBudWxsIH0sXHJcblxyXG4gICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVGhlIGdyb3VwIGlzIGEgZ3JvdXAsIG5vdCBqdXN0IGEgUGhldGlvRHluYW1pY0VsZW1lbnRDb250YWluZXJcclxuICAgICAgICBhZGRDaGlsZEVsZW1lbnQoIGNhcHN1bGU6IFBoZXRpb0NhcHN1bGU8UGFyYW1ldGVyVHlwZT4sIGNvbXBvbmVudE5hbWU6IHN0cmluZywgc3RhdGVPYmplY3Q6IFBhcmFtZXRlclN0YXRlVHlwZSApIHtcclxuXHJcbiAgICAgICAgICAvLyBzaG91bGQgdGhyb3cgQ291bGROb3RZZXREZXNlcmlhbGl6ZUVycm9yIGlmIGl0IGNhbid0IGJlIGNyZWF0ZWQgeWV0LiBMaWtlbHkgdGhhdCB3b3VsZCBiZSBiZWNhdXNlIGFub3RoZXJcclxuICAgICAgICAgIC8vIGVsZW1lbnQgaW4gdGhlIHN0YXRlIG5lZWRzIHRvIGJlIGNyZWF0ZWQgZmlyc3QsIHNvIHdlIHdpbGwgdHJ5IGFnYWluIG9uIHRoZSBuZXh0IGl0ZXJhdGlvbiBvZiB0aGUgc3RhdGVcclxuICAgICAgICAgIC8vIHNldHRpbmcgZW5naW5lLlxyXG4gICAgICAgICAgY29uc3QgYXJncyA9IHBhcmFtZXRlclR5cGUuc3RhdGVPYmplY3RUb0NyZWF0ZUVsZW1lbnRBcmd1bWVudHMoIHN0YXRlT2JqZWN0ICk7XHJcblxyXG4gICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBhcmdzIGlzIG9mIHR5cGUgUCwgYnV0IHdlIGNhbid0IHJlYWxseSBjb21tdW5pY2F0ZSB0aGF0IGhlcmVcclxuICAgICAgICAgIHJldHVybiBjYXBzdWxlLmNyZWF0ZSggYXJncywgdHJ1ZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNhY2hlLmdldCggcGFyYW1ldGVyVHlwZSApITtcclxuICB9O1xyXG59XHJcblxyXG5cclxudGFuZGVtTmFtZXNwYWNlLnJlZ2lzdGVyKCAnUGhldGlvQ2Fwc3VsZScsIFBoZXRpb0NhcHN1bGUgKTtcclxuZXhwb3J0IGRlZmF1bHQg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