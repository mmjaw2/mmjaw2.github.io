// Copyright 2022-2024, University of Colorado Boulder

/**
 * Helper type that supports a `parameters` member.
 * This is mostly useful for PhET-iO instrumented sub-class to use that takes a variable number of parameters in their
 * IOType. With this function you gain parameter validation, PhET-iO documentation, and data stream support.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import assertMutuallyExclusiveOptions from '../../phet-core/js/assertMutuallyExclusiveOptions.js';
import optionize from '../../phet-core/js/optionize.js';
import PhetioObject from './PhetioObject.js';
import Tandem from './Tandem.js';
import axon from '../../axon/js/axon.js';
import validate from '../../axon/js/validate.js';
import Validation from '../../axon/js/Validation.js';
const VALIDATE_OPTIONS_FALSE = {
  validateValidator: false
};
// Simulations have thousands of Emitters, so we re-use objects where possible.
const EMPTY_ARRAY = [];
assert && Object.freeze(EMPTY_ARRAY);

// Allowed keys to options.parameters, the parameters to emit.
const PARAMETER_KEYS = ['name',
// required for phet-io instrumented Actions
'phetioType',
// required for phet-io instrumented Actions
'phetioDocumentation',
// optional, additional documentation for this specific parameter

// Specify this to keep the parameter private to the PhET-iO API. To support emitting and executing over the PhET-iO
// API, phetioPrivate parameters must not ever be before a public one. For example `emit1( public1, private1, public2)`
// is not allowed. Instead, it must be ordered like `emit( public1, public2, private1 )`
'phetioPrivate'].concat(Validation.VALIDATOR_KEYS);

// helper closures
const paramToPhetioType = param => param.phetioType;
const paramToName = param => param.name;

// Use each subtype should provide its own phetioOuterType. That coupled with parameter IOTypes will result in the
// phetioType. Don't pass this in!

class PhetioDataHandler extends PhetioObject {
  constructor(providedOptions) {
    const options = optionize()({
      // SelfOptions
      parameters: EMPTY_ARRAY,
      hasListenerOrderDependencies: false,
      // phet-io - see PhetioObject.js for doc
      phetioPlayback: PhetioObject.DEFAULT_OPTIONS.phetioPlayback,
      phetioEventMetadata: PhetioObject.DEFAULT_OPTIONS.phetioEventMetadata,
      phetioDocumentation: ''
    }, providedOptions);
    assert && PhetioDataHandler.validateParameters(options.parameters, !!options.tandem?.supplied);
    assert && assert(options.phetioType === undefined, 'PhetioDataHandler sets its own phetioType. Instead provide parameter phetioTypes through `options.parameters` with a phetioOuterType');

    // list of parameters, see options.parameters. Filter out phetioPrivate parameters, all `phetioPrivate`
    // parameters will not have a `phetioType`, see `validateParameters`.
    const phetioPublicParameters = options.parameters.filter(paramToPhetioType);
    options.phetioType = options.phetioOuterType(phetioPublicParameters.map(paramToPhetioType));

    // phetioPlayback events need to know the order the arguments occur in order to call EmitterIO.emit()
    // Indicate whether the event is for playback, but leave this "sparse"--only indicate when this happens to be true
    if (options.phetioPlayback) {
      options.phetioEventMetadata = options.phetioEventMetadata || {}; // phetioEventMetadata defaults to null

      assert && assert(!options.phetioEventMetadata.hasOwnProperty('dataKeys'), 'dataKeys should be supplied by PhetioDataHandler, not elsewhere');
      options.phetioEventMetadata.dataKeys = options.parameters.map(paramToName);
    }
    options.phetioDocumentation = PhetioDataHandler.getPhetioDocumentation(options.phetioDocumentation, phetioPublicParameters);
    super(options);

    // Note: one test indicates stripping this out via assert && in builds may save around 300kb heap
    this.parameters = options.parameters;
  }

  /**
   * @param parameters
   * @param tandemSupplied - proxy for whether the PhetioObject is instrumented.  We cannot call
   *                                 - PhetioObject.isPhetioInstrumented() until after the supercall, so we use this beforehand.
   */
  static validateParameters(parameters, tandemSupplied) {
    // validate the parameters object
    validate(parameters, {
      valueType: Array
    });

    // PhetioDataHandler only supports phetioPrivate parameters at the end of the emit call, so once we hit the first phetioPrivate
    // parameter, then assert that the rest of them afterwards are as well.
    let reachedPhetioPrivate = false;

    // we must iterate from the first parameter to the last parameter to support phetioPrivate
    for (let i = 0; i < parameters.length; i++) {
      const parameter = parameters[i]; // metadata about a single parameter

      assert && assert(Object.getPrototypeOf(parameter) === Object.prototype, 'Extra prototype on parameter object is a code smell');
      reachedPhetioPrivate = reachedPhetioPrivate || parameter.phetioPrivate;
      assert && reachedPhetioPrivate && assert(parameter.phetioPrivate, 'after first phetioPrivate parameter, all subsequent parameters must be phetioPrivate');
      assert && tandemSupplied && Tandem.VALIDATION && assert(parameter.phetioType || parameter.phetioPrivate, 'instrumented Emitters must include phetioType for each parameter or be marked as `phetioPrivate`.');
      assert && parameter.phetioType && assert(parameter.name, '`name` is a required parameter for phet-io instrumented parameters.');
      assert && assertMutuallyExclusiveOptions(parameter, ['phetioPrivate'], ['name', 'phetioType', 'phetioDocumentation']);
      assert && assert(_.intersection(Object.keys(parameter), Validation.VALIDATOR_KEYS).length > 0, `validator must be specified for parameter ${i}`);
      for (const key in parameter) {
        assert && assert(PARAMETER_KEYS.includes(key), `unrecognized parameter key: ${key}`);
      }

      // Changing after construction indicates a logic error.
      assert && Object.freeze(parameters[i]);

      // validate the options passed in to validate each PhetioDataHandler argument
      Validation.validateValidator(parameter);
    }

    // Changing after construction indicates a logic error.
    assert && Object.freeze(parameters);
  }

  /**
   * Validate that provided args match the expected schema given via options.parameters.
   */
  validateArguments(...args) {
    assert && assert(args.length === this.parameters.length, `Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${args.length}`);
    for (let i = 0; i < this.parameters.length; i++) {
      const parameter = this.parameters[i];
      assert && validate(args[i], parameter, VALIDATE_OPTIONS_FALSE);

      // valueType overrides the phetioType validator so we don't use that one if there is a valueType
      if (parameter.phetioType && !parameter.valueType) {
        assert && validate(args[i], parameter.phetioType.validator, VALIDATE_OPTIONS_FALSE);
      }
    }
  }

  /**
   * Validate that provided args match the expected schema given via options.parameters.
   */
  getValidationErrors(...args) {
    assert && assert(args.length === this.parameters.length, `Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${args.length}`);
    return this.parameters.map((parameter, index) => {
      return Validation.getValidationError(args[index], parameter, VALIDATE_OPTIONS_FALSE);
    });
  }

  /**
   * Gets the data that will be emitted to the PhET-iO data stream, for an instrumented simulation.
   * @returns the data, keys dependent on parameter metadata
   */
  getPhetioData(...args) {
    assert && assert(Tandem.PHET_IO_ENABLED, 'should only get phet-io data in phet-io brand');

    // null if there are no arguments. dataStream.js omits null values for data
    let data = null;
    if (this.parameters.length > 0) {
      // Enumerate named argsObject for the data stream.
      data = {};
      for (let i = 0; i < this.parameters.length; i++) {
        const element = this.parameters[i];
        if (!element.phetioPrivate) {
          assert && assert(element.name, 'name required');
          data[element.name] = element.phetioType.toStateObject(args[i]);
        }
      }
    }
    return data;
  }

  /**
   * Get the phetioDocumentation compiled from all the parameters
   */
  static getPhetioDocumentation(currentPhetioDocumentation, parameters) {
    const paramToDocString = param => {
      const docText = param.phetioDocumentation ? ` - ${param.phetioDocumentation}` : '';
      return `<li>${param.name}: ${param.phetioType.typeName}${docText}</li>`;
    };
    return currentPhetioDocumentation + (parameters.length === 0 ? '<br>No parameters.' : `${'<br>The parameters are:<br/>' + '<ol>'}${parameters.map(paramToDocString).join('<br/>')}</ol>`);
  }
}
axon.register('PhetioDataHandler', PhetioDataHandler);
export default PhetioDataHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhc3NlcnRNdXR1YWxseUV4Y2x1c2l2ZU9wdGlvbnMiLCJvcHRpb25pemUiLCJQaGV0aW9PYmplY3QiLCJUYW5kZW0iLCJheG9uIiwidmFsaWRhdGUiLCJWYWxpZGF0aW9uIiwiVkFMSURBVEVfT1BUSU9OU19GQUxTRSIsInZhbGlkYXRlVmFsaWRhdG9yIiwiRU1QVFlfQVJSQVkiLCJhc3NlcnQiLCJPYmplY3QiLCJmcmVlemUiLCJQQVJBTUVURVJfS0VZUyIsImNvbmNhdCIsIlZBTElEQVRPUl9LRVlTIiwicGFyYW1Ub1BoZXRpb1R5cGUiLCJwYXJhbSIsInBoZXRpb1R5cGUiLCJwYXJhbVRvTmFtZSIsIm5hbWUiLCJQaGV0aW9EYXRhSGFuZGxlciIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInBhcmFtZXRlcnMiLCJoYXNMaXN0ZW5lck9yZGVyRGVwZW5kZW5jaWVzIiwicGhldGlvUGxheWJhY2siLCJERUZBVUxUX09QVElPTlMiLCJwaGV0aW9FdmVudE1ldGFkYXRhIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInZhbGlkYXRlUGFyYW1ldGVycyIsInRhbmRlbSIsInN1cHBsaWVkIiwidW5kZWZpbmVkIiwicGhldGlvUHVibGljUGFyYW1ldGVycyIsImZpbHRlciIsInBoZXRpb091dGVyVHlwZSIsIm1hcCIsImhhc093blByb3BlcnR5IiwiZGF0YUtleXMiLCJnZXRQaGV0aW9Eb2N1bWVudGF0aW9uIiwidGFuZGVtU3VwcGxpZWQiLCJ2YWx1ZVR5cGUiLCJBcnJheSIsInJlYWNoZWRQaGV0aW9Qcml2YXRlIiwiaSIsImxlbmd0aCIsInBhcmFtZXRlciIsImdldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwicGhldGlvUHJpdmF0ZSIsIlZBTElEQVRJT04iLCJfIiwiaW50ZXJzZWN0aW9uIiwia2V5cyIsImtleSIsImluY2x1ZGVzIiwidmFsaWRhdGVBcmd1bWVudHMiLCJhcmdzIiwidmFsaWRhdG9yIiwiZ2V0VmFsaWRhdGlvbkVycm9ycyIsImluZGV4IiwiZ2V0VmFsaWRhdGlvbkVycm9yIiwiZ2V0UGhldGlvRGF0YSIsIlBIRVRfSU9fRU5BQkxFRCIsImRhdGEiLCJlbGVtZW50IiwidG9TdGF0ZU9iamVjdCIsImN1cnJlbnRQaGV0aW9Eb2N1bWVudGF0aW9uIiwicGFyYW1Ub0RvY1N0cmluZyIsImRvY1RleHQiLCJ0eXBlTmFtZSIsImpvaW4iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBoZXRpb0RhdGFIYW5kbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEhlbHBlciB0eXBlIHRoYXQgc3VwcG9ydHMgYSBgcGFyYW1ldGVyc2AgbWVtYmVyLlxyXG4gKiBUaGlzIGlzIG1vc3RseSB1c2VmdWwgZm9yIFBoRVQtaU8gaW5zdHJ1bWVudGVkIHN1Yi1jbGFzcyB0byB1c2UgdGhhdCB0YWtlcyBhIHZhcmlhYmxlIG51bWJlciBvZiBwYXJhbWV0ZXJzIGluIHRoZWlyXHJcbiAqIElPVHlwZS4gV2l0aCB0aGlzIGZ1bmN0aW9uIHlvdSBnYWluIHBhcmFtZXRlciB2YWxpZGF0aW9uLCBQaEVULWlPIGRvY3VtZW50YXRpb24sIGFuZCBkYXRhIHN0cmVhbSBzdXBwb3J0LlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IGFzc2VydE11dHVhbGx5RXhjbHVzaXZlT3B0aW9ucyBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvYXNzZXJ0TXV0dWFsbHlFeGNsdXNpdmVPcHRpb25zLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFBoZXRpb09iamVjdCwgeyBQaGV0aW9PYmplY3RPcHRpb25zIH0gZnJvbSAnLi9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4vVGFuZGVtLmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBheG9uIGZyb20gJy4uLy4uL2F4b24vanMvYXhvbi5qcyc7XHJcbmltcG9ydCB2YWxpZGF0ZSBmcm9tICcuLi8uLi9heG9uL2pzL3ZhbGlkYXRlLmpzJztcclxuaW1wb3J0IFZhbGlkYXRpb24sIHsgVmFsaWRhdG9yIH0gZnJvbSAnLi4vLi4vYXhvbi9qcy9WYWxpZGF0aW9uLmpzJztcclxuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xyXG5pbXBvcnQgSW50ZW50aW9uYWxBbnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL0ludGVudGlvbmFsQW55LmpzJztcclxuXHJcbmNvbnN0IFZBTElEQVRFX09QVElPTlNfRkFMU0UgPSB7IHZhbGlkYXRlVmFsaWRhdG9yOiBmYWxzZSB9O1xyXG5cclxuZXhwb3J0IHR5cGUgUGFyYW1ldGVyID0ge1xyXG4gIG5hbWU/OiBzdHJpbmc7XHJcbiAgcGhldGlvRG9jdW1lbnRhdGlvbj86IHN0cmluZztcclxuICBwaGV0aW9Qcml2YXRlPzogYm9vbGVhbjtcclxufSAmIFZhbGlkYXRvcjtcclxuXHJcbi8vIFNpbXVsYXRpb25zIGhhdmUgdGhvdXNhbmRzIG9mIEVtaXR0ZXJzLCBzbyB3ZSByZS11c2Ugb2JqZWN0cyB3aGVyZSBwb3NzaWJsZS5cclxuY29uc3QgRU1QVFlfQVJSQVk6IFBhcmFtZXRlcltdID0gW107XHJcbmFzc2VydCAmJiBPYmplY3QuZnJlZXplKCBFTVBUWV9BUlJBWSApO1xyXG5cclxuLy8gQWxsb3dlZCBrZXlzIHRvIG9wdGlvbnMucGFyYW1ldGVycywgdGhlIHBhcmFtZXRlcnMgdG8gZW1pdC5cclxuY29uc3QgUEFSQU1FVEVSX0tFWVMgPSBbXHJcbiAgJ25hbWUnLCAvLyByZXF1aXJlZCBmb3IgcGhldC1pbyBpbnN0cnVtZW50ZWQgQWN0aW9uc1xyXG4gICdwaGV0aW9UeXBlJywgLy8gcmVxdWlyZWQgZm9yIHBoZXQtaW8gaW5zdHJ1bWVudGVkIEFjdGlvbnNcclxuICAncGhldGlvRG9jdW1lbnRhdGlvbicsIC8vIG9wdGlvbmFsLCBhZGRpdGlvbmFsIGRvY3VtZW50YXRpb24gZm9yIHRoaXMgc3BlY2lmaWMgcGFyYW1ldGVyXHJcblxyXG4gIC8vIFNwZWNpZnkgdGhpcyB0byBrZWVwIHRoZSBwYXJhbWV0ZXIgcHJpdmF0ZSB0byB0aGUgUGhFVC1pTyBBUEkuIFRvIHN1cHBvcnQgZW1pdHRpbmcgYW5kIGV4ZWN1dGluZyBvdmVyIHRoZSBQaEVULWlPXHJcbiAgLy8gQVBJLCBwaGV0aW9Qcml2YXRlIHBhcmFtZXRlcnMgbXVzdCBub3QgZXZlciBiZSBiZWZvcmUgYSBwdWJsaWMgb25lLiBGb3IgZXhhbXBsZSBgZW1pdDEoIHB1YmxpYzEsIHByaXZhdGUxLCBwdWJsaWMyKWBcclxuICAvLyBpcyBub3QgYWxsb3dlZC4gSW5zdGVhZCwgaXQgbXVzdCBiZSBvcmRlcmVkIGxpa2UgYGVtaXQoIHB1YmxpYzEsIHB1YmxpYzIsIHByaXZhdGUxIClgXHJcbiAgJ3BoZXRpb1ByaXZhdGUnXHJcblxyXG5dLmNvbmNhdCggVmFsaWRhdGlvbi5WQUxJREFUT1JfS0VZUyApO1xyXG5cclxuLy8gaGVscGVyIGNsb3N1cmVzXHJcbmNvbnN0IHBhcmFtVG9QaGV0aW9UeXBlID0gKCBwYXJhbTogUGFyYW1ldGVyICkgPT4gcGFyYW0ucGhldGlvVHlwZSE7XHJcbmNvbnN0IHBhcmFtVG9OYW1lID0gKCBwYXJhbTogUGFyYW1ldGVyICkgPT4gcGFyYW0ubmFtZSE7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBUaGUgcGFyYW1ldGVycyB0byB0aGUgZW1pdCBtZXRob2QgdGhhdCB3aWxsIGJlIGNhbGxlZC5cclxuICAvLyBTZWUgUEFSQU1FVEVSX0tFWVMgZm9yIGEgbGlzdCBvZiBsZWdhbCBrZXlzLCB0aGVpciB0eXBlcywgYW5kIGRvY3VtZW50YXRpb24uXHJcbiAgcGFyYW1ldGVycz86IFBhcmFtZXRlcltdO1xyXG4gIHBoZXRpb091dGVyVHlwZTogKCB0OiBJT1R5cGVbXSApID0+IElPVHlwZTtcclxuICBoYXNMaXN0ZW5lck9yZGVyRGVwZW5kZW5jaWVzPzogYm9vbGVhbjtcclxufTtcclxuXHJcbi8vIFVzZSBlYWNoIHN1YnR5cGUgc2hvdWxkIHByb3ZpZGUgaXRzIG93biBwaGV0aW9PdXRlclR5cGUuIFRoYXQgY291cGxlZCB3aXRoIHBhcmFtZXRlciBJT1R5cGVzIHdpbGwgcmVzdWx0IGluIHRoZVxyXG4vLyBwaGV0aW9UeXBlLiBEb24ndCBwYXNzIHRoaXMgaW4hXHJcbmV4cG9ydCB0eXBlIFBoZXRpb0RhdGFIYW5kbGVyT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxQaGV0aW9PYmplY3RPcHRpb25zLCAncGhldGlvVHlwZSc+O1xyXG5cclxuY2xhc3MgUGhldGlvRGF0YUhhbmRsZXI8VCBleHRlbmRzIEludGVudGlvbmFsQW55W10gPSBbXT4gZXh0ZW5kcyBQaGV0aW9PYmplY3Qge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHBhcmFtZXRlcnM6IFBhcmFtZXRlcltdO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9ucz86IFBoZXRpb0RhdGFIYW5kbGVyT3B0aW9ucyApIHtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UGhldGlvRGF0YUhhbmRsZXJPcHRpb25zLCBTZWxmT3B0aW9ucywgUGhldGlvT2JqZWN0T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgcGFyYW1ldGVyczogRU1QVFlfQVJSQVksXHJcbiAgICAgIGhhc0xpc3RlbmVyT3JkZXJEZXBlbmRlbmNpZXM6IGZhbHNlLFxyXG5cclxuICAgICAgLy8gcGhldC1pbyAtIHNlZSBQaGV0aW9PYmplY3QuanMgZm9yIGRvY1xyXG4gICAgICBwaGV0aW9QbGF5YmFjazogUGhldGlvT2JqZWN0LkRFRkFVTFRfT1BUSU9OUy5waGV0aW9QbGF5YmFjayxcclxuICAgICAgcGhldGlvRXZlbnRNZXRhZGF0YTogUGhldGlvT2JqZWN0LkRFRkFVTFRfT1BUSU9OUy5waGV0aW9FdmVudE1ldGFkYXRhLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnJ1xyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIFBoZXRpb0RhdGFIYW5kbGVyLnZhbGlkYXRlUGFyYW1ldGVycyggb3B0aW9ucy5wYXJhbWV0ZXJzLCAhIW9wdGlvbnMudGFuZGVtPy5zdXBwbGllZCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5waGV0aW9UeXBlID09PSB1bmRlZmluZWQsXHJcbiAgICAgICdQaGV0aW9EYXRhSGFuZGxlciBzZXRzIGl0cyBvd24gcGhldGlvVHlwZS4gSW5zdGVhZCBwcm92aWRlIHBhcmFtZXRlciBwaGV0aW9UeXBlcyB0aHJvdWdoIGBvcHRpb25zLnBhcmFtZXRlcnNgIHdpdGggYSBwaGV0aW9PdXRlclR5cGUnICk7XHJcblxyXG4gICAgLy8gbGlzdCBvZiBwYXJhbWV0ZXJzLCBzZWUgb3B0aW9ucy5wYXJhbWV0ZXJzLiBGaWx0ZXIgb3V0IHBoZXRpb1ByaXZhdGUgcGFyYW1ldGVycywgYWxsIGBwaGV0aW9Qcml2YXRlYFxyXG4gICAgLy8gcGFyYW1ldGVycyB3aWxsIG5vdCBoYXZlIGEgYHBoZXRpb1R5cGVgLCBzZWUgYHZhbGlkYXRlUGFyYW1ldGVyc2AuXHJcbiAgICBjb25zdCBwaGV0aW9QdWJsaWNQYXJhbWV0ZXJzID0gb3B0aW9ucy5wYXJhbWV0ZXJzLmZpbHRlciggcGFyYW1Ub1BoZXRpb1R5cGUgKTtcclxuXHJcbiAgICBvcHRpb25zLnBoZXRpb1R5cGUgPSBvcHRpb25zLnBoZXRpb091dGVyVHlwZSggcGhldGlvUHVibGljUGFyYW1ldGVycy5tYXAoIHBhcmFtVG9QaGV0aW9UeXBlICkgKTtcclxuXHJcbiAgICAvLyBwaGV0aW9QbGF5YmFjayBldmVudHMgbmVlZCB0byBrbm93IHRoZSBvcmRlciB0aGUgYXJndW1lbnRzIG9jY3VyIGluIG9yZGVyIHRvIGNhbGwgRW1pdHRlcklPLmVtaXQoKVxyXG4gICAgLy8gSW5kaWNhdGUgd2hldGhlciB0aGUgZXZlbnQgaXMgZm9yIHBsYXliYWNrLCBidXQgbGVhdmUgdGhpcyBcInNwYXJzZVwiLS1vbmx5IGluZGljYXRlIHdoZW4gdGhpcyBoYXBwZW5zIHRvIGJlIHRydWVcclxuICAgIGlmICggb3B0aW9ucy5waGV0aW9QbGF5YmFjayApIHtcclxuICAgICAgb3B0aW9ucy5waGV0aW9FdmVudE1ldGFkYXRhID0gb3B0aW9ucy5waGV0aW9FdmVudE1ldGFkYXRhIHx8IHt9OyAvLyBwaGV0aW9FdmVudE1ldGFkYXRhIGRlZmF1bHRzIHRvIG51bGxcclxuXHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zLnBoZXRpb0V2ZW50TWV0YWRhdGEuaGFzT3duUHJvcGVydHkoICdkYXRhS2V5cycgKSxcclxuICAgICAgICAnZGF0YUtleXMgc2hvdWxkIGJlIHN1cHBsaWVkIGJ5IFBoZXRpb0RhdGFIYW5kbGVyLCBub3QgZWxzZXdoZXJlJyApO1xyXG5cclxuICAgICAgb3B0aW9ucy5waGV0aW9FdmVudE1ldGFkYXRhLmRhdGFLZXlzID0gb3B0aW9ucy5wYXJhbWV0ZXJzLm1hcCggcGFyYW1Ub05hbWUgKTtcclxuICAgIH1cclxuICAgIG9wdGlvbnMucGhldGlvRG9jdW1lbnRhdGlvbiA9IFBoZXRpb0RhdGFIYW5kbGVyLmdldFBoZXRpb0RvY3VtZW50YXRpb24oIG9wdGlvbnMucGhldGlvRG9jdW1lbnRhdGlvbiwgcGhldGlvUHVibGljUGFyYW1ldGVycyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gTm90ZTogb25lIHRlc3QgaW5kaWNhdGVzIHN0cmlwcGluZyB0aGlzIG91dCB2aWEgYXNzZXJ0ICYmIGluIGJ1aWxkcyBtYXkgc2F2ZSBhcm91bmQgMzAwa2IgaGVhcFxyXG4gICAgdGhpcy5wYXJhbWV0ZXJzID0gb3B0aW9ucy5wYXJhbWV0ZXJzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHBhcmFtZXRlcnNcclxuICAgKiBAcGFyYW0gdGFuZGVtU3VwcGxpZWQgLSBwcm94eSBmb3Igd2hldGhlciB0aGUgUGhldGlvT2JqZWN0IGlzIGluc3RydW1lbnRlZC4gIFdlIGNhbm5vdCBjYWxsXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIFBoZXRpb09iamVjdC5pc1BoZXRpb0luc3RydW1lbnRlZCgpIHVudGlsIGFmdGVyIHRoZSBzdXBlcmNhbGwsIHNvIHdlIHVzZSB0aGlzIGJlZm9yZWhhbmQuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgdmFsaWRhdGVQYXJhbWV0ZXJzKCBwYXJhbWV0ZXJzOiBQYXJhbWV0ZXJbXSwgdGFuZGVtU3VwcGxpZWQ6IGJvb2xlYW4gKTogdm9pZCB7XHJcblxyXG4gICAgLy8gdmFsaWRhdGUgdGhlIHBhcmFtZXRlcnMgb2JqZWN0XHJcbiAgICB2YWxpZGF0ZSggcGFyYW1ldGVycywgeyB2YWx1ZVR5cGU6IEFycmF5IH0gKTtcclxuXHJcbiAgICAvLyBQaGV0aW9EYXRhSGFuZGxlciBvbmx5IHN1cHBvcnRzIHBoZXRpb1ByaXZhdGUgcGFyYW1ldGVycyBhdCB0aGUgZW5kIG9mIHRoZSBlbWl0IGNhbGwsIHNvIG9uY2Ugd2UgaGl0IHRoZSBmaXJzdCBwaGV0aW9Qcml2YXRlXHJcbiAgICAvLyBwYXJhbWV0ZXIsIHRoZW4gYXNzZXJ0IHRoYXQgdGhlIHJlc3Qgb2YgdGhlbSBhZnRlcndhcmRzIGFyZSBhcyB3ZWxsLlxyXG4gICAgbGV0IHJlYWNoZWRQaGV0aW9Qcml2YXRlID0gZmFsc2U7XHJcblxyXG4gICAgLy8gd2UgbXVzdCBpdGVyYXRlIGZyb20gdGhlIGZpcnN0IHBhcmFtZXRlciB0byB0aGUgbGFzdCBwYXJhbWV0ZXIgdG8gc3VwcG9ydCBwaGV0aW9Qcml2YXRlXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBwYXJhbWV0ZXJzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCBwYXJhbWV0ZXIgPSBwYXJhbWV0ZXJzWyBpIF07IC8vIG1ldGFkYXRhIGFib3V0IGEgc2luZ2xlIHBhcmFtZXRlclxyXG5cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggT2JqZWN0LmdldFByb3RvdHlwZU9mKCBwYXJhbWV0ZXIgKSA9PT0gT2JqZWN0LnByb3RvdHlwZSxcclxuICAgICAgICAnRXh0cmEgcHJvdG90eXBlIG9uIHBhcmFtZXRlciBvYmplY3QgaXMgYSBjb2RlIHNtZWxsJyApO1xyXG5cclxuICAgICAgcmVhY2hlZFBoZXRpb1ByaXZhdGUgPSByZWFjaGVkUGhldGlvUHJpdmF0ZSB8fCBwYXJhbWV0ZXIucGhldGlvUHJpdmF0ZSE7XHJcbiAgICAgIGFzc2VydCAmJiByZWFjaGVkUGhldGlvUHJpdmF0ZSAmJiBhc3NlcnQoIHBhcmFtZXRlci5waGV0aW9Qcml2YXRlLFxyXG4gICAgICAgICdhZnRlciBmaXJzdCBwaGV0aW9Qcml2YXRlIHBhcmFtZXRlciwgYWxsIHN1YnNlcXVlbnQgcGFyYW1ldGVycyBtdXN0IGJlIHBoZXRpb1ByaXZhdGUnICk7XHJcblxyXG4gICAgICBhc3NlcnQgJiYgdGFuZGVtU3VwcGxpZWQgJiYgVGFuZGVtLlZBTElEQVRJT04gJiYgYXNzZXJ0KCBwYXJhbWV0ZXIucGhldGlvVHlwZSB8fCBwYXJhbWV0ZXIucGhldGlvUHJpdmF0ZSxcclxuICAgICAgICAnaW5zdHJ1bWVudGVkIEVtaXR0ZXJzIG11c3QgaW5jbHVkZSBwaGV0aW9UeXBlIGZvciBlYWNoIHBhcmFtZXRlciBvciBiZSBtYXJrZWQgYXMgYHBoZXRpb1ByaXZhdGVgLicgKTtcclxuICAgICAgYXNzZXJ0ICYmIHBhcmFtZXRlci5waGV0aW9UeXBlICYmIGFzc2VydCggcGFyYW1ldGVyLm5hbWUsXHJcbiAgICAgICAgJ2BuYW1lYCBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlciBmb3IgcGhldC1pbyBpbnN0cnVtZW50ZWQgcGFyYW1ldGVycy4nICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnRNdXR1YWxseUV4Y2x1c2l2ZU9wdGlvbnMoIHBhcmFtZXRlciwgWyAncGhldGlvUHJpdmF0ZScgXSwgW1xyXG4gICAgICAgICduYW1lJywgJ3BoZXRpb1R5cGUnLCAncGhldGlvRG9jdW1lbnRhdGlvbidcclxuICAgICAgXSApO1xyXG5cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggXy5pbnRlcnNlY3Rpb24oIE9iamVjdC5rZXlzKCBwYXJhbWV0ZXIgKSwgVmFsaWRhdGlvbi5WQUxJREFUT1JfS0VZUyApLmxlbmd0aCA+IDAsXHJcbiAgICAgICAgYHZhbGlkYXRvciBtdXN0IGJlIHNwZWNpZmllZCBmb3IgcGFyYW1ldGVyICR7aX1gICk7XHJcblxyXG4gICAgICBmb3IgKCBjb25zdCBrZXkgaW4gcGFyYW1ldGVyICkge1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoIFBBUkFNRVRFUl9LRVlTLmluY2x1ZGVzKCBrZXkgKSwgYHVucmVjb2duaXplZCBwYXJhbWV0ZXIga2V5OiAke2tleX1gICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENoYW5naW5nIGFmdGVyIGNvbnN0cnVjdGlvbiBpbmRpY2F0ZXMgYSBsb2dpYyBlcnJvci5cclxuICAgICAgYXNzZXJ0ICYmIE9iamVjdC5mcmVlemUoIHBhcmFtZXRlcnNbIGkgXSApO1xyXG5cclxuICAgICAgLy8gdmFsaWRhdGUgdGhlIG9wdGlvbnMgcGFzc2VkIGluIHRvIHZhbGlkYXRlIGVhY2ggUGhldGlvRGF0YUhhbmRsZXIgYXJndW1lbnRcclxuICAgICAgVmFsaWRhdGlvbi52YWxpZGF0ZVZhbGlkYXRvciggcGFyYW1ldGVyICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hhbmdpbmcgYWZ0ZXIgY29uc3RydWN0aW9uIGluZGljYXRlcyBhIGxvZ2ljIGVycm9yLlxyXG4gICAgYXNzZXJ0ICYmIE9iamVjdC5mcmVlemUoIHBhcmFtZXRlcnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlIHRoYXQgcHJvdmlkZWQgYXJncyBtYXRjaCB0aGUgZXhwZWN0ZWQgc2NoZW1hIGdpdmVuIHZpYSBvcHRpb25zLnBhcmFtZXRlcnMuXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHZhbGlkYXRlQXJndW1lbnRzKCAuLi5hcmdzOiBUICk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggYXJncy5sZW5ndGggPT09IHRoaXMucGFyYW1ldGVycy5sZW5ndGgsXHJcbiAgICAgIGBFbWl0dGVkIHVuZXhwZWN0ZWQgbnVtYmVyIG9mIGFyZ3MuIEV4cGVjdGVkOiAke3RoaXMucGFyYW1ldGVycy5sZW5ndGh9IGFuZCByZWNlaXZlZCAke2FyZ3MubGVuZ3RofWBcclxuICAgICk7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLnBhcmFtZXRlcnMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IHBhcmFtZXRlciA9IHRoaXMucGFyYW1ldGVyc1sgaSBdO1xyXG4gICAgICBhc3NlcnQgJiYgdmFsaWRhdGUoIGFyZ3NbIGkgXSwgcGFyYW1ldGVyLCBWQUxJREFURV9PUFRJT05TX0ZBTFNFICk7XHJcblxyXG4gICAgICAvLyB2YWx1ZVR5cGUgb3ZlcnJpZGVzIHRoZSBwaGV0aW9UeXBlIHZhbGlkYXRvciBzbyB3ZSBkb24ndCB1c2UgdGhhdCBvbmUgaWYgdGhlcmUgaXMgYSB2YWx1ZVR5cGVcclxuICAgICAgaWYgKCBwYXJhbWV0ZXIucGhldGlvVHlwZSAmJiAhcGFyYW1ldGVyLnZhbHVlVHlwZSApIHtcclxuICAgICAgICBhc3NlcnQgJiYgdmFsaWRhdGUoIGFyZ3NbIGkgXSwgcGFyYW1ldGVyLnBoZXRpb1R5cGUudmFsaWRhdG9yLCBWQUxJREFURV9PUFRJT05TX0ZBTFNFICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlIHRoYXQgcHJvdmlkZWQgYXJncyBtYXRjaCB0aGUgZXhwZWN0ZWQgc2NoZW1hIGdpdmVuIHZpYSBvcHRpb25zLnBhcmFtZXRlcnMuXHJcbiAgICovXHJcbiAgcHVibGljIGdldFZhbGlkYXRpb25FcnJvcnMoIC4uLmFyZ3M6IFQgKTogQXJyYXk8c3RyaW5nIHwgbnVsbD4ge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggYXJncy5sZW5ndGggPT09IHRoaXMucGFyYW1ldGVycy5sZW5ndGgsXHJcbiAgICAgIGBFbWl0dGVkIHVuZXhwZWN0ZWQgbnVtYmVyIG9mIGFyZ3MuIEV4cGVjdGVkOiAke3RoaXMucGFyYW1ldGVycy5sZW5ndGh9IGFuZCByZWNlaXZlZCAke2FyZ3MubGVuZ3RofWBcclxuICAgICk7XHJcbiAgICByZXR1cm4gdGhpcy5wYXJhbWV0ZXJzLm1hcCggKCBwYXJhbWV0ZXIsIGluZGV4ICkgPT4ge1xyXG4gICAgICByZXR1cm4gVmFsaWRhdGlvbi5nZXRWYWxpZGF0aW9uRXJyb3IoIGFyZ3NbIGluZGV4IF0sIHBhcmFtZXRlciwgVkFMSURBVEVfT1BUSU9OU19GQUxTRSApO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgZGF0YSB0aGF0IHdpbGwgYmUgZW1pdHRlZCB0byB0aGUgUGhFVC1pTyBkYXRhIHN0cmVhbSwgZm9yIGFuIGluc3RydW1lbnRlZCBzaW11bGF0aW9uLlxyXG4gICAqIEByZXR1cm5zIHRoZSBkYXRhLCBrZXlzIGRlcGVuZGVudCBvbiBwYXJhbWV0ZXIgbWV0YWRhdGFcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UGhldGlvRGF0YSggLi4uYXJnczogVCApOiBudWxsIHwgUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIFRhbmRlbS5QSEVUX0lPX0VOQUJMRUQsICdzaG91bGQgb25seSBnZXQgcGhldC1pbyBkYXRhIGluIHBoZXQtaW8gYnJhbmQnICk7XHJcblxyXG4gICAgLy8gbnVsbCBpZiB0aGVyZSBhcmUgbm8gYXJndW1lbnRzLiBkYXRhU3RyZWFtLmpzIG9taXRzIG51bGwgdmFsdWVzIGZvciBkYXRhXHJcbiAgICBsZXQgZGF0YTogUmVjb3JkPHN0cmluZywgb2JqZWN0PiB8IG51bGwgPSBudWxsO1xyXG4gICAgaWYgKCB0aGlzLnBhcmFtZXRlcnMubGVuZ3RoID4gMCApIHtcclxuXHJcbiAgICAgIC8vIEVudW1lcmF0ZSBuYW1lZCBhcmdzT2JqZWN0IGZvciB0aGUgZGF0YSBzdHJlYW0uXHJcbiAgICAgIGRhdGEgPSB7fTtcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJhbWV0ZXJzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLnBhcmFtZXRlcnNbIGkgXTtcclxuICAgICAgICBpZiAoICFlbGVtZW50LnBoZXRpb1ByaXZhdGUgKSB7XHJcbiAgICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBlbGVtZW50Lm5hbWUsICduYW1lIHJlcXVpcmVkJyApO1xyXG4gICAgICAgICAgZGF0YVsgZWxlbWVudC5uYW1lISBdID0gZWxlbWVudC5waGV0aW9UeXBlIS50b1N0YXRlT2JqZWN0KCBhcmdzWyBpIF0gKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHRoZSBwaGV0aW9Eb2N1bWVudGF0aW9uIGNvbXBpbGVkIGZyb20gYWxsIHRoZSBwYXJhbWV0ZXJzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0UGhldGlvRG9jdW1lbnRhdGlvbiggY3VycmVudFBoZXRpb0RvY3VtZW50YXRpb246IHN0cmluZywgcGFyYW1ldGVyczogUGFyYW1ldGVyW10gKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHBhcmFtVG9Eb2NTdHJpbmcgPSAoIHBhcmFtOiBQYXJhbWV0ZXIgKSA9PiB7XHJcblxyXG4gICAgICBjb25zdCBkb2NUZXh0ID0gcGFyYW0ucGhldGlvRG9jdW1lbnRhdGlvbiA/IGAgLSAke3BhcmFtLnBoZXRpb0RvY3VtZW50YXRpb259YCA6ICcnO1xyXG5cclxuICAgICAgcmV0dXJuIGA8bGk+JHtwYXJhbS5uYW1lfTogJHtwYXJhbS5waGV0aW9UeXBlIS50eXBlTmFtZX0ke2RvY1RleHR9PC9saT5gO1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gY3VycmVudFBoZXRpb0RvY3VtZW50YXRpb24gKyAoIHBhcmFtZXRlcnMubGVuZ3RoID09PSAwID8gJzxicj5ObyBwYXJhbWV0ZXJzLicgOiBgJHsnPGJyPlRoZSBwYXJhbWV0ZXJzIGFyZTo8YnIvPicgK1xyXG4gICAgICAgICAgICc8b2w+J30ke3BhcmFtZXRlcnMubWFwKCBwYXJhbVRvRG9jU3RyaW5nICkuam9pbiggJzxici8+JyApfTwvb2w+YCApO1xyXG4gIH1cclxufVxyXG5cclxuYXhvbi5yZWdpc3RlciggJ1BoZXRpb0RhdGFIYW5kbGVyJywgUGhldGlvRGF0YUhhbmRsZXIgKTtcclxuZXhwb3J0IGRlZmF1bHQgUGhldGlvRGF0YUhhbmRsZXI7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLDhCQUE4QixNQUFNLHNEQUFzRDtBQUNqRyxPQUFPQyxTQUFTLE1BQU0saUNBQWlDO0FBQ3ZELE9BQU9DLFlBQVksTUFBK0IsbUJBQW1CO0FBQ3JFLE9BQU9DLE1BQU0sTUFBTSxhQUFhO0FBRWhDLE9BQU9DLElBQUksTUFBTSx1QkFBdUI7QUFDeEMsT0FBT0MsUUFBUSxNQUFNLDJCQUEyQjtBQUNoRCxPQUFPQyxVQUFVLE1BQXFCLDZCQUE2QjtBQUluRSxNQUFNQyxzQkFBc0IsR0FBRztFQUFFQyxp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