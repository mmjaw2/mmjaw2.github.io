// Copyright 2023-2024, University of Colorado Boulder

/**
 * Controls a specific animated value for an Animation.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import optionize from '../../phet-core/js/optionize.js';
import Easing from './Easing.js';
import twixt from './twixt.js';
import { isTReadOnlyProperty } from '../../axon/js/TReadOnlyProperty.js';

// Types of things where the default blend/distance/add options will work

class AnimationTarget {
  // Computed start/end values for the animation (once the animation finishes the delay and begins)
  startingValue = null;
  endingValue = null;

  /**
   * NOTE: Generally don't use this directly. Instead, use Animation, providing config for one or more targets.
   *
   * Every animation target needs two things:
   *
   * 1. A way of getting/setting the animated value (`setValue`/`getValue`, `property`, or `object`/`attribute`).
   * 2. A way of determining the value to animate toward (`to` or `delta`).
   */
  constructor(providedConfig) {
    const config = optionize()({
      setValue: null,
      getValue: null,
      property: null,
      object: null,
      attribute: null,
      to: null,
      delta: null,
      speed: null,
      from: null,
      easing: Easing.CUBIC_IN_OUT,
      // @ts-expect-error - Not sure how to tell it that the default doesn't work for some types, since we can't use the trickier object
      blend: AnimationTarget.DEFAULT_BLEND,
      // @ts-expect-error - Not sure how to tell it that the default doesn't work for some types, since we can't use the trickier object
      distance: AnimationTarget.DEFAULT_DISTANCE,
      // @ts-expect-error - Not sure how to tell it that the default doesn't work for some types, since we can't use the trickier object
      add: AnimationTarget.DEFAULT_ADD
    }, providedConfig);
    assert && assert(+(config.property !== null) + +(config.object !== null) + +(config.setValue !== null) === 1, 'Should have one (and only one) way of defining how to set the animated value. Use one of property/object/setValue');
    assert && assert(config.setValue === null || typeof config.setValue === 'function', 'If setValue is provided, it should be a function.');
    assert && assert(config.setValue === null || config.from !== null || typeof config.getValue === 'function', 'If setValue is provided and no "from" value is specified, then getValue needs to be a function.');
    assert && assert(config.to !== null || config.delta !== null, 'Need something to animate to, use to/delta');
    assert && assert(config.property === null || isTReadOnlyProperty(config.property) && config.property.isSettable(), 'If property is provided, it should be a settable Property or TinyProperty');
    assert && assert(config.object === null || typeof config.object === 'object' && typeof config.attribute === 'string', 'If object is provided, then object should be an object, and attribute should be a string.');
    assert && assert(config.easing instanceof Easing, 'The easing should be of type Easing');
    assert && assert(typeof config.blend === 'function', 'The blend option should be a function');
    assert && assert(typeof config.distance === 'function', 'The distance option should be a function');
    assert && assert(typeof config.add === 'function', 'The add option should be a function');

    // If `object` is provided, create the associated getter/setter
    if (config.object) {
      assert && assert(config.attribute !== null);

      // @ts-expect-error - We know that config.object is an object, but TS doesn't
      config.setValue = AnimationTarget.OBJECT_SET(config.object, config.attribute);
      // @ts-expect-error - We know that config.object is an object, but TS doesn't
      config.getValue = AnimationTarget.OBJECT_GET(config.object, config.attribute);
    }

    // If `property` is provided, create the associated getter/setter
    if (config.property) {
      config.setValue = AnimationTarget.PROPERTY_SET(config.property);
      config.getValue = AnimationTarget.PROPERTY_GET(config.property);
    }
    assert && assert(config.setValue !== null);
    this.getValue = config.getValue;
    this.setValue = config.setValue;
    this.easing = config.easing;
    this.from = config.from;
    this.to = config.to;
    this.delta = config.delta;
    this.speed = config.speed; // Saved config to help determine the length of the animation
    this.blend = config.blend;
    this.distance = config.distance;
    this.add = config.add;
  }

  /**
   * Default blending function for the `blend` function.
   */

  static DEFAULT_BLEND(a, b, ratio) {
    assert && assert(isFinite(ratio) && ratio >= 0 && ratio <= 1, `Invalid ratio: ${ratio}`);
    if (ratio === 0) {
      return a;
    }
    if (ratio === 1) {
      return b;
    }
    if (typeof a === 'number' && typeof b === 'number') {
      // @ts-expect-error - It can't detect we're in the T === number case.
      return a + (b - a) * ratio;
    }
    if (typeof a === 'object' && typeof b === 'object' && typeof a.blend === 'function') {
      return a.blend(b, ratio);
    }
    throw new Error(`Blending not supported for: ${JSON.stringify(a)}, ${JSON.stringify(b)}, pass in a blend option`);
  }

  /**
   * Default distance function for the `distance` option (used for the `speed` option)
   */

  static DEFAULT_DISTANCE(a, b) {
    if (typeof a === 'number' && typeof b === 'number') {
      return Math.abs(a - b);
    }
    if (typeof a === 'object' && typeof b === 'object' && typeof a.distance === 'function') {
      return a.distance(b);
    }
    throw new Error(`Distance (required for speed) by default not supported for: ${JSON.stringify(a)}, ${JSON.stringify(b)}, pass in a distance option`);
  }

  /**
   * Default addition function for the `add` option (used for the `delta` option)
   */

  static DEFAULT_ADD(a, b) {
    if (typeof a === 'number' && typeof b === 'number') {
      // @ts-expect-error - It can't detect we're in the T === number case.
      return a + b;
    }
    if (typeof a === 'object' && typeof b === 'object' && typeof a.plus === 'function') {
      return a.plus(b);
    }
    throw new Error(`Addition (required for delta) by default not supported for: ${JSON.stringify(a)}, ${JSON.stringify(b)}, pass in an add option`);
  }

  /**
   * Helper function for creating a setter closure for object[ attribute ].
   */
  static OBJECT_SET(object, attribute) {
    return function (value) {
      object[attribute] = value;
    };
  }

  /**
   * Helper function for creating a getter closure for object[ attribute ].
   */
  static OBJECT_GET(object, attribute) {
    return function () {
      return object[attribute];
    };
  }

  /**
   * Helper function for creating a setter closure for Properties
   */
  static PROPERTY_SET(property) {
    return function (value) {
      property.value = value;
    };
  }

  /**
   * Helper function for creating a getter closure for Properties
   */
  static PROPERTY_GET(property) {
    return function () {
      return property.value;
    };
  }

  /**
   * Computes the starting and ending values of this target.
   *
   * Generally called when the animation is just about to begin, so it can look up the current value if necessary.
   */
  computeStartEnd() {
    assert && assert(this.to !== null || this.delta !== null);
    assert && assert(this.from !== null || this.getValue !== null);
    this.startingValue = this.from !== null ? this.from : this.getValue();
    this.endingValue = this.to !== null ? this.to : this.add(this.startingValue, this.delta);
  }

  /**
   * Updates the value of this target.
   *
   * @param ratio - How far along (from 0 to 1) in the animation.
   */
  update(ratio) {
    // These should be non-null by this point
    assert && assert(this.setValue !== null);
    assert && assert(this.startingValue !== null);
    assert && assert(this.endingValue !== null);
    this.setValue(this.blend(this.startingValue, this.endingValue, this.easing.value(ratio)));
  }

  /**
   * Whether this target can define the duration of an animation.
   */
  hasPreferredDuration() {
    return this.speed !== null;
  }

  /**
   * Returns the preferred duration of this target (or null if not defined).
   */
  getPreferredDuration() {
    assert && assert(this.startingValue !== null);
    assert && assert(this.delta !== null);
    return this.speed === null ? null : this.speed * this.distance(this.startingValue, this.delta);
  }
}
twixt.register('AnimationTarget', AnimationTarget);
export default AnimationTarget;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJvcHRpb25pemUiLCJFYXNpbmciLCJ0d2l4dCIsImlzVFJlYWRPbmx5UHJvcGVydHkiLCJBbmltYXRpb25UYXJnZXQiLCJzdGFydGluZ1ZhbHVlIiwiZW5kaW5nVmFsdWUiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkQ29uZmlnIiwiY29uZmlnIiwic2V0VmFsdWUiLCJnZXRWYWx1ZSIsInByb3BlcnR5Iiwib2JqZWN0IiwiYXR0cmlidXRlIiwidG8iLCJkZWx0YSIsInNwZWVkIiwiZnJvbSIsImVhc2luZyIsIkNVQklDX0lOX09VVCIsImJsZW5kIiwiREVGQVVMVF9CTEVORCIsImRpc3RhbmNlIiwiREVGQVVMVF9ESVNUQU5DRSIsImFkZCIsIkRFRkFVTFRfQUREIiwiYXNzZXJ0IiwiaXNTZXR0YWJsZSIsIk9CSkVDVF9TRVQiLCJPQkpFQ1RfR0VUIiwiUFJPUEVSVFlfU0VUIiwiUFJPUEVSVFlfR0VUIiwiYSIsImIiLCJyYXRpbyIsImlzRmluaXRlIiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiTWF0aCIsImFicyIsInBsdXMiLCJ2YWx1ZSIsImNvbXB1dGVTdGFydEVuZCIsInVwZGF0ZSIsImhhc1ByZWZlcnJlZER1cmF0aW9uIiwiZ2V0UHJlZmVycmVkRHVyYXRpb24iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkFuaW1hdGlvblRhcmdldC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMy0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBDb250cm9scyBhIHNwZWNpZmljIGFuaW1hdGVkIHZhbHVlIGZvciBhbiBBbmltYXRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgVFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMyBmcm9tICcuLi8uLi9kb3QvanMvVmVjdG9yMy5qcyc7XHJcbmltcG9ydCBWZWN0b3I0IGZyb20gJy4uLy4uL2RvdC9qcy9WZWN0b3I0LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IEtleXNNYXRjaGluZyBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvS2V5c01hdGNoaW5nLmpzJztcclxuaW1wb3J0IHsgQ29sb3IgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgRWFzaW5nIGZyb20gJy4vRWFzaW5nLmpzJztcclxuaW1wb3J0IHR3aXh0IGZyb20gJy4vdHdpeHQuanMnO1xyXG5pbXBvcnQgeyBpc1RSZWFkT25seVByb3BlcnR5IH0gZnJvbSAnLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcblxyXG50eXBlIEJsZW5kRnVuY3Rpb248VD4gPSAoIGE6IFQsIGI6IFQsIGZyYWN0aW9uOiBudW1iZXIgKSA9PiBUO1xyXG50eXBlIERpc3RhbmNlRnVuY3Rpb248VD4gPSAoIGE6IFQsIGI6IFQgKSA9PiBudW1iZXI7XHJcbnR5cGUgQWRkRnVuY3Rpb248VD4gPSAoIGE6IFQsIGI6IFQgKSA9PiBUO1xyXG5cclxudHlwZSBJbnRlcm5hbEFuaW1hdGlvblRhcmdldE9wdGlvbnM8VCwgT2JqID0gdW5rbm93bj4gPSB7XHJcbiAgLypcclxuICAgKiBOT1RFOiBPbmUgb2YgYHNldFZhbHVlYC9gcHJvcGVydHlgL2BvYmplY3RgIGlzIFJFUVVJUkVELlxyXG4gICAqXHJcbiAgICogVGhlIGFuaW1hdGlvbiBuZWVkcyB0byBiZSBhYmxlIHRvIHNldCAoYW5kIHNvbWV0aW1lcyBnZXQpIHRoZSB2YWx1ZSBiZWluZyBhbmltYXRlZC4gSW4gdGhlIG1vc3QgZ2VuZXJhbCBjYXNlLFxyXG4gICAqIGEgZ2V0dGVyL3NldHRlciBwYWlyIChnZXRWYWx1ZSBhbmQgc2V0VmFsdWUpIGNhbiBiZSBwcm92aWRlZC5cclxuICAgKlxyXG4gICAqIEZvciBjb252ZW5pZW5jZSwgQW5pbWF0aW9uVGFyZ2V0IGFsc28gc3VwcG9ydHMgcGFzc2luZyBpbiBhbiBheG9uIFByb3BlcnR5IChwcm9wZXJ0eTopLCBvciBzZXR0aW5nIHVwIGZvciBhblxyXG4gICAqIGFzc2lnbm1lbnQgdG8gYW4gb2JqZWN0IHdpdGggb2JqZWN0L2F0dHJpYnV0ZSAoYWNjZXNzZXMgYXMgYG9iamVjdFsgYXR0cmlidXRlIF1gKS5cclxuICAgKlxyXG4gICAqIEUuZy46XHJcbiAgICpcclxuICAgKiBuZXcgQW5pbWF0aW9uKCB7XHJcbiAgICogICBzZXRWYWx1ZTogZnVuY3Rpb24oIHZhbHVlICkgeyB3aW5kb3cudmFsdWUgPSB2YWx1ZSAqIDEwOyB9LFxyXG4gICAqICAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCkgeyByZXR1cm4gd2luZG93LnZhbHVlIC8gMTA7IH0sXHJcbiAgICogICAvLyBvdGhlciBjb25maWdcclxuICAgKiB9IClcclxuICAgKlxyXG4gICAqIHZhciBzb21lVmVjdG9yUHJvcGVydHkgPSBuZXcgcGhldC5heG9uLlByb3BlcnR5KCBuZXcgcGhldC5kb3QuVmVjdG9yMiggMTAsIDUgKSApO1xyXG4gICAqIG5ldyBBbmltYXRpb24oIHtcclxuICAgKiAgIHByb3BlcnR5OiBzb21lVmVjdG9yUHJvcGVydHksXHJcbiAgICogICAvLyBvdGhlciBjb25maWdcclxuICAgKiB9IClcclxuICAgKlxyXG4gICAqIHZhciBvYmogPSB7IHg6IDUgfTtcclxuICAgKiBuZXcgQW5pbWF0aW9uKCB7XHJcbiAgICogICBvYmplY3Q6IG9iaixcclxuICAgKiAgIGF0dHJpYnV0ZTogJ3gnLFxyXG4gICAqICAgLy8gb3RoZXIgY29uZmlnXHJcbiAgICogfSApXHJcbiAgICpcclxuICAgKiBOT1RFOiBudWxsIHZhbHVlcyBhcmUgbm90IHN1cHBvcnRlZCwgYXMgaXQgaXMgdXNlZCBhcyB0aGUgXCJubyB2YWx1ZVwiIHZhbHVlLCBhbmQgYW5pbWF0aW5nIHRvd2FyZHMgXCJudWxsXCJcclxuICAgKiB1c3VhbGx5IHdvdWxkbid0IG1ha2Ugc2Vuc2UgKGV2ZW4gaWYgeW91IGRlZmluZSB0aGUgcHJvcGVyIGludGVycG9sYXRpb24gZnVuY3Rpb24pLlxyXG4gICAqL1xyXG5cclxuICAvLyBJZiBwcm92aWRlZCwgaXQgc2hvdWxkIGJlIGEgZnVuY3Rpb24gdGhhdCBhY3RzIGFzIFwic2V0dGluZ1wiIHRoZSB2YWx1ZSBvZiB0aGUgYW5pbWF0aW9uLlxyXG4gIC8vIE5PVEU6IGRvIG5vdCBwcm92aWRlIHRoaXMgYW5kIHByb3BlcnR5L29iamVjdC5cclxuICBzZXRWYWx1ZT86ICggKCB2YWx1ZTogVCApID0+IHZvaWQgKSB8IG51bGw7XHJcblxyXG4gIC8vIElmIHByb3ZpZGVkLCBpdCBzaG91bGQgYmUgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIGN1cnJlbnQgdmFsdWUgdGhhdCB3aWxsIGJlIGFuaW1hdGVkLlxyXG4gIC8vIE5PVEU6IFRoaXMgY2FuIGJlIG9taXR0ZWQsIGV2ZW4gaWYgc2V0VmFsdWUgaXMgcHJvdmlkZWQsIGlmIHRoZSBgZnJvbWAgb3B0aW9uIGlzIHNldCAoYXMgdGhlIGN1cnJlbnQgdmFsdWUgd291bGRcclxuICAvLyBqdXN0IGJlIGlnbm9yZWQpLlxyXG4gIGdldFZhbHVlPzogKCAoKSA9PiBUICkgfCBudWxsO1xyXG5cclxuICAvLyBJZiBwcm92aWRlZCwgaXQgc2hvdWxkIGJlIGFuIGF4b24gUHJvcGVydHkgd2l0aCB0aGUgY3VycmVudCB2YWx1ZS4gSXQgd2lsbCBiZSBtb2RpZmllZCBieSB0aGUgYW5pbWF0aW9uLlxyXG4gIC8vIE5PVEU6IGRvIG5vdCBwcm92aWRlIHRoaXMgYW5kIHNldFZhbHVlL29iamVjdFxyXG4gIHByb3BlcnR5PzogVFByb3BlcnR5PFQ+IHwgbnVsbDtcclxuXHJcbiAgLy8gSWYgcHJvdmlkZWQsIGl0IHNob3VsZCBwb2ludCB0byBhbiBvYmplY3Qgd2hlcmUgYG9iamVjdFsgYXR0cmlidXRlIF1gIGlzIHRoZSB2YWx1ZSB0byBiZSBtb2RpZmllZFxyXG4gIC8vIGJ5IHRoZSBhbmltYXRpb24uIE5PVEU6IGRvIG5vdCBwcm92aWRlIHRoaXMgYW5kIHNldFZhbHVlL3Byb3BlcnR5XHJcbiAgb2JqZWN0PzogT2JqIHwgbnVsbDtcclxuXHJcbiAgLy8gSWYgYG9iamVjdGAgaXMgcHJvdmlkZWQsIGl0IHNob3VsZCBiZSBhIHN0cmluZyBzdWNoIHRoYXQgYG9iamVjdFsgYXR0cmlidXRlIF1gIGlzIHRoZSB2YWx1ZSB0byBiZSBtb2RpZmllZC5cclxuICBhdHRyaWJ1dGU/OiBLZXlzTWF0Y2hpbmc8T2JqLCBUPiB8IG51bGw7XHJcblxyXG4gIC8qXHJcbiAgICogTk9URTogb25lIG9mIGB0b2AvYGRlbHRhYCBpcyBSRVFVSVJFRC5cclxuICAgKlxyXG4gICAqIFRoZSBlbmQgdmFsdWUgb2YgdGhlIGFuaW1hdGlvbiBuZWVkcyB0byBiZSBzcGVjaWZpZWQsIGJ1dCB0aGVyZSBhcmUgbXVsdGlwbGUgd2F5cyB0byBkbyBzby4gSWYgeW91IGtub3cgdGhlXHJcbiAgICogZXhhY3QgZW5kIHZhbHVlLCBpdCBjYW4gYmUgcHJvdmlkZWQgd2l0aCBgdG86IHZhbHVlYC4gVGhlbiBldmVyeSB0aW1lIHRoZSBhbmltYXRpb24gaXMgcnVuLCBpdCB3aWxsIGdvIHRvIHRoYXRcclxuICAgKiB2YWx1ZS5cclxuICAgKlxyXG4gICAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gcHJvdmlkZSBgZGVsdGE6IHZhbHVlYCB3aGljaCB3aWxsIGFwcGx5IGEgcmVsYXRpdmUgYW5pbWF0aW9uIGJ5IHRoYXQgYW1vdW50IChlLmcuIGZvclxyXG4gICAqIG51bWJlcnMsIGBkZWx0YTogNWAgd291bGQgaW5kaWNhdGUgdGhhdCB0aGUgYW5pbWF0aW9uIHdpbGwgaW5jcmVhc2UgdGhlIHZhbHVlIGJ5IDUgZXZlcnkgdGltZSBpdCBpcyBydW4pLlxyXG4gICAqL1xyXG5cclxuICAvLyBJZiBwcm92aWRlZCwgdGhlIGFuaW1hdGlvbiB3aWxsIHRyZWF0IHRoaXMgYXMgdGhlIGVuZCB2YWx1ZSAod2hhdCBpdCBhbmltYXRlcyB0b3dhcmQpLlxyXG4gIHRvPzogVCB8IG51bGw7XHJcblxyXG4gIC8vIElmIHByb3ZpZGVkLCB0aGUgYW5pbWF0aW9uIHdpbGwgdHJlYXQgdGhlIGVuZGluZyB2YWx1ZSBvZiB0aGUgYW5pbWF0aW9uIGFzIHRoZSBzdGFydGluZyB2YWx1ZSBwbHVzIHRoaXMgZGVsdGFcclxuICAvLyB2YWx1ZS4gVG8gZGV0ZXJtaW5lIHRoZSBleGFjdCB2YWx1ZSwgdGhlIGBhZGRgIG9wdGlvbiB3aWxsIGJlIHVzZWQgKHdoaWNoIGJ5IGRlZmF1bHQgaGFuZGxlc1xyXG4gIC8vIG51bWJlci9WZWN0b3IyL1ZlY3RvcjMvVmVjdG9yNCBhcyBleHBlY3RlZCkuIFRoZSBhbmltYXRpb24gY2FuIGJlIHJ1biBtdWx0aXBsZSB0aW1lcywgYW5kIGVhY2ggdGltZSBpdCB3aWxsIHVzZVxyXG4gIC8vIHRoZSBcInN0YXJ0aW5nXCIgdmFsdWUgZnJvbSBsYXN0IHRpbWUgKHVubGVzcyB0aGUgYGZyb21gIG9wdGlvbiBpcyB1c2VkKS5cclxuICBkZWx0YT86IFQgfCBudWxsO1xyXG5cclxuICAvLyBJZiBwcm92aWRlZCwgdGhlIGFuaW1hdGlvbidzIGxlbmd0aCB3aWxsIGJlIHRoaXMgdmFsdWUgKHNlY29uZHMvdW5pdCkgdGltZXMgdGhlIFwiZGlzdGFuY2VcIiBiZXR3ZWVuIHRoZSBzdGFydCBhbmRcclxuICAvLyBlbmQgdmFsdWUgb2YgdGhlIGFuaW1hdGlvbi4gVGhlIGBkaXN0YW5jZWAgb3B0aW9uIGNhbiBiZSB1c2VkIHRvIHNwZWNpZnkgYSB3YXkgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UsIGFuZCB3b3Jrc1xyXG4gIC8vIGJ5IGRlZmF1bHQgYXMgZXhwZWN0ZWQgZm9yIG51bWJlci9WZWN0b3IyL1ZlY3RvcjMvVmVjdG9yNC5cclxuICBzcGVlZD86IG51bWJlciB8IG51bGw7XHJcblxyXG4gIC8vIElmIHByb3ZpZGVkLCB0aGUgYW5pbWF0aW9uIHdpbGwgc3RhcnQgZnJvbSB0aGlzIHZhbHVlIChpbnN0ZWFkIG9mIGdldHRpbmcgdGhlIGN1cnJlbnQgdmFsdWUgdG8gc3RhcnQgZnJvbSkuXHJcbiAgZnJvbT86IFQgfCBudWxsO1xyXG5cclxuICAvLyBDb250cm9scyB0aGUgcmVsYXRpdmUgbW90aW9uIGZyb20gdGhlIHN0YXJ0aW5nIHZhbHVlIHRvIHRoZSBlbmRpbmcgdmFsdWUuIFNlZSBFYXNpbmcuanMgZm9yIGluZm8uXHJcbiAgZWFzaW5nPzogRWFzaW5nO1xyXG5cclxuICAvLyBTaG91bGQgYmUgb2YgdGhlIGZvcm0gYGZ1bmN0aW9uKCBzdGFydDogeyp9LCBlbmQ6IHsqfSwgcmF0aW86IHtudW1iZXJ9ICk6IHsqfWAgd2hlcmUgdGhlIHJhdGlvIHdpbGwgYmUgYmV0d2VlbiAwXHJcbiAgLy8gYW5kIDEgKGluY2x1c2l2ZSkuIElmIHRoZSByYXRpbyBpcyAwLCBpdCBzaG91bGQgcmV0dXJuIHRoZSBzdGFydGluZyB2YWx1ZSwgaWYgdGhlIHJhdGlvIGlzIDEsIGl0IHNob3VsZCByZXR1cm4gdGhlXHJcbiAgLy8gZW5kaW5nIHZhbHVlLCBhbmQgb3RoZXJ3aXNlIGl0IHNob3VsZCByZXR1cm4gdGhlIGJlc3QgaW50ZXJwb2xhdGlvbiBwb3NzaWJsZSBiZXR3ZWVuIHRoZSB0d28gdmFsdWVzLiBUaGUgZGVmYXVsdFxyXG4gIC8vIHNob3VsZCB3b3JrIGZvciBudW1iZXIvVmVjdG9yMi9WZWN0b3IzL1ZlY3RvcjQvQ29sb3IsIGJ1dCBmb3Igb3RoZXIgdHlwZXMgZWl0aGVyIGBzdGFydC5ibGVuZCggZW5kLCByYXRpbyApYCBzaG91bGRcclxuICAvLyBiZSBkZWZpbmVkIGFuZCB3b3JrLCBvciB0aGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBvdmVycmlkZGVuLlxyXG4gIGJsZW5kPzogQmxlbmRGdW5jdGlvbjxUPjtcclxuXHJcbiAgLy8gU2hvdWxkIGJlIG9mIHRoZSBmb3JtIGBmdW5jdGlvbiggc3RhcnQ6IHsqfSwgZW5kOiB7Kn0gKToge251bWJlcn1gLCBhbmQgaXQgc2hvdWxkIHJldHVybiBhIG1lYXN1cmVcclxuICAvLyBvZiBkaXN0YW5jZSAoYSBtZXRyaWMpIGJldHdlZW4gdGhlIHR3byB2YWx1ZXMuIFRoaXMgaXMgb25seSB1c2VkIGZvciBpZiB0aGUgYHNwZWVkYCBvcHRpb24gaXMgcHJvdmlkZWQgKHNvIGl0XHJcbiAgLy8gY2FuIGRldGVybWluZSB0aGUgbGVuZ3RoIG9mIHRoZSBhbmltYXRpb24pLiBUaGUgZGVmYXVsdCBzaG91bGQgd29yayBmb3IgbnVtYmVyL1ZlY3RvcjIvVmVjdG9yMy9WZWN0b3I0LlxyXG4gIGRpc3RhbmNlPzogRGlzdGFuY2VGdW5jdGlvbjxUPjtcclxuXHJcbiAgLy8gU2hvdWxkIGJlIG9mIHRoZSBmb3JtIGBmdW5jdGlvbiggc3RhcnQ6IHsqfSwgZGVsdGE6IHsqfSApOiB7Kn1gIHdoZXJlIGl0IGFkZHMgdG9nZXRoZXIgYSB2YWx1ZVxyXG4gIC8vIGFuZCBhIFwiZGVsdGFcIiAodXN1YWxseSBqdXN0IGEgdmFsdWUgb2YgdGhlIHNhbWUgdHlwZSkgYW5kIHJldHVybnMgdGhlIHJlc3VsdC4gVGhpcyBpcyB1c2VkIGZvciB0aGUgYGRlbHRhYFxyXG4gIC8vIG9wdGlvbi4gVGhlIGRlZmF1bHQgc2hvdWxkIHdvcmsgZm9yIG51bWJlci9WZWN0b3IyL1ZlY3RvcjMvVmVjdG9yNC5cclxuICBhZGQ/OiBBZGRGdW5jdGlvbjxUPjtcclxufTtcclxuXHJcbi8vIFR5cGVzIG9mIHRoaW5ncyB3aGVyZSB0aGUgZGVmYXVsdCBibGVuZC9kaXN0YW5jZS9hZGQgb3B0aW9ucyB3aWxsIHdvcmtcclxudHlwZSBEZWZhdWx0QmxlbmRhYmxlVHlwZTxUPiA9IG51bWJlciB8IHsgYmxlbmQ6ICggYjogVCwgcmF0aW86IG51bWJlciApID0+IFQgfTtcclxudHlwZSBEZWZhdWx0RGlzdGFuY2VhYmxlVHlwZTxUPiA9IG51bWJlciB8IHsgZGlzdGFuY2U6ICggYjogVCApID0+IG51bWJlciB9O1xyXG50eXBlIERlZmF1bHRBZGRhYmxlVHlwZTxUPiA9IG51bWJlciB8IHsgcGx1czogKCBiOiBUICkgPT4gVCB9O1xyXG5cclxuZXhwb3J0IHR5cGUgQW5pbWF0aW9uVGFyZ2V0T3B0aW9uczxUID0gdW5rbm93biwgT2JqID0gdW5rbm93bj4gPSBJbnRlcm5hbEFuaW1hdGlvblRhcmdldE9wdGlvbnM8VCwgT2JqPjtcclxuXHJcbmNsYXNzIEFuaW1hdGlvblRhcmdldDxULCBPYmogPSB1bmtub3duPiB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgc2V0VmFsdWU6ICggKCB2YWx1ZTogVCApID0+IHZvaWQgKTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGdldFZhbHVlOiAoICgpID0+IFQgKSB8IG51bGw7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBlYXNpbmc6IEVhc2luZztcclxuICBwcml2YXRlIHJlYWRvbmx5IHRvOiBUIHwgbnVsbDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGZyb206IFQgfCBudWxsO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGVsdGE6IFQgfCBudWxsO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgc3BlZWQ6IG51bWJlciB8IG51bGw7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBibGVuZDogQmxlbmRGdW5jdGlvbjxUPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3RhbmNlOiBEaXN0YW5jZUZ1bmN0aW9uPFQ+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgYWRkOiBBZGRGdW5jdGlvbjxUPjtcclxuXHJcbiAgLy8gQ29tcHV0ZWQgc3RhcnQvZW5kIHZhbHVlcyBmb3IgdGhlIGFuaW1hdGlvbiAob25jZSB0aGUgYW5pbWF0aW9uIGZpbmlzaGVzIHRoZSBkZWxheSBhbmQgYmVnaW5zKVxyXG4gIHByaXZhdGUgc3RhcnRpbmdWYWx1ZTogVCB8IG51bGwgPSBudWxsO1xyXG4gIHByaXZhdGUgZW5kaW5nVmFsdWU6IFQgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogTk9URTogR2VuZXJhbGx5IGRvbid0IHVzZSB0aGlzIGRpcmVjdGx5LiBJbnN0ZWFkLCB1c2UgQW5pbWF0aW9uLCBwcm92aWRpbmcgY29uZmlnIGZvciBvbmUgb3IgbW9yZSB0YXJnZXRzLlxyXG4gICAqXHJcbiAgICogRXZlcnkgYW5pbWF0aW9uIHRhcmdldCBuZWVkcyB0d28gdGhpbmdzOlxyXG4gICAqXHJcbiAgICogMS4gQSB3YXkgb2YgZ2V0dGluZy9zZXR0aW5nIHRoZSBhbmltYXRlZCB2YWx1ZSAoYHNldFZhbHVlYC9gZ2V0VmFsdWVgLCBgcHJvcGVydHlgLCBvciBgb2JqZWN0YC9gYXR0cmlidXRlYCkuXHJcbiAgICogMi4gQSB3YXkgb2YgZGV0ZXJtaW5pbmcgdGhlIHZhbHVlIHRvIGFuaW1hdGUgdG93YXJkIChgdG9gIG9yIGBkZWx0YWApLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRDb25maWc6IEFuaW1hdGlvblRhcmdldE9wdGlvbnM8VCwgT2JqPiApIHtcclxuXHJcbiAgICBjb25zdCBjb25maWcgPSBvcHRpb25pemU8SW50ZXJuYWxBbmltYXRpb25UYXJnZXRPcHRpb25zPFQsIE9iaj4sIEludGVybmFsQW5pbWF0aW9uVGFyZ2V0T3B0aW9uczxULCBPYmo+PigpKCB7XHJcbiAgICAgIHNldFZhbHVlOiBudWxsLFxyXG4gICAgICBnZXRWYWx1ZTogbnVsbCxcclxuICAgICAgcHJvcGVydHk6IG51bGwsXHJcbiAgICAgIG9iamVjdDogbnVsbCxcclxuICAgICAgYXR0cmlidXRlOiBudWxsLFxyXG4gICAgICB0bzogbnVsbCxcclxuICAgICAgZGVsdGE6IG51bGwsXHJcbiAgICAgIHNwZWVkOiBudWxsLFxyXG4gICAgICBmcm9tOiBudWxsLFxyXG4gICAgICBlYXNpbmc6IEVhc2luZy5DVUJJQ19JTl9PVVQsXHJcblxyXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gTm90IHN1cmUgaG93IHRvIHRlbGwgaXQgdGhhdCB0aGUgZGVmYXVsdCBkb2Vzbid0IHdvcmsgZm9yIHNvbWUgdHlwZXMsIHNpbmNlIHdlIGNhbid0IHVzZSB0aGUgdHJpY2tpZXIgb2JqZWN0XHJcbiAgICAgIGJsZW5kOiBBbmltYXRpb25UYXJnZXQuREVGQVVMVF9CTEVORCxcclxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIE5vdCBzdXJlIGhvdyB0byB0ZWxsIGl0IHRoYXQgdGhlIGRlZmF1bHQgZG9lc24ndCB3b3JrIGZvciBzb21lIHR5cGVzLCBzaW5jZSB3ZSBjYW4ndCB1c2UgdGhlIHRyaWNraWVyIG9iamVjdFxyXG4gICAgICBkaXN0YW5jZTogQW5pbWF0aW9uVGFyZ2V0LkRFRkFVTFRfRElTVEFOQ0UsXHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBOb3Qgc3VyZSBob3cgdG8gdGVsbCBpdCB0aGF0IHRoZSBkZWZhdWx0IGRvZXNuJ3Qgd29yayBmb3Igc29tZSB0eXBlcywgc2luY2Ugd2UgY2FuJ3QgdXNlIHRoZSB0cmlja2llciBvYmplY3RcclxuICAgICAgYWRkOiBBbmltYXRpb25UYXJnZXQuREVGQVVMVF9BRERcclxuICAgIH0sIHByb3ZpZGVkQ29uZmlnICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggKyggY29uZmlnLnByb3BlcnR5ICE9PSBudWxsICkgKyArKCBjb25maWcub2JqZWN0ICE9PSBudWxsICkgKyArKCBjb25maWcuc2V0VmFsdWUgIT09IG51bGwgKSA9PT0gMSxcclxuICAgICAgJ1Nob3VsZCBoYXZlIG9uZSAoYW5kIG9ubHkgb25lKSB3YXkgb2YgZGVmaW5pbmcgaG93IHRvIHNldCB0aGUgYW5pbWF0ZWQgdmFsdWUuIFVzZSBvbmUgb2YgcHJvcGVydHkvb2JqZWN0L3NldFZhbHVlJyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5zZXRWYWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgY29uZmlnLnNldFZhbHVlID09PSAnZnVuY3Rpb24nLFxyXG4gICAgICAnSWYgc2V0VmFsdWUgaXMgcHJvdmlkZWQsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uLicgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb25maWcuc2V0VmFsdWUgPT09IG51bGwgfHwgY29uZmlnLmZyb20gIT09IG51bGwgfHwgdHlwZW9mIGNvbmZpZy5nZXRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJyxcclxuICAgICAgJ0lmIHNldFZhbHVlIGlzIHByb3ZpZGVkIGFuZCBubyBcImZyb21cIiB2YWx1ZSBpcyBzcGVjaWZpZWQsIHRoZW4gZ2V0VmFsdWUgbmVlZHMgdG8gYmUgYSBmdW5jdGlvbi4nICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLnRvICE9PSBudWxsIHx8IGNvbmZpZy5kZWx0YSAhPT0gbnVsbCxcclxuICAgICAgJ05lZWQgc29tZXRoaW5nIHRvIGFuaW1hdGUgdG8sIHVzZSB0by9kZWx0YScgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KFxyXG4gICAgICBjb25maWcucHJvcGVydHkgPT09IG51bGwgfHxcclxuICAgICAgKCAoIGlzVFJlYWRPbmx5UHJvcGVydHkoIGNvbmZpZy5wcm9wZXJ0eSApICkgJiYgY29uZmlnLnByb3BlcnR5LmlzU2V0dGFibGUoKSApLFxyXG4gICAgICAnSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIGl0IHNob3VsZCBiZSBhIHNldHRhYmxlIFByb3BlcnR5IG9yIFRpbnlQcm9wZXJ0eScgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb25maWcub2JqZWN0ID09PSBudWxsIHx8ICggdHlwZW9mIGNvbmZpZy5vYmplY3QgPT09ICdvYmplY3QnICYmIHR5cGVvZiBjb25maWcuYXR0cmlidXRlID09PSAnc3RyaW5nJyApLFxyXG4gICAgICAnSWYgb2JqZWN0IGlzIHByb3ZpZGVkLCB0aGVuIG9iamVjdCBzaG91bGQgYmUgYW4gb2JqZWN0LCBhbmQgYXR0cmlidXRlIHNob3VsZCBiZSBhIHN0cmluZy4nICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLmVhc2luZyBpbnN0YW5jZW9mIEVhc2luZywgJ1RoZSBlYXNpbmcgc2hvdWxkIGJlIG9mIHR5cGUgRWFzaW5nJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIGNvbmZpZy5ibGVuZCA9PT0gJ2Z1bmN0aW9uJywgJ1RoZSBibGVuZCBvcHRpb24gc2hvdWxkIGJlIGEgZnVuY3Rpb24nICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgY29uZmlnLmRpc3RhbmNlID09PSAnZnVuY3Rpb24nLCAnVGhlIGRpc3RhbmNlIG9wdGlvbiBzaG91bGQgYmUgYSBmdW5jdGlvbicgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHR5cGVvZiBjb25maWcuYWRkID09PSAnZnVuY3Rpb24nLCAnVGhlIGFkZCBvcHRpb24gc2hvdWxkIGJlIGEgZnVuY3Rpb24nICk7XHJcblxyXG4gICAgLy8gSWYgYG9iamVjdGAgaXMgcHJvdmlkZWQsIGNyZWF0ZSB0aGUgYXNzb2NpYXRlZCBnZXR0ZXIvc2V0dGVyXHJcbiAgICBpZiAoIGNvbmZpZy5vYmplY3QgKSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5hdHRyaWJ1dGUgIT09IG51bGwgKTtcclxuXHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBXZSBrbm93IHRoYXQgY29uZmlnLm9iamVjdCBpcyBhbiBvYmplY3QsIGJ1dCBUUyBkb2Vzbid0XHJcbiAgICAgIGNvbmZpZy5zZXRWYWx1ZSA9IEFuaW1hdGlvblRhcmdldC5PQkpFQ1RfU0VUKCBjb25maWcub2JqZWN0LCBjb25maWcuYXR0cmlidXRlISApO1xyXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gV2Uga25vdyB0aGF0IGNvbmZpZy5vYmplY3QgaXMgYW4gb2JqZWN0LCBidXQgVFMgZG9lc24ndFxyXG4gICAgICBjb25maWcuZ2V0VmFsdWUgPSBBbmltYXRpb25UYXJnZXQuT0JKRUNUX0dFVCggY29uZmlnLm9iamVjdCwgY29uZmlnLmF0dHJpYnV0ZSEgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBgcHJvcGVydHlgIGlzIHByb3ZpZGVkLCBjcmVhdGUgdGhlIGFzc29jaWF0ZWQgZ2V0dGVyL3NldHRlclxyXG4gICAgaWYgKCBjb25maWcucHJvcGVydHkgKSB7XHJcbiAgICAgIGNvbmZpZy5zZXRWYWx1ZSA9IEFuaW1hdGlvblRhcmdldC5QUk9QRVJUWV9TRVQoIGNvbmZpZy5wcm9wZXJ0eSApO1xyXG4gICAgICBjb25maWcuZ2V0VmFsdWUgPSBBbmltYXRpb25UYXJnZXQuUFJPUEVSVFlfR0VUKCBjb25maWcucHJvcGVydHkgKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb25maWcuc2V0VmFsdWUgIT09IG51bGwgKTtcclxuXHJcbiAgICB0aGlzLmdldFZhbHVlID0gY29uZmlnLmdldFZhbHVlO1xyXG4gICAgdGhpcy5zZXRWYWx1ZSA9IGNvbmZpZy5zZXRWYWx1ZSE7XHJcbiAgICB0aGlzLmVhc2luZyA9IGNvbmZpZy5lYXNpbmc7XHJcbiAgICB0aGlzLmZyb20gPSBjb25maWcuZnJvbTtcclxuICAgIHRoaXMudG8gPSBjb25maWcudG87XHJcbiAgICB0aGlzLmRlbHRhID0gY29uZmlnLmRlbHRhO1xyXG4gICAgdGhpcy5zcGVlZCA9IGNvbmZpZy5zcGVlZDsgLy8gU2F2ZWQgY29uZmlnIHRvIGhlbHAgZGV0ZXJtaW5lIHRoZSBsZW5ndGggb2YgdGhlIGFuaW1hdGlvblxyXG4gICAgdGhpcy5ibGVuZCA9IGNvbmZpZy5ibGVuZDtcclxuICAgIHRoaXMuZGlzdGFuY2UgPSBjb25maWcuZGlzdGFuY2U7XHJcbiAgICB0aGlzLmFkZCA9IGNvbmZpZy5hZGQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZWZhdWx0IGJsZW5kaW5nIGZ1bmN0aW9uIGZvciB0aGUgYGJsZW5kYCBmdW5jdGlvbi5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQkxFTkQoIGE6IG51bWJlciwgYjogbnVtYmVyLCByYXRpbzogbnVtYmVyICk6IG51bWJlcjtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQkxFTkQoIGE6IENvbG9yLCBiOiBDb2xvciwgcmF0aW86IG51bWJlciApOiBDb2xvcjtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQkxFTkQoIGE6IFZlY3RvcjIsIGI6IFZlY3RvcjIsIHJhdGlvOiBudW1iZXIgKTogVmVjdG9yMjtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQkxFTkQoIGE6IFZlY3RvcjMsIGI6IFZlY3RvcjMsIHJhdGlvOiBudW1iZXIgKTogVmVjdG9yMztcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQkxFTkQoIGE6IFZlY3RvcjQsIGI6IFZlY3RvcjQsIHJhdGlvOiBudW1iZXIgKTogVmVjdG9yNDtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQkxFTkQ8VCBleHRlbmRzIERlZmF1bHRCbGVuZGFibGVUeXBlPFQ+PiggYTogVCwgYjogVCwgcmF0aW86IG51bWJlciApOiBUIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGlzRmluaXRlKCByYXRpbyApICYmIHJhdGlvID49IDAgJiYgcmF0aW8gPD0gMSwgYEludmFsaWQgcmF0aW86ICR7cmF0aW99YCApO1xyXG5cclxuICAgIGlmICggcmF0aW8gPT09IDAgKSB7IHJldHVybiBhOyB9XHJcbiAgICBpZiAoIHJhdGlvID09PSAxICkgeyByZXR1cm4gYjsgfVxyXG5cclxuICAgIGlmICggdHlwZW9mIGEgPT09ICdudW1iZXInICYmIHR5cGVvZiBiID09PSAnbnVtYmVyJyApIHtcclxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIEl0IGNhbid0IGRldGVjdCB3ZSdyZSBpbiB0aGUgVCA9PT0gbnVtYmVyIGNhc2UuXHJcbiAgICAgIHJldHVybiBhICsgKCBiIC0gYSApICogcmF0aW87XHJcbiAgICB9XHJcbiAgICBpZiAoIHR5cGVvZiBhID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgYiA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGEuYmxlbmQgPT09ICdmdW5jdGlvbicgKSB7XHJcbiAgICAgIHJldHVybiBhLmJsZW5kKCBiLCByYXRpbyApO1xyXG4gICAgfVxyXG5cclxuICAgIHRocm93IG5ldyBFcnJvciggYEJsZW5kaW5nIG5vdCBzdXBwb3J0ZWQgZm9yOiAke0pTT04uc3RyaW5naWZ5KCBhICl9LCAke0pTT04uc3RyaW5naWZ5KCBiICl9LCBwYXNzIGluIGEgYmxlbmQgb3B0aW9uYCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVmYXVsdCBkaXN0YW5jZSBmdW5jdGlvbiBmb3IgdGhlIGBkaXN0YW5jZWAgb3B0aW9uICh1c2VkIGZvciB0aGUgYHNwZWVkYCBvcHRpb24pXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0RJU1RBTkNFKCBhOiBudW1iZXIsIGI6IG51bWJlciApOiBudW1iZXI7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0RJU1RBTkNFKCBhOiBWZWN0b3IyLCBiOiBWZWN0b3IyICk6IG51bWJlcjtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfRElTVEFOQ0UoIGE6IFZlY3RvcjMsIGI6IFZlY3RvcjMgKTogbnVtYmVyO1xyXG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9ESVNUQU5DRSggYTogVmVjdG9yNCwgYjogVmVjdG9yNCApOiBudW1iZXI7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0RJU1RBTkNFPFQgZXh0ZW5kcyBEZWZhdWx0RGlzdGFuY2VhYmxlVHlwZTxUPj4oIGE6IFQsIGI6IFQgKTogbnVtYmVyIHtcclxuICAgIGlmICggdHlwZW9mIGEgPT09ICdudW1iZXInICYmIHR5cGVvZiBiID09PSAnbnVtYmVyJyApIHtcclxuICAgICAgcmV0dXJuIE1hdGguYWJzKCBhIC0gYiApO1xyXG4gICAgfVxyXG4gICAgaWYgKCB0eXBlb2YgYSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGIgPT09ICdvYmplY3QnICYmIHR5cGVvZiBhLmRpc3RhbmNlID09PSAnZnVuY3Rpb24nICkge1xyXG4gICAgICByZXR1cm4gYS5kaXN0YW5jZSggYiApO1xyXG4gICAgfVxyXG5cclxuICAgIHRocm93IG5ldyBFcnJvciggYERpc3RhbmNlIChyZXF1aXJlZCBmb3Igc3BlZWQpIGJ5IGRlZmF1bHQgbm90IHN1cHBvcnRlZCBmb3I6ICR7SlNPTi5zdHJpbmdpZnkoIGEgKX0sICR7SlNPTi5zdHJpbmdpZnkoIGIgKX0sIHBhc3MgaW4gYSBkaXN0YW5jZSBvcHRpb25gICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZWZhdWx0IGFkZGl0aW9uIGZ1bmN0aW9uIGZvciB0aGUgYGFkZGAgb3B0aW9uICh1c2VkIGZvciB0aGUgYGRlbHRhYCBvcHRpb24pXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0FERCggYTogbnVtYmVyLCBiOiBudW1iZXIgKTogbnVtYmVyO1xyXG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9BREQoIGE6IFZlY3RvcjIsIGI6IFZlY3RvcjIgKTogVmVjdG9yMjtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQUREKCBhOiBWZWN0b3IzLCBiOiBWZWN0b3IzICk6IFZlY3RvcjM7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0FERCggYTogVmVjdG9yNCwgYjogVmVjdG9yNCApOiBWZWN0b3I0O1xyXG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9BREQ8VCBleHRlbmRzIERlZmF1bHRBZGRhYmxlVHlwZTxUPj4oIGE6IFQsIGI6IFQgKTogVCB7XHJcbiAgICBpZiAoIHR5cGVvZiBhID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgYiA9PT0gJ251bWJlcicgKSB7XHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBJdCBjYW4ndCBkZXRlY3Qgd2UncmUgaW4gdGhlIFQgPT09IG51bWJlciBjYXNlLlxyXG4gICAgICByZXR1cm4gYSArIGI7XHJcbiAgICB9XHJcbiAgICBpZiAoIHR5cGVvZiBhID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgYiA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGEucGx1cyA9PT0gJ2Z1bmN0aW9uJyApIHtcclxuICAgICAgcmV0dXJuIGEucGx1cyggYiApO1xyXG4gICAgfVxyXG5cclxuICAgIHRocm93IG5ldyBFcnJvciggYEFkZGl0aW9uIChyZXF1aXJlZCBmb3IgZGVsdGEpIGJ5IGRlZmF1bHQgbm90IHN1cHBvcnRlZCBmb3I6ICR7SlNPTi5zdHJpbmdpZnkoIGEgKX0sICR7SlNPTi5zdHJpbmdpZnkoIGIgKX0sIHBhc3MgaW4gYW4gYWRkIG9wdGlvbmAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhlbHBlciBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYSBzZXR0ZXIgY2xvc3VyZSBmb3Igb2JqZWN0WyBhdHRyaWJ1dGUgXS5cclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBPQkpFQ1RfU0VUPE9iaiwgQXR0ciBleHRlbmRzIGtleW9mIE9iaj4oIG9iamVjdDogT2JqLCBhdHRyaWJ1dGU6IEF0dHIgKTogKCB2YWx1ZTogT2JqWyBBdHRyIF0gKSA9PiB2b2lkIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiggdmFsdWUgKSB7XHJcbiAgICAgIG9iamVjdFsgYXR0cmlidXRlIF0gPSB2YWx1ZTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIZWxwZXIgZnVuY3Rpb24gZm9yIGNyZWF0aW5nIGEgZ2V0dGVyIGNsb3N1cmUgZm9yIG9iamVjdFsgYXR0cmlidXRlIF0uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgT0JKRUNUX0dFVDxPYmosIEF0dHIgZXh0ZW5kcyBrZXlvZiBPYmo+KCBvYmplY3Q6IE9iaiwgYXR0cmlidXRlOiBBdHRyICk6ICgpID0+IE9ialsgQXR0ciBdIHtcclxuICAgIHJldHVybiBmdW5jdGlvbigpIHtcclxuICAgICAgcmV0dXJuIG9iamVjdFsgYXR0cmlidXRlIF07XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGVscGVyIGZ1bmN0aW9uIGZvciBjcmVhdGluZyBhIHNldHRlciBjbG9zdXJlIGZvciBQcm9wZXJ0aWVzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgUFJPUEVSVFlfU0VUPFQ+KCBwcm9wZXJ0eTogVFByb3BlcnR5PFQ+ICk6ICggdmFsdWU6IFQgKSA9PiB2b2lkIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiggdmFsdWUgKSB7XHJcbiAgICAgIHByb3BlcnR5LnZhbHVlID0gdmFsdWU7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGVscGVyIGZ1bmN0aW9uIGZvciBjcmVhdGluZyBhIGdldHRlciBjbG9zdXJlIGZvciBQcm9wZXJ0aWVzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgUFJPUEVSVFlfR0VUPFQ+KCBwcm9wZXJ0eTogVFByb3BlcnR5PFQ+ICk6ICgpID0+IFQge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xyXG4gICAgICByZXR1cm4gcHJvcGVydHkudmFsdWU7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29tcHV0ZXMgdGhlIHN0YXJ0aW5nIGFuZCBlbmRpbmcgdmFsdWVzIG9mIHRoaXMgdGFyZ2V0LlxyXG4gICAqXHJcbiAgICogR2VuZXJhbGx5IGNhbGxlZCB3aGVuIHRoZSBhbmltYXRpb24gaXMganVzdCBhYm91dCB0byBiZWdpbiwgc28gaXQgY2FuIGxvb2sgdXAgdGhlIGN1cnJlbnQgdmFsdWUgaWYgbmVjZXNzYXJ5LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb21wdXRlU3RhcnRFbmQoKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnRvICE9PSBudWxsIHx8IHRoaXMuZGVsdGEgIT09IG51bGwgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZnJvbSAhPT0gbnVsbCB8fCB0aGlzLmdldFZhbHVlICE9PSBudWxsICk7XHJcblxyXG4gICAgdGhpcy5zdGFydGluZ1ZhbHVlID0gKCB0aGlzLmZyb20gIT09IG51bGwgKSA/IHRoaXMuZnJvbSA6IHRoaXMuZ2V0VmFsdWUhKCk7XHJcbiAgICB0aGlzLmVuZGluZ1ZhbHVlID0gKCB0aGlzLnRvICE9PSBudWxsICkgPyB0aGlzLnRvIDogdGhpcy5hZGQoIHRoaXMuc3RhcnRpbmdWYWx1ZSwgdGhpcy5kZWx0YSEgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIHZhbHVlIG9mIHRoaXMgdGFyZ2V0LlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHJhdGlvIC0gSG93IGZhciBhbG9uZyAoZnJvbSAwIHRvIDEpIGluIHRoZSBhbmltYXRpb24uXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZSggcmF0aW86IG51bWJlciApOiB2b2lkIHtcclxuICAgIC8vIFRoZXNlIHNob3VsZCBiZSBub24tbnVsbCBieSB0aGlzIHBvaW50XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnNldFZhbHVlICE9PSBudWxsICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnN0YXJ0aW5nVmFsdWUgIT09IG51bGwgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZW5kaW5nVmFsdWUgIT09IG51bGwgKTtcclxuXHJcbiAgICB0aGlzLnNldFZhbHVlKCB0aGlzLmJsZW5kKCB0aGlzLnN0YXJ0aW5nVmFsdWUhLCB0aGlzLmVuZGluZ1ZhbHVlISwgdGhpcy5lYXNpbmcudmFsdWUoIHJhdGlvICkgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hldGhlciB0aGlzIHRhcmdldCBjYW4gZGVmaW5lIHRoZSBkdXJhdGlvbiBvZiBhbiBhbmltYXRpb24uXHJcbiAgICovXHJcbiAgcHVibGljIGhhc1ByZWZlcnJlZER1cmF0aW9uKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc3BlZWQgIT09IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBwcmVmZXJyZWQgZHVyYXRpb24gb2YgdGhpcyB0YXJnZXQgKG9yIG51bGwgaWYgbm90IGRlZmluZWQpLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQcmVmZXJyZWREdXJhdGlvbigpOiBudW1iZXIgfCBudWxsIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuc3RhcnRpbmdWYWx1ZSAhPT0gbnVsbCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5kZWx0YSAhPT0gbnVsbCApO1xyXG5cclxuICAgIHJldHVybiB0aGlzLnNwZWVkID09PSBudWxsID8gbnVsbCA6IHRoaXMuc3BlZWQgKiB0aGlzLmRpc3RhbmNlKCB0aGlzLnN0YXJ0aW5nVmFsdWUhLCB0aGlzLmRlbHRhISApO1xyXG4gIH1cclxufVxyXG5cclxudHdpeHQucmVnaXN0ZXIoICdBbmltYXRpb25UYXJnZXQnLCBBbmltYXRpb25UYXJnZXQgKTtcclxuZXhwb3J0IGRlZmF1bHQgQW5pbWF0aW9uVGFyZ2V0OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFNQSxPQUFPQSxTQUFTLE1BQU0saUNBQWlDO0FBR3ZELE9BQU9DLE1BQU0sTUFBTSxhQUFhO0FBQ2hDLE9BQU9DLEtBQUssTUFBTSxZQUFZO0FBQzlCLFNBQVNDLG1CQUFtQixRQUFRLG9DQUFvQzs7QUE4R3hFOztBQU9BLE1BQU1DLGVBQWUsQ0FBbUI7RUFhdEM7RUFDUUMsYUFBYSxHQUFhLElBQUk7RUFDOUJDLFdBQVcsR0FBYSxJQUFJOztFQUVwQztBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1NDLFdBQVdBLENBQUVDLGNBQThDLEVBQUc7SUFFbkUsTUFBTUMsTUFBTSxHQUFHVCxTQUFTLENBQWlGLENBQUMsQ0FBRTtNQUMxR1UsUUFBUSxFQUFFLElBQUk7TUFDZEMsUUFBUSxF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