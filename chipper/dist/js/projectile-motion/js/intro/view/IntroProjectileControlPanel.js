// Copyright 2016-2024, University of Colorado Boulder

/**
 * Control panel that allows users to choose what kind of projectile to fire
 * and view the properties of this projectile.
 * Also includes a checkbox for turning on and off air resistance.
 *
 * @author Andrea Lin (PhET Interactive Simulations)
 */

import Utils from '../../../../dot/js/Utils.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import { HSeparator, HStrut, Text, VBox } from '../../../../scenery/js/imports.js';
import ComboBox from '../../../../sun/js/ComboBox.js';
import Panel from '../../../../sun/js/Panel.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import ProjectileMotionConstants from '../../common/ProjectileMotionConstants.js';
import AirResistanceControl from '../../common/view/AirResistanceControl.js';
import projectileMotion from '../../projectileMotion.js';
import ProjectileMotionStrings from '../../ProjectileMotionStrings.js';
const diameterString = ProjectileMotionStrings.diameter;
const kgString = ProjectileMotionStrings.kg;
const massString = ProjectileMotionStrings.mass;
const mString = ProjectileMotionStrings.m;
const pattern0Value1UnitsWithSpaceString = ProjectileMotionStrings.pattern0Value1UnitsWithSpace;

// constants
const LABEL_OPTIONS = ProjectileMotionConstants.PANEL_LABEL_OPTIONS;
class IntroProjectileControlPanel extends Panel {
  /**
   * @param {Array.<ProjectileObjectType>} objectTypes - types of objects available for the dropdown model
   * @param {Property.<ProjectileObjectType>} selectedProjectileObjectTypeProperty - currently selected type of object
   * @param {Node} comboBoxListParent - node for containing the combo box
   * @param {Property.<number>} projectileMassProperty
   * @param {Property.<number>} projectileDiameterProperty
   * @param {Property.<number>} projectileDragCoefficientProperty
   * @param {Property.<boolean>} airResistanceOnProperty - whether air resistance is on
   * @param {Object} [options]
   */
  constructor(objectTypes, selectedProjectileObjectTypeProperty, comboBoxListParent, projectileMassProperty, projectileDiameterProperty, projectileDragCoefficientProperty, airResistanceOnProperty, options) {
    // The first object is a placeholder so none of the others get mutated
    // The second object is the default, in the constants files
    // The third object is options specific to this panel, which overrides the defaults
    // The fourth object is options given at time of construction, which overrides all the others
    options = merge({}, ProjectileMotionConstants.RIGHTSIDE_PANEL_OPTIONS, {
      tandem: Tandem.REQUIRED
    }, options);

    // maxWidth of the labels within the dropdown empirically determined
    const itemNodeOptions = merge({}, LABEL_OPTIONS, {
      maxWidth: 170
    });
    const firstItemNode = new VBox({
      align: 'left',
      children: [new Text(objectTypes[0].name, itemNodeOptions)]
    });
    const comboBoxWidth = options.minWidth - 2 * options.xMargin;
    const itemXMargin = 6;
    const buttonXMargin = 10;
    const comboBoxLineWidth = 1;

    // first item contains horizontal strut that sets width of combo box
    const firstItemNodeWidth = comboBoxWidth - itemXMargin - 0.5 * firstItemNode.height - 4 * buttonXMargin - 2 * itemXMargin - 2 * comboBoxLineWidth;
    firstItemNode.addChild(new HStrut(firstItemNodeWidth));
    const comboBoxItems = [];
    for (let i = 0; i < objectTypes.length; i++) {
      const projectileType = objectTypes[i];
      assert && assert(projectileType.benchmark, 'benchmark needed for tandemName');
      comboBoxItems[i] = {
        value: projectileType,
        createNode: () => i === 0 ? firstItemNode : new Text(projectileType.name, itemNodeOptions),
        tandemName: `${projectileType.benchmark}Item`
      };
    }

    // create view for dropdown
    const projectileChoiceComboBox = new ComboBox(selectedProjectileObjectTypeProperty, comboBoxItems, comboBoxListParent, {
      xMargin: 12,
      yMargin: 7,
      cornerRadius: 4,
      buttonLineWidth: comboBoxLineWidth,
      listLineWidth: comboBoxLineWidth,
      tandem: options.tandem.createTandem('projectileChoiceComboBox'),
      phetioDocumentation: 'Combo box that selects what projectile type to launch from the cannon'
    });

    // local var for layout and formatting
    const parameterLabelOptions = merge({}, LABEL_OPTIONS, {
      maxWidth: options.minWidth - 2 * options.xMargin
    });

    /**
     * Auxiliary function that creates vbox for a parameter label and readouts
     * @private
     *
     * @param {string} labelString - label for the parameter
     * @param {string} unitsString - units
     * @param {Property.<number>} valueProperty - the Property that is set and linked to
     * @param {Tandem} tandem
     * @returns {VBox}
     */
    function createReadout(labelString, unitsString, valueProperty, tandem) {
      const parameterLabel = new Text('', merge({
        tandem: tandem,
        stringPropertyOptions: {
          phetioReadOnly: true
        }
      }, parameterLabelOptions));
      parameterLabel.setBoundsMethod('accurate');
      valueProperty.link(value => {
        const valueReadout = unitsString ? StringUtils.fillIn(pattern0Value1UnitsWithSpaceString, {
          value: value,
          units: unitsString
        }) : Utils.toFixed(value, 2);
        parameterLabel.setString(`${labelString}: ${valueReadout}`);
      });
      return new VBox({
        align: 'left',
        children: [parameterLabel, new HStrut(parameterLabelOptions.maxWidth)]
      });
    }
    const massText = createReadout(massString, kgString, projectileMassProperty, options.tandem.createTandem('massText'));
    const diameterText = createReadout(diameterString, mString, projectileDiameterProperty, options.tandem.createTandem('diameterText'));

    // The contents of the control panel
    const content = new VBox({
      align: 'left',
      spacing: options.controlsVerticalSpace,
      children: [projectileChoiceComboBox, massText, diameterText, new HSeparator({
        stroke: ProjectileMotionConstants.SEPARATOR_COLOR
      }), new AirResistanceControl(airResistanceOnProperty, projectileDragCoefficientProperty, {
        labelOptions: LABEL_OPTIONS,
        minWidth: options.minWidth,
        xMargin: options.xMargin,
        spacing: options.controlsVerticalSpace,
        tandem: options.tandem.createTandem('airResistanceControl')
      })]
    });
    super(content, options);

    // @private make visible to methods
    this.projectileChoiceComboBox = projectileChoiceComboBox;
  }

  // @public for use by screen view
  hideComboBoxList() {
    this.projectileChoiceComboBox.hideListBox();
  }
}
projectileMotion.register('IntroProjectileControlPanel', IntroProjectileControlPanel);
export default IntroProjectileControlPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIm1lcmdlIiwiU3RyaW5nVXRpbHMiLCJIU2VwYXJhdG9yIiwiSFN0cnV0IiwiVGV4dCIsIlZCb3giLCJDb21ib0JveCIsIlBhbmVsIiwiVGFuZGVtIiwiUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cyIsIkFpclJlc2lzdGFuY2VDb250cm9sIiwicHJvamVjdGlsZU1vdGlvbiIsIlByb2plY3RpbGVNb3Rpb25TdHJpbmdzIiwiZGlhbWV0ZXJTdHJpbmciLCJkaWFtZXRlciIsImtnU3RyaW5nIiwia2ciLCJtYXNzU3RyaW5nIiwibWFzcyIsIm1TdHJpbmciLCJtIiwicGF0dGVybjBWYWx1ZTFVbml0c1dpdGhTcGFjZVN0cmluZyIsInBhdHRlcm4wVmFsdWUxVW5pdHNXaXRoU3BhY2UiLCJMQUJFTF9PUFRJT05TIiwiUEFORUxfTEFCRUxfT1BUSU9OUyIsIkludHJvUHJvamVjdGlsZUNvbnRyb2xQYW5lbCIsImNvbnN0cnVjdG9yIiwib2JqZWN0VHlwZXMiLCJzZWxlY3RlZFByb2plY3RpbGVPYmplY3RUeXBlUHJvcGVydHkiLCJjb21ib0JveExpc3RQYXJlbnQiLCJwcm9qZWN0aWxlTWFzc1Byb3BlcnR5IiwicHJvamVjdGlsZURpYW1ldGVyUHJvcGVydHkiLCJwcm9qZWN0aWxlRHJhZ0NvZWZmaWNpZW50UHJvcGVydHkiLCJhaXJSZXNpc3RhbmNlT25Qcm9wZXJ0eSIsIm9wdGlvbnMiLCJSSUdIVFNJREVfUEFORUxfT1BUSU9OUyIsInRhbmRlbSIsIlJFUVVJUkVEIiwiaXRlbU5vZGVPcHRpb25zIiwibWF4V2lkdGgiLCJmaXJzdEl0ZW1Ob2RlIiwiYWxpZ24iLCJjaGlsZHJlbiIsIm5hbWUiLCJjb21ib0JveFdpZHRoIiwibWluV2lkdGgiLCJ4TWFyZ2luIiwiaXRlbVhNYXJnaW4iLCJidXR0b25YTWFyZ2luIiwiY29tYm9Cb3hMaW5lV2lkdGgiLCJmaXJzdEl0ZW1Ob2RlV2lkdGgiLCJoZWlnaHQiLCJhZGRDaGlsZCIsImNvbWJvQm94SXRlbXMiLCJpIiwibGVuZ3RoIiwicHJvamVjdGlsZVR5cGUiLCJhc3NlcnQiLCJiZW5jaG1hcmsiLCJ2YWx1ZSIsImNyZWF0ZU5vZGUiLCJ0YW5kZW1OYW1lIiwicHJvamVjdGlsZUNob2ljZUNvbWJvQm94IiwieU1hcmdpbiIsImNvcm5lclJhZGl1cyIsImJ1dHRvbkxpbmVXaWR0aCIsImxpc3RMaW5lV2lkdGgiLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwicGFyYW1ldGVyTGFiZWxPcHRpb25zIiwiY3JlYXRlUmVhZG91dCIsImxhYmVsU3RyaW5nIiwidW5pdHNTdHJpbmciLCJ2YWx1ZVByb3BlcnR5IiwicGFyYW1ldGVyTGFiZWwiLCJzdHJpbmdQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9SZWFkT25seSIsInNldEJvdW5kc01ldGhvZCIsImxpbmsiLCJ2YWx1ZVJlYWRvdXQiLCJmaWxsSW4iLCJ1bml0cyIsInRvRml4ZWQiLCJzZXRTdHJpbmciLCJtYXNzVGV4dCIsImRpYW1ldGVyVGV4dCIsImNvbnRlbnQiLCJzcGFjaW5nIiwiY29udHJvbHNWZXJ0aWNhbFNwYWNlIiwic3Ryb2tlIiwiU0VQQVJBVE9SX0NPTE9SIiwibGFiZWxPcHRpb25zIiwiaGlkZUNvbWJvQm94TGlzdCIsImhpZGVMaXN0Qm94IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJJbnRyb1Byb2plY3RpbGVDb250cm9sUGFuZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ29udHJvbCBwYW5lbCB0aGF0IGFsbG93cyB1c2VycyB0byBjaG9vc2Ugd2hhdCBraW5kIG9mIHByb2plY3RpbGUgdG8gZmlyZVxyXG4gKiBhbmQgdmlldyB0aGUgcHJvcGVydGllcyBvZiB0aGlzIHByb2plY3RpbGUuXHJcbiAqIEFsc28gaW5jbHVkZXMgYSBjaGVja2JveCBmb3IgdHVybmluZyBvbiBhbmQgb2ZmIGFpciByZXNpc3RhbmNlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEFuZHJlYSBMaW4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IHsgSFNlcGFyYXRvciwgSFN0cnV0LCBUZXh0LCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IENvbWJvQm94IGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9Db21ib0JveC5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBBaXJSZXNpc3RhbmNlQ29udHJvbCBmcm9tICcuLi8uLi9jb21tb24vdmlldy9BaXJSZXNpc3RhbmNlQ29udHJvbC5qcyc7XHJcbmltcG9ydCBwcm9qZWN0aWxlTW90aW9uIGZyb20gJy4uLy4uL3Byb2plY3RpbGVNb3Rpb24uanMnO1xyXG5pbXBvcnQgUHJvamVjdGlsZU1vdGlvblN0cmluZ3MgZnJvbSAnLi4vLi4vUHJvamVjdGlsZU1vdGlvblN0cmluZ3MuanMnO1xyXG5cclxuY29uc3QgZGlhbWV0ZXJTdHJpbmcgPSBQcm9qZWN0aWxlTW90aW9uU3RyaW5ncy5kaWFtZXRlcjtcclxuY29uc3Qga2dTdHJpbmcgPSBQcm9qZWN0aWxlTW90aW9uU3RyaW5ncy5rZztcclxuY29uc3QgbWFzc1N0cmluZyA9IFByb2plY3RpbGVNb3Rpb25TdHJpbmdzLm1hc3M7XHJcbmNvbnN0IG1TdHJpbmcgPSBQcm9qZWN0aWxlTW90aW9uU3RyaW5ncy5tO1xyXG5jb25zdCBwYXR0ZXJuMFZhbHVlMVVuaXRzV2l0aFNwYWNlU3RyaW5nID0gUHJvamVjdGlsZU1vdGlvblN0cmluZ3MucGF0dGVybjBWYWx1ZTFVbml0c1dpdGhTcGFjZTtcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBMQUJFTF9PUFRJT05TID0gUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5QQU5FTF9MQUJFTF9PUFRJT05TO1xyXG5cclxuY2xhc3MgSW50cm9Qcm9qZWN0aWxlQ29udHJvbFBhbmVsIGV4dGVuZHMgUGFuZWwge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0FycmF5LjxQcm9qZWN0aWxlT2JqZWN0VHlwZT59IG9iamVjdFR5cGVzIC0gdHlwZXMgb2Ygb2JqZWN0cyBhdmFpbGFibGUgZm9yIHRoZSBkcm9wZG93biBtb2RlbFxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPFByb2plY3RpbGVPYmplY3RUeXBlPn0gc2VsZWN0ZWRQcm9qZWN0aWxlT2JqZWN0VHlwZVByb3BlcnR5IC0gY3VycmVudGx5IHNlbGVjdGVkIHR5cGUgb2Ygb2JqZWN0XHJcbiAgICogQHBhcmFtIHtOb2RlfSBjb21ib0JveExpc3RQYXJlbnQgLSBub2RlIGZvciBjb250YWluaW5nIHRoZSBjb21ibyBib3hcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxudW1iZXI+fSBwcm9qZWN0aWxlTWFzc1Byb3BlcnR5XHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48bnVtYmVyPn0gcHJvamVjdGlsZURpYW1ldGVyUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxudW1iZXI+fSBwcm9qZWN0aWxlRHJhZ0NvZWZmaWNpZW50UHJvcGVydHlcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5Ljxib29sZWFuPn0gYWlyUmVzaXN0YW5jZU9uUHJvcGVydHkgLSB3aGV0aGVyIGFpciByZXNpc3RhbmNlIGlzIG9uXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBvYmplY3RUeXBlcyxcclxuICAgICAgICAgICAgICAgc2VsZWN0ZWRQcm9qZWN0aWxlT2JqZWN0VHlwZVByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBjb21ib0JveExpc3RQYXJlbnQsXHJcbiAgICAgICAgICAgICAgIHByb2plY3RpbGVNYXNzUHJvcGVydHksXHJcbiAgICAgICAgICAgICAgIHByb2plY3RpbGVEaWFtZXRlclByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBwcm9qZWN0aWxlRHJhZ0NvZWZmaWNpZW50UHJvcGVydHksXHJcbiAgICAgICAgICAgICAgIGFpclJlc2lzdGFuY2VPblByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBvcHRpb25zICkge1xyXG5cclxuICAgIC8vIFRoZSBmaXJzdCBvYmplY3QgaXMgYSBwbGFjZWhvbGRlciBzbyBub25lIG9mIHRoZSBvdGhlcnMgZ2V0IG11dGF0ZWRcclxuICAgIC8vIFRoZSBzZWNvbmQgb2JqZWN0IGlzIHRoZSBkZWZhdWx0LCBpbiB0aGUgY29uc3RhbnRzIGZpbGVzXHJcbiAgICAvLyBUaGUgdGhpcmQgb2JqZWN0IGlzIG9wdGlvbnMgc3BlY2lmaWMgdG8gdGhpcyBwYW5lbCwgd2hpY2ggb3ZlcnJpZGVzIHRoZSBkZWZhdWx0c1xyXG4gICAgLy8gVGhlIGZvdXJ0aCBvYmplY3QgaXMgb3B0aW9ucyBnaXZlbiBhdCB0aW1lIG9mIGNvbnN0cnVjdGlvbiwgd2hpY2ggb3ZlcnJpZGVzIGFsbCB0aGUgb3RoZXJzXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHt9LCBQcm9qZWN0aWxlTW90aW9uQ29uc3RhbnRzLlJJR0hUU0lERV9QQU5FTF9PUFRJT05TLCB7XHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVEXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gbWF4V2lkdGggb2YgdGhlIGxhYmVscyB3aXRoaW4gdGhlIGRyb3Bkb3duIGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuICAgIGNvbnN0IGl0ZW1Ob2RlT3B0aW9ucyA9IG1lcmdlKCB7fSwgTEFCRUxfT1BUSU9OUywgeyBtYXhXaWR0aDogMTcwIH0gKTtcclxuXHJcbiAgICBjb25zdCBmaXJzdEl0ZW1Ob2RlID0gbmV3IFZCb3goIHtcclxuICAgICAgYWxpZ246ICdsZWZ0JyxcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBuZXcgVGV4dCggb2JqZWN0VHlwZXNbIDAgXS5uYW1lLCBpdGVtTm9kZU9wdGlvbnMgKVxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgY29tYm9Cb3hXaWR0aCA9IG9wdGlvbnMubWluV2lkdGggLSAyICogb3B0aW9ucy54TWFyZ2luO1xyXG4gICAgY29uc3QgaXRlbVhNYXJnaW4gPSA2O1xyXG4gICAgY29uc3QgYnV0dG9uWE1hcmdpbiA9IDEwO1xyXG4gICAgY29uc3QgY29tYm9Cb3hMaW5lV2lkdGggPSAxO1xyXG5cclxuICAgIC8vIGZpcnN0IGl0ZW0gY29udGFpbnMgaG9yaXpvbnRhbCBzdHJ1dCB0aGF0IHNldHMgd2lkdGggb2YgY29tYm8gYm94XHJcbiAgICBjb25zdCBmaXJzdEl0ZW1Ob2RlV2lkdGggPSBjb21ib0JveFdpZHRoIC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1YTWFyZ2luIC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuNSAqIGZpcnN0SXRlbU5vZGUuaGVpZ2h0IC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQgKiBidXR0b25YTWFyZ2luIC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIgKiBpdGVtWE1hcmdpbiAtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAyICogY29tYm9Cb3hMaW5lV2lkdGg7XHJcbiAgICBmaXJzdEl0ZW1Ob2RlLmFkZENoaWxkKCBuZXcgSFN0cnV0KCBmaXJzdEl0ZW1Ob2RlV2lkdGggKSApO1xyXG5cclxuICAgIGNvbnN0IGNvbWJvQm94SXRlbXMgPSBbXTtcclxuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBvYmplY3RUeXBlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgcHJvamVjdGlsZVR5cGUgPSBvYmplY3RUeXBlc1sgaSBdO1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwcm9qZWN0aWxlVHlwZS5iZW5jaG1hcmssICdiZW5jaG1hcmsgbmVlZGVkIGZvciB0YW5kZW1OYW1lJyApO1xyXG5cclxuICAgICAgY29tYm9Cb3hJdGVtc1sgaSBdID0ge1xyXG4gICAgICAgIHZhbHVlOiBwcm9qZWN0aWxlVHlwZSxcclxuICAgICAgICBjcmVhdGVOb2RlOiAoKSA9PiAoIGkgPT09IDAgKSA/IGZpcnN0SXRlbU5vZGUgOiBuZXcgVGV4dCggcHJvamVjdGlsZVR5cGUubmFtZSwgaXRlbU5vZGVPcHRpb25zICksXHJcbiAgICAgICAgdGFuZGVtTmFtZTogYCR7cHJvamVjdGlsZVR5cGUuYmVuY2htYXJrfUl0ZW1gXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY3JlYXRlIHZpZXcgZm9yIGRyb3Bkb3duXHJcbiAgICBjb25zdCBwcm9qZWN0aWxlQ2hvaWNlQ29tYm9Cb3ggPSBuZXcgQ29tYm9Cb3goIHNlbGVjdGVkUHJvamVjdGlsZU9iamVjdFR5cGVQcm9wZXJ0eSwgY29tYm9Cb3hJdGVtcywgY29tYm9Cb3hMaXN0UGFyZW50LCB7XHJcbiAgICAgIHhNYXJnaW46IDEyLFxyXG4gICAgICB5TWFyZ2luOiA3LFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IDQsXHJcbiAgICAgIGJ1dHRvbkxpbmVXaWR0aDogY29tYm9Cb3hMaW5lV2lkdGgsXHJcbiAgICAgIGxpc3RMaW5lV2lkdGg6IGNvbWJvQm94TGluZVdpZHRoLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Byb2plY3RpbGVDaG9pY2VDb21ib0JveCcgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ0NvbWJvIGJveCB0aGF0IHNlbGVjdHMgd2hhdCBwcm9qZWN0aWxlIHR5cGUgdG8gbGF1bmNoIGZyb20gdGhlIGNhbm5vbidcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBsb2NhbCB2YXIgZm9yIGxheW91dCBhbmQgZm9ybWF0dGluZ1xyXG4gICAgY29uc3QgcGFyYW1ldGVyTGFiZWxPcHRpb25zID0gbWVyZ2UoIHt9LCBMQUJFTF9PUFRJT05TLCB7IG1heFdpZHRoOiBvcHRpb25zLm1pbldpZHRoIC0gMiAqIG9wdGlvbnMueE1hcmdpbiB9ICk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBdXhpbGlhcnkgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIHZib3ggZm9yIGEgcGFyYW1ldGVyIGxhYmVsIGFuZCByZWFkb3V0c1xyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbGFiZWxTdHJpbmcgLSBsYWJlbCBmb3IgdGhlIHBhcmFtZXRlclxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVuaXRzU3RyaW5nIC0gdW5pdHNcclxuICAgICAqIEBwYXJhbSB7UHJvcGVydHkuPG51bWJlcj59IHZhbHVlUHJvcGVydHkgLSB0aGUgUHJvcGVydHkgdGhhdCBpcyBzZXQgYW5kIGxpbmtlZCB0b1xyXG4gICAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAgICogQHJldHVybnMge1ZCb3h9XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZVJlYWRvdXQoIGxhYmVsU3RyaW5nLCB1bml0c1N0cmluZywgdmFsdWVQcm9wZXJ0eSwgdGFuZGVtICkge1xyXG4gICAgICBjb25zdCBwYXJhbWV0ZXJMYWJlbCA9IG5ldyBUZXh0KCAnJywgbWVyZ2UoIHtcclxuICAgICAgICB0YW5kZW06IHRhbmRlbSxcclxuICAgICAgICBzdHJpbmdQcm9wZXJ0eU9wdGlvbnM6IHsgcGhldGlvUmVhZE9ubHk6IHRydWUgfVxyXG4gICAgICB9LCBwYXJhbWV0ZXJMYWJlbE9wdGlvbnMgKSApO1xyXG5cclxuICAgICAgcGFyYW1ldGVyTGFiZWwuc2V0Qm91bmRzTWV0aG9kKCAnYWNjdXJhdGUnICk7XHJcblxyXG4gICAgICB2YWx1ZVByb3BlcnR5LmxpbmsoIHZhbHVlID0+IHtcclxuICAgICAgICBjb25zdCB2YWx1ZVJlYWRvdXQgPSB1bml0c1N0cmluZyA/IFN0cmluZ1V0aWxzLmZpbGxJbiggcGF0dGVybjBWYWx1ZTFVbml0c1dpdGhTcGFjZVN0cmluZywge1xyXG4gICAgICAgICAgdmFsdWU6IHZhbHVlLFxyXG4gICAgICAgICAgdW5pdHM6IHVuaXRzU3RyaW5nXHJcbiAgICAgICAgfSApIDogVXRpbHMudG9GaXhlZCggdmFsdWUsIDIgKTtcclxuICAgICAgICBwYXJhbWV0ZXJMYWJlbC5zZXRTdHJpbmcoIGAke2xhYmVsU3RyaW5nfTogJHt2YWx1ZVJlYWRvdXR9YCApO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICByZXR1cm4gbmV3IFZCb3goIHtcclxuICAgICAgICBhbGlnbjogJ2xlZnQnLFxyXG4gICAgICAgIGNoaWxkcmVuOiBbIHBhcmFtZXRlckxhYmVsLCBuZXcgSFN0cnV0KCBwYXJhbWV0ZXJMYWJlbE9wdGlvbnMubWF4V2lkdGggKSBdXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBtYXNzVGV4dCA9IGNyZWF0ZVJlYWRvdXQoXHJcbiAgICAgIG1hc3NTdHJpbmcsXHJcbiAgICAgIGtnU3RyaW5nLFxyXG4gICAgICBwcm9qZWN0aWxlTWFzc1Byb3BlcnR5LFxyXG4gICAgICBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdtYXNzVGV4dCcgKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBkaWFtZXRlclRleHQgPSBjcmVhdGVSZWFkb3V0KFxyXG4gICAgICBkaWFtZXRlclN0cmluZyxcclxuICAgICAgbVN0cmluZyxcclxuICAgICAgcHJvamVjdGlsZURpYW1ldGVyUHJvcGVydHksXHJcbiAgICAgIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RpYW1ldGVyVGV4dCcgKVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBUaGUgY29udGVudHMgb2YgdGhlIGNvbnRyb2wgcGFuZWxcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBuZXcgVkJveCgge1xyXG4gICAgICBhbGlnbjogJ2xlZnQnLFxyXG4gICAgICBzcGFjaW5nOiBvcHRpb25zLmNvbnRyb2xzVmVydGljYWxTcGFjZSxcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBwcm9qZWN0aWxlQ2hvaWNlQ29tYm9Cb3gsXHJcbiAgICAgICAgbWFzc1RleHQsXHJcbiAgICAgICAgZGlhbWV0ZXJUZXh0LFxyXG4gICAgICAgIG5ldyBIU2VwYXJhdG9yKCB7IHN0cm9rZTogUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5TRVBBUkFUT1JfQ09MT1IgfSApLFxyXG4gICAgICAgIG5ldyBBaXJSZXNpc3RhbmNlQ29udHJvbCggYWlyUmVzaXN0YW5jZU9uUHJvcGVydHksIHByb2plY3RpbGVEcmFnQ29lZmZpY2llbnRQcm9wZXJ0eSwge1xyXG4gICAgICAgICAgbGFiZWxPcHRpb25zOiBMQUJFTF9PUFRJT05TLFxyXG4gICAgICAgICAgbWluV2lkdGg6IG9wdGlvbnMubWluV2lkdGgsXHJcbiAgICAgICAgICB4TWFyZ2luOiBvcHRpb25zLnhNYXJnaW4sXHJcbiAgICAgICAgICBzcGFjaW5nOiBvcHRpb25zLmNvbnRyb2xzVmVydGljYWxTcGFjZSxcclxuICAgICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnYWlyUmVzaXN0YW5jZUNvbnRyb2wnIClcclxuICAgICAgICB9IClcclxuICAgICAgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCBjb250ZW50LCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgbWFrZSB2aXNpYmxlIHRvIG1ldGhvZHNcclxuICAgIHRoaXMucHJvamVjdGlsZUNob2ljZUNvbWJvQm94ID0gcHJvamVjdGlsZUNob2ljZUNvbWJvQm94O1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpYyBmb3IgdXNlIGJ5IHNjcmVlbiB2aWV3XHJcbiAgaGlkZUNvbWJvQm94TGlzdCgpIHtcclxuICAgIHRoaXMucHJvamVjdGlsZUNob2ljZUNvbWJvQm94LmhpZGVMaXN0Qm94KCk7XHJcbiAgfVxyXG59XHJcblxyXG5wcm9qZWN0aWxlTW90aW9uLnJlZ2lzdGVyKCAnSW50cm9Qcm9qZWN0aWxlQ29udHJvbFBhbmVsJywgSW50cm9Qcm9qZWN0aWxlQ29udHJvbFBhbmVsICk7XHJcbmV4cG9ydCBkZWZhdWx0IEludHJvUHJvamVjdGlsZUNvbnRyb2xQYW5lbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLFNBQVNDLFVBQVUsRUFBRUMsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDbEYsT0FBT0MsUUFBUSxNQUFNLGdDQUFnQztBQUNyRCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MseUJBQXlCLE1BQU0sMkNBQTJDO0FBQ2pGLE9BQU9DLG9CQUFvQixNQUFNLDJDQUEyQztBQUM1RSxPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFDeEQsT0FBT0MsdUJBQXVCLE1BQU0sa0NBQWtDO0FBRXRFLE1BQU1DLGNBQWMsR0FB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