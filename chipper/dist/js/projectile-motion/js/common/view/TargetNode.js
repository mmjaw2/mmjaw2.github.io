// Copyright 2016-2023, University of Colorado Boulder

/**
 * View for the target.
 * X position can change when user drags the cannon, y remains constant (on the ground)
 *
 * @author Andrea Lin (PhET Interactive Simulations)
 */

import Range from '../../../../dot/js/Range.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import optionize, { combineOptions } from '../../../../phet-core/js/optionize.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import NumberDisplay from '../../../../scenery-phet/js/NumberDisplay.js';
import StarNode from '../../../../scenery-phet/js/StarNode.js';
import { Circle, DragListener, Node } from '../../../../scenery/js/imports.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import Animation from '../../../../twixt/js/Animation.js';
import Easing from '../../../../twixt/js/Easing.js';
import projectileMotion from '../../projectileMotion.js';
import ProjectileMotionStrings from '../../ProjectileMotionStrings.js';
import ProjectileMotionConstants from '../ProjectileMotionConstants.js';
const mString = ProjectileMotionStrings.m;
const pattern0Value1UnitsWithSpaceString = ProjectileMotionStrings.pattern0Value1UnitsWithSpace;

// constants
const TARGET_DIAMETER = ProjectileMotionConstants.TARGET_WIDTH;
const TARGET_HEIGHT = ProjectileMotionConstants.TARGET_HEIGHT;
const REWARD_NODE_INITIAL_Y_OFFSET = -10; // in screen coords
const REWARD_NODE_Y_MOVEMENT = 70; // in screen coords
const REWARD_NODE_GROWTH_AMOUNT = 0.5; // scale factor, larger = more growth

class TargetNode extends Node {
  // for coordinate transforms as well as adding the stars as children

  // local var to improve readability

  // keeps track of rewardNodes that animate when projectile has scored

  constructor(target, transformProperty, screenView, providedOptions) {
    const options = optionize()({
      phetioInputEnabledPropertyInstrumented: true,
      tandem: Tandem.REQUIRED
    }, providedOptions);
    super(options);
    this.screenView = screenView;
    this.positionProperty = target.positionProperty;
    this.transformProperty = transformProperty;

    // red and white circles of the target
    const outerCircle = new Circle(1, {
      fill: 'red',
      stroke: 'black',
      lineWidth: this.transformProperty.get().viewToModelDeltaX(1)
    });
    const middleCircle = new Circle(2 / 3, {
      fill: 'white',
      stroke: 'black',
      lineWidth: this.transformProperty.get().viewToModelDeltaX(0.5)
    });
    const innerCircle = new Circle(1 / 3, {
      fill: 'red',
      stroke: 'black',
      lineWidth: this.transformProperty.get().viewToModelDeltaX(0.5)
    });

    // target view
    const targetView = new Node({
      pickable: true,
      cursor: 'pointer',
      children: [outerCircle, middleCircle, innerCircle]
    });

    // scaling the target to the right size
    const viewRadius = this.transformProperty.get().modelToViewDeltaX(TARGET_DIAMETER) / 2;
    const targetHeightInView = TARGET_HEIGHT / TARGET_DIAMETER * viewRadius;
    targetView.setScaleMagnitude(viewRadius, targetHeightInView);

    // center on model's positionProperty
    targetView.center = this.transformProperty.get().modelToViewPosition(Vector2.pool.create(this.positionProperty.get(), 0));

    // add target to scene graph
    this.addChild(targetView);

    // variables used in drag handler
    let startPoint;
    let startX;
    let mousePoint;

    // Horizontal drag only
    const dragListener = new DragListener({
      start: event => {
        startPoint = screenView.globalToLocalPoint(event.pointer.point);
        startX = targetView.centerX; // view units
      },
      drag: event => {
        mousePoint = screenView.globalToLocalPoint(event.pointer.point);

        // change in x, view units
        const xChange = mousePoint.x - startPoint.x;
        const newTargetX = Utils.roundSymmetric(this.transformProperty.get().viewToModelX(startX + xChange) * 10) / 10;
        this.positionProperty.set(Utils.clamp(newTargetX, this.positionProperty.range.min, this.positionProperty.range.max));
      },
      allowTouchSnag: true,
      tandem: options.tandem.createTandem('dragListener')
    });

    // drag target to change horizontal position
    targetView.addInputListener(dragListener);

    // update the range based on the current transform
    this.updateTargetXRange(this.transformProperty.get());

    // text readout for horizontal distance from fire, which is origin, which is base of cannon
    const distancePattern = StringUtils.fillIn(pattern0Value1UnitsWithSpaceString, {
      units: mString
    });
    const distanceLabel = new NumberDisplay(this.positionProperty, this.positionProperty.range, combineOptions({}, ProjectileMotionConstants.NUMBER_DISPLAY_OPTIONS, {
      textOptions: {
        fill: 'black'
      },
      valuePattern: distancePattern,
      xMargin: 10.5,
      yMargin: 2,
      decimalPlaces: 1,
      cursor: 'pointer',
      tandem: options.tandem.createTandem('numberDisplay'),
      phetioDocumentation: 'The number display in model coordinates of how far the cannon is from the target'
    }));
    this.addChild(distanceLabel);

    // drag text to change horizontal position
    distanceLabel.addInputListener(dragListener);
    this.rewardNodes = [];

    // listen to model for whether target indicator should be shown
    target.scoredEmitter.addListener(numberOfStars => {
      let rewardNode;
      if (numberOfStars === 1) {
        rewardNode = new Node({
          children: [new StarNode({
            x: 0,
            y: -30
          })]
        });
      } else if (numberOfStars === 2) {
        rewardNode = new Node({
          children: [new StarNode({
            x: -20,
            y: -20
          }), new StarNode({
            x: 20,
            y: -20
          })]
        });
      } else {
        assert && assert(numberOfStars === 3, '3 stars expected here');
        rewardNode = new Node({
          children: [new StarNode({
            x: -30,
            y: -20
          }), new StarNode({
            x: 0,
            y: -30
          }), new StarNode({
            x: 30,
            y: -20
          })]
        });
      }
      const rewardNodeStartPosition = new Vector2(targetView.centerX, targetView.centerY + REWARD_NODE_INITIAL_Y_OFFSET);
      rewardNode.center = rewardNodeStartPosition;
      screenView.addChild(rewardNode);
      this.rewardNodes.push(rewardNode);

      // animate the reward node (one to three stars) to move up, expand, and fade out
      const rewardNodeAnimation = new Animation({
        duration: 1,
        easing: Easing.QUADRATIC_OUT,
        setValue: newYPos => {
          rewardNode.centerY = newYPos;
          const animationProportionCompleted = Math.abs(newYPos - rewardNodeStartPosition.y) / REWARD_NODE_Y_MOVEMENT;
          rewardNode.opacity = 1 - animationProportionCompleted;
          rewardNode.setScaleMagnitude(1 + animationProportionCompleted * REWARD_NODE_GROWTH_AMOUNT);
        },
        from: rewardNodeStartPosition.y,
        to: rewardNodeStartPosition.y - REWARD_NODE_Y_MOVEMENT
      });

      // remove the reward node when the animation finishes
      rewardNodeAnimation.finishEmitter.addListener(() => {
        this.rewardNodes.splice(this.rewardNodes.indexOf(rewardNode), 1);
        rewardNode.dispose();
      });

      // kick off the animation
      rewardNodeAnimation.start();
    });

    // Observe changes in the model horizontal position and update the view correspondingly
    const updateHorizontalPosition = targetX => {
      targetView.centerX = this.transformProperty.get().modelToViewX(targetX);
      distanceLabel.centerX = targetView.centerX;
      distanceLabel.top = targetView.bottom + 2;
      this.rewardNodes.forEach(rewardNode => {
        rewardNode.x = targetView.centerX;
      });
    };
    this.positionProperty.link(updateHorizontalPosition);

    // Observe changes in the modelViewTransform and update the view
    this.transformProperty.link(transform => {
      this.updateTargetXRange(transform);
      const viewRadius = transform.modelToViewDeltaX(TARGET_DIAMETER) / 2;
      targetView.setScaleMagnitude(viewRadius, targetHeightInView);
      updateHorizontalPosition(this.positionProperty.get());
    });

    // The node lasts for the lifetime of the sim, so its links/references don't need to be disposed
  }
  updateTargetXRange(transform) {
    const newRange = new Range(transform.viewToModelX(this.screenView.layoutBounds.minX), transform.viewToModelX(this.screenView.layoutBounds.maxX));
    this.positionProperty.setValueAndRange(Utils.clamp(this.positionProperty.value, newRange.min, newRange.max), newRange);
  }

  /**
   * Remove animations
   */
  reset() {
    this.rewardNodes.forEach(rewardNode => {
      if (this.screenView.hasChild(rewardNode)) {
        this.screenView.removeChild(rewardNode);
      }
    });
    this.rewardNodes = [];

    // reset the range of the target
    this.updateTargetXRange(this.transformProperty.value);
  }
}
projectileMotion.register('TargetNode', TargetNode);
export default TargetNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSYW5nZSIsIlV0aWxzIiwiVmVjdG9yMiIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiU3RyaW5nVXRpbHMiLCJOdW1iZXJEaXNwbGF5IiwiU3Rhck5vZGUiLCJDaXJjbGUiLCJEcmFnTGlzdGVuZXIiLCJOb2RlIiwiVGFuZGVtIiwiQW5pbWF0aW9uIiwiRWFzaW5nIiwicHJvamVjdGlsZU1vdGlvbiIsIlByb2plY3RpbGVNb3Rpb25TdHJpbmdzIiwiUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cyIsIm1TdHJpbmciLCJtIiwicGF0dGVybjBWYWx1ZTFVbml0c1dpdGhTcGFjZVN0cmluZyIsInBhdHRlcm4wVmFsdWUxVW5pdHNXaXRoU3BhY2UiLCJUQVJHRVRfRElBTUVURVIiLCJUQVJHRVRfV0lEVEgiLCJUQVJHRVRfSEVJR0hUIiwiUkVXQVJEX05PREVfSU5JVElBTF9ZX09GRlNFVCIsIlJFV0FSRF9OT0RFX1lfTU9WRU1FTlQiLCJSRVdBUkRfTk9ERV9HUk9XVEhfQU1PVU5UIiwiVGFyZ2V0Tm9kZSIsImNvbnN0cnVjdG9yIiwidGFyZ2V0IiwidHJhbnNmb3JtUHJvcGVydHkiLCJzY3JlZW5WaWV3IiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInBoZXRpb0lucHV0RW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkIiwidGFuZGVtIiwiUkVRVUlSRUQiLCJwb3NpdGlvblByb3BlcnR5Iiwib3V0ZXJDaXJjbGUiLCJmaWxsIiwic3Ryb2tlIiwibGluZVdpZHRoIiwiZ2V0Iiwidmlld1RvTW9kZWxEZWx0YVgiLCJtaWRkbGVDaXJjbGUiLCJpbm5lckNpcmNsZSIsInRhcmdldFZpZXciLCJwaWNrYWJsZSIsImN1cnNvciIsImNoaWxkcmVuIiwidmlld1JhZGl1cyIsIm1vZGVsVG9WaWV3RGVsdGFYIiwidGFyZ2V0SGVpZ2h0SW5WaWV3Iiwic2V0U2NhbGVNYWduaXR1ZGUiLCJjZW50ZXIiLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwicG9vbCIsImNyZWF0ZSIsImFkZENoaWxkIiwic3RhcnRQb2ludCIsInN0YXJ0WCIsIm1vdXNlUG9pbnQiLCJkcmFnTGlzdGVuZXIiLCJzdGFydCIsImV2ZW50IiwiZ2xvYmFsVG9Mb2NhbFBvaW50IiwicG9pbnRlciIsInBvaW50IiwiY2VudGVyWCIsImRyYWciLCJ4Q2hhbmdlIiwieCIsIm5ld1RhcmdldFgiLCJyb3VuZFN5bW1ldHJpYyIsInZpZXdUb01vZGVsWCIsInNldCIsImNsYW1wIiwicmFuZ2UiLCJtaW4iLCJtYXgiLCJhbGxvd1RvdWNoU25hZyIsImNyZWF0ZVRhbmRlbSIsImFkZElucHV0TGlzdGVuZXIiLCJ1cGRhdGVUYXJnZXRYUmFuZ2UiLCJkaXN0YW5jZVBhdHRlcm4iLCJmaWxsSW4iLCJ1bml0cyIsImRpc3RhbmNlTGFiZWwiLCJOVU1CRVJfRElTUExBWV9PUFRJT05TIiwidGV4dE9wdGlvbnMiLCJ2YWx1ZVBhdHRlcm4iLCJ4TWFyZ2luIiwieU1hcmdpbiIsImRlY2ltYWxQbGFjZXMiLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwicmV3YXJkTm9kZXMiLCJzY29yZWRFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJudW1iZXJPZlN0YXJzIiwicmV3YXJkTm9kZSIsInkiLCJhc3NlcnQiLCJyZXdhcmROb2RlU3RhcnRQb3NpdGlvbiIsImNlbnRlclkiLCJwdXNoIiwicmV3YXJkTm9kZUFuaW1hdGlvbiIsImR1cmF0aW9uIiwiZWFzaW5nIiwiUVVBRFJBVElDX09VVCIsInNldFZhbHVlIiwibmV3WVBvcyIsImFuaW1hdGlvblByb3BvcnRpb25Db21wbGV0ZWQiLCJNYXRoIiwiYWJzIiwib3BhY2l0eSIsImZyb20iLCJ0byIsImZpbmlzaEVtaXR0ZXIiLCJzcGxpY2UiLCJpbmRleE9mIiwiZGlzcG9zZSIsInVwZGF0ZUhvcml6b250YWxQb3NpdGlvbiIsInRhcmdldFgiLCJtb2RlbFRvVmlld1giLCJ0b3AiLCJib3R0b20iLCJmb3JFYWNoIiwibGluayIsInRyYW5zZm9ybSIsIm5ld1JhbmdlIiwibGF5b3V0Qm91bmRzIiwibWluWCIsIm1heFgiLCJzZXRWYWx1ZUFuZFJhbmdlIiwidmFsdWUiLCJyZXNldCIsImhhc0NoaWxkIiwicmVtb3ZlQ2hpbGQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlRhcmdldE5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVmlldyBmb3IgdGhlIHRhcmdldC5cclxuICogWCBwb3NpdGlvbiBjYW4gY2hhbmdlIHdoZW4gdXNlciBkcmFncyB0aGUgY2Fubm9uLCB5IHJlbWFpbnMgY29uc3RhbnQgKG9uIHRoZSBncm91bmQpXHJcbiAqXHJcbiAqIEBhdXRob3IgQW5kcmVhIExpbiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBTY3JlZW5WaWV3IGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zLCBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBTdHJpbmdVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3V0aWwvU3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCBOdW1iZXJEaXNwbGF5LCB7IE51bWJlckRpc3BsYXlPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL051bWJlckRpc3BsYXkuanMnO1xyXG5pbXBvcnQgU3Rhck5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1N0YXJOb2RlLmpzJztcclxuaW1wb3J0IHsgQ2lyY2xlLCBEcmFnTGlzdGVuZXIsIE5vZGUsIE5vZGVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IEFuaW1hdGlvbiBmcm9tICcuLi8uLi8uLi8uLi90d2l4dC9qcy9BbmltYXRpb24uanMnO1xyXG5pbXBvcnQgRWFzaW5nIGZyb20gJy4uLy4uLy4uLy4uL3R3aXh0L2pzL0Vhc2luZy5qcyc7XHJcbmltcG9ydCBwcm9qZWN0aWxlTW90aW9uIGZyb20gJy4uLy4uL3Byb2plY3RpbGVNb3Rpb24uanMnO1xyXG5pbXBvcnQgUHJvamVjdGlsZU1vdGlvblN0cmluZ3MgZnJvbSAnLi4vLi4vUHJvamVjdGlsZU1vdGlvblN0cmluZ3MuanMnO1xyXG5pbXBvcnQgVGFyZ2V0IGZyb20gJy4uL21vZGVsL1RhcmdldC5qcyc7XHJcbmltcG9ydCBQcm9qZWN0aWxlTW90aW9uQ29uc3RhbnRzIGZyb20gJy4uL1Byb2plY3RpbGVNb3Rpb25Db25zdGFudHMuanMnO1xyXG5cclxuY29uc3QgbVN0cmluZyA9IFByb2plY3RpbGVNb3Rpb25TdHJpbmdzLm07XHJcbmNvbnN0IHBhdHRlcm4wVmFsdWUxVW5pdHNXaXRoU3BhY2VTdHJpbmcgPSBQcm9qZWN0aWxlTW90aW9uU3RyaW5ncy5wYXR0ZXJuMFZhbHVlMVVuaXRzV2l0aFNwYWNlO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFRBUkdFVF9ESUFNRVRFUiA9IFByb2plY3RpbGVNb3Rpb25Db25zdGFudHMuVEFSR0VUX1dJRFRIO1xyXG5jb25zdCBUQVJHRVRfSEVJR0hUID0gUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5UQVJHRVRfSEVJR0hUO1xyXG5jb25zdCBSRVdBUkRfTk9ERV9JTklUSUFMX1lfT0ZGU0VUID0gLTEwOyAvLyBpbiBzY3JlZW4gY29vcmRzXHJcbmNvbnN0IFJFV0FSRF9OT0RFX1lfTU9WRU1FTlQgPSA3MDsgLy8gaW4gc2NyZWVuIGNvb3Jkc1xyXG5jb25zdCBSRVdBUkRfTk9ERV9HUk9XVEhfQU1PVU5UID0gMC41OyAvLyBzY2FsZSBmYWN0b3IsIGxhcmdlciA9IG1vcmUgZ3Jvd3RoXHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxuXHJcbnR5cGUgVGFyZ2V0Tm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIE5vZGVPcHRpb25zO1xyXG5cclxuY2xhc3MgVGFyZ2V0Tm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvLyBmb3IgY29vcmRpbmF0ZSB0cmFuc2Zvcm1zIGFzIHdlbGwgYXMgYWRkaW5nIHRoZSBzdGFycyBhcyBjaGlsZHJlblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgc2NyZWVuVmlldzogU2NyZWVuVmlldztcclxuXHJcbiAgLy8gbG9jYWwgdmFyIHRvIGltcHJvdmUgcmVhZGFiaWxpdHlcclxuICBwcml2YXRlIHJlYWRvbmx5IHBvc2l0aW9uUHJvcGVydHk6IE51bWJlclByb3BlcnR5O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdHJhbnNmb3JtUHJvcGVydHk6IFByb3BlcnR5PE1vZGVsVmlld1RyYW5zZm9ybTI+O1xyXG5cclxuICAvLyBrZWVwcyB0cmFjayBvZiByZXdhcmROb2RlcyB0aGF0IGFuaW1hdGUgd2hlbiBwcm9qZWN0aWxlIGhhcyBzY29yZWRcclxuICBwcml2YXRlIHJld2FyZE5vZGVzOiBOb2RlW107XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggdGFyZ2V0OiBUYXJnZXQsIHRyYW5zZm9ybVByb3BlcnR5OiBQcm9wZXJ0eTxNb2RlbFZpZXdUcmFuc2Zvcm0yPiwgc2NyZWVuVmlldzogU2NyZWVuVmlldywgcHJvdmlkZWRPcHRpb25zPzogVGFyZ2V0Tm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxUYXJnZXROb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcbiAgICAgIHBoZXRpb0lucHV0RW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkOiB0cnVlLFxyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnNjcmVlblZpZXcgPSBzY3JlZW5WaWV3O1xyXG4gICAgdGhpcy5wb3NpdGlvblByb3BlcnR5ID0gdGFyZ2V0LnBvc2l0aW9uUHJvcGVydHk7XHJcbiAgICB0aGlzLnRyYW5zZm9ybVByb3BlcnR5ID0gdHJhbnNmb3JtUHJvcGVydHk7XHJcblxyXG4gICAgLy8gcmVkIGFuZCB3aGl0ZSBjaXJjbGVzIG9mIHRoZSB0YXJnZXRcclxuICAgIGNvbnN0IG91dGVyQ2lyY2xlID0gbmV3IENpcmNsZSggMSwge1xyXG4gICAgICBmaWxsOiAncmVkJyxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lV2lkdGg6IHRoaXMudHJhbnNmb3JtUHJvcGVydHkuZ2V0KCkudmlld1RvTW9kZWxEZWx0YVgoIDEgKVxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgbWlkZGxlQ2lyY2xlID0gbmV3IENpcmNsZSggMiAvIDMsIHtcclxuICAgICAgZmlsbDogJ3doaXRlJyxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lV2lkdGg6IHRoaXMudHJhbnNmb3JtUHJvcGVydHkuZ2V0KCkudmlld1RvTW9kZWxEZWx0YVgoIDAuNSApXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBpbm5lckNpcmNsZSA9IG5ldyBDaXJjbGUoIDEgLyAzLCB7XHJcbiAgICAgIGZpbGw6ICdyZWQnLFxyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGxpbmVXaWR0aDogdGhpcy50cmFuc2Zvcm1Qcm9wZXJ0eS5nZXQoKS52aWV3VG9Nb2RlbERlbHRhWCggMC41IClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB0YXJnZXQgdmlld1xyXG4gICAgY29uc3QgdGFyZ2V0VmlldyA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIHBpY2thYmxlOiB0cnVlLFxyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgY2hpbGRyZW46IFsgb3V0ZXJDaXJjbGUsIG1pZGRsZUNpcmNsZSwgaW5uZXJDaXJjbGUgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHNjYWxpbmcgdGhlIHRhcmdldCB0byB0aGUgcmlnaHQgc2l6ZVxyXG4gICAgY29uc3Qgdmlld1JhZGl1cyA9IHRoaXMudHJhbnNmb3JtUHJvcGVydHkuZ2V0KCkubW9kZWxUb1ZpZXdEZWx0YVgoIFRBUkdFVF9ESUFNRVRFUiApIC8gMjtcclxuICAgIGNvbnN0IHRhcmdldEhlaWdodEluVmlldyA9IFRBUkdFVF9IRUlHSFQgLyBUQVJHRVRfRElBTUVURVIgKiB2aWV3UmFkaXVzO1xyXG4gICAgdGFyZ2V0Vmlldy5zZXRTY2FsZU1hZ25pdHVkZSggdmlld1JhZGl1cywgdGFyZ2V0SGVpZ2h0SW5WaWV3ICk7XHJcblxyXG4gICAgLy8gY2VudGVyIG9uIG1vZGVsJ3MgcG9zaXRpb25Qcm9wZXJ0eVxyXG4gICAgdGFyZ2V0Vmlldy5jZW50ZXIgPSB0aGlzLnRyYW5zZm9ybVByb3BlcnR5LmdldCgpLm1vZGVsVG9WaWV3UG9zaXRpb24oIFZlY3RvcjIucG9vbC5jcmVhdGUoIHRoaXMucG9zaXRpb25Qcm9wZXJ0eS5nZXQoKSwgMCApICk7XHJcblxyXG4gICAgLy8gYWRkIHRhcmdldCB0byBzY2VuZSBncmFwaFxyXG4gICAgdGhpcy5hZGRDaGlsZCggdGFyZ2V0VmlldyApO1xyXG5cclxuICAgIC8vIHZhcmlhYmxlcyB1c2VkIGluIGRyYWcgaGFuZGxlclxyXG4gICAgbGV0IHN0YXJ0UG9pbnQ6IFZlY3RvcjI7XHJcbiAgICBsZXQgc3RhcnRYOiBudW1iZXI7XHJcbiAgICBsZXQgbW91c2VQb2ludDtcclxuXHJcbiAgICAvLyBIb3Jpem9udGFsIGRyYWcgb25seVxyXG4gICAgY29uc3QgZHJhZ0xpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICBzdGFydDogZXZlbnQgPT4ge1xyXG4gICAgICAgIHN0YXJ0UG9pbnQgPSBzY3JlZW5WaWV3Lmdsb2JhbFRvTG9jYWxQb2ludCggZXZlbnQucG9pbnRlci5wb2ludCApO1xyXG4gICAgICAgIHN0YXJ0WCA9IHRhcmdldFZpZXcuY2VudGVyWDsgLy8gdmlldyB1bml0c1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgZHJhZzogZXZlbnQgPT4ge1xyXG4gICAgICAgIG1vdXNlUG9pbnQgPSBzY3JlZW5WaWV3Lmdsb2JhbFRvTG9jYWxQb2ludCggZXZlbnQucG9pbnRlci5wb2ludCApO1xyXG5cclxuICAgICAgICAvLyBjaGFuZ2UgaW4geCwgdmlldyB1bml0c1xyXG4gICAgICAgIGNvbnN0IHhDaGFuZ2UgPSBtb3VzZVBvaW50LnggLSBzdGFydFBvaW50Lng7XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld1RhcmdldFggPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggdGhpcy50cmFuc2Zvcm1Qcm9wZXJ0eS5nZXQoKS52aWV3VG9Nb2RlbFgoIHN0YXJ0WCArIHhDaGFuZ2UgKSAqIDEwICkgLyAxMDtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkuc2V0KCBVdGlscy5jbGFtcCggbmV3VGFyZ2V0WCwgdGhpcy5wb3NpdGlvblByb3BlcnR5LnJhbmdlLm1pbiwgdGhpcy5wb3NpdGlvblByb3BlcnR5LnJhbmdlLm1heCApICk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBhbGxvd1RvdWNoU25hZzogdHJ1ZSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkcmFnTGlzdGVuZXInIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBkcmFnIHRhcmdldCB0byBjaGFuZ2UgaG9yaXpvbnRhbCBwb3NpdGlvblxyXG4gICAgdGFyZ2V0Vmlldy5hZGRJbnB1dExpc3RlbmVyKCBkcmFnTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIHJhbmdlIGJhc2VkIG9uIHRoZSBjdXJyZW50IHRyYW5zZm9ybVxyXG4gICAgdGhpcy51cGRhdGVUYXJnZXRYUmFuZ2UoIHRoaXMudHJhbnNmb3JtUHJvcGVydHkuZ2V0KCkgKTtcclxuXHJcbiAgICAvLyB0ZXh0IHJlYWRvdXQgZm9yIGhvcml6b250YWwgZGlzdGFuY2UgZnJvbSBmaXJlLCB3aGljaCBpcyBvcmlnaW4sIHdoaWNoIGlzIGJhc2Ugb2YgY2Fubm9uXHJcbiAgICBjb25zdCBkaXN0YW5jZVBhdHRlcm4gPSBTdHJpbmdVdGlscy5maWxsSW4oIHBhdHRlcm4wVmFsdWUxVW5pdHNXaXRoU3BhY2VTdHJpbmcsIHsgdW5pdHM6IG1TdHJpbmcgfSApO1xyXG4gICAgY29uc3QgZGlzdGFuY2VMYWJlbCA9IG5ldyBOdW1iZXJEaXNwbGF5KFxyXG4gICAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgIHRoaXMucG9zaXRpb25Qcm9wZXJ0eS5yYW5nZSxcclxuICAgICAgY29tYmluZU9wdGlvbnM8TnVtYmVyRGlzcGxheU9wdGlvbnM+KCB7fSwgUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5OVU1CRVJfRElTUExBWV9PUFRJT05TLCB7XHJcbiAgICAgICAgdGV4dE9wdGlvbnM6IHtcclxuICAgICAgICAgIGZpbGw6ICdibGFjaydcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhbHVlUGF0dGVybjogZGlzdGFuY2VQYXR0ZXJuLFxyXG4gICAgICAgIHhNYXJnaW46IDEwLjUsXHJcbiAgICAgICAgeU1hcmdpbjogMixcclxuICAgICAgICBkZWNpbWFsUGxhY2VzOiAxLFxyXG4gICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbnVtYmVyRGlzcGxheScgKSxcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnVGhlIG51bWJlciBkaXNwbGF5IGluIG1vZGVsIGNvb3JkaW5hdGVzIG9mIGhvdyBmYXIgdGhlIGNhbm5vbiBpcyBmcm9tIHRoZSB0YXJnZXQnXHJcbiAgICAgIH0gKVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBkaXN0YW5jZUxhYmVsICk7XHJcblxyXG4gICAgLy8gZHJhZyB0ZXh0IHRvIGNoYW5nZSBob3Jpem9udGFsIHBvc2l0aW9uXHJcbiAgICBkaXN0YW5jZUxhYmVsLmFkZElucHV0TGlzdGVuZXIoIGRyYWdMaXN0ZW5lciApO1xyXG5cclxuICAgIHRoaXMucmV3YXJkTm9kZXMgPSBbXTtcclxuXHJcbiAgICAvLyBsaXN0ZW4gdG8gbW9kZWwgZm9yIHdoZXRoZXIgdGFyZ2V0IGluZGljYXRvciBzaG91bGQgYmUgc2hvd25cclxuICAgIHRhcmdldC5zY29yZWRFbWl0dGVyLmFkZExpc3RlbmVyKCBudW1iZXJPZlN0YXJzID0+IHtcclxuXHJcbiAgICAgIGxldCByZXdhcmROb2RlOiBOb2RlO1xyXG4gICAgICBpZiAoIG51bWJlck9mU3RhcnMgPT09IDEgKSB7XHJcbiAgICAgICAgcmV3YXJkTm9kZSA9IG5ldyBOb2RlKCB7XHJcbiAgICAgICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgICAgICBuZXcgU3Rhck5vZGUoIHsgeDogMCwgeTogLTMwIH0gKVxyXG4gICAgICAgICAgXVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggbnVtYmVyT2ZTdGFycyA9PT0gMiApIHtcclxuICAgICAgICByZXdhcmROb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgICAgIG5ldyBTdGFyTm9kZSggeyB4OiAtMjAsIHk6IC0yMCB9ICksXHJcbiAgICAgICAgICAgIG5ldyBTdGFyTm9kZSggeyB4OiAyMCwgeTogLTIwIH0gKVxyXG4gICAgICAgICAgXVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBudW1iZXJPZlN0YXJzID09PSAzLCAnMyBzdGFycyBleHBlY3RlZCBoZXJlJyApO1xyXG4gICAgICAgIHJld2FyZE5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICAgICAgbmV3IFN0YXJOb2RlKCB7IHg6IC0zMCwgeTogLTIwIH0gKSxcclxuICAgICAgICAgICAgbmV3IFN0YXJOb2RlKCB7IHg6IDAsIHk6IC0zMCB9ICksXHJcbiAgICAgICAgICAgIG5ldyBTdGFyTm9kZSggeyB4OiAzMCwgeTogLTIwIH0gKVxyXG4gICAgICAgICAgXVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCByZXdhcmROb2RlU3RhcnRQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCB0YXJnZXRWaWV3LmNlbnRlclgsIHRhcmdldFZpZXcuY2VudGVyWSArIFJFV0FSRF9OT0RFX0lOSVRJQUxfWV9PRkZTRVQgKTtcclxuICAgICAgcmV3YXJkTm9kZS5jZW50ZXIgPSByZXdhcmROb2RlU3RhcnRQb3NpdGlvbjtcclxuICAgICAgc2NyZWVuVmlldy5hZGRDaGlsZCggcmV3YXJkTm9kZSApO1xyXG4gICAgICB0aGlzLnJld2FyZE5vZGVzLnB1c2goIHJld2FyZE5vZGUgKTtcclxuXHJcbiAgICAgIC8vIGFuaW1hdGUgdGhlIHJld2FyZCBub2RlIChvbmUgdG8gdGhyZWUgc3RhcnMpIHRvIG1vdmUgdXAsIGV4cGFuZCwgYW5kIGZhZGUgb3V0XHJcbiAgICAgIGNvbnN0IHJld2FyZE5vZGVBbmltYXRpb24gPSBuZXcgQW5pbWF0aW9uKCB7XHJcbiAgICAgICAgZHVyYXRpb246IDEsXHJcbiAgICAgICAgZWFzaW5nOiBFYXNpbmcuUVVBRFJBVElDX09VVCxcclxuICAgICAgICBzZXRWYWx1ZTogKCBuZXdZUG9zOiBudW1iZXIgKSA9PiB7XHJcbiAgICAgICAgICByZXdhcmROb2RlLmNlbnRlclkgPSBuZXdZUG9zO1xyXG4gICAgICAgICAgY29uc3QgYW5pbWF0aW9uUHJvcG9ydGlvbkNvbXBsZXRlZCA9IE1hdGguYWJzKCBuZXdZUG9zIC0gcmV3YXJkTm9kZVN0YXJ0UG9zaXRpb24ueSApIC8gUkVXQVJEX05PREVfWV9NT1ZFTUVOVDtcclxuICAgICAgICAgIHJld2FyZE5vZGUub3BhY2l0eSA9IDEgLSBhbmltYXRpb25Qcm9wb3J0aW9uQ29tcGxldGVkO1xyXG4gICAgICAgICAgcmV3YXJkTm9kZS5zZXRTY2FsZU1hZ25pdHVkZSggMSArICggYW5pbWF0aW9uUHJvcG9ydGlvbkNvbXBsZXRlZCAqIFJFV0FSRF9OT0RFX0dST1dUSF9BTU9VTlQgKSApO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZnJvbTogcmV3YXJkTm9kZVN0YXJ0UG9zaXRpb24ueSxcclxuICAgICAgICB0bzogcmV3YXJkTm9kZVN0YXJ0UG9zaXRpb24ueSAtIFJFV0FSRF9OT0RFX1lfTU9WRU1FTlRcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gcmVtb3ZlIHRoZSByZXdhcmQgbm9kZSB3aGVuIHRoZSBhbmltYXRpb24gZmluaXNoZXNcclxuICAgICAgcmV3YXJkTm9kZUFuaW1hdGlvbi5maW5pc2hFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXdhcmROb2Rlcy5zcGxpY2UoIHRoaXMucmV3YXJkTm9kZXMuaW5kZXhPZiggcmV3YXJkTm9kZSApLCAxICk7XHJcbiAgICAgICAgcmV3YXJkTm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIC8vIGtpY2sgb2ZmIHRoZSBhbmltYXRpb25cclxuICAgICAgcmV3YXJkTm9kZUFuaW1hdGlvbi5zdGFydCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE9ic2VydmUgY2hhbmdlcyBpbiB0aGUgbW9kZWwgaG9yaXpvbnRhbCBwb3NpdGlvbiBhbmQgdXBkYXRlIHRoZSB2aWV3IGNvcnJlc3BvbmRpbmdseVxyXG4gICAgY29uc3QgdXBkYXRlSG9yaXpvbnRhbFBvc2l0aW9uID0gKCB0YXJnZXRYOiBudW1iZXIgKSA9PiB7XHJcbiAgICAgIHRhcmdldFZpZXcuY2VudGVyWCA9IHRoaXMudHJhbnNmb3JtUHJvcGVydHkuZ2V0KCkubW9kZWxUb1ZpZXdYKCB0YXJnZXRYICk7XHJcbiAgICAgIGRpc3RhbmNlTGFiZWwuY2VudGVyWCA9IHRhcmdldFZpZXcuY2VudGVyWDtcclxuICAgICAgZGlzdGFuY2VMYWJlbC50b3AgPSB0YXJnZXRWaWV3LmJvdHRvbSArIDI7XHJcbiAgICAgIHRoaXMucmV3YXJkTm9kZXMuZm9yRWFjaCggcmV3YXJkTm9kZSA9PiB7XHJcbiAgICAgICAgcmV3YXJkTm9kZS54ID0gdGFyZ2V0Vmlldy5jZW50ZXJYO1xyXG4gICAgICB9ICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCB1cGRhdGVIb3Jpem9udGFsUG9zaXRpb24gKTtcclxuXHJcbiAgICAvLyBPYnNlcnZlIGNoYW5nZXMgaW4gdGhlIG1vZGVsVmlld1RyYW5zZm9ybSBhbmQgdXBkYXRlIHRoZSB2aWV3XHJcbiAgICB0aGlzLnRyYW5zZm9ybVByb3BlcnR5LmxpbmsoIHRyYW5zZm9ybSA9PiB7XHJcbiAgICAgIHRoaXMudXBkYXRlVGFyZ2V0WFJhbmdlKCB0cmFuc2Zvcm0gKTtcclxuICAgICAgY29uc3Qgdmlld1JhZGl1cyA9IHRyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggVEFSR0VUX0RJQU1FVEVSICkgLyAyO1xyXG4gICAgICB0YXJnZXRWaWV3LnNldFNjYWxlTWFnbml0dWRlKCB2aWV3UmFkaXVzLCB0YXJnZXRIZWlnaHRJblZpZXcgKTtcclxuICAgICAgdXBkYXRlSG9yaXpvbnRhbFBvc2l0aW9uKCB0aGlzLnBvc2l0aW9uUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBUaGUgbm9kZSBsYXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0sIHNvIGl0cyBsaW5rcy9yZWZlcmVuY2VzIGRvbid0IG5lZWQgdG8gYmUgZGlzcG9zZWRcclxuXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZVRhcmdldFhSYW5nZSggdHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yICk6IHZvaWQge1xyXG5cclxuICAgIGNvbnN0IG5ld1JhbmdlID0gbmV3IFJhbmdlKFxyXG4gICAgICB0cmFuc2Zvcm0udmlld1RvTW9kZWxYKCB0aGlzLnNjcmVlblZpZXcubGF5b3V0Qm91bmRzLm1pblggKSxcclxuICAgICAgdHJhbnNmb3JtLnZpZXdUb01vZGVsWCggdGhpcy5zY3JlZW5WaWV3LmxheW91dEJvdW5kcy5tYXhYIClcclxuICAgICk7XHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkuc2V0VmFsdWVBbmRSYW5nZSggVXRpbHMuY2xhbXAoIHRoaXMucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZSwgbmV3UmFuZ2UubWluLCBuZXdSYW5nZS5tYXggKSwgbmV3UmFuZ2UgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZSBhbmltYXRpb25zXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5yZXdhcmROb2Rlcy5mb3JFYWNoKCByZXdhcmROb2RlID0+IHtcclxuICAgICAgaWYgKCB0aGlzLnNjcmVlblZpZXcuaGFzQ2hpbGQoIHJld2FyZE5vZGUgKSApIHtcclxuICAgICAgICB0aGlzLnNjcmVlblZpZXcucmVtb3ZlQ2hpbGQoIHJld2FyZE5vZGUgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5yZXdhcmROb2RlcyA9IFtdO1xyXG5cclxuICAgIC8vIHJlc2V0IHRoZSByYW5nZSBvZiB0aGUgdGFyZ2V0XHJcbiAgICB0aGlzLnVwZGF0ZVRhcmdldFhSYW5nZSggdGhpcy50cmFuc2Zvcm1Qcm9wZXJ0eS52YWx1ZSApO1xyXG4gIH1cclxufVxyXG5cclxucHJvamVjdGlsZU1vdGlvbi5yZWdpc3RlciggJ1RhcmdldE5vZGUnLCBUYXJnZXROb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBUYXJnZXROb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUlBLE9BQU9BLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBRW5ELE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUEwQix1Q0FBdUM7QUFDbkcsT0FBT0MsV0FBVyxNQUFNLCtDQUErQztBQUV2RSxPQUFPQyxhQUFhLE1BQWdDLDhDQUE4QztBQUNsRyxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLE1BQU0sRUFBRUMsWUFBWSxFQUFFQyxJQUFJLFFBQXFCLG1DQUFtQztBQUMzRixPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLFNBQVMsTUFBTSxtQ0FBbUM7QUFDekQsT0FBT0MsTUFBTSxNQUFNLGdDQUFnQztBQUNuRCxPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFDeEQsT0FBT0MsdUJBQXVCLE1BQU0sa0NBQWtDO0FBRXRFLE9BQU9DLHlCQUF5QixNQUFNLGlDQUFpQztBQUV2RSxN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