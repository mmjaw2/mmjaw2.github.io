// Copyright 2022, University of Colorado Boulder

/**
 * Writes a file with grunt and adds it to git.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

const gitAdd = require('./gitAdd');
const gitIsClean = require('./gitIsClean');
const grunt = require('grunt');
const isGitRepo = require('./isGitRepo');

/**
 * @public
 *
 * @param {string} repo - The repository name
 * @param {string} filePath - File name and potentially path relative to the repo
 * @param {string} content - The content of the file as a string
 * @returns {Promise.<string>} - Stdout
 * @rejects {ExecuteError}
 */
module.exports = async function (repo, filePath, content) {
  const outputFile = `../${repo}/${filePath}`;
  grunt.file.write(outputFile, content);
  if (await isGitRepo(repo)) {
    const fileClean = await gitIsClean(repo, filePath);
    if (!fileClean) {
      await gitAdd(repo, filePath);
    }
  } else {
    console.warn(`${repo} is not a git repository. Skipping gitAdd.`);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnaXRBZGQiLCJyZXF1aXJlIiwiZ2l0SXNDbGVhbiIsImdydW50IiwiaXNHaXRSZXBvIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlcG8iLCJmaWxlUGF0aCIsImNvbnRlbnQiLCJvdXRwdXRGaWxlIiwiZmlsZSIsIndyaXRlIiwiZmlsZUNsZWFuIiwiY29uc29sZSIsIndhcm4iXSwic291cmNlcyI6WyJ3cml0ZUZpbGVBbmRHaXRBZGQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFdyaXRlcyBhIGZpbGUgd2l0aCBncnVudCBhbmQgYWRkcyBpdCB0byBnaXQuXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmNvbnN0IGdpdEFkZCA9IHJlcXVpcmUoICcuL2dpdEFkZCcgKTtcclxuY29uc3QgZ2l0SXNDbGVhbiA9IHJlcXVpcmUoICcuL2dpdElzQ2xlYW4nICk7XHJcbmNvbnN0IGdydW50ID0gcmVxdWlyZSggJ2dydW50JyApO1xyXG5jb25zdCBpc0dpdFJlcG8gPSByZXF1aXJlKCAnLi9pc0dpdFJlcG8nICk7XHJcblxyXG4vKipcclxuICogQHB1YmxpY1xyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVwbyAtIFRoZSByZXBvc2l0b3J5IG5hbWVcclxuICogQHBhcmFtIHtzdHJpbmd9IGZpbGVQYXRoIC0gRmlsZSBuYW1lIGFuZCBwb3RlbnRpYWxseSBwYXRoIHJlbGF0aXZlIHRvIHRoZSByZXBvXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50IC0gVGhlIGNvbnRlbnQgb2YgdGhlIGZpbGUgYXMgYSBzdHJpbmdcclxuICogQHJldHVybnMge1Byb21pc2UuPHN0cmluZz59IC0gU3Rkb3V0XHJcbiAqIEByZWplY3RzIHtFeGVjdXRlRXJyb3J9XHJcbiAqL1xyXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIGZ1bmN0aW9uKCByZXBvLCBmaWxlUGF0aCwgY29udGVudCApIHtcclxuICBjb25zdCBvdXRwdXRGaWxlID0gYC4uLyR7cmVwb30vJHtmaWxlUGF0aH1gO1xyXG4gIGdydW50LmZpbGUud3JpdGUoIG91dHB1dEZpbGUsIGNvbnRlbnQgKTtcclxuXHJcbiAgaWYgKCBhd2FpdCBpc0dpdFJlcG8oIHJlcG8gKSApIHtcclxuICAgIGNvbnN0IGZpbGVDbGVhbiA9IGF3YWl0IGdpdElzQ2xlYW4oIHJlcG8sIGZpbGVQYXRoICk7XHJcbiAgICBpZiAoICFmaWxlQ2xlYW4gKSB7XHJcbiAgICAgIGF3YWl0IGdpdEFkZCggcmVwbywgZmlsZVBhdGggKTtcclxuICAgIH1cclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICBjb25zb2xlLndhcm4oIGAke3JlcG99IGlzIG5vdCBhIGdpdCByZXBvc2l0b3J5LiBTa2lwcGluZyBnaXRBZGQuYCApO1xyXG4gIH1cclxufTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUUsVUFBVyxDQUFDO0FBQ3BDLE1BQU1DLFVBQVUsR0FBR0QsT0FBTyxDQUFFLGNBQWUsQ0FBQztBQUM1QyxNQUFNRSxLQUFLLEdBQUdGLE9BQU8sQ0FBRSxPQUFRLENBQUM7QUFDaEMsTUFBTUcsU0FBUyxHQUFHSCxPQUFPLENBQUUsYUFBYyxDQUFDOztBQUUxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQUksTUFBTSxDQUFDQyxPQUFPLEdBQUcsZ0JBQWdCQyxJQUFJLEVBQUVDLFFBQVEsRUFBRUMsT0FBTyxFQUFHO0VBQ3pELE1BQU1DLFVBQVUsR0FBSSxNQUFLSCxJQUFLLElBQUdDLFFBQVMsRUFBQztFQUMzQ0wsS0FBSyxDQUFDUSxJQUFJLENBQUNDLEtBQUssQ0FBRUYsVUFBVSxFQUFFRCxPQUFRLENBQUM7RUFFdkMsSUFBSyxNQUFNTCxTQUFTLENBQUVHLElBQUssQ0FBQyxFQUFHO0lBQzdCLE1BQU1NLFNBQVMsR0FBRyxNQUFNWCxVQUFVLENBQUVLLElBQUksRUFBRUMsUUFBUyxDQUFDO0lBQ3BELElBQUssQ0FBQ0ssU0FBUyxFQUFHO01BQ2hCLE1BQU1iLE1BQU0sQ0FBRU8sSUFBSSxFQUFFQyxRQUFTLENBQUM7SUFDaEM7RUFDRixDQUFDLE1BQ0k7SUFDSE0sT0FBTyxDQUFDQyxJQUFJLENBQUcsR0FBRVIsSUFBSyw0Q0FBNEMsQ0FBQztFQUNyRTtBQUNGLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=