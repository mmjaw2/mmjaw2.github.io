// Copyright 2021, University of Colorado Boulder

/**
 * Generally a "one-stop shop" for all things needed to update the PhET Codebase. This will:
 * - clone missing repos
 * - pull all repos
 * - set up tracking to the remote (only if needed)
 * - npm update in chipper/perennial/perennial-alias
 * - transpile (see --transpile)
 * - Conduct pull and tracking on all branches associated with the repo (see --allBranches) (useful for doing batch MRs)
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

const cloneMissingRepos = require('../common/cloneMissingRepos');
const execute = require('../common/execute');
const getActiveRepos = require('../common/getActiveRepos');
const getBranches = require('../common/getBranches');
const gitCheckout = require('../common/gitCheckout');
const gitFetch = require('../common/gitFetch');
const gitIsClean = require('../common/gitIsClean');
const gitPullRebase = require('../common/gitPullRebase');
const gitRevParse = require('../common/gitRevParse');
const npmUpdate = require('../common/npmUpdate');
const outputJSAll = require('../common/outputJSAll');
const winston = require('../../../../../../perennial-alias/node_modules/winston');
const _ = require('lodash');
winston.default.transports.console.level = 'error';

// If this is provided, we'll track ALL remote branches, check them out, and pull them (with rebase)
const allBranches = process.argv.includes('--allBranches');

// Additionally run the transpiler after pulling
const transpile = process.argv.includes('--transpile');

// Log all repos, even if nothing changed with them.
const allRepos = process.argv.includes('--all');

// ANSI escape sequences to move to the right (in the same line) or to apply or reset colors
const moveRight = ' \u001b[42G';
const red = '\u001b[31m';
const green = '\u001b[32m';
const reset = '\u001b[0m';
const repos = getActiveRepos();
const data = {};
const getStatus = async repo => {
  data[repo] = '';
  try {
    if (await gitIsClean(repo)) {
      if (allBranches) {
        const branches = await getBranches(repo);
        for (const branch of branches) {
          // Only track the remote branch if it hasn't been tracked yet
          if ((await execute('git', ['rev-parse', '--verify', branch], `../${repo}`, {
            errors: 'resolve'
          })).code !== 0) {
            await gitFetch(repo);
            await execute('git', ['branch', '--track', branch, `origin/${branch}`], `../${repo}`);
          }
          await gitCheckout(repo, branch);
          try {
            await gitPullRebase(repo);
          } catch (e) {
            // Likely there is no tracking info set up on the local branch
            await execute('git', ['branch', `--set-upstream-to=origin/${branch}`, branch], `../${repo}`);
            await gitPullRebase(repo);
          }
        }

        // Go back to main
        await gitCheckout(repo, 'main');
      } else {
        await gitCheckout(repo, 'main');
        await gitPullRebase(repo);
      }
    } else if (repo === 'perennial') {
      console.log(`${red}perennial is not clean, skipping pull${reset}`);
    }
    if (repo === 'perennial') {
      await cloneMissingRepos();
    }
    const symbolicRef = (await execute('git', ['symbolic-ref', '-q', 'HEAD'], `../${repo}`)).trim();
    const branch = symbolicRef.replace('refs/heads/', ''); // might be empty string
    const sha = await gitRevParse(repo, 'HEAD');
    const status = await execute('git', ['status', '--porcelain'], `../${repo}`);
    const track = branch ? (await execute('git', ['for-each-ref', '--format=%(push:track,nobracket)', symbolicRef], `../${repo}`)).trim() : '';
    let isGreen = false;
    if (branch) {
      isGreen = !status && branch === 'main' && !track.length;
      if (!isGreen || allRepos) {
        data[repo] += `${repo}${moveRight}${isGreen ? green : red}${branch}${reset} ${track}\n`;
      }
    } else {
      // if no branch, print our SHA (detached head)
      data[repo] += `${repo}${moveRight}${red}${sha}${reset}\n`;
    }
    if (status) {
      if (!isGreen || allRepos) {
        data[repo] += status + '\n';
      }
    }
  } catch (e) {
    data[repo] += `${repo} ERROR: ${e}`;
  }
};
(async () => {
  await Promise.all(repos.map(repo => getStatus(repo)));
  repos.forEach(repo => {
    process.stdout.write(data[repo]);
  });
  console.log(`${_.every(repos, repo => !data[repo].length) ? green : red}-----=====] finished pulls [=====-----${reset}\n`);
  await npmUpdate('chipper');
  await npmUpdate('perennial');
  await npmUpdate('perennial-alias');
  console.log(`${_.every(repos, repo => !data[repo].length) ? green : red}-----=====] finished npm [=====-----${reset}\n`);
  if (transpile) {
    await outputJSAll();
    console.log(`${_.every(repos, repo => !data[repo].length) ? green : red}-----=====] finished transpile [=====-----${reset}\n`);
  }
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjbG9uZU1pc3NpbmdSZXBvcyIsInJlcXVpcmUiLCJleGVjdXRlIiwiZ2V0QWN0aXZlUmVwb3MiLCJnZXRCcmFuY2hlcyIsImdpdENoZWNrb3V0IiwiZ2l0RmV0Y2giLCJnaXRJc0NsZWFuIiwiZ2l0UHVsbFJlYmFzZSIsImdpdFJldlBhcnNlIiwibnBtVXBkYXRlIiwib3V0cHV0SlNBbGwiLCJ3aW5zdG9uIiwiXyIsImRlZmF1bHQiLCJ0cmFuc3BvcnRzIiwiY29uc29sZSIsImxldmVsIiwiYWxsQnJhbmNoZXMiLCJwcm9jZXNzIiwiYXJndiIsImluY2x1ZGVzIiwidHJhbnNwaWxlIiwiYWxsUmVwb3MiLCJtb3ZlUmlnaHQiLCJyZWQiLCJncmVlbiIsInJlc2V0IiwicmVwb3MiLCJkYXRhIiwiZ2V0U3RhdHVzIiwicmVwbyIsImJyYW5jaGVzIiwiYnJhbmNoIiwiZXJyb3JzIiwiY29kZSIsImUiLCJsb2ciLCJzeW1ib2xpY1JlZiIsInRyaW0iLCJyZXBsYWNlIiwic2hhIiwic3RhdHVzIiwidHJhY2siLCJpc0dyZWVuIiwibGVuZ3RoIiwiUHJvbWlzZSIsImFsbCIsIm1hcCIsImZvckVhY2giLCJzdGRvdXQiLCJ3cml0ZSIsImV2ZXJ5Il0sInNvdXJjZXMiOlsibWFpbi1wdWxsLXN0YXR1cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogR2VuZXJhbGx5IGEgXCJvbmUtc3RvcCBzaG9wXCIgZm9yIGFsbCB0aGluZ3MgbmVlZGVkIHRvIHVwZGF0ZSB0aGUgUGhFVCBDb2RlYmFzZS4gVGhpcyB3aWxsOlxyXG4gKiAtIGNsb25lIG1pc3NpbmcgcmVwb3NcclxuICogLSBwdWxsIGFsbCByZXBvc1xyXG4gKiAtIHNldCB1cCB0cmFja2luZyB0byB0aGUgcmVtb3RlIChvbmx5IGlmIG5lZWRlZClcclxuICogLSBucG0gdXBkYXRlIGluIGNoaXBwZXIvcGVyZW5uaWFsL3BlcmVubmlhbC1hbGlhc1xyXG4gKiAtIHRyYW5zcGlsZSAoc2VlIC0tdHJhbnNwaWxlKVxyXG4gKiAtIENvbmR1Y3QgcHVsbCBhbmQgdHJhY2tpbmcgb24gYWxsIGJyYW5jaGVzIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVwbyAoc2VlIC0tYWxsQnJhbmNoZXMpICh1c2VmdWwgZm9yIGRvaW5nIGJhdGNoIE1ScylcclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmNvbnN0IGNsb25lTWlzc2luZ1JlcG9zID0gcmVxdWlyZSggJy4uL2NvbW1vbi9jbG9uZU1pc3NpbmdSZXBvcycgKTtcclxuY29uc3QgZXhlY3V0ZSA9IHJlcXVpcmUoICcuLi9jb21tb24vZXhlY3V0ZScgKTtcclxuY29uc3QgZ2V0QWN0aXZlUmVwb3MgPSByZXF1aXJlKCAnLi4vY29tbW9uL2dldEFjdGl2ZVJlcG9zJyApO1xyXG5jb25zdCBnZXRCcmFuY2hlcyA9IHJlcXVpcmUoICcuLi9jb21tb24vZ2V0QnJhbmNoZXMnICk7XHJcbmNvbnN0IGdpdENoZWNrb3V0ID0gcmVxdWlyZSggJy4uL2NvbW1vbi9naXRDaGVja291dCcgKTtcclxuY29uc3QgZ2l0RmV0Y2ggPSByZXF1aXJlKCAnLi4vY29tbW9uL2dpdEZldGNoJyApO1xyXG5jb25zdCBnaXRJc0NsZWFuID0gcmVxdWlyZSggJy4uL2NvbW1vbi9naXRJc0NsZWFuJyApO1xyXG5jb25zdCBnaXRQdWxsUmViYXNlID0gcmVxdWlyZSggJy4uL2NvbW1vbi9naXRQdWxsUmViYXNlJyApO1xyXG5jb25zdCBnaXRSZXZQYXJzZSA9IHJlcXVpcmUoICcuLi9jb21tb24vZ2l0UmV2UGFyc2UnICk7XHJcbmNvbnN0IG5wbVVwZGF0ZSA9IHJlcXVpcmUoICcuLi9jb21tb24vbnBtVXBkYXRlJyApO1xyXG5jb25zdCBvdXRwdXRKU0FsbCA9IHJlcXVpcmUoICcuLi9jb21tb24vb3V0cHV0SlNBbGwnICk7XHJcbmNvbnN0IHdpbnN0b24gPSByZXF1aXJlKCAnd2luc3RvbicgKTtcclxuY29uc3QgXyA9IHJlcXVpcmUoICdsb2Rhc2gnICk7XHJcblxyXG53aW5zdG9uLmRlZmF1bHQudHJhbnNwb3J0cy5jb25zb2xlLmxldmVsID0gJ2Vycm9yJztcclxuXHJcbi8vIElmIHRoaXMgaXMgcHJvdmlkZWQsIHdlJ2xsIHRyYWNrIEFMTCByZW1vdGUgYnJhbmNoZXMsIGNoZWNrIHRoZW0gb3V0LCBhbmQgcHVsbCB0aGVtICh3aXRoIHJlYmFzZSlcclxuY29uc3QgYWxsQnJhbmNoZXMgPSBwcm9jZXNzLmFyZ3YuaW5jbHVkZXMoICctLWFsbEJyYW5jaGVzJyApO1xyXG5cclxuLy8gQWRkaXRpb25hbGx5IHJ1biB0aGUgdHJhbnNwaWxlciBhZnRlciBwdWxsaW5nXHJcbmNvbnN0IHRyYW5zcGlsZSA9IHByb2Nlc3MuYXJndi5pbmNsdWRlcyggJy0tdHJhbnNwaWxlJyApO1xyXG5cclxuLy8gTG9nIGFsbCByZXBvcywgZXZlbiBpZiBub3RoaW5nIGNoYW5nZWQgd2l0aCB0aGVtLlxyXG5jb25zdCBhbGxSZXBvcyA9IHByb2Nlc3MuYXJndi5pbmNsdWRlcyggJy0tYWxsJyApO1xyXG5cclxuLy8gQU5TSSBlc2NhcGUgc2VxdWVuY2VzIHRvIG1vdmUgdG8gdGhlIHJpZ2h0IChpbiB0aGUgc2FtZSBsaW5lKSBvciB0byBhcHBseSBvciByZXNldCBjb2xvcnNcclxuY29uc3QgbW92ZVJpZ2h0ID0gJyBcXHUwMDFiWzQyRyc7XHJcbmNvbnN0IHJlZCA9ICdcXHUwMDFiWzMxbSc7XHJcbmNvbnN0IGdyZWVuID0gJ1xcdTAwMWJbMzJtJztcclxuY29uc3QgcmVzZXQgPSAnXFx1MDAxYlswbSc7XHJcblxyXG5jb25zdCByZXBvcyA9IGdldEFjdGl2ZVJlcG9zKCk7XHJcbmNvbnN0IGRhdGEgPSB7fTtcclxuXHJcbmNvbnN0IGdldFN0YXR1cyA9IGFzeW5jIHJlcG8gPT4ge1xyXG4gIGRhdGFbIHJlcG8gXSA9ICcnO1xyXG5cclxuICB0cnkge1xyXG4gICAgaWYgKCBhd2FpdCBnaXRJc0NsZWFuKCByZXBvICkgKSB7XHJcbiAgICAgIGlmICggYWxsQnJhbmNoZXMgKSB7XHJcbiAgICAgICAgY29uc3QgYnJhbmNoZXMgPSBhd2FpdCBnZXRCcmFuY2hlcyggcmVwbyApO1xyXG4gICAgICAgIGZvciAoIGNvbnN0IGJyYW5jaCBvZiBicmFuY2hlcyApIHtcclxuICAgICAgICAgIC8vIE9ubHkgdHJhY2sgdGhlIHJlbW90ZSBicmFuY2ggaWYgaXQgaGFzbid0IGJlZW4gdHJhY2tlZCB5ZXRcclxuICAgICAgICAgIGlmICggKCBhd2FpdCBleGVjdXRlKCAnZ2l0JywgWyAncmV2LXBhcnNlJywgJy0tdmVyaWZ5JywgYnJhbmNoIF0sIGAuLi8ke3JlcG99YCwgeyBlcnJvcnM6ICdyZXNvbHZlJyB9ICkgKS5jb2RlICE9PSAwICkge1xyXG4gICAgICAgICAgICBhd2FpdCBnaXRGZXRjaCggcmVwbyApO1xyXG4gICAgICAgICAgICBhd2FpdCBleGVjdXRlKCAnZ2l0JywgWyAnYnJhbmNoJywgJy0tdHJhY2snLCBicmFuY2gsIGBvcmlnaW4vJHticmFuY2h9YCBdLCBgLi4vJHtyZXBvfWAgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGF3YWl0IGdpdENoZWNrb3V0KCByZXBvLCBicmFuY2ggKTtcclxuXHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCBnaXRQdWxsUmViYXNlKCByZXBvICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjYXRjaCggZSApIHtcclxuXHJcbiAgICAgICAgICAgIC8vIExpa2VseSB0aGVyZSBpcyBubyB0cmFja2luZyBpbmZvIHNldCB1cCBvbiB0aGUgbG9jYWwgYnJhbmNoXHJcbiAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGUoICdnaXQnLCBbICdicmFuY2gnLCBgLS1zZXQtdXBzdHJlYW0tdG89b3JpZ2luLyR7YnJhbmNofWAsIGJyYW5jaCBdLCBgLi4vJHtyZXBvfWAgKTtcclxuICAgICAgICAgICAgYXdhaXQgZ2l0UHVsbFJlYmFzZSggcmVwbyApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gR28gYmFjayB0byBtYWluXHJcbiAgICAgICAgYXdhaXQgZ2l0Q2hlY2tvdXQoIHJlcG8sICdtYWluJyApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IGdpdENoZWNrb3V0KCByZXBvLCAnbWFpbicgKTtcclxuICAgICAgICBhd2FpdCBnaXRQdWxsUmViYXNlKCByZXBvICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCByZXBvID09PSAncGVyZW5uaWFsJyApIHtcclxuICAgICAgY29uc29sZS5sb2coIGAke3JlZH1wZXJlbm5pYWwgaXMgbm90IGNsZWFuLCBza2lwcGluZyBwdWxsJHtyZXNldH1gICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCByZXBvID09PSAncGVyZW5uaWFsJyApIHtcclxuICAgICAgYXdhaXQgY2xvbmVNaXNzaW5nUmVwb3MoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzeW1ib2xpY1JlZiA9ICggYXdhaXQgZXhlY3V0ZSggJ2dpdCcsIFsgJ3N5bWJvbGljLXJlZicsICctcScsICdIRUFEJyBdLCBgLi4vJHtyZXBvfWAgKSApLnRyaW0oKTtcclxuICAgIGNvbnN0IGJyYW5jaCA9IHN5bWJvbGljUmVmLnJlcGxhY2UoICdyZWZzL2hlYWRzLycsICcnICk7IC8vIG1pZ2h0IGJlIGVtcHR5IHN0cmluZ1xyXG4gICAgY29uc3Qgc2hhID0gYXdhaXQgZ2l0UmV2UGFyc2UoIHJlcG8sICdIRUFEJyApO1xyXG4gICAgY29uc3Qgc3RhdHVzID0gYXdhaXQgZXhlY3V0ZSggJ2dpdCcsIFsgJ3N0YXR1cycsICctLXBvcmNlbGFpbicgXSwgYC4uLyR7cmVwb31gICk7XHJcbiAgICBjb25zdCB0cmFjayA9IGJyYW5jaCA/ICggYXdhaXQgZXhlY3V0ZSggJ2dpdCcsIFsgJ2Zvci1lYWNoLXJlZicsICctLWZvcm1hdD0lKHB1c2g6dHJhY2ssbm9icmFja2V0KScsIHN5bWJvbGljUmVmIF0sIGAuLi8ke3JlcG99YCApICkudHJpbSgpIDogJyc7XHJcblxyXG4gICAgbGV0IGlzR3JlZW4gPSBmYWxzZTtcclxuICAgIGlmICggYnJhbmNoICkge1xyXG4gICAgICBpc0dyZWVuID0gIXN0YXR1cyAmJiBicmFuY2ggPT09ICdtYWluJyAmJiAhdHJhY2subGVuZ3RoO1xyXG5cclxuICAgICAgaWYgKCAhaXNHcmVlbiB8fCBhbGxSZXBvcyApIHtcclxuICAgICAgICBkYXRhWyByZXBvIF0gKz0gYCR7cmVwb30ke21vdmVSaWdodH0ke2lzR3JlZW4gPyBncmVlbiA6IHJlZH0ke2JyYW5jaH0ke3Jlc2V0fSAke3RyYWNrfVxcbmA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBpZiBubyBicmFuY2gsIHByaW50IG91ciBTSEEgKGRldGFjaGVkIGhlYWQpXHJcbiAgICAgIGRhdGFbIHJlcG8gXSArPSBgJHtyZXBvfSR7bW92ZVJpZ2h0fSR7cmVkfSR7c2hhfSR7cmVzZXR9XFxuYDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHN0YXR1cyApIHtcclxuICAgICAgaWYgKCAhaXNHcmVlbiB8fCBhbGxSZXBvcyApIHtcclxuICAgICAgICBkYXRhWyByZXBvIF0gKz0gc3RhdHVzICsgJ1xcbic7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgY2F0Y2goIGUgKSB7XHJcbiAgICBkYXRhWyByZXBvIF0gKz0gYCR7cmVwb30gRVJST1I6ICR7ZX1gO1xyXG4gIH1cclxufTtcclxuXHJcbiggYXN5bmMgKCkgPT4ge1xyXG4gIGF3YWl0IFByb21pc2UuYWxsKCByZXBvcy5tYXAoIHJlcG8gPT4gZ2V0U3RhdHVzKCByZXBvICkgKSApO1xyXG5cclxuICByZXBvcy5mb3JFYWNoKCByZXBvID0+IHtcclxuICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCBkYXRhWyByZXBvIF0gKTtcclxuICB9ICk7XHJcblxyXG4gIGNvbnNvbGUubG9nKCBgJHtfLmV2ZXJ5KCByZXBvcywgcmVwbyA9PiAhZGF0YVsgcmVwbyBdLmxlbmd0aCApID8gZ3JlZW4gOiByZWR9LS0tLS09PT09PV0gZmluaXNoZWQgcHVsbHMgWz09PT09LS0tLS0ke3Jlc2V0fVxcbmAgKTtcclxuXHJcbiAgYXdhaXQgbnBtVXBkYXRlKCAnY2hpcHBlcicgKTtcclxuICBhd2FpdCBucG1VcGRhdGUoICdwZXJlbm5pYWwnICk7XHJcbiAgYXdhaXQgbnBtVXBkYXRlKCAncGVyZW5uaWFsLWFsaWFzJyApO1xyXG5cclxuICBjb25zb2xlLmxvZyggYCR7Xy5ldmVyeSggcmVwb3MsIHJlcG8gPT4gIWRhdGFbIHJlcG8gXS5sZW5ndGggKSA/IGdyZWVuIDogcmVkfS0tLS0tPT09PT1dIGZpbmlzaGVkIG5wbSBbPT09PT0tLS0tLSR7cmVzZXR9XFxuYCApO1xyXG5cclxuICBpZiAoIHRyYW5zcGlsZSApIHtcclxuICAgIGF3YWl0IG91dHB1dEpTQWxsKCk7XHJcblxyXG4gICAgY29uc29sZS5sb2coIGAke18uZXZlcnkoIHJlcG9zLCByZXBvID0+ICFkYXRhWyByZXBvIF0ubGVuZ3RoICkgPyBncmVlbiA6IHJlZH0tLS0tLT09PT09XSBmaW5pc2hlZCB0cmFuc3BpbGUgWz09PT09LS0tLS0ke3Jlc2V0fVxcbmAgKTtcclxuICB9XHJcbn0gKSgpOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxpQkFBaUIsR0FBR0MsT0FBTyxDQUFFLDZCQUE4QixDQUFDO0FBQ2xFLE1BQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFFLG1CQUFvQixDQUFDO0FBQzlDLE1BQU1FLGNBQWMsR0FBR0YsT0FBTyxDQUFFLDBCQUEyQixDQUFDO0FBQzVELE1BQU1HLFdBQVcsR0FBR0gsT0FBTyxDQUFF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