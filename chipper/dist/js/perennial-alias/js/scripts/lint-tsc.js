// Copyright 2021, University of Colorado Boulder

/**
 * Lints and typechecks, reporting any errors
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

const execute = require('../common/execute');
const gruntCommand = require('../common/gruntCommand');
const winston = require('../../../../../../perennial-alias/node_modules/winston');
winston.default.transports.console.level = 'error';

// ANSI escape sequences to move to the right (in the same line) or to apply or reset colors
const red = '\u001b[31m';
const green = '\u001b[32m';
const reset = '\u001b[0m';
(async () => {
  // {code:number,stdout:string,stderr:string}
  let lintResults = null;
  let tscResults = null;
  const outputResult = (name, results) => {
    if (results.code === 0) {
      console.log(`${green}${name} OK${reset}`);
    } else {
      console.log(`${red}${name} FAIL${reset}`);
      if (results.stdout.trim().length > 0) {
        console.log(results.stdout);
      }
      if (results.stderr.trim().length > 0) {
        console.log(results.stderr);
      }
    }
  };
  const runLint = async () => {
    lintResults = await execute(gruntCommand, ['lint-everything'], '../perennial', {
      errors: 'resolve'
    });
    outputResult('lint', lintResults);
  };
  const runTsc = async () => {
    tscResults = await execute('node', ['--max-old-space-size=8192', '../../node_modules/typescript/bin/tsc'], '../chipper/tsconfig/all', {
      errors: 'resolve'
    });
    outputResult('tsc', tscResults);
  };
  const runAPIChecks = async () => {
    lintResults = await execute(gruntCommand, ['generate-phet-io-api', '--stable'], '../chipper', {
      errors: 'resolve'
    });
    outputResult('generate-phet-io-api', lintResults);
  };
  await Promise.all([runLint(), runTsc(), runAPIChecks()]);
  console.log(`\n${lintResults.code === 0 && tscResults.code === 0 ? green : red}-----=====] finished [=====-----${reset}\n`);
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleGVjdXRlIiwicmVxdWlyZSIsImdydW50Q29tbWFuZCIsIndpbnN0b24iLCJkZWZhdWx0IiwidHJhbnNwb3J0cyIsImNvbnNvbGUiLCJsZXZlbCIsInJlZCIsImdyZWVuIiwicmVzZXQiLCJsaW50UmVzdWx0cyIsInRzY1Jlc3VsdHMiLCJvdXRwdXRSZXN1bHQiLCJuYW1lIiwicmVzdWx0cyIsImNvZGUiLCJsb2ciLCJzdGRvdXQiLCJ0cmltIiwibGVuZ3RoIiwic3RkZXJyIiwicnVuTGludCIsImVycm9ycyIsInJ1blRzYyIsInJ1bkFQSUNoZWNrcyIsIlByb21pc2UiLCJhbGwiXSwic291cmNlcyI6WyJsaW50LXRzYy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTGludHMgYW5kIHR5cGVjaGVja3MsIHJlcG9ydGluZyBhbnkgZXJyb3JzXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5jb25zdCBleGVjdXRlID0gcmVxdWlyZSggJy4uL2NvbW1vbi9leGVjdXRlJyApO1xyXG5jb25zdCBncnVudENvbW1hbmQgPSByZXF1aXJlKCAnLi4vY29tbW9uL2dydW50Q29tbWFuZCcgKTtcclxuY29uc3Qgd2luc3RvbiA9IHJlcXVpcmUoICd3aW5zdG9uJyApO1xyXG5cclxud2luc3Rvbi5kZWZhdWx0LnRyYW5zcG9ydHMuY29uc29sZS5sZXZlbCA9ICdlcnJvcic7XHJcblxyXG4vLyBBTlNJIGVzY2FwZSBzZXF1ZW5jZXMgdG8gbW92ZSB0byB0aGUgcmlnaHQgKGluIHRoZSBzYW1lIGxpbmUpIG9yIHRvIGFwcGx5IG9yIHJlc2V0IGNvbG9yc1xyXG5jb25zdCByZWQgPSAnXFx1MDAxYlszMW0nO1xyXG5jb25zdCBncmVlbiA9ICdcXHUwMDFiWzMybSc7XHJcbmNvbnN0IHJlc2V0ID0gJ1xcdTAwMWJbMG0nO1xyXG5cclxuKCBhc3luYyAoKSA9PiB7XHJcblxyXG4gIC8vIHtjb2RlOm51bWJlcixzdGRvdXQ6c3RyaW5nLHN0ZGVycjpzdHJpbmd9XHJcbiAgbGV0IGxpbnRSZXN1bHRzID0gbnVsbDtcclxuICBsZXQgdHNjUmVzdWx0cyA9IG51bGw7XHJcblxyXG4gIGNvbnN0IG91dHB1dFJlc3VsdCA9ICggbmFtZSwgcmVzdWx0cyApID0+IHtcclxuICAgIGlmICggcmVzdWx0cy5jb2RlID09PSAwICkge1xyXG4gICAgICBjb25zb2xlLmxvZyggYCR7Z3JlZW59JHtuYW1lfSBPSyR7cmVzZXR9YCApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCBgJHtyZWR9JHtuYW1lfSBGQUlMJHtyZXNldH1gICk7XHJcblxyXG4gICAgICBpZiAoIHJlc3VsdHMuc3Rkb3V0LnRyaW0oKS5sZW5ndGggPiAwICkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCByZXN1bHRzLnN0ZG91dCApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggcmVzdWx0cy5zdGRlcnIudHJpbSgpLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coIHJlc3VsdHMuc3RkZXJyICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBydW5MaW50ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgbGludFJlc3VsdHMgPSBhd2FpdCBleGVjdXRlKCBncnVudENvbW1hbmQsIFsgJ2xpbnQtZXZlcnl0aGluZycgXSwgJy4uL3BlcmVubmlhbCcsIHtcclxuICAgICAgZXJyb3JzOiAncmVzb2x2ZSdcclxuICAgIH0gKTtcclxuICAgIG91dHB1dFJlc3VsdCggJ2xpbnQnLCBsaW50UmVzdWx0cyApO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJ1blRzYyA9IGFzeW5jICgpID0+IHtcclxuICAgIHRzY1Jlc3VsdHMgPSBhd2FpdCBleGVjdXRlKCAnbm9kZScsIFsgJy0tbWF4LW9sZC1zcGFjZS1zaXplPTgxOTInLCAnLi4vLi4vbm9kZV9tb2R1bGVzL3R5cGVzY3JpcHQvYmluL3RzYycgXSwgJy4uL2NoaXBwZXIvdHNjb25maWcvYWxsJywge1xyXG4gICAgICBlcnJvcnM6ICdyZXNvbHZlJ1xyXG4gICAgfSApO1xyXG4gICAgb3V0cHV0UmVzdWx0KCAndHNjJywgdHNjUmVzdWx0cyApO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJ1bkFQSUNoZWNrcyA9IGFzeW5jICgpID0+IHtcclxuICAgIGxpbnRSZXN1bHRzID0gYXdhaXQgZXhlY3V0ZSggZ3J1bnRDb21tYW5kLCBbICdnZW5lcmF0ZS1waGV0LWlvLWFwaScsICctLXN0YWJsZScgXSwgJy4uL2NoaXBwZXInLCB7XHJcbiAgICAgIGVycm9yczogJ3Jlc29sdmUnXHJcbiAgICB9ICk7XHJcbiAgICBvdXRwdXRSZXN1bHQoICdnZW5lcmF0ZS1waGV0LWlvLWFwaScsIGxpbnRSZXN1bHRzICk7XHJcbiAgfTtcclxuXHJcbiAgYXdhaXQgUHJvbWlzZS5hbGwoIFsgcnVuTGludCgpLCBydW5Uc2MoKSwgcnVuQVBJQ2hlY2tzKCkgXSApO1xyXG5cclxuICBjb25zb2xlLmxvZyggYFxcbiR7bGludFJlc3VsdHMuY29kZSA9PT0gMCAmJiB0c2NSZXN1bHRzLmNvZGUgPT09IDAgPyBncmVlbiA6IHJlZH0tLS0tLT09PT09XSBmaW5pc2hlZCBbPT09PT0tLS0tLSR7cmVzZXR9XFxuYCApO1xyXG59ICkoKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUUsbUJBQW9CLENBQUM7QUFDOUMsTUFBTUMsWUFBWSxHQUFHRCxPQUFPLENBQUUsd0JBQXlCLENBQUM7QUFDeEQsTUFBTUUsT0FBTyxHQUFHRixPQUFPLENBQUUsU0FBVSxDQUFDO0FBRXBDRSxPQUFPLENBQUNDLE9BQU8sQ0FBQ0MsVUFBVSxDQUFD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