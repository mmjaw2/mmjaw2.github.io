// Copyright 2002-2017, University of Colorado Boulder

/**
 * PhET build and deploy server. The server is designed to run on the same host as the production site (phet-server.int.colorado.edu).
 * This file initializes the app and the main process queue.
 *
 * @author Aaron Davis
 * @author Matt Pennington
 */

const constants = require('./constants');
const childProcess = require('child_process'); // eslint-disable-line require-statement-match
const winston = require('./log.js'); // eslint-disable-line require-statement-match
const logRequest = require('./logRequest');
const sendEmail = require('./sendEmail');
const taskWorker = require('./taskWorker');
const async = require('async');
const bodyParser = require('body-parser'); // eslint-disable-line require-statement-match
const express = require('express');
const _ = require('lodash');
const parseArgs = require('minimist'); // eslint-disable-line require-statement-match
const persistentQueue = require('./persistentQueue');
const getStatus = require('./getStatus');

// set this process up with the appropriate permissions, value is in octal
process.umask(0o0002);

/**
 * Handle command line input
 * First 2 args provide info about executables, ignore
 */
const parsedCommandLineOptions = parseArgs(process.argv.slice(2), {
  boolean: true
});
const defaultOptions = {
  verbose: constants.BUILD_SERVER_CONFIG.verbose,
  // can be overridden by a flag on the command line

  // options for supporting help
  help: false,
  h: false
};
for (const key in parsedCommandLineOptions) {
  if (key !== '_' && parsedCommandLineOptions.hasOwnProperty(key) && !defaultOptions.hasOwnProperty(key)) {
    console.error(`Unrecognized option: ${key}`);
    console.error('try --help for usage information.');
    process.exit(1);
  }
}

// If help flag, print help and usage info
if (parsedCommandLineOptions.hasOwnProperty('help') || parsedCommandLineOptions.hasOwnProperty('h')) {
  console.log('Usage:');
  console.log('  node build-server.js [options]');
  console.log('');
  console.log('Options:');
  console.log('  --help (print usage and exit)\n' + '    type: bool  default: false\n' + '  --verbose (output grunt logs in addition to build-server)\n' + '    type: bool  default: false\n');
  process.exit(1);
}

// Merge the default and supplied options.
const options = _.assignIn(defaultOptions, parsedCommandLineOptions);
const verbose = options.verbose;
const taskQueue = async.queue(taskWorker, 1); // 1 is the max number of tasks that can run concurrently

/**
 * Handle chipper 1.0 requests
 *
 * @param {express.Request} req
 * @param {express.Response} res
 * @param {String} key - one of 'query' or 'body', used to differentiate query parameters or POST data.
 */
const queueDeployApiVersion1 = (req, res, key) => {
  const repos = JSON.parse(decodeURIComponent(req[key][constants.REPOS_KEY]));
  const simName = decodeURIComponent(req[key][constants.SIM_NAME_KEY]);
  const version = decodeURIComponent(req[key][constants.VERSION_KEY]);
  const locales = decodeURIComponent(req[key][constants.LOCALES_KEY]) || null;
  const option = decodeURIComponent(req[key][constants.OPTION_KEY]) || 'default';
  const email = decodeURIComponent(req[key][constants.EMAIL_KEY]) || null;
  const translatorId = decodeURIComponent(req[key][constants.USER_ID_KEY]) || null;
  const authorizationKey = decodeURIComponent(req[key][constants.AUTHORIZATION_KEY]);
  const branch = decodeURIComponent(req[key][constants.BRANCH_KEY]) || repos[simName].branch;

  // TODO https://github.com/phetsims/perennial/issues/167 determine if this comment needs updating for chipper 1.0 deploys
  // For RC deploys, only send to the dev server.  For production deploys, the local build will send to the dev server so the build-server
  // only sends to the production server (phet-server2).
  const servers = option === 'rc' ? [constants.DEV_SERVER] : [constants.PRODUCTION_SERVER];
  const brands = version.indexOf('phetio') < 0 ? [constants.PHET_BRAND] : [constants.PHET_IO_BRAND];
  queueDeploy('1.0', repos, simName, version, locales, brands, servers, email, translatorId, branch, authorizationKey, req, res);
};
const getQueueDeploy = (req, res) => {
  logRequest(req, 'query', winston);
  queueDeployApiVersion1(req, res, 'query');
};
const postQueueDeploy = (req, res) => {
  logRequest(req, 'body', winston);
  const api = decodeURIComponent(req.body[constants.API_KEY]);
  if (api && api.startsWith('2.')) {
    const repos = JSON.parse(req.body[constants.DEPENDENCIES_KEY]);
    const simName = req.body[constants.SIM_NAME_KEY];
    const version = req.body[constants.VERSION_KEY];
    const locales = req.body[constants.LOCALES_KEY] || null;
    const servers = req.body[constants.SERVERS_KEY];
    const brands = req.body[constants.BRANDS_KEY];
    const authorizationKey = req.body[constants.AUTHORIZATION_KEY];
    const translatorId = req.body[constants.TRANSLATOR_ID_KEY] || null;
    const email = req.body[constants.EMAIL_KEY] || null;
    const branch = req.body[constants.BRANCH_KEY] || null;
    queueDeploy(api, repos, simName, version, locales, brands, servers, email, translatorId, branch, authorizationKey, req, res);
  } else {
    queueDeployApiVersion1(req, res, 'body');
  }
};

/**
 * Adds the request to the processing queue and handles email notifications about success or failures
 *
 * @param {String} api
 * @param {Object} repos
 * @param {String} simName
 * @param {String} version
 * @param {Array.<String>} locales
 * @param {Array.<String>} brands
 * @param {Array.<String>} servers
 * @param {String} email
 * @param {String} userId
 * @param {String} branch
 * @param {String} authorizationKey
 * @param {express.Request} req
 * @param {express.Response} res
 */
const queueDeploy = (api, repos, simName, version, locales, brands, servers, email, userId, branch, authorizationKey, req, res) => {
  if (repos && simName && version && authorizationKey) {
    const productionBrands = [constants.PHET_BRAND, constants.PHET_IO_BRAND];
    if (authorizationKey !== constants.BUILD_SERVER_CONFIG.buildServerAuthorizationCode) {
      const err = 'wrong authorization code';
      winston.log('error', err);
      res.status(401);
      res.send(err);
    } else if (servers.indexOf(constants.PRODUCTION_SERVER) >= 0 && brands.some(brand => !productionBrands.includes(brand))) {
      const err = 'Cannot complete production deploys for brands outside of phet and phet-io';
      winston.log('error', err);
      res.status(400);
      res.send(err);
    } else {
      winston.log('info', `queuing build for ${simName} ${version}`);
      const task = {
        api: api,
        repos: repos,
        simName: simName,
        version: version,
        locales: locales,
        servers: servers,
        brands: brands,
        email: email,
        userId: userId,
        branch: branch
      };
      persistentQueue.addTask(task);
      taskQueue.push(task, buildCallback(task));
      res.status(api === '1.0' ? 200 : 202);
      res.send('build process initiated, check logs for details');
    }
  } else {
    const errorString = 'missing one or more required query parameters: dependencies, simName, version, authorizationCode';
    winston.log('error', errorString);
    res.status(400);
    res.send(errorString);
  }
};
const buildCallback = task => {
  return err => {
    const simInfoString = `Sim = ${task.simName} Version = ${task.version} Brands = ${task.brands} Locales = ${task.locales}`;
    if (err) {
      let shas = task.repos;

      // try to format the JSON nicely for the email, but don't worry if it is invalid JSON
      try {
        shas = JSON.stringify(JSON.parse(shas), null, 2);
      } catch (e) {
        // invalid JSON
      }
      const errorMessage = `Build failure: ${err}. ${simInfoString} Shas = ${JSON.stringify(shas)}`;
      winston.log('error', errorMessage);
      sendEmail('BUILD ERROR', errorMessage, task.email);
    } else {
      winston.log('info', `build for ${task.simName} finished successfully`);
      persistentQueue.finishTask();
      sendEmail('Build Succeeded', simInfoString, task.email, true);
    }
  };
};
const postQueueImageDeploy = (req, res) => {
  logRequest(req, 'body', winston);
  const authorizationKey = req.body[constants.AUTHORIZATION_KEY];
  if (authorizationKey !== constants.BUILD_SERVER_CONFIG.buildServerAuthorizationCode) {
    const err = 'wrong authorization code';
    winston.log('error', err);
    res.status(401);
    res.send(err);
    return;
  }
  const branch = req.body[constants.BRANCH_KEY] || 'main';
  const brands = req.body[constants.BRANDS_KEY] || 'phet';
  const email = req.body[constants.EMAIL_KEY] || null;
  const simulation = req.body[constants.SIM_NAME_KEY] || null;
  const version = req.body[constants.VERSION_KEY] || null;
  const emailBodyText = 'Not implemented';
  taskQueue.push({
    deployImages: true,
    branch: branch,
    brands: brands,
    simulation: simulation,
    version: version
  }, err => {
    if (err) {
      const errorMessage = `Image deploy failure: ${err}`;
      winston.log('error', errorMessage);
      sendEmail('IMAGE DEPLOY ERROR', errorMessage, email);
    } else {
      winston.log('info', 'Image deploy finished successfully');
      sendEmail('Image deploy succeeded', emailBodyText, email, true);
    }
  });
  res.status(202);
  res.send('build process initiated, check logs for details');
};

// Create the ExpressJS app
const app = express();

// to support JSON-encoded bodies
app.use(bodyParser.json());

// add the route to build and deploy
app.get('/deploy-html-simulation', getQueueDeploy);
app.post('/deploy-html-simulation', postQueueDeploy);
app.post('/deploy-images', postQueueImageDeploy);
app.set('views', './views');
app.set('view engine', 'pug');
app.get('/deploy-status', getStatus);

// start the server
app.listen(constants.LISTEN_PORT, () => {
  winston.log('info', `Listening on port ${constants.LISTEN_PORT}`);
  winston.log('info', `Verbose mode: ${verbose}`);

  // log the SHA of perennial - this may make it easier to duplicate and track down problems
  try {
    const sha = childProcess.execSync('git rev-parse HEAD');
    winston.info(`current SHA: ${sha.toString()}`);
  } catch (err) {
    winston.warn(`unable to get SHA from git, err: ${err}`);
  }

  // Recreate queue
  try {
    const queue = persistentQueue.getQueue().queue;
    for (const task of queue) {
      console.log('Resuming task from persistent queue: ', task);
      taskQueue.push(task, buildCallback(task));
    }
  } catch (e) {
    console.error('could not resume queue');
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb25zdGFudHMiLCJyZXF1aXJlIiwiY2hpbGRQcm9jZXNzIiwid2luc3RvbiIsImxvZ1JlcXVlc3QiLCJzZW5kRW1haWwiLCJ0YXNrV29ya2VyIiwiYXN5bmMiLCJib2R5UGFyc2VyIiwiZXhwcmVzcyIsIl8iLCJwYXJzZUFyZ3MiLCJwZXJzaXN0ZW50UXVldWUiLCJnZXRTdGF0dXMiLCJwcm9jZXNzIiwidW1hc2siLCJwYXJzZWRDb21tYW5kTGluZU9wdGlvbnMiLCJhcmd2Iiwic2xpY2UiLCJib29sZWFuIiwiZGVmYXVsdE9wdGlvbnMiLCJ2ZXJib3NlIiwiQlVJTERfU0VSVkVSX0NPTkZJRyIsImhlbHAiLCJoIiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJjb25zb2xlIiwiZXJyb3IiLCJleGl0IiwibG9nIiwib3B0aW9ucyIsImFzc2lnbkluIiwidGFza1F1ZXVlIiwicXVldWUiLCJxdWV1ZURlcGxveUFwaVZlcnNpb24xIiwicmVxIiwicmVzIiwicmVwb3MiLCJKU09OIiwicGFyc2UiLCJkZWNvZGVVUklDb21wb25lbnQiLCJSRVBPU19LRVkiLCJzaW1OYW1lIiwiU0lNX05BTUVfS0VZIiwidmVyc2lvbiIsIlZFUlNJT05fS0VZIiwibG9jYWxlcyIsIkxPQ0FMRVNfS0VZIiwib3B0aW9uIiwiT1BUSU9OX0tFWSIsImVtYWlsIiwiRU1BSUxfS0VZIiwidHJhbnNsYXRvcklkIiwiVVNFUl9JRF9LRVkiLCJhdXRob3JpemF0aW9uS2V5IiwiQVVUSE9SSVpBVElPTl9LRVkiLCJicmFuY2giLCJCUkFOQ0hfS0VZIiwic2VydmVycyIsIkRFVl9TRVJWRVIiLCJQUk9EVUNUSU9OX1NFUlZFUiIsImJyYW5kcyIsImluZGV4T2YiLCJQSEVUX0JSQU5EIiwiUEhFVF9JT19CUkFORCIsInF1ZXVlRGVwbG95IiwiZ2V0UXVldWVEZXBsb3kiLCJwb3N0UXVldWVEZXBsb3kiLCJhcGkiLCJib2R5IiwiQVBJX0tFWSIsInN0YXJ0c1dpdGgiLCJERVBFTkRFTkNJRVNfS0VZIiwiU0VSVkVSU19LRVkiLCJCUkFORFNfS0VZIiwiVFJBTlNMQVRPUl9JRF9LRVkiLCJ1c2VySWQiLCJwcm9kdWN0aW9uQnJhbmRzIiwiYnVpbGRTZXJ2ZXJBdXRob3JpemF0aW9uQ29kZSIsImVyciIsInN0YXR1cyIsInNlbmQiLCJzb21lIiwiYnJhbmQiLCJpbmNsdWRlcyIsInRhc2siLCJhZGRUYXNrIiwicHVzaCIsImJ1aWxkQ2FsbGJhY2siLCJlcnJvclN0cmluZyIsInNpbUluZm9TdHJpbmciLCJzaGFzIiwic3RyaW5naWZ5IiwiZSIsImVycm9yTWVzc2FnZSIsImZpbmlzaFRhc2siLCJwb3N0UXVldWVJbWFnZURlcGxveSIsInNpbXVsYXRpb24iLCJlbWFpbEJvZHlUZXh0IiwiZGVwbG95SW1hZ2VzIiwiYXBwIiwidXNlIiwianNvbiIsImdldCIsInBvc3QiLCJzZXQiLCJsaXN0ZW4iLCJMSVNURU5fUE9SVCIsInNoYSIsImV4ZWNTeW5jIiwiaW5mbyIsInRvU3RyaW5nIiwid2FybiIsImdldFF1ZXVlIl0sInNvdXJjZXMiOlsiYnVpbGQtc2VydmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDAyLTIwMTcsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFBoRVQgYnVpbGQgYW5kIGRlcGxveSBzZXJ2ZXIuIFRoZSBzZXJ2ZXIgaXMgZGVzaWduZWQgdG8gcnVuIG9uIHRoZSBzYW1lIGhvc3QgYXMgdGhlIHByb2R1Y3Rpb24gc2l0ZSAocGhldC1zZXJ2ZXIuaW50LmNvbG9yYWRvLmVkdSkuXHJcbiAqIFRoaXMgZmlsZSBpbml0aWFsaXplcyB0aGUgYXBwIGFuZCB0aGUgbWFpbiBwcm9jZXNzIHF1ZXVlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEFhcm9uIERhdmlzXHJcbiAqIEBhdXRob3IgTWF0dCBQZW5uaW5ndG9uXHJcbiAqL1xyXG5cclxuXHJcbmNvbnN0IGNvbnN0YW50cyA9IHJlcXVpcmUoICcuL2NvbnN0YW50cycgKTtcclxuY29uc3QgY2hpbGRQcm9jZXNzID0gcmVxdWlyZSggJ2NoaWxkX3Byb2Nlc3MnICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1zdGF0ZW1lbnQtbWF0Y2hcclxuY29uc3Qgd2luc3RvbiA9IHJlcXVpcmUoICcuL2xvZy5qcycgKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLXN0YXRlbWVudC1tYXRjaFxyXG5jb25zdCBsb2dSZXF1ZXN0ID0gcmVxdWlyZSggJy4vbG9nUmVxdWVzdCcgKTtcclxuY29uc3Qgc2VuZEVtYWlsID0gcmVxdWlyZSggJy4vc2VuZEVtYWlsJyApO1xyXG5jb25zdCB0YXNrV29ya2VyID0gcmVxdWlyZSggJy4vdGFza1dvcmtlcicgKTtcclxuY29uc3QgYXN5bmMgPSByZXF1aXJlKCAnYXN5bmMnICk7XHJcbmNvbnN0IGJvZHlQYXJzZXIgPSByZXF1aXJlKCAnYm9keS1wYXJzZXInICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1zdGF0ZW1lbnQtbWF0Y2hcclxuY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoICdleHByZXNzJyApO1xyXG5jb25zdCBfID0gcmVxdWlyZSggJ2xvZGFzaCcgKTtcclxuY29uc3QgcGFyc2VBcmdzID0gcmVxdWlyZSggJ21pbmltaXN0JyApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtc3RhdGVtZW50LW1hdGNoXHJcbmNvbnN0IHBlcnNpc3RlbnRRdWV1ZSA9IHJlcXVpcmUoICcuL3BlcnNpc3RlbnRRdWV1ZScgKTtcclxuY29uc3QgZ2V0U3RhdHVzID0gcmVxdWlyZSggJy4vZ2V0U3RhdHVzJyApO1xyXG5cclxuLy8gc2V0IHRoaXMgcHJvY2VzcyB1cCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBwZXJtaXNzaW9ucywgdmFsdWUgaXMgaW4gb2N0YWxcclxucHJvY2Vzcy51bWFzayggMG8wMDAyICk7XHJcblxyXG4vKipcclxuICogSGFuZGxlIGNvbW1hbmQgbGluZSBpbnB1dFxyXG4gKiBGaXJzdCAyIGFyZ3MgcHJvdmlkZSBpbmZvIGFib3V0IGV4ZWN1dGFibGVzLCBpZ25vcmVcclxuICovXHJcbmNvbnN0IHBhcnNlZENvbW1hbmRMaW5lT3B0aW9ucyA9IHBhcnNlQXJncyggcHJvY2Vzcy5hcmd2LnNsaWNlKCAyICksIHtcclxuICBib29sZWFuOiB0cnVlXHJcbn0gKTtcclxuXHJcbmNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xyXG4gIHZlcmJvc2U6IGNvbnN0YW50cy5CVUlMRF9TRVJWRVJfQ09ORklHLnZlcmJvc2UsIC8vIGNhbiBiZSBvdmVycmlkZGVuIGJ5IGEgZmxhZyBvbiB0aGUgY29tbWFuZCBsaW5lXHJcblxyXG4gIC8vIG9wdGlvbnMgZm9yIHN1cHBvcnRpbmcgaGVscFxyXG4gIGhlbHA6IGZhbHNlLFxyXG4gIGg6IGZhbHNlXHJcbn07XHJcblxyXG5mb3IgKCBjb25zdCBrZXkgaW4gcGFyc2VkQ29tbWFuZExpbmVPcHRpb25zICkge1xyXG4gIGlmICgga2V5ICE9PSAnXycgJiYgcGFyc2VkQ29tbWFuZExpbmVPcHRpb25zLmhhc093blByb3BlcnR5KCBrZXkgKSAmJiAhZGVmYXVsdE9wdGlvbnMuaGFzT3duUHJvcGVydHkoIGtleSApICkge1xyXG4gICAgY29uc29sZS5lcnJvciggYFVucmVjb2duaXplZCBvcHRpb246ICR7a2V5fWAgKTtcclxuICAgIGNvbnNvbGUuZXJyb3IoICd0cnkgLS1oZWxwIGZvciB1c2FnZSBpbmZvcm1hdGlvbi4nICk7XHJcbiAgICBwcm9jZXNzLmV4aXQoIDEgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIElmIGhlbHAgZmxhZywgcHJpbnQgaGVscCBhbmQgdXNhZ2UgaW5mb1xyXG5pZiAoIHBhcnNlZENvbW1hbmRMaW5lT3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSggJ2hlbHAnICkgfHwgcGFyc2VkQ29tbWFuZExpbmVPcHRpb25zLmhhc093blByb3BlcnR5KCAnaCcgKSApIHtcclxuICBjb25zb2xlLmxvZyggJ1VzYWdlOicgKTtcclxuICBjb25zb2xlLmxvZyggJyAgbm9kZSBidWlsZC1zZXJ2ZXIuanMgW29wdGlvbnNdJyApO1xyXG4gIGNvbnNvbGUubG9nKCAnJyApO1xyXG4gIGNvbnNvbGUubG9nKCAnT3B0aW9uczonICk7XHJcbiAgY29uc29sZS5sb2coXHJcbiAgICAnICAtLWhlbHAgKHByaW50IHVzYWdlIGFuZCBleGl0KVxcbicgK1xyXG4gICAgJyAgICB0eXBlOiBib29sICBkZWZhdWx0OiBmYWxzZVxcbicgK1xyXG4gICAgJyAgLS12ZXJib3NlIChvdXRwdXQgZ3J1bnQgbG9ncyBpbiBhZGRpdGlvbiB0byBidWlsZC1zZXJ2ZXIpXFxuJyArXHJcbiAgICAnICAgIHR5cGU6IGJvb2wgIGRlZmF1bHQ6IGZhbHNlXFxuJ1xyXG4gICk7XHJcbiAgcHJvY2Vzcy5leGl0KCAxICk7XHJcbn1cclxuXHJcbi8vIE1lcmdlIHRoZSBkZWZhdWx0IGFuZCBzdXBwbGllZCBvcHRpb25zLlxyXG5jb25zdCBvcHRpb25zID0gXy5hc3NpZ25JbiggZGVmYXVsdE9wdGlvbnMsIHBhcnNlZENvbW1hbmRMaW5lT3B0aW9ucyApO1xyXG5jb25zdCB2ZXJib3NlID0gb3B0aW9ucy52ZXJib3NlO1xyXG5cclxuY29uc3QgdGFza1F1ZXVlID0gYXN5bmMucXVldWUoIHRhc2tXb3JrZXIsIDEgKTsgLy8gMSBpcyB0aGUgbWF4IG51bWJlciBvZiB0YXNrcyB0aGF0IGNhbiBydW4gY29uY3VycmVudGx5XHJcblxyXG4vKipcclxuICogSGFuZGxlIGNoaXBwZXIgMS4wIHJlcXVlc3RzXHJcbiAqXHJcbiAqIEBwYXJhbSB7ZXhwcmVzcy5SZXF1ZXN0fSByZXFcclxuICogQHBhcmFtIHtleHByZXNzLlJlc3BvbnNlfSByZXNcclxuICogQHBhcmFtIHtTdHJpbmd9IGtleSAtIG9uZSBvZiAncXVlcnknIG9yICdib2R5JywgdXNlZCB0byBkaWZmZXJlbnRpYXRlIHF1ZXJ5IHBhcmFtZXRlcnMgb3IgUE9TVCBkYXRhLlxyXG4gKi9cclxuY29uc3QgcXVldWVEZXBsb3lBcGlWZXJzaW9uMSA9ICggcmVxLCByZXMsIGtleSApID0+IHtcclxuICBjb25zdCByZXBvcyA9IEpTT04ucGFyc2UoIGRlY29kZVVSSUNvbXBvbmVudCggcmVxWyBrZXkgXVsgY29uc3RhbnRzLlJFUE9TX0tFWSBdICkgKTtcclxuICBjb25zdCBzaW1OYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KCByZXFbIGtleSBdWyBjb25zdGFudHMuU0lNX05BTUVfS0VZIF0gKTtcclxuICBjb25zdCB2ZXJzaW9uID0gZGVjb2RlVVJJQ29tcG9uZW50KCByZXFbIGtleSBdWyBjb25zdGFudHMuVkVSU0lPTl9LRVkgXSApO1xyXG4gIGNvbnN0IGxvY2FsZXMgPSBkZWNvZGVVUklDb21wb25lbnQoIHJlcVsga2V5IF1bIGNvbnN0YW50cy5MT0NBTEVTX0tFWSBdICkgfHwgbnVsbDtcclxuICBjb25zdCBvcHRpb24gPSBkZWNvZGVVUklDb21wb25lbnQoIHJlcVsga2V5IF1bIGNvbnN0YW50cy5PUFRJT05fS0VZIF0gKSB8fCAnZGVmYXVsdCc7XHJcbiAgY29uc3QgZW1haWwgPSBkZWNvZGVVUklDb21wb25lbnQoIHJlcVsga2V5IF1bIGNvbnN0YW50cy5FTUFJTF9LRVkgXSApIHx8IG51bGw7XHJcbiAgY29uc3QgdHJhbnNsYXRvcklkID0gZGVjb2RlVVJJQ29tcG9uZW50KCByZXFbIGtleSBdWyBjb25zdGFudHMuVVNFUl9JRF9LRVkgXSApIHx8IG51bGw7XHJcbiAgY29uc3QgYXV0aG9yaXphdGlvbktleSA9IGRlY29kZVVSSUNvbXBvbmVudCggcmVxWyBrZXkgXVsgY29uc3RhbnRzLkFVVEhPUklaQVRJT05fS0VZIF0gKTtcclxuICBjb25zdCBicmFuY2ggPSBkZWNvZGVVUklDb21wb25lbnQoIHJlcVsga2V5IF1bIGNvbnN0YW50cy5CUkFOQ0hfS0VZIF0gKSB8fCByZXBvc1sgc2ltTmFtZSBdLmJyYW5jaDtcclxuXHJcbiAgLy8gVE9ETyBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcGVyZW5uaWFsL2lzc3Vlcy8xNjcgZGV0ZXJtaW5lIGlmIHRoaXMgY29tbWVudCBuZWVkcyB1cGRhdGluZyBmb3IgY2hpcHBlciAxLjAgZGVwbG95c1xyXG4gIC8vIEZvciBSQyBkZXBsb3lzLCBvbmx5IHNlbmQgdG8gdGhlIGRldiBzZXJ2ZXIuICBGb3IgcHJvZHVjdGlvbiBkZXBsb3lzLCB0aGUgbG9jYWwgYnVpbGQgd2lsbCBzZW5kIHRvIHRoZSBkZXYgc2VydmVyIHNvIHRoZSBidWlsZC1zZXJ2ZXJcclxuICAvLyBvbmx5IHNlbmRzIHRvIHRoZSBwcm9kdWN0aW9uIHNlcnZlciAocGhldC1zZXJ2ZXIyKS5cclxuICBjb25zdCBzZXJ2ZXJzID0gKCBvcHRpb24gPT09ICdyYycgKSA/IFsgY29uc3RhbnRzLkRFVl9TRVJWRVIgXSA6IFsgY29uc3RhbnRzLlBST0RVQ1RJT05fU0VSVkVSIF07XHJcbiAgY29uc3QgYnJhbmRzID0gdmVyc2lvbi5pbmRleE9mKCAncGhldGlvJyApIDwgMCA/IFsgY29uc3RhbnRzLlBIRVRfQlJBTkQgXSA6IFsgY29uc3RhbnRzLlBIRVRfSU9fQlJBTkQgXTtcclxuXHJcbiAgcXVldWVEZXBsb3koICcxLjAnLCByZXBvcywgc2ltTmFtZSwgdmVyc2lvbiwgbG9jYWxlcywgYnJhbmRzLCBzZXJ2ZXJzLCBlbWFpbCwgdHJhbnNsYXRvcklkLCBicmFuY2gsIGF1dGhvcml6YXRpb25LZXksIHJlcSwgcmVzICk7XHJcbn07XHJcblxyXG5jb25zdCBnZXRRdWV1ZURlcGxveSA9ICggcmVxLCByZXMgKSA9PiB7XHJcbiAgbG9nUmVxdWVzdCggcmVxLCAncXVlcnknLCB3aW5zdG9uICk7XHJcbiAgcXVldWVEZXBsb3lBcGlWZXJzaW9uMSggcmVxLCByZXMsICdxdWVyeScgKTtcclxufTtcclxuXHJcbmNvbnN0IHBvc3RRdWV1ZURlcGxveSA9ICggcmVxLCByZXMgKSA9PiB7XHJcbiAgbG9nUmVxdWVzdCggcmVxLCAnYm9keScsIHdpbnN0b24gKTtcclxuXHJcbiAgY29uc3QgYXBpID0gZGVjb2RlVVJJQ29tcG9uZW50KCByZXEuYm9keVsgY29uc3RhbnRzLkFQSV9LRVkgXSApO1xyXG5cclxuICBpZiAoIGFwaSAmJiBhcGkuc3RhcnRzV2l0aCggJzIuJyApICkge1xyXG4gICAgY29uc3QgcmVwb3MgPSBKU09OLnBhcnNlKCByZXEuYm9keVsgY29uc3RhbnRzLkRFUEVOREVOQ0lFU19LRVkgXSApO1xyXG4gICAgY29uc3Qgc2ltTmFtZSA9IHJlcS5ib2R5WyBjb25zdGFudHMuU0lNX05BTUVfS0VZIF07XHJcbiAgICBjb25zdCB2ZXJzaW9uID0gcmVxLmJvZHlbIGNvbnN0YW50cy5WRVJTSU9OX0tFWSBdO1xyXG4gICAgY29uc3QgbG9jYWxlcyA9IHJlcS5ib2R5WyBjb25zdGFudHMuTE9DQUxFU19LRVkgXSB8fCBudWxsO1xyXG4gICAgY29uc3Qgc2VydmVycyA9IHJlcS5ib2R5WyBjb25zdGFudHMuU0VSVkVSU19LRVkgXTtcclxuICAgIGNvbnN0IGJyYW5kcyA9IHJlcS5ib2R5WyBjb25zdGFudHMuQlJBTkRTX0tFWSBdO1xyXG4gICAgY29uc3QgYXV0aG9yaXphdGlvbktleSA9IHJlcS5ib2R5WyBjb25zdGFudHMuQVVUSE9SSVpBVElPTl9LRVkgXTtcclxuICAgIGNvbnN0IHRyYW5zbGF0b3JJZCA9IHJlcS5ib2R5WyBjb25zdGFudHMuVFJBTlNMQVRPUl9JRF9LRVkgXSB8fCBudWxsO1xyXG4gICAgY29uc3QgZW1haWwgPSByZXEuYm9keVsgY29uc3RhbnRzLkVNQUlMX0tFWSBdIHx8IG51bGw7XHJcbiAgICBjb25zdCBicmFuY2ggPSByZXEuYm9keVsgY29uc3RhbnRzLkJSQU5DSF9LRVkgXSB8fCBudWxsO1xyXG5cclxuICAgIHF1ZXVlRGVwbG95KCBhcGksIHJlcG9zLCBzaW1OYW1lLCB2ZXJzaW9uLCBsb2NhbGVzLCBicmFuZHMsIHNlcnZlcnMsIGVtYWlsLCB0cmFuc2xhdG9ySWQsIGJyYW5jaCwgYXV0aG9yaXphdGlvbktleSwgcmVxLCByZXMgKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICBxdWV1ZURlcGxveUFwaVZlcnNpb24xKCByZXEsIHJlcywgJ2JvZHknICk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkZHMgdGhlIHJlcXVlc3QgdG8gdGhlIHByb2Nlc3NpbmcgcXVldWUgYW5kIGhhbmRsZXMgZW1haWwgbm90aWZpY2F0aW9ucyBhYm91dCBzdWNjZXNzIG9yIGZhaWx1cmVzXHJcbiAqXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBhcGlcclxuICogQHBhcmFtIHtPYmplY3R9IHJlcG9zXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBzaW1OYW1lXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSB2ZXJzaW9uXHJcbiAqIEBwYXJhbSB7QXJyYXkuPFN0cmluZz59IGxvY2FsZXNcclxuICogQHBhcmFtIHtBcnJheS48U3RyaW5nPn0gYnJhbmRzXHJcbiAqIEBwYXJhbSB7QXJyYXkuPFN0cmluZz59IHNlcnZlcnNcclxuICogQHBhcmFtIHtTdHJpbmd9IGVtYWlsXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWRcclxuICogQHBhcmFtIHtTdHJpbmd9IGJyYW5jaFxyXG4gKiBAcGFyYW0ge1N0cmluZ30gYXV0aG9yaXphdGlvbktleVxyXG4gKiBAcGFyYW0ge2V4cHJlc3MuUmVxdWVzdH0gcmVxXHJcbiAqIEBwYXJhbSB7ZXhwcmVzcy5SZXNwb25zZX0gcmVzXHJcbiAqL1xyXG5jb25zdCBxdWV1ZURlcGxveSA9ICggYXBpLCByZXBvcywgc2ltTmFtZSwgdmVyc2lvbiwgbG9jYWxlcywgYnJhbmRzLCBzZXJ2ZXJzLCBlbWFpbCwgdXNlcklkLCBicmFuY2gsIGF1dGhvcml6YXRpb25LZXksIHJlcSwgcmVzICkgPT4ge1xyXG5cclxuICBpZiAoIHJlcG9zICYmIHNpbU5hbWUgJiYgdmVyc2lvbiAmJiBhdXRob3JpemF0aW9uS2V5ICkge1xyXG4gICAgY29uc3QgcHJvZHVjdGlvbkJyYW5kcyA9IFsgY29uc3RhbnRzLlBIRVRfQlJBTkQsIGNvbnN0YW50cy5QSEVUX0lPX0JSQU5EIF07XHJcblxyXG4gICAgaWYgKCBhdXRob3JpemF0aW9uS2V5ICE9PSBjb25zdGFudHMuQlVJTERfU0VSVkVSX0NPTkZJRy5idWlsZFNlcnZlckF1dGhvcml6YXRpb25Db2RlICkge1xyXG4gICAgICBjb25zdCBlcnIgPSAnd3JvbmcgYXV0aG9yaXphdGlvbiBjb2RlJztcclxuICAgICAgd2luc3Rvbi5sb2coICdlcnJvcicsIGVyciApO1xyXG4gICAgICByZXMuc3RhdHVzKCA0MDEgKTtcclxuICAgICAgcmVzLnNlbmQoIGVyciApO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHNlcnZlcnMuaW5kZXhPZiggY29uc3RhbnRzLlBST0RVQ1RJT05fU0VSVkVSICkgPj0gMCAmJiBicmFuZHMuc29tZSggYnJhbmQgPT4gIXByb2R1Y3Rpb25CcmFuZHMuaW5jbHVkZXMoIGJyYW5kICkgKSApIHtcclxuICAgICAgY29uc3QgZXJyID0gJ0Nhbm5vdCBjb21wbGV0ZSBwcm9kdWN0aW9uIGRlcGxveXMgZm9yIGJyYW5kcyBvdXRzaWRlIG9mIHBoZXQgYW5kIHBoZXQtaW8nO1xyXG4gICAgICB3aW5zdG9uLmxvZyggJ2Vycm9yJywgZXJyICk7XHJcbiAgICAgIHJlcy5zdGF0dXMoIDQwMCApO1xyXG4gICAgICByZXMuc2VuZCggZXJyICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgd2luc3Rvbi5sb2coICdpbmZvJywgYHF1ZXVpbmcgYnVpbGQgZm9yICR7c2ltTmFtZX0gJHt2ZXJzaW9ufWAgKTtcclxuICAgICAgY29uc3QgdGFzayA9IHtcclxuICAgICAgICBhcGk6IGFwaSxcclxuICAgICAgICByZXBvczogcmVwb3MsXHJcbiAgICAgICAgc2ltTmFtZTogc2ltTmFtZSxcclxuICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLFxyXG4gICAgICAgIGxvY2FsZXM6IGxvY2FsZXMsXHJcbiAgICAgICAgc2VydmVyczogc2VydmVycyxcclxuICAgICAgICBicmFuZHM6IGJyYW5kcyxcclxuICAgICAgICBlbWFpbDogZW1haWwsXHJcbiAgICAgICAgdXNlcklkOiB1c2VySWQsXHJcbiAgICAgICAgYnJhbmNoOiBicmFuY2hcclxuICAgICAgfTtcclxuICAgICAgcGVyc2lzdGVudFF1ZXVlLmFkZFRhc2soIHRhc2sgKTtcclxuICAgICAgdGFza1F1ZXVlLnB1c2goIHRhc2ssIGJ1aWxkQ2FsbGJhY2soIHRhc2sgKSApO1xyXG5cclxuICAgICAgcmVzLnN0YXR1cyggYXBpID09PSAnMS4wJyA/IDIwMCA6IDIwMiApO1xyXG4gICAgICByZXMuc2VuZCggJ2J1aWxkIHByb2Nlc3MgaW5pdGlhdGVkLCBjaGVjayBsb2dzIGZvciBkZXRhaWxzJyApO1xyXG4gICAgfVxyXG4gIH1cclxuICBlbHNlIHtcclxuICAgIGNvbnN0IGVycm9yU3RyaW5nID0gJ21pc3Npbmcgb25lIG9yIG1vcmUgcmVxdWlyZWQgcXVlcnkgcGFyYW1ldGVyczogZGVwZW5kZW5jaWVzLCBzaW1OYW1lLCB2ZXJzaW9uLCBhdXRob3JpemF0aW9uQ29kZSc7XHJcbiAgICB3aW5zdG9uLmxvZyggJ2Vycm9yJywgZXJyb3JTdHJpbmcgKTtcclxuICAgIHJlcy5zdGF0dXMoIDQwMCApO1xyXG4gICAgcmVzLnNlbmQoIGVycm9yU3RyaW5nICk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgYnVpbGRDYWxsYmFjayA9IHRhc2sgPT4ge1xyXG4gIHJldHVybiBlcnIgPT4ge1xyXG4gICAgY29uc3Qgc2ltSW5mb1N0cmluZyA9IGBTaW0gPSAke3Rhc2suc2ltTmFtZVxyXG4gICAgfSBWZXJzaW9uID0gJHt0YXNrLnZlcnNpb25cclxuICAgIH0gQnJhbmRzID0gJHt0YXNrLmJyYW5kc1xyXG4gICAgfSBMb2NhbGVzID0gJHt0YXNrLmxvY2FsZXN9YDtcclxuXHJcbiAgICBpZiAoIGVyciApIHtcclxuICAgICAgbGV0IHNoYXMgPSB0YXNrLnJlcG9zO1xyXG5cclxuICAgICAgLy8gdHJ5IHRvIGZvcm1hdCB0aGUgSlNPTiBuaWNlbHkgZm9yIHRoZSBlbWFpbCwgYnV0IGRvbid0IHdvcnJ5IGlmIGl0IGlzIGludmFsaWQgSlNPTlxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHNoYXMgPSBKU09OLnN0cmluZ2lmeSggSlNPTi5wYXJzZSggc2hhcyApLCBudWxsLCAyICk7XHJcbiAgICAgIH1cclxuICAgICAgY2F0Y2goIGUgKSB7XHJcbiAgICAgICAgLy8gaW52YWxpZCBKU09OXHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYEJ1aWxkIGZhaWx1cmU6ICR7ZXJyfS4gJHtzaW1JbmZvU3RyaW5nfSBTaGFzID0gJHtKU09OLnN0cmluZ2lmeSggc2hhcyApfWA7XHJcbiAgICAgIHdpbnN0b24ubG9nKCAnZXJyb3InLCBlcnJvck1lc3NhZ2UgKTtcclxuICAgICAgc2VuZEVtYWlsKCAnQlVJTEQgRVJST1InLCBlcnJvck1lc3NhZ2UsIHRhc2suZW1haWwgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB3aW5zdG9uLmxvZyggJ2luZm8nLCBgYnVpbGQgZm9yICR7dGFzay5zaW1OYW1lfSBmaW5pc2hlZCBzdWNjZXNzZnVsbHlgICk7XHJcbiAgICAgIHBlcnNpc3RlbnRRdWV1ZS5maW5pc2hUYXNrKCk7XHJcbiAgICAgIHNlbmRFbWFpbCggJ0J1aWxkIFN1Y2NlZWRlZCcsIHNpbUluZm9TdHJpbmcsIHRhc2suZW1haWwsIHRydWUgKTtcclxuICAgIH1cclxuICB9O1xyXG59O1xyXG5cclxuY29uc3QgcG9zdFF1ZXVlSW1hZ2VEZXBsb3kgPSAoIHJlcSwgcmVzICkgPT4ge1xyXG4gIGxvZ1JlcXVlc3QoIHJlcSwgJ2JvZHknLCB3aW5zdG9uICk7XHJcblxyXG4gIGNvbnN0IGF1dGhvcml6YXRpb25LZXkgPSByZXEuYm9keVsgY29uc3RhbnRzLkFVVEhPUklaQVRJT05fS0VZIF07XHJcbiAgaWYgKCBhdXRob3JpemF0aW9uS2V5ICE9PSBjb25zdGFudHMuQlVJTERfU0VSVkVSX0NPTkZJRy5idWlsZFNlcnZlckF1dGhvcml6YXRpb25Db2RlICkge1xyXG4gICAgY29uc3QgZXJyID0gJ3dyb25nIGF1dGhvcml6YXRpb24gY29kZSc7XHJcbiAgICB3aW5zdG9uLmxvZyggJ2Vycm9yJywgZXJyICk7XHJcbiAgICByZXMuc3RhdHVzKCA0MDEgKTtcclxuICAgIHJlcy5zZW5kKCBlcnIgKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnN0IGJyYW5jaCA9IHJlcS5ib2R5WyBjb25zdGFudHMuQlJBTkNIX0tFWSBdIHx8ICdtYWluJztcclxuICBjb25zdCBicmFuZHMgPSByZXEuYm9keVsgY29uc3RhbnRzLkJSQU5EU19LRVkgXSB8fCAncGhldCc7XHJcbiAgY29uc3QgZW1haWwgPSByZXEuYm9keVsgY29uc3RhbnRzLkVNQUlMX0tFWSBdIHx8IG51bGw7XHJcbiAgY29uc3Qgc2ltdWxhdGlvbiA9IHJlcS5ib2R5WyBjb25zdGFudHMuU0lNX05BTUVfS0VZIF0gfHwgbnVsbDtcclxuICBjb25zdCB2ZXJzaW9uID0gcmVxLmJvZHlbIGNvbnN0YW50cy5WRVJTSU9OX0tFWSBdIHx8IG51bGw7XHJcbiAgY29uc3QgZW1haWxCb2R5VGV4dCA9ICdOb3QgaW1wbGVtZW50ZWQnO1xyXG5cclxuICB0YXNrUXVldWUucHVzaChcclxuICAgIHtcclxuICAgICAgZGVwbG95SW1hZ2VzOiB0cnVlLFxyXG4gICAgICBicmFuY2g6IGJyYW5jaCxcclxuICAgICAgYnJhbmRzOiBicmFuZHMsXHJcbiAgICAgIHNpbXVsYXRpb246IHNpbXVsYXRpb24sXHJcbiAgICAgIHZlcnNpb246IHZlcnNpb25cclxuICAgIH0sXHJcbiAgICBlcnIgPT4ge1xyXG4gICAgICBpZiAoIGVyciApIHtcclxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBgSW1hZ2UgZGVwbG95IGZhaWx1cmU6ICR7ZXJyfWA7XHJcbiAgICAgICAgd2luc3Rvbi5sb2coICdlcnJvcicsIGVycm9yTWVzc2FnZSApO1xyXG4gICAgICAgIHNlbmRFbWFpbCggJ0lNQUdFIERFUExPWSBFUlJPUicsIGVycm9yTWVzc2FnZSwgZW1haWwgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB3aW5zdG9uLmxvZyggJ2luZm8nLCAnSW1hZ2UgZGVwbG95IGZpbmlzaGVkIHN1Y2Nlc3NmdWxseScgKTtcclxuICAgICAgICBzZW5kRW1haWwoICdJbWFnZSBkZXBsb3kgc3VjY2VlZGVkJywgZW1haWxCb2R5VGV4dCwgZW1haWwsIHRydWUgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICByZXMuc3RhdHVzKCAyMDIgKTtcclxuICByZXMuc2VuZCggJ2J1aWxkIHByb2Nlc3MgaW5pdGlhdGVkLCBjaGVjayBsb2dzIGZvciBkZXRhaWxzJyApO1xyXG59O1xyXG5cclxuLy8gQ3JlYXRlIHRoZSBFeHByZXNzSlMgYXBwXHJcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbi8vIHRvIHN1cHBvcnQgSlNPTi1lbmNvZGVkIGJvZGllc1xyXG5hcHAudXNlKCBib2R5UGFyc2VyLmpzb24oKSApO1xyXG5cclxuLy8gYWRkIHRoZSByb3V0ZSB0byBidWlsZCBhbmQgZGVwbG95XHJcbmFwcC5nZXQoICcvZGVwbG95LWh0bWwtc2ltdWxhdGlvbicsIGdldFF1ZXVlRGVwbG95ICk7XHJcbmFwcC5wb3N0KCAnL2RlcGxveS1odG1sLXNpbXVsYXRpb24nLCBwb3N0UXVldWVEZXBsb3kgKTtcclxuYXBwLnBvc3QoICcvZGVwbG95LWltYWdlcycsIHBvc3RRdWV1ZUltYWdlRGVwbG95ICk7XHJcblxyXG5hcHAuc2V0KCAndmlld3MnLCAnLi92aWV3cycgKTtcclxuYXBwLnNldCggJ3ZpZXcgZW5naW5lJywgJ3B1ZycgKTtcclxuYXBwLmdldCggJy9kZXBsb3ktc3RhdHVzJywgZ2V0U3RhdHVzICk7XHJcblxyXG4vLyBzdGFydCB0aGUgc2VydmVyXHJcbmFwcC5saXN0ZW4oIGNvbnN0YW50cy5MSVNURU5fUE9SVCwgKCkgPT4ge1xyXG4gIHdpbnN0b24ubG9nKCAnaW5mbycsIGBMaXN0ZW5pbmcgb24gcG9ydCAke2NvbnN0YW50cy5MSVNURU5fUE9SVH1gICk7XHJcbiAgd2luc3Rvbi5sb2coICdpbmZvJywgYFZlcmJvc2UgbW9kZTogJHt2ZXJib3NlfWAgKTtcclxuXHJcbiAgLy8gbG9nIHRoZSBTSEEgb2YgcGVyZW5uaWFsIC0gdGhpcyBtYXkgbWFrZSBpdCBlYXNpZXIgdG8gZHVwbGljYXRlIGFuZCB0cmFjayBkb3duIHByb2JsZW1zXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNoYSA9IGNoaWxkUHJvY2Vzcy5leGVjU3luYyggJ2dpdCByZXYtcGFyc2UgSEVBRCcgKTtcclxuICAgIHdpbnN0b24uaW5mbyggYGN1cnJlbnQgU0hBOiAke3NoYS50b1N0cmluZygpfWAgKTtcclxuICB9XHJcbiAgY2F0Y2goIGVyciApIHtcclxuICAgIHdpbnN0b24ud2FybiggYHVuYWJsZSB0byBnZXQgU0hBIGZyb20gZ2l0LCBlcnI6ICR7ZXJyfWAgKTtcclxuICB9XHJcblxyXG4gIC8vIFJlY3JlYXRlIHF1ZXVlXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHF1ZXVlID0gcGVyc2lzdGVudFF1ZXVlLmdldFF1ZXVlKCkucXVldWU7XHJcbiAgICBmb3IgKCBjb25zdCB0YXNrIG9mIHF1ZXVlICkge1xyXG4gICAgICBjb25zb2xlLmxvZyggJ1Jlc3VtaW5nIHRhc2sgZnJvbSBwZXJzaXN0ZW50IHF1ZXVlOiAnLCB0YXNrICk7XHJcbiAgICAgIHRhc2tRdWV1ZS5wdXNoKCB0YXNrLCBidWlsZENhbGxiYWNrKCB0YXNrICkgKTtcclxuICAgIH1cclxuICB9XHJcbiAgY2F0Y2goIGUgKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCAnY291bGQgbm90IHJlc3VtZSBxdWV1ZScgKTtcclxuICB9XHJcbn0gKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE1BQU1BLFNBQVMsR0FBR0MsT0FBTyxDQUFFLGFBQWMsQ0FBQztBQUMxQyxN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