// Copyright 2021-2023, University of Colorado Boulder

/**
 * CarouselComboBox behaves like a combo box, but its listbox is a carousel. This allows you to scroll through a
 * long list of items, a feature that ComboBoxListBox does not support. ComboBoxItem, ComboBoxButton, and
 * Carousel are reused.
 *
 * THINK TWICE BEFORE USING THIS IN A SIM!
 * CarouselComboBox was created as a quick way to address situations where ComboBox's listbox gets too long,
 * for example https://github.com/phetsims/sun/issues/673. This tends to happen in internal 'demo' applications
 * (sun, scenery-phet,... ) that have long lists of demos. And as a design best-practice, PhET tends to avoid
 * longs lists of things in sims. So if you find yourself reaching for CarouselComboBox, consider whether a
 * different UI component might provide a better UX.
 *
 * Possible future work:
 * - Modify ComboBox so that it can use different types of popups (ComboBoxListBox, Carousel,...), or
 * - Make CarouselComboBox pop up the Carousel in front of everything else
 * - a11y support in CarouselComboBox
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Multilink from '../../axon/js/Multilink.js';
import Dimension2 from '../../dot/js/Dimension2.js';
import dotRandom from '../../dot/js/dotRandom.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { AlignBox, AlignGroup, Color, HBox, Node, PressListener, Rectangle, VBox, WidthSizable } from '../../scenery/js/imports.js';
import Tandem from '../../tandem/js/Tandem.js';
import Carousel from './Carousel.js';
import ComboBoxButton from './ComboBoxButton.js';
import PageControl from './PageControl.js';
import sun from './sun.js';
import ComboBox from './ComboBox.js';
import { getGroupItemNodes } from './GroupItemOptions.js';
export default class CarouselComboBox extends WidthSizable(Node) {
  // See ComboBox for a description of this property.

  /**
   * @param property - the Property that is set when an item is selected
   * @param comboBoxItems - the items that appear in the carousel
   * @param providedOptions
   */
  constructor(property, comboBoxItems, providedOptions) {
    const options = optionize()({
      itemNodeOptions: {
        align: 'left',
        // {string} alignment of item nodes on backgrounds, 'left'|'center'|'right'
        overColor: Color.grayColor(245),
        // {ColorDef} background color of the item that the pointer is over
        selectedColor: 'yellow',
        // {ColorDef} background color of the selected item
        xMargin: 6,
        // {number} x margin for backgrounds on the items in the carousel
        yMargin: 2 // {number} y margin for backgrounds on the items in the carousel
      },
      carouselOptions: {
        buttonOptions: {
          arrowSize: new Dimension2(20, 4)
        },
        // Like ComboBox, 'vertical' is the only orientation supported (verified below).
        orientation: 'vertical',
        // Spacing and margins will be built into the backgrounds that are add to the item Nodes,
        // so set them to zero for the carousel.
        spacing: 0,
        margin: 0,
        // {number} If there are fewer items than this in the carousel, the actual number of items will be used.
        itemsPerPage: 15
      },
      pageControlOptions: {
        interactive: true
      },
      buttonOptions: {
        arrowDirection: 'down',
        // 'up' is not currently supported (verified below)
        baseColor: 'rgb( 218, 236, 255 )',
        xMargin: 6,
        // You'll typically want this to be the same as itemNodeOptions.xMargin, but we're not going to force you :)
        yMargin: 4
      },
      // phet-io
      tandem: Tandem.OPTIONAL
    }, providedOptions);

    // Validate options
    assert && assert(options.carouselOptions.orientation === 'vertical', 'orientation must be vertical');
    assert && assert(options.buttonOptions.arrowDirection === 'down', 'arrowDirection must be down');

    // Don't create pages that are longer than the number of items
    options.carouselOptions.itemsPerPage = Math.min(options.carouselOptions.itemsPerPage, comboBoxItems.length);

    // Create tandems for subcomponents, if they were not provided
    options.carouselOptions.tandem = options.carouselOptions.tandem || options.tandem.createTandem('carousel');
    options.buttonOptions.tandem = options.buttonOptions.tandem || options.tandem.createTandem('button');
    super();
    this.a11yNamePropertyMap = ComboBox.getA11yNamePropertyMap(comboBoxItems);

    // Make items in the carousel have the same width and height.
    const alignGroup = new AlignGroup();
    const contentNodes = getGroupItemNodes(comboBoxItems, options.tandem.createTandem('items'));

    // Create items for the carousel, whose API for 'items' is different than ComboBox.
    const carouselItemNodes = _.map(comboBoxItems, (comboBoxItem, i) => {
      return {
        createNode: () => new CarouselItemNode(property, comboBoxItem, contentNodes[i], alignGroup, options.itemNodeOptions)
      };
    });
    assert && assert(carouselItemNodes.length === comboBoxItems.length, 'expected a carouselItem for each comboBoxItem');
    const hBoxChildren = [];

    // Create the carousel.
    const carousel = new Carousel(carouselItemNodes, options.carouselOptions);
    hBoxChildren.push(carousel);

    // page control
    let pageControl = null;
    if (carousel.numberOfPagesProperty.value > 1) {
      pageControl = new PageControl(carousel.pageNumberProperty, carousel.numberOfPagesProperty, combineOptions({
        orientation: options.carouselOptions.orientation
      }, options.pageControlOptions));
      hBoxChildren.push(pageControl);
    }

    // pageControl to the left of carousel
    const carouselAndPageControl = new HBox({
      spacing: 4,
      children: hBoxChildren
    });

    // Pressing this button pops the carousel up and down
    const button = new ComboBoxButton(property, comboBoxItems, contentNodes, this.a11yNamePropertyMap, combineOptions({
      listener: () => {
        carouselAndPageControl.visible = !carouselAndPageControl.visible;
      },
      widthSizable: options.widthSizable,
      localPreferredWidthProperty: this.localPreferredWidthProperty,
      localMinimumWidthProperty: this.localMinimumWidthProperty
    }, options.buttonOptions));

    // Put the button above the carousel, left aligned.
    const vBox = new VBox({
      spacing: 0,
      align: 'left',
      children: [button, carouselAndPageControl]
    });

    // Wrap everything with Node, to hide VBox's API.
    options.children = [vBox];
    this.mutate(options);

    // If the Property changes, hide the carousel. unlink is needed on disposed.
    const propertyListener = () => {
      carouselAndPageControl.visible = false;
    };
    property.link(propertyListener);

    // Clicking outside this UI component will hide the carousel and page control.
    // NOTE: adapted from ComboBox.
    const clickToDismissListener = {
      down: event => {
        assert && assert(carousel.visible, 'this listener should be registered only when carousel is visible');

        // If fuzzing is enabled, exercise this listener some percentage of the time, so that this listener is tested.
        // The rest of the time, ignore this listener, so that the carousel remains popped up, and we test making
        // choices from the carousel. See https://github.com/phetsims/sun/issues/677
        if (!phet.chipper.isFuzzEnabled() || dotRandom.nextDouble() < 0.25) {
          const trail = event.trail;
          if (!trail.containsNode(button) && !trail.containsNode(carousel) && (!pageControl || !trail.containsNode(pageControl))) {
            carouselAndPageControl.visible = false;
          }
        }
      }
    };

    // Add clickToDismissListener only when the carousel & page control are visible. unlink is not needed.
    // NOTE: adapted from ComboBox.
    let display = null;
    carouselAndPageControl.visibleProperty.link(visible => {
      if (visible) {
        assert && assert(!display, 'unexpected display');
        display = this.getUniqueTrail().rootNode().getRootedDisplays()[0];
        display.addInputListener(clickToDismissListener);
      } else {
        if (display && display.hasInputListener(clickToDismissListener)) {
          display.removeInputListener(clickToDismissListener);
          display = null;
        }
      }
    });
    this.disposeCarouselComboBox = () => {
      // Deregister observers
      property.unlink(propertyListener);

      // Dispose of subcomponents
      button.dispose();
      pageControl && pageControl.dispose();
      carousel.dispose();
      contentNodes.forEach(node => node.dispose());
    };
  }
  dispose() {
    this.disposeCarouselComboBox();
    super.dispose();
  }
}
/**
 * CarouselItemNode is an item this UI component's carousel. Carousel and ComboBox have different APIs for 'items'.
 * This class adapts a ComboBoxItem by making the Node have uniform dimensions, and putting a background behind the
 * Node. The background changes color when the item is selected or the pointer is over the item.
 */
class CarouselItemNode extends Node {
  constructor(property, comboBoxItem, node, alignGroup, providedOptions) {
    const options = optionize()({
      // CarouselItemNodeSelfOptions
      align: 'left',
      xMargin: 6,
      yMargin: 2,
      overColor: Color.grayColor(245),
      selectedColor: 'yellow',
      // NodeOptions
      tandem: Tandem.OPTIONAL
    }, providedOptions);
    const uniformNode = new AlignBox(node, {
      xAlign: options.align,
      group: alignGroup
    });
    const backgroundNode = new Rectangle(0, 0, 1, 1);

    // Size backgroundNode to fit uniformNode. Note that uniformNode's bounds may change when additional Nodes are
    // added to alignGroup.
    uniformNode.boundsProperty.link(bounds => {
      backgroundNode.setRectBounds(bounds.dilatedXY(options.xMargin, options.yMargin));
    });
    options.children = [backgroundNode, uniformNode];
    super(options);

    // Press on an item to select its associated value.
    const pressListener = new PressListener({
      press: () => {
        property.value = comboBoxItem.value;
      },
      tandem: options.tandem.createTandem('pressListener')
    });
    this.addInputListener(pressListener);

    // Selecting an item sets its background to the selected color.
    // Pointer over an item sets its background to the highlighted color.
    // Must be disposed because we do not own property.
    const multilink = new Multilink([property, pressListener.isOverProperty], (propertyValue, isOver) => {
      if (propertyValue === comboBoxItem.value) {
        backgroundNode.fill = options.selectedColor;
      } else if (isOver) {
        backgroundNode.fill = options.overColor;
      } else {
        backgroundNode.fill = 'transparent';
      }
    });
    this.disposeCarouselItemNode = () => {
      multilink.dispose();
    };
  }
  dispose() {
    this.disposeCarouselItemNode();
    super.dispose();
  }
}
sun.register('CarouselComboBox', CarouselComboBox);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJEaW1lbnNpb24yIiwiZG90UmFuZG9tIiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJBbGlnbkJveCIsIkFsaWduR3JvdXAiLCJDb2xvciIsIkhCb3giLCJOb2RlIiwiUHJlc3NMaXN0ZW5lciIsIlJlY3RhbmdsZSIsIlZCb3giLCJXaWR0aFNpemFibGUiLCJUYW5kZW0iLCJDYXJvdXNlbCIsIkNvbWJvQm94QnV0dG9uIiwiUGFnZUNvbnRyb2wiLCJzdW4iLCJDb21ib0JveCIsImdldEdyb3VwSXRlbU5vZGVzIiwiQ2Fyb3VzZWxDb21ib0JveCIsImNvbnN0cnVjdG9yIiwicHJvcGVydHkiLCJjb21ib0JveEl0ZW1zIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsIml0ZW1Ob2RlT3B0aW9ucyIsImFsaWduIiwib3ZlckNvbG9yIiwiZ3JheUNvbG9yIiwic2VsZWN0ZWRDb2xvciIsInhNYXJnaW4iLCJ5TWFyZ2luIiwiY2Fyb3VzZWxPcHRpb25zIiwiYnV0dG9uT3B0aW9ucyIsImFycm93U2l6ZSIsIm9yaWVudGF0aW9uIiwic3BhY2luZyIsIm1hcmdpbiIsIml0ZW1zUGVyUGFnZSIsInBhZ2VDb250cm9sT3B0aW9ucyIsImludGVyYWN0aXZlIiwiYXJyb3dEaXJlY3Rpb24iLCJiYXNlQ29sb3IiLCJ0YW5kZW0iLCJPUFRJT05BTCIsImFzc2VydCIsIk1hdGgiLCJtaW4iLCJsZW5ndGgiLCJjcmVhdGVUYW5kZW0iLCJhMTF5TmFtZVByb3BlcnR5TWFwIiwiZ2V0QTExeU5hbWVQcm9wZXJ0eU1hcCIsImFsaWduR3JvdXAiLCJjb250ZW50Tm9kZXMiLCJjYXJvdXNlbEl0ZW1Ob2RlcyIsIl8iLCJtYXAiLCJjb21ib0JveEl0ZW0iLCJpIiwiY3JlYXRlTm9kZSIsIkNhcm91c2VsSXRlbU5vZGUiLCJoQm94Q2hpbGRyZW4iLCJjYXJvdXNlbCIsInB1c2giLCJwYWdlQ29udHJvbCIsIm51bWJlck9mUGFnZXNQcm9wZXJ0eSIsInZhbHVlIiwicGFnZU51bWJlclByb3BlcnR5IiwiY2Fyb3VzZWxBbmRQYWdlQ29udHJvbCIsImNoaWxkcmVuIiwiYnV0dG9uIiwibGlzdGVuZXIiLCJ2aXNpYmxlIiwid2lkdGhTaXphYmxlIiwibG9jYWxQcmVmZXJyZWRXaWR0aFByb3BlcnR5IiwibG9jYWxNaW5pbXVtV2lkdGhQcm9wZXJ0eSIsInZCb3giLCJtdXRhdGUiLCJwcm9wZXJ0eUxpc3RlbmVyIiwibGluayIsImNsaWNrVG9EaXNtaXNzTGlzdGVuZXIiLCJkb3duIiwiZXZlbnQiLCJwaGV0IiwiY2hpcHBlciIsImlzRnV6ekVuYWJsZWQiLCJuZXh0RG91YmxlIiwidHJhaWwiLCJjb250YWluc05vZGUiLCJkaXNwbGF5IiwidmlzaWJsZVByb3BlcnR5IiwiZ2V0VW5pcXVlVHJhaWwiLCJyb290Tm9kZSIsImdldFJvb3RlZERpc3BsYXlzIiwiYWRkSW5wdXRMaXN0ZW5lciIsImhhc0lucHV0TGlzdGVuZXIiLCJyZW1vdmVJbnB1dExpc3RlbmVyIiwiZGlzcG9zZUNhcm91c2VsQ29tYm9Cb3giLCJ1bmxpbmsiLCJkaXNwb3NlIiwiZm9yRWFjaCIsIm5vZGUiLCJ1bmlmb3JtTm9kZSIsInhBbGlnbiIsImdyb3VwIiwiYmFja2dyb3VuZE5vZGUiLCJib3VuZHNQcm9wZXJ0eSIsImJvdW5kcyIsInNldFJlY3RCb3VuZHMiLCJkaWxhdGVkWFkiLCJwcmVzc0xpc3RlbmVyIiwicHJlc3MiLCJtdWx0aWxpbmsiLCJpc092ZXJQcm9wZXJ0eSIsInByb3BlcnR5VmFsdWUiLCJpc092ZXIiLCJmaWxsIiwiZGlzcG9zZUNhcm91c2VsSXRlbU5vZGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNhcm91c2VsQ29tYm9Cb3gudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ2Fyb3VzZWxDb21ib0JveCBiZWhhdmVzIGxpa2UgYSBjb21ibyBib3gsIGJ1dCBpdHMgbGlzdGJveCBpcyBhIGNhcm91c2VsLiBUaGlzIGFsbG93cyB5b3UgdG8gc2Nyb2xsIHRocm91Z2ggYVxyXG4gKiBsb25nIGxpc3Qgb2YgaXRlbXMsIGEgZmVhdHVyZSB0aGF0IENvbWJvQm94TGlzdEJveCBkb2VzIG5vdCBzdXBwb3J0LiBDb21ib0JveEl0ZW0sIENvbWJvQm94QnV0dG9uLCBhbmRcclxuICogQ2Fyb3VzZWwgYXJlIHJldXNlZC5cclxuICpcclxuICogVEhJTksgVFdJQ0UgQkVGT1JFIFVTSU5HIFRISVMgSU4gQSBTSU0hXHJcbiAqIENhcm91c2VsQ29tYm9Cb3ggd2FzIGNyZWF0ZWQgYXMgYSBxdWljayB3YXkgdG8gYWRkcmVzcyBzaXR1YXRpb25zIHdoZXJlIENvbWJvQm94J3MgbGlzdGJveCBnZXRzIHRvbyBsb25nLFxyXG4gKiBmb3IgZXhhbXBsZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc3VuL2lzc3Vlcy82NzMuIFRoaXMgdGVuZHMgdG8gaGFwcGVuIGluIGludGVybmFsICdkZW1vJyBhcHBsaWNhdGlvbnNcclxuICogKHN1biwgc2NlbmVyeS1waGV0LC4uLiApIHRoYXQgaGF2ZSBsb25nIGxpc3RzIG9mIGRlbW9zLiBBbmQgYXMgYSBkZXNpZ24gYmVzdC1wcmFjdGljZSwgUGhFVCB0ZW5kcyB0byBhdm9pZFxyXG4gKiBsb25ncyBsaXN0cyBvZiB0aGluZ3MgaW4gc2ltcy4gU28gaWYgeW91IGZpbmQgeW91cnNlbGYgcmVhY2hpbmcgZm9yIENhcm91c2VsQ29tYm9Cb3gsIGNvbnNpZGVyIHdoZXRoZXIgYVxyXG4gKiBkaWZmZXJlbnQgVUkgY29tcG9uZW50IG1pZ2h0IHByb3ZpZGUgYSBiZXR0ZXIgVVguXHJcbiAqXHJcbiAqIFBvc3NpYmxlIGZ1dHVyZSB3b3JrOlxyXG4gKiAtIE1vZGlmeSBDb21ib0JveCBzbyB0aGF0IGl0IGNhbiB1c2UgZGlmZmVyZW50IHR5cGVzIG9mIHBvcHVwcyAoQ29tYm9Cb3hMaXN0Qm94LCBDYXJvdXNlbCwuLi4pLCBvclxyXG4gKiAtIE1ha2UgQ2Fyb3VzZWxDb21ib0JveCBwb3AgdXAgdGhlIENhcm91c2VsIGluIGZyb250IG9mIGV2ZXJ5dGhpbmcgZWxzZVxyXG4gKiAtIGExMXkgc3VwcG9ydCBpbiBDYXJvdXNlbENvbWJvQm94XHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFRQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IGRvdFJhbmRvbSBmcm9tICcuLi8uLi9kb3QvanMvZG90UmFuZG9tLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBjb21iaW5lT3B0aW9ucyB9IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgeyBBbGlnbkJveCwgQWxpZ25Hcm91cCwgQ29sb3IsIERpc3BsYXksIEhCb3gsIE5vZGUsIE5vZGVPcHRpb25zLCBQcmVzc0xpc3RlbmVyLCBSZWN0YW5nbGUsIFNjZW5lcnlFdmVudCwgVENvbG9yLCBWQm94LCBXaWR0aFNpemFibGUsIFdpZHRoU2l6YWJsZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgQ2Fyb3VzZWwsIHsgQ2Fyb3VzZWxPcHRpb25zIH0gZnJvbSAnLi9DYXJvdXNlbC5qcyc7XHJcbmltcG9ydCBDb21ib0JveEJ1dHRvbiwgeyBDb21ib0JveEJ1dHRvbk9wdGlvbnMgfSBmcm9tICcuL0NvbWJvQm94QnV0dG9uLmpzJztcclxuaW1wb3J0IFBhZ2VDb250cm9sLCB7IFBhZ2VDb250cm9sT3B0aW9ucyB9IGZyb20gJy4vUGFnZUNvbnRyb2wuanMnO1xyXG5pbXBvcnQgc3VuIGZyb20gJy4vc3VuLmpzJztcclxuaW1wb3J0IENvbWJvQm94LCB7IENvbWJvQm94QTExeU5hbWVQcm9wZXJ0eU1hcCwgQ29tYm9Cb3hJdGVtIH0gZnJvbSAnLi9Db21ib0JveC5qcyc7XHJcbmltcG9ydCB7IGdldEdyb3VwSXRlbU5vZGVzIH0gZnJvbSAnLi9Hcm91cEl0ZW1PcHRpb25zLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIE5lc3RlZCBvcHRpb25zIHBhc3NlZCB0byBzdWJjb21wb25lbnRzXHJcbiAgaXRlbU5vZGVPcHRpb25zPzogQ2Fyb3VzZWxJdGVtTm9kZU9wdGlvbnM7XHJcbiAgY2Fyb3VzZWxPcHRpb25zPzogQ2Fyb3VzZWxPcHRpb25zO1xyXG4gIHBhZ2VDb250cm9sT3B0aW9ucz86IFN0cmljdE9taXQ8UGFnZUNvbnRyb2xPcHRpb25zLCAnb3JpZW50YXRpb24nPjtcclxuICBidXR0b25PcHRpb25zPzogU3RyaWN0T21pdDxDb21ib0JveEJ1dHRvbk9wdGlvbnMsICdjb250ZW50JyB8ICdsaXN0ZW5lcic+O1xyXG59O1xyXG5cclxudHlwZSBQYXJlbnRPcHRpb25zID0gTm9kZU9wdGlvbnMgJiBXaWR0aFNpemFibGVPcHRpb25zO1xyXG5leHBvcnQgdHlwZSBDYXJvdXNlbENvbWJvQm94T3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxQYXJlbnRPcHRpb25zLCAnY2hpbGRyZW4nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcm91c2VsQ29tYm9Cb3g8VD4gZXh0ZW5kcyBXaWR0aFNpemFibGUoIE5vZGUgKSB7XHJcblxyXG4gIC8vIFNlZSBDb21ib0JveCBmb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGlzIHByb3BlcnR5LlxyXG4gIHB1YmxpYyByZWFkb25seSBhMTF5TmFtZVByb3BlcnR5TWFwOiBDb21ib0JveEExMXlOYW1lUHJvcGVydHlNYXA8VD47XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUNhcm91c2VsQ29tYm9Cb3g6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eSAtIHRoZSBQcm9wZXJ0eSB0aGF0IGlzIHNldCB3aGVuIGFuIGl0ZW0gaXMgc2VsZWN0ZWRcclxuICAgKiBAcGFyYW0gY29tYm9Cb3hJdGVtcyAtIHRoZSBpdGVtcyB0aGF0IGFwcGVhciBpbiB0aGUgY2Fyb3VzZWxcclxuICAgKiBAcGFyYW0gcHJvdmlkZWRPcHRpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm9wZXJ0eTogVFByb3BlcnR5PFQ+LCBjb21ib0JveEl0ZW1zOiBDb21ib0JveEl0ZW08VD5bXSwgcHJvdmlkZWRPcHRpb25zPzogQ2Fyb3VzZWxDb21ib0JveE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxDYXJvdXNlbENvbWJvQm94T3B0aW9ucywgU2VsZk9wdGlvbnMsIFBhcmVudE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIGl0ZW1Ob2RlT3B0aW9uczoge1xyXG4gICAgICAgIGFsaWduOiAnbGVmdCcsIC8vIHtzdHJpbmd9IGFsaWdubWVudCBvZiBpdGVtIG5vZGVzIG9uIGJhY2tncm91bmRzLCAnbGVmdCd8J2NlbnRlcid8J3JpZ2h0J1xyXG4gICAgICAgIG92ZXJDb2xvcjogQ29sb3IuZ3JheUNvbG9yKCAyNDUgKSwgLy8ge0NvbG9yRGVmfSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBpdGVtIHRoYXQgdGhlIHBvaW50ZXIgaXMgb3ZlclxyXG4gICAgICAgIHNlbGVjdGVkQ29sb3I6ICd5ZWxsb3cnLCAvLyB7Q29sb3JEZWZ9IGJhY2tncm91bmQgY29sb3Igb2YgdGhlIHNlbGVjdGVkIGl0ZW1cclxuICAgICAgICB4TWFyZ2luOiA2LCAvLyB7bnVtYmVyfSB4IG1hcmdpbiBmb3IgYmFja2dyb3VuZHMgb24gdGhlIGl0ZW1zIGluIHRoZSBjYXJvdXNlbFxyXG4gICAgICAgIHlNYXJnaW46IDIgLy8ge251bWJlcn0geSBtYXJnaW4gZm9yIGJhY2tncm91bmRzIG9uIHRoZSBpdGVtcyBpbiB0aGUgY2Fyb3VzZWxcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGNhcm91c2VsT3B0aW9uczoge1xyXG4gICAgICAgIGJ1dHRvbk9wdGlvbnM6IHtcclxuICAgICAgICAgIGFycm93U2l6ZTogbmV3IERpbWVuc2lvbjIoIDIwLCA0IClcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyBMaWtlIENvbWJvQm94LCAndmVydGljYWwnIGlzIHRoZSBvbmx5IG9yaWVudGF0aW9uIHN1cHBvcnRlZCAodmVyaWZpZWQgYmVsb3cpLlxyXG4gICAgICAgIG9yaWVudGF0aW9uOiAndmVydGljYWwnLFxyXG5cclxuICAgICAgICAvLyBTcGFjaW5nIGFuZCBtYXJnaW5zIHdpbGwgYmUgYnVpbHQgaW50byB0aGUgYmFja2dyb3VuZHMgdGhhdCBhcmUgYWRkIHRvIHRoZSBpdGVtIE5vZGVzLFxyXG4gICAgICAgIC8vIHNvIHNldCB0aGVtIHRvIHplcm8gZm9yIHRoZSBjYXJvdXNlbC5cclxuICAgICAgICBzcGFjaW5nOiAwLFxyXG4gICAgICAgIG1hcmdpbjogMCxcclxuXHJcbiAgICAgICAgLy8ge251bWJlcn0gSWYgdGhlcmUgYXJlIGZld2VyIGl0ZW1zIHRoYW4gdGhpcyBpbiB0aGUgY2Fyb3VzZWwsIHRoZSBhY3R1YWwgbnVtYmVyIG9mIGl0ZW1zIHdpbGwgYmUgdXNlZC5cclxuICAgICAgICBpdGVtc1BlclBhZ2U6IDE1XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBwYWdlQ29udHJvbE9wdGlvbnM6IHtcclxuICAgICAgICBpbnRlcmFjdGl2ZTogdHJ1ZVxyXG4gICAgICB9LFxyXG5cclxuICAgICAgYnV0dG9uT3B0aW9uczoge1xyXG4gICAgICAgIGFycm93RGlyZWN0aW9uOiAnZG93bicsIC8vICd1cCcgaXMgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgKHZlcmlmaWVkIGJlbG93KVxyXG4gICAgICAgIGJhc2VDb2xvcjogJ3JnYiggMjE4LCAyMzYsIDI1NSApJyxcclxuICAgICAgICB4TWFyZ2luOiA2LCAvLyBZb3UnbGwgdHlwaWNhbGx5IHdhbnQgdGhpcyB0byBiZSB0aGUgc2FtZSBhcyBpdGVtTm9kZU9wdGlvbnMueE1hcmdpbiwgYnV0IHdlJ3JlIG5vdCBnb2luZyB0byBmb3JjZSB5b3UgOilcclxuICAgICAgICB5TWFyZ2luOiA0XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLk9QVElPTkFMXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBvcHRpb25zXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLmNhcm91c2VsT3B0aW9ucy5vcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJywgJ29yaWVudGF0aW9uIG11c3QgYmUgdmVydGljYWwnICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLmJ1dHRvbk9wdGlvbnMuYXJyb3dEaXJlY3Rpb24gPT09ICdkb3duJywgJ2Fycm93RGlyZWN0aW9uIG11c3QgYmUgZG93bicgKTtcclxuXHJcbiAgICAvLyBEb24ndCBjcmVhdGUgcGFnZXMgdGhhdCBhcmUgbG9uZ2VyIHRoYW4gdGhlIG51bWJlciBvZiBpdGVtc1xyXG4gICAgb3B0aW9ucy5jYXJvdXNlbE9wdGlvbnMuaXRlbXNQZXJQYWdlID0gTWF0aC5taW4oIG9wdGlvbnMuY2Fyb3VzZWxPcHRpb25zLml0ZW1zUGVyUGFnZSEsIGNvbWJvQm94SXRlbXMubGVuZ3RoICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRhbmRlbXMgZm9yIHN1YmNvbXBvbmVudHMsIGlmIHRoZXkgd2VyZSBub3QgcHJvdmlkZWRcclxuICAgIG9wdGlvbnMuY2Fyb3VzZWxPcHRpb25zLnRhbmRlbSA9IG9wdGlvbnMuY2Fyb3VzZWxPcHRpb25zLnRhbmRlbSB8fCBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdjYXJvdXNlbCcgKTtcclxuICAgIG9wdGlvbnMuYnV0dG9uT3B0aW9ucy50YW5kZW0gPSBvcHRpb25zLmJ1dHRvbk9wdGlvbnMudGFuZGVtIHx8IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2J1dHRvbicgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIHRoaXMuYTExeU5hbWVQcm9wZXJ0eU1hcCA9IENvbWJvQm94LmdldEExMXlOYW1lUHJvcGVydHlNYXAoIGNvbWJvQm94SXRlbXMgKTtcclxuXHJcbiAgICAvLyBNYWtlIGl0ZW1zIGluIHRoZSBjYXJvdXNlbCBoYXZlIHRoZSBzYW1lIHdpZHRoIGFuZCBoZWlnaHQuXHJcbiAgICBjb25zdCBhbGlnbkdyb3VwID0gbmV3IEFsaWduR3JvdXAoKTtcclxuXHJcbiAgICBjb25zdCBjb250ZW50Tm9kZXMgPSBnZXRHcm91cEl0ZW1Ob2RlcyggY29tYm9Cb3hJdGVtcywgb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaXRlbXMnICkgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgaXRlbXMgZm9yIHRoZSBjYXJvdXNlbCwgd2hvc2UgQVBJIGZvciAnaXRlbXMnIGlzIGRpZmZlcmVudCB0aGFuIENvbWJvQm94LlxyXG4gICAgY29uc3QgY2Fyb3VzZWxJdGVtTm9kZXMgPSBfLm1hcCggY29tYm9Cb3hJdGVtcyxcclxuICAgICAgKCBjb21ib0JveEl0ZW0sIGkgKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHsgY3JlYXRlTm9kZTogKCkgPT4gbmV3IENhcm91c2VsSXRlbU5vZGUoIHByb3BlcnR5LCBjb21ib0JveEl0ZW0sIGNvbnRlbnROb2Rlc1sgaSBdLCBhbGlnbkdyb3VwLCBvcHRpb25zLml0ZW1Ob2RlT3B0aW9ucyApIH07XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjYXJvdXNlbEl0ZW1Ob2Rlcy5sZW5ndGggPT09IGNvbWJvQm94SXRlbXMubGVuZ3RoLCAnZXhwZWN0ZWQgYSBjYXJvdXNlbEl0ZW0gZm9yIGVhY2ggY29tYm9Cb3hJdGVtJyApO1xyXG5cclxuICAgIGNvbnN0IGhCb3hDaGlsZHJlbiA9IFtdO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgY2Fyb3VzZWwuXHJcbiAgICBjb25zdCBjYXJvdXNlbCA9IG5ldyBDYXJvdXNlbCggY2Fyb3VzZWxJdGVtTm9kZXMsIG9wdGlvbnMuY2Fyb3VzZWxPcHRpb25zICk7XHJcbiAgICBoQm94Q2hpbGRyZW4ucHVzaCggY2Fyb3VzZWwgKTtcclxuXHJcbiAgICAvLyBwYWdlIGNvbnRyb2xcclxuICAgIGxldCBwYWdlQ29udHJvbDogUGFnZUNvbnRyb2wgfCBudWxsID0gbnVsbDtcclxuICAgIGlmICggY2Fyb3VzZWwubnVtYmVyT2ZQYWdlc1Byb3BlcnR5LnZhbHVlID4gMSApIHtcclxuICAgICAgcGFnZUNvbnRyb2wgPSBuZXcgUGFnZUNvbnRyb2woIGNhcm91c2VsLnBhZ2VOdW1iZXJQcm9wZXJ0eSwgY2Fyb3VzZWwubnVtYmVyT2ZQYWdlc1Byb3BlcnR5LCBjb21iaW5lT3B0aW9uczxQYWdlQ29udHJvbE9wdGlvbnM+KCB7XHJcbiAgICAgICAgb3JpZW50YXRpb246IG9wdGlvbnMuY2Fyb3VzZWxPcHRpb25zLm9yaWVudGF0aW9uXHJcbiAgICAgIH0sIG9wdGlvbnMucGFnZUNvbnRyb2xPcHRpb25zICkgKTtcclxuICAgICAgaEJveENoaWxkcmVuLnB1c2goIHBhZ2VDb250cm9sICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcGFnZUNvbnRyb2wgdG8gdGhlIGxlZnQgb2YgY2Fyb3VzZWxcclxuICAgIGNvbnN0IGNhcm91c2VsQW5kUGFnZUNvbnRyb2wgPSBuZXcgSEJveCgge1xyXG4gICAgICBzcGFjaW5nOiA0LFxyXG4gICAgICBjaGlsZHJlbjogaEJveENoaWxkcmVuXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gUHJlc3NpbmcgdGhpcyBidXR0b24gcG9wcyB0aGUgY2Fyb3VzZWwgdXAgYW5kIGRvd25cclxuICAgIGNvbnN0IGJ1dHRvbiA9IG5ldyBDb21ib0JveEJ1dHRvbiggcHJvcGVydHksIGNvbWJvQm94SXRlbXMsIGNvbnRlbnROb2RlcywgdGhpcy5hMTF5TmFtZVByb3BlcnR5TWFwLCBjb21iaW5lT3B0aW9uczxDb21ib0JveEJ1dHRvbk9wdGlvbnM+KCB7XHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgY2Fyb3VzZWxBbmRQYWdlQ29udHJvbC52aXNpYmxlID0gIWNhcm91c2VsQW5kUGFnZUNvbnRyb2wudmlzaWJsZTtcclxuICAgICAgfSxcclxuICAgICAgd2lkdGhTaXphYmxlOiBvcHRpb25zLndpZHRoU2l6YWJsZSxcclxuICAgICAgbG9jYWxQcmVmZXJyZWRXaWR0aFByb3BlcnR5OiB0aGlzLmxvY2FsUHJlZmVycmVkV2lkdGhQcm9wZXJ0eSxcclxuICAgICAgbG9jYWxNaW5pbXVtV2lkdGhQcm9wZXJ0eTogdGhpcy5sb2NhbE1pbmltdW1XaWR0aFByb3BlcnR5XHJcbiAgICB9LCBvcHRpb25zLmJ1dHRvbk9wdGlvbnMgKSApO1xyXG5cclxuICAgIC8vIFB1dCB0aGUgYnV0dG9uIGFib3ZlIHRoZSBjYXJvdXNlbCwgbGVmdCBhbGlnbmVkLlxyXG4gICAgY29uc3QgdkJveCA9IG5ldyBWQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDAsXHJcbiAgICAgIGFsaWduOiAnbGVmdCcsXHJcbiAgICAgIGNoaWxkcmVuOiBbIGJ1dHRvbiwgY2Fyb3VzZWxBbmRQYWdlQ29udHJvbCBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gV3JhcCBldmVyeXRoaW5nIHdpdGggTm9kZSwgdG8gaGlkZSBWQm94J3MgQVBJLlxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgdkJveCBdO1xyXG5cclxuICAgIHRoaXMubXV0YXRlKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gSWYgdGhlIFByb3BlcnR5IGNoYW5nZXMsIGhpZGUgdGhlIGNhcm91c2VsLiB1bmxpbmsgaXMgbmVlZGVkIG9uIGRpc3Bvc2VkLlxyXG4gICAgY29uc3QgcHJvcGVydHlMaXN0ZW5lciA9ICgpID0+IHsgY2Fyb3VzZWxBbmRQYWdlQ29udHJvbC52aXNpYmxlID0gZmFsc2U7IH07XHJcbiAgICBwcm9wZXJ0eS5saW5rKCBwcm9wZXJ0eUxpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gQ2xpY2tpbmcgb3V0c2lkZSB0aGlzIFVJIGNvbXBvbmVudCB3aWxsIGhpZGUgdGhlIGNhcm91c2VsIGFuZCBwYWdlIGNvbnRyb2wuXHJcbiAgICAvLyBOT1RFOiBhZGFwdGVkIGZyb20gQ29tYm9Cb3guXHJcbiAgICBjb25zdCBjbGlja1RvRGlzbWlzc0xpc3RlbmVyID0ge1xyXG4gICAgICBkb3duOiAoIGV2ZW50OiBTY2VuZXJ5RXZlbnQgKSA9PiB7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggY2Fyb3VzZWwudmlzaWJsZSwgJ3RoaXMgbGlzdGVuZXIgc2hvdWxkIGJlIHJlZ2lzdGVyZWQgb25seSB3aGVuIGNhcm91c2VsIGlzIHZpc2libGUnICk7XHJcblxyXG4gICAgICAgIC8vIElmIGZ1enppbmcgaXMgZW5hYmxlZCwgZXhlcmNpc2UgdGhpcyBsaXN0ZW5lciBzb21lIHBlcmNlbnRhZ2Ugb2YgdGhlIHRpbWUsIHNvIHRoYXQgdGhpcyBsaXN0ZW5lciBpcyB0ZXN0ZWQuXHJcbiAgICAgICAgLy8gVGhlIHJlc3Qgb2YgdGhlIHRpbWUsIGlnbm9yZSB0aGlzIGxpc3RlbmVyLCBzbyB0aGF0IHRoZSBjYXJvdXNlbCByZW1haW5zIHBvcHBlZCB1cCwgYW5kIHdlIHRlc3QgbWFraW5nXHJcbiAgICAgICAgLy8gY2hvaWNlcyBmcm9tIHRoZSBjYXJvdXNlbC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzY3N1xyXG4gICAgICAgIGlmICggIXBoZXQuY2hpcHBlci5pc0Z1enpFbmFibGVkKCkgfHwgZG90UmFuZG9tLm5leHREb3VibGUoKSA8IDAuMjUgKSB7XHJcbiAgICAgICAgICBjb25zdCB0cmFpbCA9IGV2ZW50LnRyYWlsO1xyXG4gICAgICAgICAgaWYgKCAhdHJhaWwuY29udGFpbnNOb2RlKCBidXR0b24gKSAmJiAhdHJhaWwuY29udGFpbnNOb2RlKCBjYXJvdXNlbCApICYmICggIXBhZ2VDb250cm9sIHx8ICF0cmFpbC5jb250YWluc05vZGUoIHBhZ2VDb250cm9sICkgKSApIHtcclxuICAgICAgICAgICAgY2Fyb3VzZWxBbmRQYWdlQ29udHJvbC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEFkZCBjbGlja1RvRGlzbWlzc0xpc3RlbmVyIG9ubHkgd2hlbiB0aGUgY2Fyb3VzZWwgJiBwYWdlIGNvbnRyb2wgYXJlIHZpc2libGUuIHVubGluayBpcyBub3QgbmVlZGVkLlxyXG4gICAgLy8gTk9URTogYWRhcHRlZCBmcm9tIENvbWJvQm94LlxyXG4gICAgbGV0IGRpc3BsYXk6IERpc3BsYXkgfCBudWxsID0gbnVsbDtcclxuICAgIGNhcm91c2VsQW5kUGFnZUNvbnRyb2wudmlzaWJsZVByb3BlcnR5LmxpbmsoIHZpc2libGUgPT4ge1xyXG4gICAgICBpZiAoIHZpc2libGUgKSB7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggIWRpc3BsYXksICd1bmV4cGVjdGVkIGRpc3BsYXknICk7XHJcbiAgICAgICAgZGlzcGxheSA9IHRoaXMuZ2V0VW5pcXVlVHJhaWwoKS5yb290Tm9kZSgpLmdldFJvb3RlZERpc3BsYXlzKClbIDAgXTtcclxuICAgICAgICBkaXNwbGF5LmFkZElucHV0TGlzdGVuZXIoIGNsaWNrVG9EaXNtaXNzTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBpZiAoIGRpc3BsYXkgJiYgZGlzcGxheS5oYXNJbnB1dExpc3RlbmVyKCBjbGlja1RvRGlzbWlzc0xpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgICBkaXNwbGF5LnJlbW92ZUlucHV0TGlzdGVuZXIoIGNsaWNrVG9EaXNtaXNzTGlzdGVuZXIgKTtcclxuICAgICAgICAgIGRpc3BsYXkgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUNhcm91c2VsQ29tYm9Cb3ggPSAoKSA9PiB7XHJcblxyXG4gICAgICAvLyBEZXJlZ2lzdGVyIG9ic2VydmVyc1xyXG4gICAgICBwcm9wZXJ0eS51bmxpbmsoIHByb3BlcnR5TGlzdGVuZXIgKTtcclxuXHJcbiAgICAgIC8vIERpc3Bvc2Ugb2Ygc3ViY29tcG9uZW50c1xyXG4gICAgICBidXR0b24uZGlzcG9zZSgpO1xyXG4gICAgICBwYWdlQ29udHJvbCAmJiBwYWdlQ29udHJvbC5kaXNwb3NlKCk7XHJcbiAgICAgIGNhcm91c2VsLmRpc3Bvc2UoKTtcclxuICAgICAgY29udGVudE5vZGVzLmZvckVhY2goIG5vZGUgPT4gbm9kZS5kaXNwb3NlKCkgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUNhcm91c2VsQ29tYm9Cb3goKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnR5cGUgQ2Fyb3VzZWxJdGVtTm9kZVNlbGZPcHRpb25zID0ge1xyXG4gIGFsaWduPzogJ2xlZnQnIHwgJ3JpZ2h0JyB8ICdjZW50ZXInOyAvLyBhbGlnbm1lbnQgb2Ygbm9kZSBvbiBiYWNrZ3JvdW5kXHJcbiAgeE1hcmdpbj86IG51bWJlcjsgLy8geCBtYXJnaW4gZm9yIGJhY2tncm91bmRzIG9uIHRoZSBpdGVtcyBpbiB0aGUgY2Fyb3VzZWxcclxuICB5TWFyZ2luPzogbnVtYmVyOyAvLyB5IG1hcmdpbiBmb3IgYmFja2dyb3VuZHMgb24gdGhlIGl0ZW1zIGluIHRoZSBjYXJvdXNlbFxyXG4gIG92ZXJDb2xvcj86IFRDb2xvcjsgLy8gYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgaXRlbSB0aGF0IHRoZSBwb2ludGVyIGlzIG92ZXJcclxuICBzZWxlY3RlZENvbG9yPzogVENvbG9yOyAvLyBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBzZWxlY3RlZCBpdGVtXHJcbn07XHJcblxyXG50eXBlIENhcm91c2VsSXRlbU5vZGVPcHRpb25zID0gQ2Fyb3VzZWxJdGVtTm9kZVNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxOb2RlT3B0aW9ucywgJ2NoaWxkcmVuJz47XHJcblxyXG4vKipcclxuICogQ2Fyb3VzZWxJdGVtTm9kZSBpcyBhbiBpdGVtIHRoaXMgVUkgY29tcG9uZW50J3MgY2Fyb3VzZWwuIENhcm91c2VsIGFuZCBDb21ib0JveCBoYXZlIGRpZmZlcmVudCBBUElzIGZvciAnaXRlbXMnLlxyXG4gKiBUaGlzIGNsYXNzIGFkYXB0cyBhIENvbWJvQm94SXRlbSBieSBtYWtpbmcgdGhlIE5vZGUgaGF2ZSB1bmlmb3JtIGRpbWVuc2lvbnMsIGFuZCBwdXR0aW5nIGEgYmFja2dyb3VuZCBiZWhpbmQgdGhlXHJcbiAqIE5vZGUuIFRoZSBiYWNrZ3JvdW5kIGNoYW5nZXMgY29sb3Igd2hlbiB0aGUgaXRlbSBpcyBzZWxlY3RlZCBvciB0aGUgcG9pbnRlciBpcyBvdmVyIHRoZSBpdGVtLlxyXG4gKi9cclxuY2xhc3MgQ2Fyb3VzZWxJdGVtTm9kZTxUPiBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VDYXJvdXNlbEl0ZW1Ob2RlOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3BlcnR5OiBUUHJvcGVydHk8VD4sIGNvbWJvQm94SXRlbTogQ29tYm9Cb3hJdGVtPFQ+LCBub2RlOiBOb2RlLCBhbGlnbkdyb3VwOiBBbGlnbkdyb3VwLCBwcm92aWRlZE9wdGlvbnM/OiBDYXJvdXNlbEl0ZW1Ob2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPENhcm91c2VsSXRlbU5vZGVPcHRpb25zLCBDYXJvdXNlbEl0ZW1Ob2RlU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBDYXJvdXNlbEl0ZW1Ob2RlU2VsZk9wdGlvbnNcclxuICAgICAgYWxpZ246ICdsZWZ0JyxcclxuICAgICAgeE1hcmdpbjogNixcclxuICAgICAgeU1hcmdpbjogMixcclxuICAgICAgb3ZlckNvbG9yOiBDb2xvci5ncmF5Q29sb3IoIDI0NSApLFxyXG4gICAgICBzZWxlY3RlZENvbG9yOiAneWVsbG93JyxcclxuXHJcbiAgICAgIC8vIE5vZGVPcHRpb25zXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLk9QVElPTkFMXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCB1bmlmb3JtTm9kZSA9IG5ldyBBbGlnbkJveCggbm9kZSwge1xyXG4gICAgICB4QWxpZ246IG9wdGlvbnMuYWxpZ24sXHJcbiAgICAgIGdyb3VwOiBhbGlnbkdyb3VwXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgYmFja2dyb3VuZE5vZGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCAxLCAxICk7XHJcblxyXG4gICAgLy8gU2l6ZSBiYWNrZ3JvdW5kTm9kZSB0byBmaXQgdW5pZm9ybU5vZGUuIE5vdGUgdGhhdCB1bmlmb3JtTm9kZSdzIGJvdW5kcyBtYXkgY2hhbmdlIHdoZW4gYWRkaXRpb25hbCBOb2RlcyBhcmVcclxuICAgIC8vIGFkZGVkIHRvIGFsaWduR3JvdXAuXHJcbiAgICB1bmlmb3JtTm9kZS5ib3VuZHNQcm9wZXJ0eS5saW5rKCBib3VuZHMgPT4ge1xyXG4gICAgICBiYWNrZ3JvdW5kTm9kZS5zZXRSZWN0Qm91bmRzKCBib3VuZHMuZGlsYXRlZFhZKCBvcHRpb25zLnhNYXJnaW4sIG9wdGlvbnMueU1hcmdpbiApICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgYmFja2dyb3VuZE5vZGUsIHVuaWZvcm1Ob2RlIF07XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBQcmVzcyBvbiBhbiBpdGVtIHRvIHNlbGVjdCBpdHMgYXNzb2NpYXRlZCB2YWx1ZS5cclxuICAgIGNvbnN0IHByZXNzTGlzdGVuZXIgPSBuZXcgUHJlc3NMaXN0ZW5lcigge1xyXG4gICAgICBwcmVzczogKCkgPT4ge1xyXG4gICAgICAgIHByb3BlcnR5LnZhbHVlID0gY29tYm9Cb3hJdGVtLnZhbHVlO1xyXG4gICAgICB9LFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3ByZXNzTGlzdGVuZXInIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggcHJlc3NMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIFNlbGVjdGluZyBhbiBpdGVtIHNldHMgaXRzIGJhY2tncm91bmQgdG8gdGhlIHNlbGVjdGVkIGNvbG9yLlxyXG4gICAgLy8gUG9pbnRlciBvdmVyIGFuIGl0ZW0gc2V0cyBpdHMgYmFja2dyb3VuZCB0byB0aGUgaGlnaGxpZ2h0ZWQgY29sb3IuXHJcbiAgICAvLyBNdXN0IGJlIGRpc3Bvc2VkIGJlY2F1c2Ugd2UgZG8gbm90IG93biBwcm9wZXJ0eS5cclxuICAgIGNvbnN0IG11bHRpbGluayA9IG5ldyBNdWx0aWxpbmsoXHJcbiAgICAgIFsgcHJvcGVydHksIHByZXNzTGlzdGVuZXIuaXNPdmVyUHJvcGVydHkgXSxcclxuICAgICAgKCBwcm9wZXJ0eVZhbHVlLCBpc092ZXIgKSA9PiB7XHJcbiAgICAgICAgaWYgKCBwcm9wZXJ0eVZhbHVlID09PSBjb21ib0JveEl0ZW0udmFsdWUgKSB7XHJcbiAgICAgICAgICBiYWNrZ3JvdW5kTm9kZS5maWxsID0gb3B0aW9ucy5zZWxlY3RlZENvbG9yO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICggaXNPdmVyICkge1xyXG4gICAgICAgICAgYmFja2dyb3VuZE5vZGUuZmlsbCA9IG9wdGlvbnMub3ZlckNvbG9yO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGJhY2tncm91bmROb2RlLmZpbGwgPSAndHJhbnNwYXJlbnQnO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUNhcm91c2VsSXRlbU5vZGUgPSAoKSA9PiB7XHJcbiAgICAgIG11bHRpbGluay5kaXNwb3NlKCk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VDYXJvdXNlbEl0ZW1Ob2RlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5zdW4ucmVnaXN0ZXIoICdDYXJvdXNlbENvbWJvQm94JywgQ2Fyb3VzZWxDb21ib0JveCApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUEsT0FBT0EsU0FBUyxNQUFNLDRCQUE0QjtBQUNsRCxPQUFPQyxVQUFVLE1BQU0sNEJBQTRCO0FBQ25ELE9BQU9DLFNBQVMsTUFBTSwyQkFBMkI7QUFDakQsT0FBT0MsU0FBUyxJQUFJQyxjQUFjLFFBQVEsaUNBQWlDO0FBQzNFLFNBQVNDLFFBQVEsRUFBRUMsVUFBVSxFQUFFQyxLQUFLLEVBQVdDLElBQUksRUFBRUMsSUFBSSxFQUFlQyxhQUFhLEVBQUVDLFNBQVMsRUFBd0JDLElBQUksRUFBRUMsWUFBWSxRQUE2Qiw2QkFBNkI7QUFDcE0sT0FBT0MsTUFBTSxNQUFNLDJCQUEyQjtB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QUFXLENBQUNJLGNBQWMsQ0FBQzNCLElBQUksQ0FBRTRCLE1BQU0sSUFBSTtNQUN6Q0YsY0FBYyxDQUFDRyxhQUFhLENBQUVELE1BQU0sQ0FBQ0UsU0FBUyxDQUFFckYsT0FBTyxDQUFDTSxPQUFPLEVBQUVOLE9BQU8sQ0FBQ08sT0FBUSxDQUFFLENBQUM7SUFDdEYsQ0FBRSxDQUFDO0lBRUhQLE9BQU8sQ0FBQzZDLFFBQVEsR0FBRyxDQUFFb0MsY0FBYyxFQUFFSCxXQUFXLENBQUU7SUFFbEQsS0FBSyxDQUFFOUUsT0FBUSxDQUFDOztJQUVoQjtJQUNBLE1BQU1zRixhQUFhLEdBQUcsSUFBSXRHLGFBQWEsQ0FBRTtNQUN2Q3VHLEtBQUssRUFBRUEsQ0FBQSxLQUFNO1FBQ1gxRixRQUFRLENBQUM2QyxLQUFLLEdBQUdULFlBQVksQ0FBQ1MsS0FBSztNQUNyQyxDQUFDO01BQ0R2QixNQUFNLEVBQUVuQixPQUFPLENBQUNtQixNQUFNLENBQUNNLFlBQVksQ0FBRSxlQUFnQjtJQUN2RCxDQUFFLENBQUM7SUFDSCxJQUFJLENBQUM2QyxnQkFBZ0IsQ0FBRWdCLGFBQWMsQ0FBQzs7SUFFdEM7SUFDQTtJQUNBO0lBQ0EsTUFBTUUsU0FBUyxHQUFHLElBQUlsSCxTQUFTLENBQzdCLENBQUV1QixRQUFRLEVBQUV5RixhQUFhLENBQUNHLGNBQWMsQ0FBRSxFQUMxQyxDQUFFQyxhQUFhLEVBQUVDLE1BQU0sS0FBTTtNQUMzQixJQUFLRCxhQUFhLEtBQUt6RCxZQUFZLENBQUNTLEtBQUssRUFBRztRQUMxQ3VDLGNBQWMsQ0FBQ1csSUFBSSxHQUFHNUYsT0FBTyxDQUFDSyxhQUFhO01BQzdDLENBQUMsTUFDSSxJQUFLc0YsTUFBTSxFQUFHO1FBQ2pCVixjQUFjLENBQUNXLElBQUksR0FBRzVGLE9BQU8sQ0FBQ0csU0FBUztNQUN6QyxDQUFDLE1BQ0k7UUFDSDhFLGNBQWMsQ0FBQ1csSUFBSSxHQUFHLGFBQWE7TUFDckM7SUFDRixDQUFFLENBQUM7SUFFTCxJQUFJLENBQUNDLHVCQUF1QixHQUFHLE1BQU07TUFDbkNMLFNBQVMsQ0FBQ2IsT0FBTyxDQUFDLENBQUM7SUFDckIsQ0FBQztFQUNIO0VBRWdCQSxPQUFPQSxDQUFBLEVBQVM7SUFDOUIsSUFBSSxDQUFDa0IsdUJBQXVCLENBQUMsQ0FBQztJQUM5QixLQUFLLENBQUNsQixPQUFPLENBQUMsQ0FBQztFQUNqQjtBQUNGO0FBRUFuRixHQUFHLENBQUNzRyxRQUFRLENBQUUsa0JBQWtCLEVBQUVuRyxnQkFBaUIsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==