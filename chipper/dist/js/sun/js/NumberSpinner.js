// Copyright 2016-2024, University of Colorado Boulder

/**
 * Spinner for numbers.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Andrea Lin (PhET Interactive Simulations)
 */

import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import NumberDisplay from '../../scenery-phet/js/NumberDisplay.js';
import { Node, SceneryConstants } from '../../scenery/js/imports.js';
import Tandem from '../../tandem/js/Tandem.js';
import AccessibleNumberSpinner from './accessibility/AccessibleNumberSpinner.js';
import ArrowButton from './buttons/ArrowButton.js';
import sun from './sun.js';
import pushButtonSoundPlayer from '../../tambo/js/shared-sound-players/pushButtonSoundPlayer.js';
import nullSoundPlayer from '../../tambo/js/shared-sound-players/nullSoundPlayer.js';

// both arrow buttons below the value

export default class NumberSpinner extends AccessibleNumberSpinner(Node, 0) {
  /**
   * @param numberProperty - value, must be an integer
   * @param rangeProperty - dynamic range of values, min and max must be integers
   * @param [providedOptions]
   */
  constructor(numberProperty, rangeProperty, providedOptions) {
    assert && assert(rangeProperty.value.contains(numberProperty.get()), `value ${numberProperty.get()} is out of range ${rangeProperty.value.toString()}`);
    const options = optionize()({
      // SelfOptions
      arrowsSoundPlayer: pushButtonSoundPlayer,
      arrowsPosition: 'bothRight',
      arrowsScale: null,
      arrowButtonFill: 'white',
      arrowButtonStroke: 'black',
      arrowButtonLineWidth: 1,
      deltaValue: 1,
      xSpacing: 5,
      ySpacing: 3,
      numberDisplayOptions: {
        cornerRadius: 5,
        backgroundStroke: 'black'
      },
      touchAreaXDilation: 0,
      touchAreaYDilation: 0,
      mouseAreaXDilation: 0,
      mouseAreaYDilation: 0,
      // AccessibleNumberSpinnerOptions
      valueProperty: numberProperty,
      enabledRangeProperty: rangeProperty,
      disabledOpacity: SceneryConstants.DISABLED_OPACITY,
      // The focus highlight surrounds the entire component, but the spinner display is not interactive with
      // mouse and touch events so this highlight is hidden. Instead, default highlights surround the arrow buttons.
      interactiveHighlight: 'invisible',
      // PhET-iO
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'Spinner',
      phetioFeatured: true,
      phetioEnabledPropertyInstrumented: true // opt into default PhET-iO instrumented enabledProperty
    }, providedOptions);

    // Defaults for incrementFunction and decrementFunction
    const incrementFunction = options.incrementFunction || (value => value + options.deltaValue);
    const decrementFunction = options.decrementFunction || (value => value - options.deltaValue);
    const numberDisplay = new NumberDisplay(numberProperty, rangeProperty.value, combineOptions({
      tandem: options.tandem.createTandem('numberDisplay')
    }, options.numberDisplayOptions));

    // buttons
    const arrowButtonOptions = {
      baseColor: options.arrowButtonFill,
      stroke: options.arrowButtonStroke,
      lineWidth: options.arrowButtonLineWidth,
      focusable: false,
      // Override the default sound player for the buttons since sound production is handled in this class.
      soundPlayer: nullSoundPlayer,
      // as requested in https://github.com/phetsims/sun/issues/575
      enabledPropertyOptions: {
        phetioReadOnly: true,
        phetioFeatured: false
      }
    };

    // increment button
    const incrementButton = new ArrowButton(options.arrowsPosition === 'topBottom' || options.arrowsPosition === 'bothRight' ? 'up' : 'right', () => {
      numberProperty.set(incrementFunction(numberProperty.get()));
      options.arrowsSoundPlayer.play();
    }, combineOptions({
      tandem: options.tandem.createTandem('incrementButton')
    }, arrowButtonOptions));

    // decrement button
    const decrementButton = new ArrowButton(options.arrowsPosition === 'topBottom' || options.arrowsPosition === 'bothRight' ? 'down' : 'left', () => {
      numberProperty.set(decrementFunction(numberProperty.get()));
      options.arrowsSoundPlayer.play();
    }, combineOptions({
      tandem: options.tandem.createTandem('decrementButton')
    }, arrowButtonOptions));

    // arrow button scaling
    let arrowsScale;
    if (!arrowsScale) {
      if (options.arrowsPosition === 'leftRight') {
        arrowsScale = numberDisplay.height / incrementButton.height;
      } else if (options.arrowsPosition === 'topBottom') {
        arrowsScale = numberDisplay.width / incrementButton.width;
      } else if (options.arrowsPosition === 'bothRight') {
        arrowsScale = (numberDisplay.height / 2 - options.ySpacing / 2) / incrementButton.height;
      } else {
        // 'bothBottom'
        arrowsScale = (numberDisplay.width / 2 - options.xSpacing / 2) / incrementButton.width;
      }
    }
    if (options.arrowsScale) {
      arrowsScale = arrowsScale * options.arrowsScale;
    }
    incrementButton.setScaleMagnitude(arrowsScale);
    decrementButton.setScaleMagnitude(arrowsScale);

    // Because range may change via rangeProperty, the size of numberDisplay may change, in which case layout will need
    // to be revised. See https://github.com/phetsims/sun/issues/709
    const updateLayout = () => {
      if (options.arrowsPosition === 'leftRight') {
        incrementButton.left = numberDisplay.right + options.xSpacing;
        decrementButton.right = numberDisplay.left - options.xSpacing;
        incrementButton.centerY = decrementButton.centerY = numberDisplay.centerY;
      } else if (options.arrowsPosition === 'topBottom') {
        incrementButton.centerX = decrementButton.centerX = numberDisplay.centerX;
        incrementButton.bottom = numberDisplay.top - options.ySpacing;
        decrementButton.top = numberDisplay.bottom + options.ySpacing;
      } else if (options.arrowsPosition === 'bothRight') {
        incrementButton.left = decrementButton.left = numberDisplay.right + options.xSpacing;
        incrementButton.bottom = numberDisplay.centerY - options.ySpacing / 2;
        decrementButton.top = numberDisplay.centerY + options.ySpacing / 2;
      } else {
        // 'bothBottom'
        incrementButton.left = numberDisplay.centerX + options.xSpacing / 2;
        decrementButton.right = numberDisplay.centerX - options.xSpacing / 2;
        incrementButton.top = decrementButton.top = numberDisplay.bottom + options.ySpacing;
      }
    };
    numberDisplay.boundsProperty.link(() => updateLayout());

    // touch areas
    if (options.touchAreaXDilation || options.touchAreaYDilation) {
      incrementButton.touchArea = incrementButton.localBounds.dilatedXY(options.touchAreaXDilation, options.touchAreaYDilation);
      decrementButton.touchArea = decrementButton.localBounds.dilatedXY(options.touchAreaXDilation, options.touchAreaYDilation);

      // shift touch areas for these options, to prevent overlap
      if (options.arrowsPosition === 'bothRight') {
        incrementButton.touchArea = incrementButton.touchArea.shiftedY(-options.touchAreaYDilation);
        decrementButton.touchArea = decrementButton.touchArea.shiftedY(options.touchAreaYDilation);
      } else if (options.arrowsPosition === 'bothBottom') {
        incrementButton.touchArea = incrementButton.touchArea.shiftedX(options.touchAreaXDilation);
        decrementButton.touchArea = decrementButton.touchArea.shiftedX(-options.touchAreaXDilation);
      }
    }

    // mouse areas
    if (options.mouseAreaXDilation || options.mouseAreaYDilation) {
      incrementButton.mouseArea = incrementButton.localBounds.dilatedXY(options.mouseAreaXDilation, options.mouseAreaYDilation);
      decrementButton.mouseArea = decrementButton.localBounds.dilatedXY(options.mouseAreaXDilation, options.mouseAreaYDilation);

      // shift touch areas for these options, to prevent overlap
      if (options.arrowsPosition === 'bothRight') {
        incrementButton.mouseArea = incrementButton.mouseArea.shiftedY(-options.mouseAreaYDilation);
        decrementButton.mouseArea = decrementButton.mouseArea.shiftedY(options.mouseAreaYDilation);
      } else if (options.arrowsPosition === 'bothBottom') {
        incrementButton.mouseArea = incrementButton.mouseArea.shiftedX(options.mouseAreaXDilation);
        decrementButton.mouseArea = decrementButton.mouseArea.shiftedX(-options.mouseAreaXDilation);
      }
    }
    options.children = [numberDisplay, incrementButton, decrementButton];

    // pdom - NumberSpinner uses AccessibleValueHandler for accessibility, but it was decided that keyboardStep
    // and shiftKeyboardStep should have the same behavior as the NumberSpinner ArrowButtons AND the ArrowButtons
    // should look depressed when interacting with those keys. To accomplish this we actually press the ArrowButtons
    // in response to input with those keys. keyboardStep and shiftKeyboardStep are set to zero so the value isn't
    // modified again by AccessibleValueHandler. See https://github.com/phetsims/scenery/issues/1340.
    assert && assert(options.keyboardStep === undefined, 'NumberSpinner sets keyboardStep, it will be the same as deltaValue');
    assert && assert(options.shiftKeyboardStep === undefined, 'NumberSpinner sets shiftKeyboardStep, it will be the same as deltaValue');
    assert && assert(options.pageKeyboardStep === undefined, 'NumberSpinner sets pageKeyboardStep, it should not be used with NumberSpinner');
    options.keyboardStep = 0;
    options.shiftKeyboardStep = 0;
    options.pageKeyboardStep = 0;

    // Call super without the options that require valid bounds. Call mutate later with those options.
    const boundsRequiredOptionKeys = _.pick(options, Node.REQUIRES_BOUNDS_OPTION_KEYS);
    super(_.omit(options, Node.REQUIRES_BOUNDS_OPTION_KEYS));

    // enable/disable arrow buttons
    const updateEnabled = () => {
      incrementButton.enabled = incrementFunction(numberProperty.value) <= rangeProperty.value.max;
      decrementButton.enabled = decrementFunction(numberProperty.value) >= rangeProperty.value.min;
    };

    // synchronize with number value
    const numberPropertyObserver = value => {
      assert && assert(rangeProperty.value.contains(value), `value out of range: ${value}`);
      updateEnabled();
    };
    numberProperty.link(numberPropertyObserver); // must be unlinked in dispose

    // Dynamic range changes, see https://github.com/phetsims/scenery-phet/issues/305
    const rangeObserver = range => {
      // If our value is outside our new range, adjust it to be within the range.
      numberProperty.value = range.constrainValue(numberProperty.value);

      // Range changes may change whether the buttons are enabled
      updateEnabled();
    };
    rangeProperty.link(rangeObserver);

    // pdom - click arrow buttons on press of arrow keys so that the Property value changes by deltaValue
    // and the buttons look depressed
    const increasedListener = isDown => isDown && incrementButton.pdomClick();
    const decreasedListener = isDown => isDown && decrementButton.pdomClick();
    this.pdomIncrementDownEmitter.addListener(increasedListener);
    this.pdomDecrementDownEmitter.addListener(decreasedListener);
    this.disposeNumberSpinner = () => {
      // dispose of subcomponents
      numberDisplay.dispose();
      incrementButton.dispose();
      decrementButton.dispose();

      // dispose a11y features
      this.pdomIncrementDownEmitter.removeListener(increasedListener);
      this.pdomDecrementDownEmitter.removeListener(decreasedListener);
      numberProperty.unlink(numberPropertyObserver);
      rangeProperty.unlink(rangeObserver);
    };
    this.mutate(boundsRequiredOptionKeys);
    this.numberDisplay = numberDisplay;

    // Create a link to associated Property, so it's easier to find in Studio. Must be after instrumentation
    this.addLinkedElement(numberProperty, {
      tandemName: 'property'
    });

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet?.chipper?.queryParameters?.binder && InstanceRegistry.registerDataURL('sun', 'NumberSpinner', this);
  }
  dispose() {
    this.disposeNumberSpinner();
    super.dispose();
  }
}
sun.register('NumberSpinner', NumberSpinner);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnN0YW5jZVJlZ2lzdHJ5Iiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJOdW1iZXJEaXNwbGF5IiwiTm9kZSIsIlNjZW5lcnlDb25zdGFudHMiLCJUYW5kZW0iLCJBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lciIsIkFycm93QnV0dG9uIiwic3VuIiwicHVzaEJ1dHRvblNvdW5kUGxheWVyIiwibnVsbFNvdW5kUGxheWVyIiwiTnVtYmVyU3Bpbm5lciIsImNvbnN0cnVjdG9yIiwibnVtYmVyUHJvcGVydHkiLCJyYW5nZVByb3BlcnR5IiwicHJvdmlkZWRPcHRpb25zIiwiYXNzZXJ0IiwidmFsdWUiLCJjb250YWlucyIsImdldCIsInRvU3RyaW5nIiwib3B0aW9ucyIsImFycm93c1NvdW5kUGxheWVyIiwiYXJyb3dzUG9zaXRpb24iLCJhcnJvd3NTY2FsZSIsImFycm93QnV0dG9uRmlsbCIsImFycm93QnV0dG9uU3Ryb2tlIiwiYXJyb3dCdXR0b25MaW5lV2lkdGgiLCJkZWx0YVZhbHVlIiwieFNwYWNpbmciLCJ5U3BhY2luZyIsIm51bWJlckRpc3BsYXlPcHRpb25zIiwiY29ybmVyUmFkaXVzIiwiYmFja2dyb3VuZFN0cm9rZSIsInRvdWNoQXJlYVhEaWxhdGlvbiIsInRvdWNoQXJlYVlEaWxhdGlvbiIsIm1vdXNlQXJlYVhEaWxhdGlvbiIsIm1vdXNlQXJlYVlEaWxhdGlvbiIsInZhbHVlUHJvcGVydHkiLCJlbmFibGVkUmFuZ2VQcm9wZXJ0eSIsImRpc2FibGVkT3BhY2l0eSIsIkRJU0FCTEVEX09QQUNJVFkiLCJpbnRlcmFjdGl2ZUhpZ2hsaWdodCIsInRhbmRlbSIsIlJFUVVJUkVEIiwidGFuZGVtTmFtZVN1ZmZpeCIsInBoZXRpb0ZlYXR1cmVkIiwicGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkIiwiaW5jcmVtZW50RnVuY3Rpb24iLCJkZWNyZW1lbnRGdW5jdGlvbiIsIm51bWJlckRpc3BsYXkiLCJjcmVhdGVUYW5kZW0iLCJhcnJvd0J1dHRvbk9wdGlvbnMiLCJiYXNlQ29sb3IiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJmb2N1c2FibGUiLCJzb3VuZFBsYXllciIsImVuYWJsZWRQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9SZWFkT25seSIsImluY3JlbWVudEJ1dHRvbiIsInNldCIsInBsYXkiLCJkZWNyZW1lbnRCdXR0b24iLCJoZWlnaHQiLCJ3aWR0aCIsInNldFNjYWxlTWFnbml0dWRlIiwidXBkYXRlTGF5b3V0IiwibGVmdCIsInJpZ2h0IiwiY2VudGVyWSIsImNlbnRlclgiLCJib3R0b20iLCJ0b3AiLCJib3VuZHNQcm9wZXJ0eSIsImxpbmsiLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWRYWSIsInNoaWZ0ZWRZIiwic2hpZnRlZFgiLCJtb3VzZUFyZWEiLCJjaGlsZHJlbiIsImtleWJvYXJkU3RlcCIsInVuZGVmaW5lZCIsInNoaWZ0S2V5Ym9hcmRTdGVwIiwicGFnZUtleWJvYXJkU3RlcCIsImJvdW5kc1JlcXVpcmVkT3B0aW9uS2V5cyIsIl8iLCJwaWNrIiwiUkVRVUlSRVNfQk9VTkRTX09QVElPTl9LRVlTIiwib21pdCIsInVwZGF0ZUVuYWJsZWQiLCJlbmFibGVkIiwibWF4IiwibWluIiwibnVtYmVyUHJvcGVydHlPYnNlcnZlciIsInJhbmdlT2JzZXJ2ZXIiLCJyYW5nZSIsImNvbnN0cmFpblZhbHVlIiwiaW5jcmVhc2VkTGlzdGVuZXIiLCJpc0Rvd24iLCJwZG9tQ2xpY2siLCJkZWNyZWFzZWRMaXN0ZW5lciIsInBkb21JbmNyZW1lbnREb3duRW1pdHRlciIsImFkZExpc3RlbmVyIiwicGRvbURlY3JlbWVudERvd25FbWl0dGVyIiwiZGlzcG9zZU51bWJlclNwaW5uZXIiLCJkaXNwb3NlIiwicmVtb3ZlTGlzdGVuZXIiLCJ1bmxpbmsiLCJtdXRhdGUiLCJhZGRMaW5rZWRFbGVtZW50IiwidGFuZGVtTmFtZSIsInBoZXQiLCJjaGlwcGVyIiwicXVlcnlQYXJhbWV0ZXJzIiwiYmluZGVyIiwicmVnaXN0ZXJEYXRhVVJMIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJOdW1iZXJTcGlubmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNwaW5uZXIgZm9yIG51bWJlcnMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqIEBhdXRob3IgQW5kcmVhIExpbiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgSW5zdGFuY2VSZWdpc3RyeSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvZG9jdW1lbnRhdGlvbi9JbnN0YW5jZVJlZ2lzdHJ5LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBjb21iaW5lT3B0aW9ucyB9IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgTnVtYmVyRGlzcGxheSwgeyBOdW1iZXJEaXNwbGF5T3B0aW9ucyB9IGZyb20gJy4uLy4uL3NjZW5lcnktcGhldC9qcy9OdW1iZXJEaXNwbGF5LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgTm9kZU9wdGlvbnMsIFNjZW5lcnlDb25zdGFudHMsIFRDb2xvciB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lciwgeyBBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lck9wdGlvbnMgfSBmcm9tICcuL2FjY2Vzc2liaWxpdHkvQWNjZXNzaWJsZU51bWJlclNwaW5uZXIuanMnO1xyXG5pbXBvcnQgQXJyb3dCdXR0b24sIHsgQXJyb3dCdXR0b25PcHRpb25zIH0gZnJvbSAnLi9idXR0b25zL0Fycm93QnV0dG9uLmpzJztcclxuXHJcbmltcG9ydCBzdW4gZnJvbSAnLi9zdW4uanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IHB1c2hCdXR0b25Tb3VuZFBsYXllciBmcm9tICcuLi8uLi90YW1iby9qcy9zaGFyZWQtc291bmQtcGxheWVycy9wdXNoQnV0dG9uU291bmRQbGF5ZXIuanMnO1xyXG5pbXBvcnQgVFNvdW5kUGxheWVyIGZyb20gJy4uLy4uL3RhbWJvL2pzL1RTb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBudWxsU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vdGFtYm8vanMvc2hhcmVkLXNvdW5kLXBsYXllcnMvbnVsbFNvdW5kUGxheWVyLmpzJztcclxuXHJcbnR5cGUgTnVtYmVyU3Bpbm5lckFycm93c1Bvc2l0aW9uID1cclxuICAnbGVmdFJpZ2h0JyB8IC8vIGFycm93IGJ1dHRvbnMgb24gbGVmdCBhbmQgcmlnaHQgb2YgdmFsdWVcclxuICAndG9wQm90dG9tJyB8IC8vIGFycm93IGJ1dHRvbnMgb24gdG9wIGFuZCBib3R0b20gb2YgdmFsdWVcclxuICAnYm90aFJpZ2h0JyB8IC8vIGJvdGggYXJyb3cgYnV0dG9ucyB0byB0aGUgcmlnaHQgb2YgdGhlIHZhbHVlXHJcbiAgJ2JvdGhCb3R0b20nOyAvLyBib3RoIGFycm93IGJ1dHRvbnMgYmVsb3cgdGhlIHZhbHVlXHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyB3aGVyZSB0byBwbGFjZSB0aGUgYXJyb3cgYnV0dG9uc1xyXG4gIGFycm93c1Bvc2l0aW9uPzogTnVtYmVyU3Bpbm5lckFycm93c1Bvc2l0aW9uO1xyXG5cclxuICAvLyBCeSBkZWZhdWx0LCBhcnJvd3MgYXJlIHNjYWxlZCB0byBmaXQgZGltZW5zaW9ucyBvZiB2YWx1ZSBiYWNrZ3JvdW5kLiBUaGlzIGlzIGFuIGFkZGl0aW9uYWwgc2NhbGUgZmFjdG9yLlxyXG4gIGFycm93c1NjYWxlPzogbnVtYmVyIHwgbnVsbDtcclxuICBhcnJvd0J1dHRvbkZpbGw/OiBUQ29sb3I7XHJcbiAgYXJyb3dCdXR0b25TdHJva2U/OiBUQ29sb3I7XHJcbiAgYXJyb3dCdXR0b25MaW5lV2lkdGg/OiBudW1iZXI7XHJcblxyXG4gIGFycm93c1NvdW5kUGxheWVyPzogVFNvdW5kUGxheWVyO1xyXG5cclxuICAvLyBGdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGUgaW5jcmVtZW50IGJ1dHRvbiBpcyBwcmVzc2VkLiBEZWZhdWx0cyB0byBhZGRpbmcgb3B0aW9ucy5kZWx0YVZhbHVlLlxyXG4gIGluY3JlbWVudEZ1bmN0aW9uPzogKCAoIHZhbHVlOiBudW1iZXIgKSA9PiBudW1iZXIgKTtcclxuXHJcbiAgLy8gRnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIGRlY3JlbWVudCBidXR0b24gaXMgcHJlc3NlZC4gRGVmYXVsdHMgdG8gc3VidHJhY3Rpbmcgb3B0aW9ucy5kZWx0YVZhbHVlLlxyXG4gIGRlY3JlbWVudEZ1bmN0aW9uPzogKCAoIHZhbHVlOiBudW1iZXIgKSA9PiBudW1iZXIgKTtcclxuXHJcbiAgLy8gbWF5IGJlIGlnbm9yZWQgaWYgaW5jcmVtZW50RnVuY3Rpb24gYW5kIGRlY3JlbWVudEZ1bmN0aW9uIGFyZSBwcm92aWRlZFxyXG4gIGRlbHRhVmFsdWU/OiBudW1iZXI7XHJcblxyXG4gIHhTcGFjaW5nPzogbnVtYmVyO1xyXG4gIHlTcGFjaW5nPzogbnVtYmVyO1xyXG5cclxuICAvLyBOdW1iZXJEaXNwbGF5IG9wdGlvbnNcclxuICBudW1iZXJEaXNwbGF5T3B0aW9ucz86IE51bWJlckRpc3BsYXlPcHRpb25zO1xyXG5cclxuICAvLyBhcnJvdyBidXR0b24gcG9pbnRlciBhcmVhc1xyXG4gIHRvdWNoQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICB0b3VjaEFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgbW91c2VBcmVhWERpbGF0aW9uPzogbnVtYmVyO1xyXG4gIG1vdXNlQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcclxufTtcclxudHlwZSBQYXJlbnRPcHRpb25zID0gQWNjZXNzaWJsZU51bWJlclNwaW5uZXJPcHRpb25zICYgTm9kZU9wdGlvbnM7XHJcbmV4cG9ydCB0eXBlIE51bWJlclNwaW5uZXJPcHRpb25zID0gU2VsZk9wdGlvbnMgJlxyXG4gIFN0cmljdE9taXQ8UGFyZW50T3B0aW9ucywgJ2NoaWxkcmVuJyB8ICd2YWx1ZVByb3BlcnR5JyB8ICdlbmFibGVkUmFuZ2VQcm9wZXJ0eScgfCAna2V5Ym9hcmRTdGVwJyB8ICdzaGlmdEtleWJvYXJkU3RlcCcgfCAncGFnZUtleWJvYXJkU3RlcCc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTnVtYmVyU3Bpbm5lciBleHRlbmRzIEFjY2Vzc2libGVOdW1iZXJTcGlubmVyKCBOb2RlLCAwICkge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IG51bWJlckRpc3BsYXk6IE51bWJlckRpc3BsYXk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlTnVtYmVyU3Bpbm5lcjogKCkgPT4gdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIG51bWJlclByb3BlcnR5IC0gdmFsdWUsIG11c3QgYmUgYW4gaW50ZWdlclxyXG4gICAqIEBwYXJhbSByYW5nZVByb3BlcnR5IC0gZHluYW1pYyByYW5nZSBvZiB2YWx1ZXMsIG1pbiBhbmQgbWF4IG11c3QgYmUgaW50ZWdlcnNcclxuICAgKiBAcGFyYW0gW3Byb3ZpZGVkT3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG51bWJlclByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+LCByYW5nZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxSYW5nZT4sIHByb3ZpZGVkT3B0aW9ucz86IE51bWJlclNwaW5uZXJPcHRpb25zICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHJhbmdlUHJvcGVydHkudmFsdWUuY29udGFpbnMoIG51bWJlclByb3BlcnR5LmdldCgpICksXHJcbiAgICAgIGB2YWx1ZSAke251bWJlclByb3BlcnR5LmdldCgpfSBpcyBvdXQgb2YgcmFuZ2UgJHtyYW5nZVByb3BlcnR5LnZhbHVlLnRvU3RyaW5nKCl9YCApO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8TnVtYmVyU3Bpbm5lck9wdGlvbnMsXHJcbiAgICAgIFN0cmljdE9taXQ8U2VsZk9wdGlvbnMsICdpbmNyZW1lbnRGdW5jdGlvbicgfCAnZGVjcmVtZW50RnVuY3Rpb24nPixcclxuICAgICAgUGFyZW50T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgYXJyb3dzU291bmRQbGF5ZXI6IHB1c2hCdXR0b25Tb3VuZFBsYXllcixcclxuICAgICAgYXJyb3dzUG9zaXRpb246ICdib3RoUmlnaHQnLFxyXG4gICAgICBhcnJvd3NTY2FsZTogbnVsbCxcclxuICAgICAgYXJyb3dCdXR0b25GaWxsOiAnd2hpdGUnLFxyXG4gICAgICBhcnJvd0J1dHRvblN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgYXJyb3dCdXR0b25MaW5lV2lkdGg6IDEsXHJcbiAgICAgIGRlbHRhVmFsdWU6IDEsXHJcbiAgICAgIHhTcGFjaW5nOiA1LFxyXG4gICAgICB5U3BhY2luZzogMyxcclxuICAgICAgbnVtYmVyRGlzcGxheU9wdGlvbnM6IHtcclxuICAgICAgICBjb3JuZXJSYWRpdXM6IDUsXHJcbiAgICAgICAgYmFja2dyb3VuZFN0cm9rZTogJ2JsYWNrJ1xyXG4gICAgICB9LFxyXG4gICAgICB0b3VjaEFyZWFYRGlsYXRpb246IDAsXHJcbiAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogMCxcclxuICAgICAgbW91c2VBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICBtb3VzZUFyZWFZRGlsYXRpb246IDAsXHJcblxyXG4gICAgICAvLyBBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lck9wdGlvbnNcclxuICAgICAgdmFsdWVQcm9wZXJ0eTogbnVtYmVyUHJvcGVydHksXHJcbiAgICAgIGVuYWJsZWRSYW5nZVByb3BlcnR5OiByYW5nZVByb3BlcnR5LFxyXG4gICAgICBkaXNhYmxlZE9wYWNpdHk6IFNjZW5lcnlDb25zdGFudHMuRElTQUJMRURfT1BBQ0lUWSxcclxuXHJcbiAgICAgIC8vIFRoZSBmb2N1cyBoaWdobGlnaHQgc3Vycm91bmRzIHRoZSBlbnRpcmUgY29tcG9uZW50LCBidXQgdGhlIHNwaW5uZXIgZGlzcGxheSBpcyBub3QgaW50ZXJhY3RpdmUgd2l0aFxyXG4gICAgICAvLyBtb3VzZSBhbmQgdG91Y2ggZXZlbnRzIHNvIHRoaXMgaGlnaGxpZ2h0IGlzIGhpZGRlbi4gSW5zdGVhZCwgZGVmYXVsdCBoaWdobGlnaHRzIHN1cnJvdW5kIHRoZSBhcnJvdyBidXR0b25zLlxyXG4gICAgICBpbnRlcmFjdGl2ZUhpZ2hsaWdodDogJ2ludmlzaWJsZScsXHJcblxyXG4gICAgICAvLyBQaEVULWlPXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxyXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiAnU3Bpbm5lcicsXHJcbiAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlLFxyXG4gICAgICBwaGV0aW9FbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQ6IHRydWUgLy8gb3B0IGludG8gZGVmYXVsdCBQaEVULWlPIGluc3RydW1lbnRlZCBlbmFibGVkUHJvcGVydHlcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIERlZmF1bHRzIGZvciBpbmNyZW1lbnRGdW5jdGlvbiBhbmQgZGVjcmVtZW50RnVuY3Rpb25cclxuICAgIGNvbnN0IGluY3JlbWVudEZ1bmN0aW9uID0gb3B0aW9ucy5pbmNyZW1lbnRGdW5jdGlvbiB8fCAoICggdmFsdWU6IG51bWJlciApID0+IHZhbHVlICsgb3B0aW9ucy5kZWx0YVZhbHVlICk7XHJcbiAgICBjb25zdCBkZWNyZW1lbnRGdW5jdGlvbiA9IG9wdGlvbnMuZGVjcmVtZW50RnVuY3Rpb24gfHwgKCAoIHZhbHVlOiBudW1iZXIgKSA9PiB2YWx1ZSAtIG9wdGlvbnMuZGVsdGFWYWx1ZSApO1xyXG5cclxuICAgIGNvbnN0IG51bWJlckRpc3BsYXkgPSBuZXcgTnVtYmVyRGlzcGxheSggbnVtYmVyUHJvcGVydHksIHJhbmdlUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIGNvbWJpbmVPcHRpb25zPE51bWJlckRpc3BsYXlPcHRpb25zPigge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbnVtYmVyRGlzcGxheScgKVxyXG4gICAgICB9LCBvcHRpb25zLm51bWJlckRpc3BsYXlPcHRpb25zICkgKTtcclxuXHJcbiAgICAvLyBidXR0b25zXHJcbiAgICBjb25zdCBhcnJvd0J1dHRvbk9wdGlvbnM6IEFycm93QnV0dG9uT3B0aW9ucyA9IHtcclxuICAgICAgYmFzZUNvbG9yOiBvcHRpb25zLmFycm93QnV0dG9uRmlsbCxcclxuICAgICAgc3Ryb2tlOiBvcHRpb25zLmFycm93QnV0dG9uU3Ryb2tlLFxyXG4gICAgICBsaW5lV2lkdGg6IG9wdGlvbnMuYXJyb3dCdXR0b25MaW5lV2lkdGgsXHJcbiAgICAgIGZvY3VzYWJsZTogZmFsc2UsXHJcblxyXG4gICAgICAvLyBPdmVycmlkZSB0aGUgZGVmYXVsdCBzb3VuZCBwbGF5ZXIgZm9yIHRoZSBidXR0b25zIHNpbmNlIHNvdW5kIHByb2R1Y3Rpb24gaXMgaGFuZGxlZCBpbiB0aGlzIGNsYXNzLlxyXG4gICAgICBzb3VuZFBsYXllcjogbnVsbFNvdW5kUGxheWVyLFxyXG5cclxuICAgICAgLy8gYXMgcmVxdWVzdGVkIGluIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzU3NVxyXG4gICAgICBlbmFibGVkUHJvcGVydHlPcHRpb25zOiB7XHJcbiAgICAgICAgcGhldGlvUmVhZE9ubHk6IHRydWUsXHJcbiAgICAgICAgcGhldGlvRmVhdHVyZWQ6IGZhbHNlXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gaW5jcmVtZW50IGJ1dHRvblxyXG4gICAgY29uc3QgaW5jcmVtZW50QnV0dG9uID0gbmV3IEFycm93QnV0dG9uKFxyXG4gICAgICAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICd0b3BCb3R0b20nIHx8IG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkgPyAndXAnIDogJ3JpZ2h0JyxcclxuICAgICAgKCkgPT4ge1xyXG4gICAgICAgIG51bWJlclByb3BlcnR5LnNldCggaW5jcmVtZW50RnVuY3Rpb24oIG51bWJlclByb3BlcnR5LmdldCgpICkgKTtcclxuICAgICAgICBvcHRpb25zLmFycm93c1NvdW5kUGxheWVyLnBsYXkoKTtcclxuICAgICAgfSxcclxuICAgICAgY29tYmluZU9wdGlvbnM8QXJyb3dCdXR0b25PcHRpb25zPigge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaW5jcmVtZW50QnV0dG9uJyApXHJcbiAgICAgIH0sIGFycm93QnV0dG9uT3B0aW9ucyApXHJcbiAgICApO1xyXG5cclxuICAgIC8vIGRlY3JlbWVudCBidXR0b25cclxuICAgIGNvbnN0IGRlY3JlbWVudEJ1dHRvbiA9IG5ldyBBcnJvd0J1dHRvbihcclxuICAgICAgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAndG9wQm90dG9tJyB8fCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnYm90aFJpZ2h0JyApID8gJ2Rvd24nIDogJ2xlZnQnLFxyXG4gICAgICAoKSA9PiB7XHJcbiAgICAgICAgbnVtYmVyUHJvcGVydHkuc2V0KCBkZWNyZW1lbnRGdW5jdGlvbiggbnVtYmVyUHJvcGVydHkuZ2V0KCkgKSApO1xyXG4gICAgICAgIG9wdGlvbnMuYXJyb3dzU291bmRQbGF5ZXIucGxheSgpO1xyXG4gICAgICB9LFxyXG4gICAgICBjb21iaW5lT3B0aW9uczxBcnJvd0J1dHRvbk9wdGlvbnM+KCB7XHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkZWNyZW1lbnRCdXR0b24nIClcclxuICAgICAgfSwgYXJyb3dCdXR0b25PcHRpb25zIClcclxuICAgICk7XHJcblxyXG4gICAgLy8gYXJyb3cgYnV0dG9uIHNjYWxpbmdcclxuICAgIGxldCBhcnJvd3NTY2FsZTtcclxuICAgIGlmICggIWFycm93c1NjYWxlICkge1xyXG4gICAgICBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdsZWZ0UmlnaHQnICkge1xyXG4gICAgICAgIGFycm93c1NjYWxlID0gbnVtYmVyRGlzcGxheS5oZWlnaHQgLyBpbmNyZW1lbnRCdXR0b24uaGVpZ2h0O1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAndG9wQm90dG9tJyApIHtcclxuICAgICAgICBhcnJvd3NTY2FsZSA9IG51bWJlckRpc3BsYXkud2lkdGggLyBpbmNyZW1lbnRCdXR0b24ud2lkdGg7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkge1xyXG4gICAgICAgIGFycm93c1NjYWxlID0gKCAoIG51bWJlckRpc3BsYXkuaGVpZ2h0IC8gMiApIC0gKCBvcHRpb25zLnlTcGFjaW5nIC8gMiApICkgLyBpbmNyZW1lbnRCdXR0b24uaGVpZ2h0O1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgeyAvLyAnYm90aEJvdHRvbSdcclxuICAgICAgICBhcnJvd3NTY2FsZSA9ICggKCBudW1iZXJEaXNwbGF5LndpZHRoIC8gMiApIC0gKCBvcHRpb25zLnhTcGFjaW5nIC8gMiApICkgLyBpbmNyZW1lbnRCdXR0b24ud2lkdGg7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICggb3B0aW9ucy5hcnJvd3NTY2FsZSApIHtcclxuICAgICAgYXJyb3dzU2NhbGUgPSBhcnJvd3NTY2FsZSAqIG9wdGlvbnMuYXJyb3dzU2NhbGU7XHJcbiAgICB9XHJcbiAgICBpbmNyZW1lbnRCdXR0b24uc2V0U2NhbGVNYWduaXR1ZGUoIGFycm93c1NjYWxlICk7XHJcbiAgICBkZWNyZW1lbnRCdXR0b24uc2V0U2NhbGVNYWduaXR1ZGUoIGFycm93c1NjYWxlICk7XHJcblxyXG4gICAgLy8gQmVjYXVzZSByYW5nZSBtYXkgY2hhbmdlIHZpYSByYW5nZVByb3BlcnR5LCB0aGUgc2l6ZSBvZiBudW1iZXJEaXNwbGF5IG1heSBjaGFuZ2UsIGluIHdoaWNoIGNhc2UgbGF5b3V0IHdpbGwgbmVlZFxyXG4gICAgLy8gdG8gYmUgcmV2aXNlZC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzcwOVxyXG4gICAgY29uc3QgdXBkYXRlTGF5b3V0ID0gKCkgPT4ge1xyXG4gICAgICBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdsZWZ0UmlnaHQnICkge1xyXG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi5sZWZ0ID0gbnVtYmVyRGlzcGxheS5yaWdodCArIG9wdGlvbnMueFNwYWNpbmc7XHJcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLnJpZ2h0ID0gbnVtYmVyRGlzcGxheS5sZWZ0IC0gb3B0aW9ucy54U3BhY2luZztcclxuICAgICAgICBpbmNyZW1lbnRCdXR0b24uY2VudGVyWSA9IGRlY3JlbWVudEJ1dHRvbi5jZW50ZXJZID0gbnVtYmVyRGlzcGxheS5jZW50ZXJZO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAndG9wQm90dG9tJyApIHtcclxuICAgICAgICBpbmNyZW1lbnRCdXR0b24uY2VudGVyWCA9IGRlY3JlbWVudEJ1dHRvbi5jZW50ZXJYID0gbnVtYmVyRGlzcGxheS5jZW50ZXJYO1xyXG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi5ib3R0b20gPSBudW1iZXJEaXNwbGF5LnRvcCAtIG9wdGlvbnMueVNwYWNpbmc7XHJcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLnRvcCA9IG51bWJlckRpc3BsYXkuYm90dG9tICsgb3B0aW9ucy55U3BhY2luZztcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggb3B0aW9ucy5hcnJvd3NQb3NpdGlvbiA9PT0gJ2JvdGhSaWdodCcgKSB7XHJcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmxlZnQgPSBkZWNyZW1lbnRCdXR0b24ubGVmdCA9IG51bWJlckRpc3BsYXkucmlnaHQgKyBvcHRpb25zLnhTcGFjaW5nO1xyXG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi5ib3R0b20gPSBudW1iZXJEaXNwbGF5LmNlbnRlclkgLSAoIG9wdGlvbnMueVNwYWNpbmcgLyAyICk7XHJcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLnRvcCA9IG51bWJlckRpc3BsYXkuY2VudGVyWSArICggb3B0aW9ucy55U3BhY2luZyAvIDIgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHsgLy8gJ2JvdGhCb3R0b20nXHJcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmxlZnQgPSBudW1iZXJEaXNwbGF5LmNlbnRlclggKyAoIG9wdGlvbnMueFNwYWNpbmcgLyAyICk7XHJcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLnJpZ2h0ID0gbnVtYmVyRGlzcGxheS5jZW50ZXJYIC0gKCBvcHRpb25zLnhTcGFjaW5nIC8gMiApO1xyXG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi50b3AgPSBkZWNyZW1lbnRCdXR0b24udG9wID0gbnVtYmVyRGlzcGxheS5ib3R0b20gKyBvcHRpb25zLnlTcGFjaW5nO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgbnVtYmVyRGlzcGxheS5ib3VuZHNQcm9wZXJ0eS5saW5rKCAoKSA9PiB1cGRhdGVMYXlvdXQoKSApO1xyXG5cclxuICAgIC8vIHRvdWNoIGFyZWFzXHJcbiAgICBpZiAoIG9wdGlvbnMudG91Y2hBcmVhWERpbGF0aW9uIHx8IG9wdGlvbnMudG91Y2hBcmVhWURpbGF0aW9uICkge1xyXG5cclxuICAgICAgaW5jcmVtZW50QnV0dG9uLnRvdWNoQXJlYSA9IGluY3JlbWVudEJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIG9wdGlvbnMudG91Y2hBcmVhWERpbGF0aW9uLCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApO1xyXG4gICAgICBkZWNyZW1lbnRCdXR0b24udG91Y2hBcmVhID0gZGVjcmVtZW50QnV0dG9uLmxvY2FsQm91bmRzLmRpbGF0ZWRYWSggb3B0aW9ucy50b3VjaEFyZWFYRGlsYXRpb24sIG9wdGlvbnMudG91Y2hBcmVhWURpbGF0aW9uICk7XHJcblxyXG4gICAgICAvLyBzaGlmdCB0b3VjaCBhcmVhcyBmb3IgdGhlc2Ugb3B0aW9ucywgdG8gcHJldmVudCBvdmVybGFwXHJcbiAgICAgIGlmICggb3B0aW9ucy5hcnJvd3NQb3NpdGlvbiA9PT0gJ2JvdGhSaWdodCcgKSB7XHJcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLnRvdWNoQXJlYSA9IGluY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEuc2hpZnRlZFkoIC1vcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApO1xyXG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEgPSBkZWNyZW1lbnRCdXR0b24udG91Y2hBcmVhLnNoaWZ0ZWRZKCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnYm90aEJvdHRvbScgKSB7XHJcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLnRvdWNoQXJlYSA9IGluY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEuc2hpZnRlZFgoIG9wdGlvbnMudG91Y2hBcmVhWERpbGF0aW9uICk7XHJcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLnRvdWNoQXJlYSA9IGRlY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEuc2hpZnRlZFgoIC1vcHRpb25zLnRvdWNoQXJlYVhEaWxhdGlvbiApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gbW91c2UgYXJlYXNcclxuICAgIGlmICggb3B0aW9ucy5tb3VzZUFyZWFYRGlsYXRpb24gfHwgb3B0aW9ucy5tb3VzZUFyZWFZRGlsYXRpb24gKSB7XHJcblxyXG4gICAgICBpbmNyZW1lbnRCdXR0b24ubW91c2VBcmVhID0gaW5jcmVtZW50QnV0dG9uLmxvY2FsQm91bmRzLmRpbGF0ZWRYWSggb3B0aW9ucy5tb3VzZUFyZWFYRGlsYXRpb24sIG9wdGlvbnMubW91c2VBcmVhWURpbGF0aW9uICk7XHJcbiAgICAgIGRlY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEgPSBkZWNyZW1lbnRCdXR0b24ubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCBvcHRpb25zLm1vdXNlQXJlYVhEaWxhdGlvbiwgb3B0aW9ucy5tb3VzZUFyZWFZRGlsYXRpb24gKTtcclxuXHJcbiAgICAgIC8vIHNoaWZ0IHRvdWNoIGFyZWFzIGZvciB0aGVzZSBvcHRpb25zLCB0byBwcmV2ZW50IG92ZXJsYXBcclxuICAgICAgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnYm90aFJpZ2h0JyApIHtcclxuICAgICAgICBpbmNyZW1lbnRCdXR0b24ubW91c2VBcmVhID0gaW5jcmVtZW50QnV0dG9uLm1vdXNlQXJlYS5zaGlmdGVkWSggLW9wdGlvbnMubW91c2VBcmVhWURpbGF0aW9uICk7XHJcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLm1vdXNlQXJlYSA9IGRlY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEuc2hpZnRlZFkoIG9wdGlvbnMubW91c2VBcmVhWURpbGF0aW9uICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoQm90dG9tJyApIHtcclxuICAgICAgICBpbmNyZW1lbnRCdXR0b24ubW91c2VBcmVhID0gaW5jcmVtZW50QnV0dG9uLm1vdXNlQXJlYS5zaGlmdGVkWCggb3B0aW9ucy5tb3VzZUFyZWFYRGlsYXRpb24gKTtcclxuICAgICAgICBkZWNyZW1lbnRCdXR0b24ubW91c2VBcmVhID0gZGVjcmVtZW50QnV0dG9uLm1vdXNlQXJlYS5zaGlmdGVkWCggLW9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyBudW1iZXJEaXNwbGF5LCBpbmNyZW1lbnRCdXR0b24sIGRlY3JlbWVudEJ1dHRvbiBdO1xyXG5cclxuICAgIC8vIHBkb20gLSBOdW1iZXJTcGlubmVyIHVzZXMgQWNjZXNzaWJsZVZhbHVlSGFuZGxlciBmb3IgYWNjZXNzaWJpbGl0eSwgYnV0IGl0IHdhcyBkZWNpZGVkIHRoYXQga2V5Ym9hcmRTdGVwXHJcbiAgICAvLyBhbmQgc2hpZnRLZXlib2FyZFN0ZXAgc2hvdWxkIGhhdmUgdGhlIHNhbWUgYmVoYXZpb3IgYXMgdGhlIE51bWJlclNwaW5uZXIgQXJyb3dCdXR0b25zIEFORCB0aGUgQXJyb3dCdXR0b25zXHJcbiAgICAvLyBzaG91bGQgbG9vayBkZXByZXNzZWQgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRob3NlIGtleXMuIFRvIGFjY29tcGxpc2ggdGhpcyB3ZSBhY3R1YWxseSBwcmVzcyB0aGUgQXJyb3dCdXR0b25zXHJcbiAgICAvLyBpbiByZXNwb25zZSB0byBpbnB1dCB3aXRoIHRob3NlIGtleXMuIGtleWJvYXJkU3RlcCBhbmQgc2hpZnRLZXlib2FyZFN0ZXAgYXJlIHNldCB0byB6ZXJvIHNvIHRoZSB2YWx1ZSBpc24ndFxyXG4gICAgLy8gbW9kaWZpZWQgYWdhaW4gYnkgQWNjZXNzaWJsZVZhbHVlSGFuZGxlci4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5L2lzc3Vlcy8xMzQwLlxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5rZXlib2FyZFN0ZXAgPT09IHVuZGVmaW5lZCwgJ051bWJlclNwaW5uZXIgc2V0cyBrZXlib2FyZFN0ZXAsIGl0IHdpbGwgYmUgdGhlIHNhbWUgYXMgZGVsdGFWYWx1ZScgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuc2hpZnRLZXlib2FyZFN0ZXAgPT09IHVuZGVmaW5lZCwgJ051bWJlclNwaW5uZXIgc2V0cyBzaGlmdEtleWJvYXJkU3RlcCwgaXQgd2lsbCBiZSB0aGUgc2FtZSBhcyBkZWx0YVZhbHVlJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5wYWdlS2V5Ym9hcmRTdGVwID09PSB1bmRlZmluZWQsICdOdW1iZXJTcGlubmVyIHNldHMgcGFnZUtleWJvYXJkU3RlcCwgaXQgc2hvdWxkIG5vdCBiZSB1c2VkIHdpdGggTnVtYmVyU3Bpbm5lcicgKTtcclxuICAgIG9wdGlvbnMua2V5Ym9hcmRTdGVwID0gMDtcclxuICAgIG9wdGlvbnMuc2hpZnRLZXlib2FyZFN0ZXAgPSAwO1xyXG4gICAgb3B0aW9ucy5wYWdlS2V5Ym9hcmRTdGVwID0gMDtcclxuXHJcbiAgICAvLyBDYWxsIHN1cGVyIHdpdGhvdXQgdGhlIG9wdGlvbnMgdGhhdCByZXF1aXJlIHZhbGlkIGJvdW5kcy4gQ2FsbCBtdXRhdGUgbGF0ZXIgd2l0aCB0aG9zZSBvcHRpb25zLlxyXG4gICAgY29uc3QgYm91bmRzUmVxdWlyZWRPcHRpb25LZXlzID0gXy5waWNrKCBvcHRpb25zLCBOb2RlLlJFUVVJUkVTX0JPVU5EU19PUFRJT05fS0VZUyApO1xyXG4gICAgc3VwZXIoIF8ub21pdCggb3B0aW9ucywgTm9kZS5SRVFVSVJFU19CT1VORFNfT1BUSU9OX0tFWVMgKSApO1xyXG5cclxuICAgIC8vIGVuYWJsZS9kaXNhYmxlIGFycm93IGJ1dHRvbnNcclxuICAgIGNvbnN0IHVwZGF0ZUVuYWJsZWQgPSAoKSA9PiB7XHJcbiAgICAgIGluY3JlbWVudEJ1dHRvbi5lbmFibGVkID0gKCBpbmNyZW1lbnRGdW5jdGlvbiggbnVtYmVyUHJvcGVydHkudmFsdWUgKSA8PSByYW5nZVByb3BlcnR5LnZhbHVlLm1heCApO1xyXG4gICAgICBkZWNyZW1lbnRCdXR0b24uZW5hYmxlZCA9ICggZGVjcmVtZW50RnVuY3Rpb24oIG51bWJlclByb3BlcnR5LnZhbHVlICkgPj0gcmFuZ2VQcm9wZXJ0eS52YWx1ZS5taW4gKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gc3luY2hyb25pemUgd2l0aCBudW1iZXIgdmFsdWVcclxuICAgIGNvbnN0IG51bWJlclByb3BlcnR5T2JzZXJ2ZXIgPSAoIHZhbHVlOiBudW1iZXIgKSA9PiB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHJhbmdlUHJvcGVydHkudmFsdWUuY29udGFpbnMoIHZhbHVlICksIGB2YWx1ZSBvdXQgb2YgcmFuZ2U6ICR7dmFsdWV9YCApO1xyXG4gICAgICB1cGRhdGVFbmFibGVkKCk7XHJcbiAgICB9O1xyXG4gICAgbnVtYmVyUHJvcGVydHkubGluayggbnVtYmVyUHJvcGVydHlPYnNlcnZlciApOyAvLyBtdXN0IGJlIHVubGlua2VkIGluIGRpc3Bvc2VcclxuXHJcbiAgICAvLyBEeW5hbWljIHJhbmdlIGNoYW5nZXMsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS1waGV0L2lzc3Vlcy8zMDVcclxuICAgIGNvbnN0IHJhbmdlT2JzZXJ2ZXIgPSAoIHJhbmdlOiBSYW5nZSApID0+IHtcclxuXHJcbiAgICAgIC8vIElmIG91ciB2YWx1ZSBpcyBvdXRzaWRlIG91ciBuZXcgcmFuZ2UsIGFkanVzdCBpdCB0byBiZSB3aXRoaW4gdGhlIHJhbmdlLlxyXG4gICAgICBudW1iZXJQcm9wZXJ0eS52YWx1ZSA9IHJhbmdlLmNvbnN0cmFpblZhbHVlKCBudW1iZXJQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICAgICAgLy8gUmFuZ2UgY2hhbmdlcyBtYXkgY2hhbmdlIHdoZXRoZXIgdGhlIGJ1dHRvbnMgYXJlIGVuYWJsZWRcclxuICAgICAgdXBkYXRlRW5hYmxlZCgpO1xyXG4gICAgfTtcclxuICAgIHJhbmdlUHJvcGVydHkubGluayggcmFuZ2VPYnNlcnZlciApO1xyXG5cclxuICAgIC8vIHBkb20gLSBjbGljayBhcnJvdyBidXR0b25zIG9uIHByZXNzIG9mIGFycm93IGtleXMgc28gdGhhdCB0aGUgUHJvcGVydHkgdmFsdWUgY2hhbmdlcyBieSBkZWx0YVZhbHVlXHJcbiAgICAvLyBhbmQgdGhlIGJ1dHRvbnMgbG9vayBkZXByZXNzZWRcclxuICAgIGNvbnN0IGluY3JlYXNlZExpc3RlbmVyID0gKCBpc0Rvd246IGJvb2xlYW4gKSA9PiAoIGlzRG93biAmJiBpbmNyZW1lbnRCdXR0b24ucGRvbUNsaWNrKCkgKTtcclxuICAgIGNvbnN0IGRlY3JlYXNlZExpc3RlbmVyID0gKCBpc0Rvd246IGJvb2xlYW4gKSA9PiAoIGlzRG93biAmJiBkZWNyZW1lbnRCdXR0b24ucGRvbUNsaWNrKCkgKTtcclxuICAgIHRoaXMucGRvbUluY3JlbWVudERvd25FbWl0dGVyLmFkZExpc3RlbmVyKCBpbmNyZWFzZWRMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5wZG9tRGVjcmVtZW50RG93bkVtaXR0ZXIuYWRkTGlzdGVuZXIoIGRlY3JlYXNlZExpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlTnVtYmVyU3Bpbm5lciA9ICgpID0+IHtcclxuXHJcbiAgICAgIC8vIGRpc3Bvc2Ugb2Ygc3ViY29tcG9uZW50c1xyXG4gICAgICBudW1iZXJEaXNwbGF5LmRpc3Bvc2UoKTtcclxuICAgICAgaW5jcmVtZW50QnV0dG9uLmRpc3Bvc2UoKTtcclxuICAgICAgZGVjcmVtZW50QnV0dG9uLmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgIC8vIGRpc3Bvc2UgYTExeSBmZWF0dXJlc1xyXG4gICAgICB0aGlzLnBkb21JbmNyZW1lbnREb3duRW1pdHRlci5yZW1vdmVMaXN0ZW5lciggaW5jcmVhc2VkTGlzdGVuZXIgKTtcclxuICAgICAgdGhpcy5wZG9tRGVjcmVtZW50RG93bkVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIGRlY3JlYXNlZExpc3RlbmVyICk7XHJcblxyXG4gICAgICBudW1iZXJQcm9wZXJ0eS51bmxpbmsoIG51bWJlclByb3BlcnR5T2JzZXJ2ZXIgKTtcclxuICAgICAgcmFuZ2VQcm9wZXJ0eS51bmxpbmsoIHJhbmdlT2JzZXJ2ZXIgKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIGJvdW5kc1JlcXVpcmVkT3B0aW9uS2V5cyApO1xyXG5cclxuICAgIHRoaXMubnVtYmVyRGlzcGxheSA9IG51bWJlckRpc3BsYXk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgbGluayB0byBhc3NvY2lhdGVkIFByb3BlcnR5LCBzbyBpdCdzIGVhc2llciB0byBmaW5kIGluIFN0dWRpby4gTXVzdCBiZSBhZnRlciBpbnN0cnVtZW50YXRpb25cclxuICAgIHRoaXMuYWRkTGlua2VkRWxlbWVudCggbnVtYmVyUHJvcGVydHksIHtcclxuICAgICAgdGFuZGVtTmFtZTogJ3Byb3BlcnR5J1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHN1cHBvcnQgZm9yIGJpbmRlciBkb2N1bWVudGF0aW9uLCBzdHJpcHBlZCBvdXQgaW4gYnVpbGRzIGFuZCBvbmx5IHJ1bnMgd2hlbiA/YmluZGVyIGlzIHNwZWNpZmllZFxyXG4gICAgYXNzZXJ0ICYmIHBoZXQ/LmNoaXBwZXI/LnF1ZXJ5UGFyYW1ldGVycz8uYmluZGVyICYmIEluc3RhbmNlUmVnaXN0cnkucmVnaXN0ZXJEYXRhVVJMKCAnc3VuJywgJ051bWJlclNwaW5uZXInLCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZU51bWJlclNwaW5uZXIoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnN1bi5yZWdpc3RlciggJ051bWJlclNwaW5uZXInLCBOdW1iZXJTcGlubmVyICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUEsT0FBT0EsZ0JBQWdCLE1BQU0sc0RBQXNEO0FBQ25GLE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLGlDQUFpQztBQUMzRSxPQUFPQyxhQUFhLE1BQWdDLHdDQUF3QztBQUM1RixTQUFTQyxJQUFJLEVBQWVDLGdCQUFnQixRQUFnQiw2QkFBNkI7QUFDekYsT0FBT0MsTUFBTSxNQUFNLDJCQUEyQjtBQUM5QyxPQUFPQyx1QkFBdUIsTUFBMEMsNENBQTRDO0FBQ3BILE9BQU9DLFdBQVcsTUFBOEIsMEJBQTBCO0FBRTFFLE9BQU9DLEdBQUcsTUFBTSxVQUFVO0FBRzFCLE9BQU9DLHFCQUFxQixNQUFNLDhEQUE4RDtBQUVoRyxPQUFPQyxlQUFlLE1BQU0sd0RBQXdEOztBQU1wRTs7QUF3Q2hCLGVBQWUsTUFBTUMsYUFBYSxTQUFTTCx1QkFBdUIsQ0FBRUgsSUFBSSxFQUFFLENBQUUsQ0FBQyxDQUFDO0VBSzVFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDU1MsV0FBV0EsQ0FBRUMsY0FBZ0MsRUFBRUMsYUFBdUMsRUFBRUMsZUFBc0MsRUFBRztJQUV0SUMsTUFBTSxJQUFJQSxNQUFNLENBQUVGLGFBQWEsQ0FBQ0csS0FBSyxDQUFDQyxRQUFRLENBQUVMLGNBQWMsQ0FBQ00sR0FBRyxDQUFDLENBQUUsQ0FBQyxFQUNuRSxTQUFRTixjQUFjLENBQUNNLEdBQUcsQ0FBQyxDQUFFLG9CQUFtQkwsYUFBYSxDQUFDRyxLQUFLLENBQUNHLFFBQVEsQ0FBQyxDQUFFLEVBQUUsQ0FBQztJQUVyRixNQUFNQyxPQUFPLEdBQUdyQixTQUFTLENBRVIsQ0FBQyxDQUFFO01BRWxCO01BQ0FzQixpQkFBaUIsRUFBRWIscUJBQXFCO01BQ3hDYyxjQUFjLEVBQUUsV0FBVztNQUMz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