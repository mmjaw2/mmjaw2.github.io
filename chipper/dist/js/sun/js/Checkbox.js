// Copyright 2013-2024, University of Colorado Boulder

/**
 * Checkbox is a typical checkbox UI component.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import PhetioAction from '../../tandem/js/PhetioAction.js';
import validate from '../../axon/js/validate.js';
import { m3 } from '../../dot/js/Matrix3.js';
import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import { FireListener, isWidthSizable, LayoutConstraint, Node, Path, Rectangle, SceneryConstants, Voicing, WidthSizable } from '../../scenery/js/imports.js';
import checkEmptySolidShape from '../../sherpa/js/fontawesome-4/checkEmptySolidShape.js';
import checkSquareOSolidShape from '../../sherpa/js/fontawesome-4/checkSquareOSolidShape.js';
import checkboxCheckedSoundPlayer from '../../tambo/js/shared-sound-players/checkboxCheckedSoundPlayer.js';
import checkboxUncheckedSoundPlayer from '../../tambo/js/shared-sound-players/checkboxUncheckedSoundPlayer.js';
import EventType from '../../tandem/js/EventType.js';
import PhetioObject from '../../tandem/js/PhetioObject.js';
import Tandem from '../../tandem/js/Tandem.js';
import optionize from '../../phet-core/js/optionize.js';
import sun from './sun.js';
import Utterance from '../../utterance-queue/js/Utterance.js';
// constants
const BOOLEAN_VALIDATOR = {
  valueType: 'boolean'
};
const SHAPE_MATRIX = m3(0.025, 0, 0, 0, -0.025, 0, 0, 0, 1); // to create a unity-scale icon
const uncheckedShape = checkEmptySolidShape.transformed(SHAPE_MATRIX);
const checkedShape = checkSquareOSolidShape.transformed(SHAPE_MATRIX);
export default class Checkbox extends WidthSizable(Voicing(Node)) {
  // We need to record if the mouse/touch areas are customized, so that we can avoid overwriting them.
  // public for use by CheckboxConstraint only!
  _isMouseAreaCustomized = false;
  _isTouchAreaCustomized = false;
  _isSettingAreas = false;

  // Handles layout of the content, rectangles and mouse/touch areas

  constructor(property, content, providedOptions) {
    const options = optionize()({
      // CheckboxOptions
      spacing: 5,
      boxWidth: 21,
      checkboxColor: 'black',
      checkboxColorBackground: 'white',
      touchAreaXDilation: 0,
      touchAreaYDilation: 0,
      mouseAreaXDilation: 0,
      mouseAreaYDilation: 0,
      checkedSoundPlayer: checkboxCheckedSoundPlayer,
      uncheckedSoundPlayer: checkboxUncheckedSoundPlayer,
      phetioLinkProperty: true,
      // NodeOptions
      cursor: 'pointer',
      disabledOpacity: SceneryConstants.DISABLED_OPACITY,
      // phet-io
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'Checkbox',
      phetioEventType: EventType.USER,
      visiblePropertyOptions: {
        phetioFeatured: true
      },
      phetioEnabledPropertyInstrumented: true,
      // opt into default PhET-iO instrumented enabledProperty

      // to support properly passing this to children, see https://github.com/phetsims/tandem/issues/60
      phetioReadOnly: PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,
      phetioFeatured: true,
      // pdom
      tagName: 'input',
      inputType: 'checkbox',
      appendDescription: true,
      // voicing
      voicingCheckedObjectResponse: null,
      voicingUncheckedObjectResponse: null,
      // Utterances to be spoken with a screen reader after the checkbox is pressed. Also used for
      // the voicingContextResponse
      checkedContextResponse: null,
      uncheckedContextResponse: null,
      voiceNameResponseOnSelection: true
    }, providedOptions);
    super();

    // sends out notifications when the checkbox is toggled.
    const toggleAction = new PhetioAction(() => {
      property.value = !property.value;
      validate(property.value, BOOLEAN_VALIDATOR);
      if (property.value) {
        options.checkedSoundPlayer.play();
        options.checkedContextResponse && this.alertDescriptionUtterance(options.checkedContextResponse);
        this.voicingSpeakResponse({
          nameResponse: options.voiceNameResponseOnSelection ? this.voicingNameResponse : null,
          objectResponse: Utterance.alertableToText(options.voicingCheckedObjectResponse),
          contextResponse: Utterance.alertableToText(options.checkedContextResponse)
        });
      } else {
        options.uncheckedSoundPlayer.play();
        options.uncheckedContextResponse && this.alertDescriptionUtterance(options.uncheckedContextResponse);
        this.voicingSpeakResponse({
          nameResponse: options.voiceNameResponseOnSelection ? this.voicingNameResponse : null,
          objectResponse: Utterance.alertableToText(options.voicingUncheckedObjectResponse),
          contextResponse: Utterance.alertableToText(options.uncheckedContextResponse)
        });
      }
    }, {
      parameters: [],
      tandem: options.tandem.createTandem('toggleAction'),
      phetioDocumentation: 'Emits when user input causes the checkbox to toggle, emitting a single arg: ' + 'the new boolean value of the checkbox state.',
      phetioReadOnly: true,
      // interoperability should be done through the Property, this is just for the data stream event.
      phetioEventType: EventType.USER
    });

    // Create the background.
    // Until we are creating our own shapes, just put a rectangle behind the font awesome checkbox icons.
    this.backgroundNode = new Rectangle(0, -options.boxWidth, options.boxWidth * 0.95, options.boxWidth * 0.95, options.boxWidth * 0.2, options.boxWidth * 0.2, {
      fill: options.checkboxColorBackground
    });
    this.uncheckedNode = new Path(uncheckedShape, {
      fill: options.checkboxColor
    });
    const iconScale = options.boxWidth / this.uncheckedNode.width;
    this.uncheckedNode.scale(iconScale);
    this.checkedNode = new Path(checkedShape, {
      scale: iconScale,
      fill: options.checkboxColor
    });
    const checkboxNode = new Node({
      children: [this.backgroundNode, this.checkedNode, this.uncheckedNode]
    });

    // put a rectangle on top of everything to prevent dead zones when clicking
    const rectangle = new Rectangle({});
    this.children = [checkboxNode, content, rectangle];
    this.constraint = new CheckboxConstraint(this, checkboxNode, this.checkedNode, content, rectangle, options);
    this.constraint.updateLayout();
    content.pickable = false; // since there's a pickable rectangle on top of content

    // In case the content is an instance of a focusable Node. Checkbox icon should not be in the traversal order.
    content.pdomVisible = false;

    // interactivity
    const fireListener = new FireListener({
      fire: () => toggleAction.execute(),
      tandem: options.tandem.createTandem('fireListener')
    });
    this.addInputListener(fireListener);

    // sync with property
    const checkboxCheckedListener = checked => {
      this.checkedNode.visible = checked;
      this.uncheckedNode.visible = !checked;
      this.pdomChecked = checked;
    };
    property.link(checkboxCheckedListener);

    // Apply additional options
    this.mutate(options);

    // pdom - to prevent a bug with NVDA and Firefox where the label sibling receives two click events, see
    // https://github.com/phetsims/gravity-force-lab/issues/257
    this.setExcludeLabelSiblingFromInput();

    // must be after the Checkbox is instrumented
    options.phetioLinkProperty && this.addLinkedElement(property, {
      tandemName: 'property'
    });

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet?.chipper?.queryParameters?.binder && InstanceRegistry.registerDataURL('sun', 'Checkbox', this);
    this.disposeCheckbox = () => {
      rectangle.dispose();
      this.backgroundNode.dispose();
      this.uncheckedNode.dispose();
      this.checkedNode.dispose();
      checkboxNode.dispose();
      fireListener.dispose();
      if (property.hasListener(checkboxCheckedListener)) {
        property.unlink(checkboxCheckedListener);
      }

      // Private to Checkbox, but we need to clean up tandem.
      toggleAction.dispose();
    };
  }
  dispose() {
    this.constraint.dispose();
    this.disposeCheckbox();
    super.dispose();
  }

  /**
   * Sets the background color of the checkbox.
   */
  setCheckboxColorBackground(value) {
    this.backgroundNode.fill = value;
  }
  set checkboxColorBackground(value) {
    this.setCheckboxColorBackground(value);
  }
  get checkboxColorBackground() {
    return this.getCheckboxColorBackground();
  }

  /**
   * Gets the background color of the checkbox.
   */
  getCheckboxColorBackground() {
    return this.backgroundNode.fill;
  }

  /**
   * Sets the color of the checkbox.
   */
  setCheckboxColor(value) {
    this.checkedNode.fill = this.uncheckedNode.fill = value;
  }
  set checkboxColor(value) {
    this.setCheckboxColor(value);
  }
  get checkboxColor() {
    return this.getCheckboxColor();
  }

  /**
   * Gets the color of the checkbox.
   */
  getCheckboxColor() {
    return this.checkedNode.fill;
  }
  setMouseArea(area) {
    if (!this._isSettingAreas) {
      this._isMouseAreaCustomized = true;
    }
    return super.setMouseArea(area);
  }
  setTouchArea(area) {
    if (!this._isSettingAreas) {
      this._isTouchAreaCustomized = true;
    }
    return super.setTouchArea(area);
  }
}
class CheckboxConstraint extends LayoutConstraint {
  constructor(checkbox, checkboxNode, checkedNode, content, rectangle, options) {
    super(checkbox);
    this.checkbox = checkbox;
    this.checkboxNode = checkboxNode;
    this.checkedNode = checkedNode;
    this.content = content;
    this.rectangle = rectangle;
    this.options = options;
    this.checkbox.localPreferredWidthProperty.lazyLink(this._updateLayoutListener);
    this.addNode(content);
  }
  layout() {
    super.layout();

    // LayoutProxy helps with some layout operations, and will support a non-child content.
    const contentProxy = this.createLayoutProxy(this.content);
    const contentWidth = contentProxy.minimumWidth;

    // Our bounds are based on checkboxNode, but our layout is relative to checkedNode
    const checkboxWithoutSpacingWidth = this.checkedNode.right - this.checkboxNode.left;
    const minimumWidth = checkboxWithoutSpacingWidth + this.options.spacing + contentWidth;
    const preferredWidth = Math.max(minimumWidth, this.checkbox.localPreferredWidth || 0);

    // Attempt to set a preferredWidth
    if (isWidthSizable(this.content) && this.checkbox.localPreferredWidth !== null) {
      contentProxy.preferredWidth = preferredWidth - checkboxWithoutSpacingWidth - this.options.spacing;
    }

    // For now just position content. Future updates could include widthResizable content?
    contentProxy.left = this.checkedNode.right + this.options.spacing;
    contentProxy.centerY = this.checkedNode.centerY;

    // Our rectangle bounds will cover the checkboxNode and content, and if necessary expand to include the full
    // preferredWidth
    this.rectangle.rectBounds = this.checkboxNode.bounds.union(contentProxy.bounds).withMaxX(Math.max(this.checkboxNode.left + preferredWidth, contentProxy.right));

    // Update pointer areas (if the client hasn't customized them)
    this.checkbox._isSettingAreas = true;
    if (!this.checkbox._isTouchAreaCustomized) {
      this.checkbox.touchArea = this.checkbox.localBounds.dilatedXY(this.options.touchAreaXDilation, this.options.touchAreaYDilation);
    }
    if (!this.checkbox._isMouseAreaCustomized) {
      this.checkbox.mouseArea = this.checkbox.localBounds.dilatedXY(this.options.mouseAreaXDilation, this.options.mouseAreaYDilation);
    }
    this.checkbox._isSettingAreas = false;
    contentProxy.dispose();

    // Set the minimumWidth last, since this may trigger a relayout
    this.checkbox.localMinimumWidth = minimumWidth;
  }
  dispose() {
    this.checkbox.localPreferredWidthProperty.unlink(this._updateLayoutListener);
    super.dispose();
  }
}
sun.register('Checkbox', Checkbox);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQaGV0aW9BY3Rpb24iLCJ2YWxpZGF0ZSIsIm0zIiwiSW5zdGFuY2VSZWdpc3RyeSIsIkZpcmVMaXN0ZW5lciIsImlzV2lkdGhTaXphYmxlIiwiTGF5b3V0Q29uc3RyYWludCIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwiU2NlbmVyeUNvbnN0YW50cyIsIlZvaWNpbmciLCJXaWR0aFNpemFibGUiLCJjaGVja0VtcHR5U29saWRTaGFwZSIsImNoZWNrU3F1YXJlT1NvbGlkU2hhcGUiLCJjaGVja2JveENoZWNrZWRTb3VuZFBsYXllciIsImNoZWNrYm94VW5jaGVja2VkU291bmRQbGF5ZXIiLCJFdmVudFR5cGUiLCJQaGV0aW9PYmplY3QiLCJUYW5kZW0iLCJvcHRpb25pemUiLCJzdW4iLCJVdHRlcmFuY2UiLCJCT09MRUFOX1ZBTElEQVRPUiIsInZhbHVlVHlwZSIsIlNIQVBFX01BVFJJWCIsInVuY2hlY2tlZFNoYXBlIiwidHJhbnNmb3JtZWQiLCJjaGVja2VkU2hhcGUiLCJDaGVja2JveCIsIl9pc01vdXNlQXJlYUN1c3RvbWl6ZWQiLCJfaXNUb3VjaEFyZWFDdXN0b21pemVkIiwiX2lzU2V0dGluZ0FyZWFzIiwiY29uc3RydWN0b3IiLCJwcm9wZXJ0eSIsImNvbnRlbnQiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwic3BhY2luZyIsImJveFdpZHRoIiwiY2hlY2tib3hDb2xvciIsImNoZWNrYm94Q29sb3JCYWNrZ3JvdW5kIiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwibW91c2VBcmVhWERpbGF0aW9uIiwibW91c2VBcmVhWURpbGF0aW9uIiwiY2hlY2tlZFNvdW5kUGxheWVyIiwidW5jaGVja2VkU291bmRQbGF5ZXIiLCJwaGV0aW9MaW5rUHJvcGVydHkiLCJjdXJzb3IiLCJkaXNhYmxlZE9wYWNpdHkiLCJESVNBQkxFRF9PUEFDSVRZIiwidGFuZGVtIiwiUkVRVUlSRUQiLCJ0YW5kZW1OYW1lU3VmZml4IiwicGhldGlvRXZlbnRUeXBlIiwiVVNFUiIsInZpc2libGVQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9GZWF0dXJlZCIsInBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsInBoZXRpb1JlYWRPbmx5IiwiREVGQVVMVF9PUFRJT05TIiwidGFnTmFtZSIsImlucHV0VHlwZSIsImFwcGVuZERlc2NyaXB0aW9uIiwidm9pY2luZ0NoZWNrZWRPYmplY3RSZXNwb25zZSIsInZvaWNpbmdVbmNoZWNrZWRPYmplY3RSZXNwb25zZSIsImNoZWNrZWRDb250ZXh0UmVzcG9uc2UiLCJ1bmNoZWNrZWRDb250ZXh0UmVzcG9uc2UiLCJ2b2ljZU5hbWVSZXNwb25zZU9uU2VsZWN0aW9uIiwidG9nZ2xlQWN0aW9uIiwidmFsdWUiLCJwbGF5IiwiYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSIsInZvaWNpbmdTcGVha1Jlc3BvbnNlIiwibmFtZVJlc3BvbnNlIiwidm9pY2luZ05hbWVSZXNwb25zZSIsIm9iamVjdFJlc3BvbnNlIiwiYWxlcnRhYmxlVG9UZXh0IiwiY29udGV4dFJlc3BvbnNlIiwicGFyYW1ldGVycyIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJiYWNrZ3JvdW5kTm9kZSIsImZpbGwiLCJ1bmNoZWNrZWROb2RlIiwiaWNvblNjYWxlIiwid2lkdGgiLCJzY2FsZSIsImNoZWNrZWROb2RlIiwiY2hlY2tib3hOb2RlIiwiY2hpbGRyZW4iLCJyZWN0YW5nbGUiLCJjb25zdHJhaW50IiwiQ2hlY2tib3hDb25zdHJhaW50IiwidXBkYXRlTGF5b3V0IiwicGlja2FibGUiLCJwZG9tVmlzaWJsZSIsImZpcmVMaXN0ZW5lciIsImZpcmUiLCJleGVjdXRlIiwiYWRkSW5wdXRMaXN0ZW5lciIsImNoZWNrYm94Q2hlY2tlZExpc3RlbmVyIiwiY2hlY2tlZCIsInZpc2libGUiLCJwZG9tQ2hlY2tlZCIsImxpbmsiLCJtdXRhdGUiLCJzZXRFeGNsdWRlTGFiZWxTaWJsaW5nRnJvbUlucHV0IiwiYWRkTGlua2VkRWxlbWVudCIsInRhbmRlbU5hbWUiLCJhc3NlcnQiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsImJpbmRlciIsInJlZ2lzdGVyRGF0YVVSTCIsImRpc3Bvc2VDaGVja2JveCIsImRpc3Bvc2UiLCJoYXNMaXN0ZW5lciIsInVubGluayIsInNldENoZWNrYm94Q29sb3JCYWNrZ3JvdW5kIiwiZ2V0Q2hlY2tib3hDb2xvckJhY2tncm91bmQiLCJzZXRDaGVja2JveENvbG9yIiwiZ2V0Q2hlY2tib3hDb2xvciIsInNldE1vdXNlQXJlYSIsImFyZWEiLCJzZXRUb3VjaEFyZWEiLCJjaGVja2JveCIsImxvY2FsUHJlZmVycmVkV2lkdGhQcm9wZXJ0eSIsImxhenlMaW5rIiwiX3VwZGF0ZUxheW91dExpc3RlbmVyIiwiYWRkTm9kZSIsImxheW91dCIsImNvbnRlbnRQcm94eSIsImNyZWF0ZUxheW91dFByb3h5IiwiY29udGVudFdpZHRoIiwibWluaW11bVdpZHRoIiwiY2hlY2tib3hXaXRob3V0U3BhY2luZ1dpZHRoIiwicmlnaHQiLCJsZWZ0IiwicHJlZmVycmVkV2lkdGgiLCJNYXRoIiwibWF4IiwibG9jYWxQcmVmZXJyZWRXaWR0aCIsImNlbnRlclkiLCJyZWN0Qm91bmRzIiwiYm91bmRzIiwidW5pb24iLCJ3aXRoTWF4WCIsInRvdWNoQXJlYSIsImxvY2FsQm91bmRzIiwiZGlsYXRlZFhZIiwibW91c2VBcmVhIiwibG9jYWxNaW5pbXVtV2lkdGgiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNoZWNrYm94LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENoZWNrYm94IGlzIGEgdHlwaWNhbCBjaGVja2JveCBVSSBjb21wb25lbnQuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFBoZXRpb0FjdGlvbiBmcm9tICcuLi8uLi90YW5kZW0vanMvUGhldGlvQWN0aW9uLmpzJztcclxuaW1wb3J0IHZhbGlkYXRlIGZyb20gJy4uLy4uL2F4b24vanMvdmFsaWRhdGUuanMnO1xyXG5pbXBvcnQgeyBtMyB9IGZyb20gJy4uLy4uL2RvdC9qcy9NYXRyaXgzLmpzJztcclxuaW1wb3J0IEluc3RhbmNlUmVnaXN0cnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL2RvY3VtZW50YXRpb24vSW5zdGFuY2VSZWdpc3RyeS5qcyc7XHJcbmltcG9ydCB7IEZpcmVMaXN0ZW5lciwgaXNXaWR0aFNpemFibGUsIExheW91dENvbnN0cmFpbnQsIE5vZGUsIE5vZGVPcHRpb25zLCBQYXRoLCBSZWN0YW5nbGUsIFNjZW5lcnlDb25zdGFudHMsIFRQYWludCwgVm9pY2luZywgVm9pY2luZ09wdGlvbnMsIFdpZHRoU2l6YWJsZSwgV2lkdGhTaXphYmxlT3B0aW9ucyB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBjaGVja0VtcHR5U29saWRTaGFwZSBmcm9tICcuLi8uLi9zaGVycGEvanMvZm9udGF3ZXNvbWUtNC9jaGVja0VtcHR5U29saWRTaGFwZS5qcyc7XHJcbmltcG9ydCBjaGVja1NxdWFyZU9Tb2xpZFNoYXBlIGZyb20gJy4uLy4uL3NoZXJwYS9qcy9mb250YXdlc29tZS00L2NoZWNrU3F1YXJlT1NvbGlkU2hhcGUuanMnO1xyXG5pbXBvcnQgY2hlY2tib3hDaGVja2VkU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vdGFtYm8vanMvc2hhcmVkLXNvdW5kLXBsYXllcnMvY2hlY2tib3hDaGVja2VkU291bmRQbGF5ZXIuanMnO1xyXG5pbXBvcnQgY2hlY2tib3hVbmNoZWNrZWRTb3VuZFBsYXllciBmcm9tICcuLi8uLi90YW1iby9qcy9zaGFyZWQtc291bmQtcGxheWVycy9jaGVja2JveFVuY2hlY2tlZFNvdW5kUGxheWVyLmpzJztcclxuaW1wb3J0IEV2ZW50VHlwZSBmcm9tICcuLi8uLi90YW5kZW0vanMvRXZlbnRUeXBlLmpzJztcclxuaW1wb3J0IFBoZXRpb09iamVjdCBmcm9tICcuLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHN1biBmcm9tICcuL3N1bi5qcyc7XHJcbmltcG9ydCBUU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vdGFtYm8vanMvVFNvdW5kUGxheWVyLmpzJztcclxuaW1wb3J0IFV0dGVyYW5jZSwgeyBUQWxlcnRhYmxlIH0gZnJvbSAnLi4vLi4vdXR0ZXJhbmNlLXF1ZXVlL2pzL1V0dGVyYW5jZS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBQaGV0aW9Qcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1BoZXRpb1Byb3BlcnR5LmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBCT09MRUFOX1ZBTElEQVRPUiA9IHsgdmFsdWVUeXBlOiAnYm9vbGVhbicgfTtcclxuY29uc3QgU0hBUEVfTUFUUklYID0gbTMoIDAuMDI1LCAwLCAwLCAwLCAtMC4wMjUsIDAsIDAsIDAsIDEgKTsgLy8gdG8gY3JlYXRlIGEgdW5pdHktc2NhbGUgaWNvblxyXG5jb25zdCB1bmNoZWNrZWRTaGFwZSA9IGNoZWNrRW1wdHlTb2xpZFNoYXBlLnRyYW5zZm9ybWVkKCBTSEFQRV9NQVRSSVggKTtcclxuY29uc3QgY2hlY2tlZFNoYXBlID0gY2hlY2tTcXVhcmVPU29saWRTaGFwZS50cmFuc2Zvcm1lZCggU0hBUEVfTUFUUklYICk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIHNwYWNpbmc/OiBudW1iZXI7ICAvLyBzcGFjaW5nIGJldHdlZW4gYm94IGFuZCBjb250ZW50XHJcbiAgYm94V2lkdGg/OiBudW1iZXI7IC8vIHdpZHRoIChhbmQgaGVpZ2h0KSBvZiB0aGUgYm94XHJcbiAgY2hlY2tib3hDb2xvcj86IFRQYWludDtcclxuICBjaGVja2JveENvbG9yQmFja2dyb3VuZD86IFRQYWludDtcclxuXHJcbiAgLy8gcG9pbnRlciBhcmVhc1xyXG4gIHRvdWNoQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICB0b3VjaEFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgbW91c2VBcmVhWERpbGF0aW9uPzogbnVtYmVyO1xyXG4gIG1vdXNlQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcclxuXHJcbiAgLy8gc291bmRzXHJcbiAgY2hlY2tlZFNvdW5kUGxheWVyPzogVFNvdW5kUGxheWVyO1xyXG4gIHVuY2hlY2tlZFNvdW5kUGxheWVyPzogVFNvdW5kUGxheWVyO1xyXG5cclxuICAvLyBVdHRlcmFuY2VzIHRvIGJlIHNwb2tlbiB3aXRoIGEgc2NyZWVuIHJlYWRlciBhZnRlciB0aGUgY2hlY2tib3ggaXMgcHJlc3NlZC4gQWxzbyB1c2VkIGZvciB0aGUgdm9pY2luZ0NvbnRleHRSZXNwb25zZS5cclxuICBjaGVja2VkQ29udGV4dFJlc3BvbnNlPzogVEFsZXJ0YWJsZTtcclxuICB1bmNoZWNrZWRDb250ZXh0UmVzcG9uc2U/OiBUQWxlcnRhYmxlO1xyXG5cclxuICAvLyBCeSBkZWZhdWx0IHZvaWNlIHRoZSBuYW1lIHJlc3BvbnNlIG9uIGNoZWNrYm94IGNoYW5nZSAod2l0aCB0aGUgY29udGV4dCByZXNwb25zZSksIGJ1dCBvcHRpb25hbGx5IHR1cm4gaXQgb2ZmIGhlcmUuXHJcbiAgdm9pY2VOYW1lUmVzcG9uc2VPblNlbGVjdGlvbj86IGJvb2xlYW47XHJcblxyXG4gIC8vIE91dHB1dCBkZXNjcmliaW5nIHRoZSBzdGF0ZSBvZiB0aGUgQ2hlY2tib3ggYWZ0ZXIgaXQgaXMgcHJlc3NlZCB1c2luZyB0aGUgVm9pY2luZyBmZWF0dXJlLiBMaWtlIFwiQ2hlY2tlZFwiIG9yXHJcbiAgLy8gXCJMb2NrZWRcIi4gTm90IHVzdWFsbHkgbmVlZGVkLCBkZWZhdWx0IGlzIG51bGwuXHJcbiAgdm9pY2luZ0NoZWNrZWRPYmplY3RSZXNwb25zZT86IFRBbGVydGFibGU7XHJcbiAgdm9pY2luZ1VuY2hlY2tlZE9iamVjdFJlc3BvbnNlPzogVEFsZXJ0YWJsZTtcclxuXHJcbiAgLy8gd2hldGhlciBhIFBoRVQtaU8gbGluayB0byB0aGUgY2hlY2tib3gncyBQcm9wZXJ0eSBpcyBjcmVhdGVkXHJcbiAgcGhldGlvTGlua1Byb3BlcnR5PzogYm9vbGVhbjtcclxufTtcclxuXHJcbnR5cGUgUGFyZW50T3B0aW9ucyA9IFdpZHRoU2l6YWJsZU9wdGlvbnMgJiBWb2ljaW5nT3B0aW9ucyAmIE5vZGVPcHRpb25zO1xyXG5cclxuZXhwb3J0IHR5cGUgQ2hlY2tib3hPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PFBhcmVudE9wdGlvbnMsICdjaGlsZHJlbicgfCAnbW91c2VBcmVhJyB8ICd0b3VjaEFyZWEnPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENoZWNrYm94IGV4dGVuZHMgV2lkdGhTaXphYmxlKCBWb2ljaW5nKCBOb2RlICkgKSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgYmFja2dyb3VuZE5vZGU6IFJlY3RhbmdsZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNoZWNrZWROb2RlOiBQYXRoO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdW5jaGVja2VkTm9kZTogUGF0aDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VDaGVja2JveDogKCkgPT4gdm9pZDtcclxuXHJcbiAgLy8gV2UgbmVlZCB0byByZWNvcmQgaWYgdGhlIG1vdXNlL3RvdWNoIGFyZWFzIGFyZSBjdXN0b21pemVkLCBzbyB0aGF0IHdlIGNhbiBhdm9pZCBvdmVyd3JpdGluZyB0aGVtLlxyXG4gIC8vIHB1YmxpYyBmb3IgdXNlIGJ5IENoZWNrYm94Q29uc3RyYWludCBvbmx5IVxyXG4gIHB1YmxpYyBfaXNNb3VzZUFyZWFDdXN0b21pemVkID0gZmFsc2U7XHJcbiAgcHVibGljIF9pc1RvdWNoQXJlYUN1c3RvbWl6ZWQgPSBmYWxzZTtcclxuICBwdWJsaWMgX2lzU2V0dGluZ0FyZWFzID0gZmFsc2U7XHJcblxyXG4gIC8vIEhhbmRsZXMgbGF5b3V0IG9mIHRoZSBjb250ZW50LCByZWN0YW5nbGVzIGFuZCBtb3VzZS90b3VjaCBhcmVhc1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY29uc3RyYWludDogQ2hlY2tib3hDb25zdHJhaW50O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3BlcnR5OiBQaGV0aW9Qcm9wZXJ0eTxib29sZWFuPiwgY29udGVudDogTm9kZSwgcHJvdmlkZWRPcHRpb25zPzogQ2hlY2tib3hPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8Q2hlY2tib3hPcHRpb25zLCBTZWxmT3B0aW9ucywgUGFyZW50T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gQ2hlY2tib3hPcHRpb25zXHJcbiAgICAgIHNwYWNpbmc6IDUsXHJcbiAgICAgIGJveFdpZHRoOiAyMSxcclxuICAgICAgY2hlY2tib3hDb2xvcjogJ2JsYWNrJyxcclxuICAgICAgY2hlY2tib3hDb2xvckJhY2tncm91bmQ6ICd3aGl0ZScsXHJcbiAgICAgIHRvdWNoQXJlYVhEaWxhdGlvbjogMCxcclxuICAgICAgdG91Y2hBcmVhWURpbGF0aW9uOiAwLFxyXG4gICAgICBtb3VzZUFyZWFYRGlsYXRpb246IDAsXHJcbiAgICAgIG1vdXNlQXJlYVlEaWxhdGlvbjogMCxcclxuICAgICAgY2hlY2tlZFNvdW5kUGxheWVyOiBjaGVja2JveENoZWNrZWRTb3VuZFBsYXllcixcclxuICAgICAgdW5jaGVja2VkU291bmRQbGF5ZXI6IGNoZWNrYm94VW5jaGVja2VkU291bmRQbGF5ZXIsXHJcbiAgICAgIHBoZXRpb0xpbmtQcm9wZXJ0eTogdHJ1ZSxcclxuXHJcbiAgICAgIC8vIE5vZGVPcHRpb25zXHJcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxyXG4gICAgICBkaXNhYmxlZE9wYWNpdHk6IFNjZW5lcnlDb25zdGFudHMuRElTQUJMRURfT1BBQ0lUWSxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXHJcbiAgICAgIHRhbmRlbU5hbWVTdWZmaXg6ICdDaGVja2JveCcsXHJcbiAgICAgIHBoZXRpb0V2ZW50VHlwZTogRXZlbnRUeXBlLlVTRVIsXHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eU9wdGlvbnM6IHsgcGhldGlvRmVhdHVyZWQ6IHRydWUgfSxcclxuICAgICAgcGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkOiB0cnVlLCAvLyBvcHQgaW50byBkZWZhdWx0IFBoRVQtaU8gaW5zdHJ1bWVudGVkIGVuYWJsZWRQcm9wZXJ0eVxyXG5cclxuICAgICAgLy8gdG8gc3VwcG9ydCBwcm9wZXJseSBwYXNzaW5nIHRoaXMgdG8gY2hpbGRyZW4sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdGFuZGVtL2lzc3Vlcy82MFxyXG4gICAgICBwaGV0aW9SZWFkT25seTogUGhldGlvT2JqZWN0LkRFRkFVTFRfT1BUSU9OUy5waGV0aW9SZWFkT25seSxcclxuICAgICAgcGhldGlvRmVhdHVyZWQ6IHRydWUsXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICdpbnB1dCcsXHJcbiAgICAgIGlucHV0VHlwZTogJ2NoZWNrYm94JyxcclxuICAgICAgYXBwZW5kRGVzY3JpcHRpb246IHRydWUsXHJcblxyXG4gICAgICAvLyB2b2ljaW5nXHJcbiAgICAgIHZvaWNpbmdDaGVja2VkT2JqZWN0UmVzcG9uc2U6IG51bGwsXHJcbiAgICAgIHZvaWNpbmdVbmNoZWNrZWRPYmplY3RSZXNwb25zZTogbnVsbCxcclxuXHJcbiAgICAgIC8vIFV0dGVyYW5jZXMgdG8gYmUgc3Bva2VuIHdpdGggYSBzY3JlZW4gcmVhZGVyIGFmdGVyIHRoZSBjaGVja2JveCBpcyBwcmVzc2VkLiBBbHNvIHVzZWQgZm9yXHJcbiAgICAgIC8vIHRoZSB2b2ljaW5nQ29udGV4dFJlc3BvbnNlXHJcbiAgICAgIGNoZWNrZWRDb250ZXh0UmVzcG9uc2U6IG51bGwsXHJcbiAgICAgIHVuY2hlY2tlZENvbnRleHRSZXNwb25zZTogbnVsbCxcclxuICAgICAgdm9pY2VOYW1lUmVzcG9uc2VPblNlbGVjdGlvbjogdHJ1ZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICAvLyBzZW5kcyBvdXQgbm90aWZpY2F0aW9ucyB3aGVuIHRoZSBjaGVja2JveCBpcyB0b2dnbGVkLlxyXG4gICAgY29uc3QgdG9nZ2xlQWN0aW9uID0gbmV3IFBoZXRpb0FjdGlvbiggKCkgPT4ge1xyXG4gICAgICBwcm9wZXJ0eS52YWx1ZSA9ICFwcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgdmFsaWRhdGUoIHByb3BlcnR5LnZhbHVlLCBCT09MRUFOX1ZBTElEQVRPUiApO1xyXG4gICAgICBpZiAoIHByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgIG9wdGlvbnMuY2hlY2tlZFNvdW5kUGxheWVyLnBsYXkoKTtcclxuICAgICAgICBvcHRpb25zLmNoZWNrZWRDb250ZXh0UmVzcG9uc2UgJiYgdGhpcy5hbGVydERlc2NyaXB0aW9uVXR0ZXJhbmNlKCBvcHRpb25zLmNoZWNrZWRDb250ZXh0UmVzcG9uc2UgKTtcclxuICAgICAgICB0aGlzLnZvaWNpbmdTcGVha1Jlc3BvbnNlKCB7XHJcbiAgICAgICAgICBuYW1lUmVzcG9uc2U6IG9wdGlvbnMudm9pY2VOYW1lUmVzcG9uc2VPblNlbGVjdGlvbiA/IHRoaXMudm9pY2luZ05hbWVSZXNwb25zZSA6IG51bGwsXHJcbiAgICAgICAgICBvYmplY3RSZXNwb25zZTogVXR0ZXJhbmNlLmFsZXJ0YWJsZVRvVGV4dCggb3B0aW9ucy52b2ljaW5nQ2hlY2tlZE9iamVjdFJlc3BvbnNlICksXHJcbiAgICAgICAgICBjb250ZXh0UmVzcG9uc2U6IFV0dGVyYW5jZS5hbGVydGFibGVUb1RleHQoIG9wdGlvbnMuY2hlY2tlZENvbnRleHRSZXNwb25zZSApXHJcbiAgICAgICAgfSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIG9wdGlvbnMudW5jaGVja2VkU291bmRQbGF5ZXIucGxheSgpO1xyXG4gICAgICAgIG9wdGlvbnMudW5jaGVja2VkQ29udGV4dFJlc3BvbnNlICYmIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggb3B0aW9ucy51bmNoZWNrZWRDb250ZXh0UmVzcG9uc2UgKTtcclxuICAgICAgICB0aGlzLnZvaWNpbmdTcGVha1Jlc3BvbnNlKCB7XHJcbiAgICAgICAgICBuYW1lUmVzcG9uc2U6IG9wdGlvbnMudm9pY2VOYW1lUmVzcG9uc2VPblNlbGVjdGlvbiA/IHRoaXMudm9pY2luZ05hbWVSZXNwb25zZSA6IG51bGwsXHJcbiAgICAgICAgICBvYmplY3RSZXNwb25zZTogVXR0ZXJhbmNlLmFsZXJ0YWJsZVRvVGV4dCggb3B0aW9ucy52b2ljaW5nVW5jaGVja2VkT2JqZWN0UmVzcG9uc2UgKSxcclxuICAgICAgICAgIGNvbnRleHRSZXNwb25zZTogVXR0ZXJhbmNlLmFsZXJ0YWJsZVRvVGV4dCggb3B0aW9ucy51bmNoZWNrZWRDb250ZXh0UmVzcG9uc2UgKVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgfSwge1xyXG4gICAgICBwYXJhbWV0ZXJzOiBbXSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd0b2dnbGVBY3Rpb24nICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdFbWl0cyB3aGVuIHVzZXIgaW5wdXQgY2F1c2VzIHRoZSBjaGVja2JveCB0byB0b2dnbGUsIGVtaXR0aW5nIGEgc2luZ2xlIGFyZzogJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICd0aGUgbmV3IGJvb2xlYW4gdmFsdWUgb2YgdGhlIGNoZWNrYm94IHN0YXRlLicsXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlLCAvLyBpbnRlcm9wZXJhYmlsaXR5IHNob3VsZCBiZSBkb25lIHRocm91Z2ggdGhlIFByb3BlcnR5LCB0aGlzIGlzIGp1c3QgZm9yIHRoZSBkYXRhIHN0cmVhbSBldmVudC5cclxuICAgICAgcGhldGlvRXZlbnRUeXBlOiBFdmVudFR5cGUuVVNFUlxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgYmFja2dyb3VuZC5cclxuICAgIC8vIFVudGlsIHdlIGFyZSBjcmVhdGluZyBvdXIgb3duIHNoYXBlcywganVzdCBwdXQgYSByZWN0YW5nbGUgYmVoaW5kIHRoZSBmb250IGF3ZXNvbWUgY2hlY2tib3ggaWNvbnMuXHJcbiAgICB0aGlzLmJhY2tncm91bmROb2RlID0gbmV3IFJlY3RhbmdsZSggMCwgLW9wdGlvbnMuYm94V2lkdGgsIG9wdGlvbnMuYm94V2lkdGggKiAwLjk1LCBvcHRpb25zLmJveFdpZHRoICogMC45NSxcclxuICAgICAgb3B0aW9ucy5ib3hXaWR0aCAqIDAuMiwgb3B0aW9ucy5ib3hXaWR0aCAqIDAuMiwge1xyXG4gICAgICAgIGZpbGw6IG9wdGlvbnMuY2hlY2tib3hDb2xvckJhY2tncm91bmRcclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMudW5jaGVja2VkTm9kZSA9IG5ldyBQYXRoKCB1bmNoZWNrZWRTaGFwZSwge1xyXG4gICAgICBmaWxsOiBvcHRpb25zLmNoZWNrYm94Q29sb3JcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGljb25TY2FsZSA9IG9wdGlvbnMuYm94V2lkdGggLyB0aGlzLnVuY2hlY2tlZE5vZGUud2lkdGg7XHJcbiAgICB0aGlzLnVuY2hlY2tlZE5vZGUuc2NhbGUoIGljb25TY2FsZSApO1xyXG5cclxuICAgIHRoaXMuY2hlY2tlZE5vZGUgPSBuZXcgUGF0aCggY2hlY2tlZFNoYXBlLCB7XHJcbiAgICAgIHNjYWxlOiBpY29uU2NhbGUsXHJcbiAgICAgIGZpbGw6IG9wdGlvbnMuY2hlY2tib3hDb2xvclxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGNoZWNrYm94Tm9kZSA9IG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBbIHRoaXMuYmFja2dyb3VuZE5vZGUsIHRoaXMuY2hlY2tlZE5vZGUsIHRoaXMudW5jaGVja2VkTm9kZSBdIH0gKTtcclxuXHJcbiAgICAvLyBwdXQgYSByZWN0YW5nbGUgb24gdG9wIG9mIGV2ZXJ5dGhpbmcgdG8gcHJldmVudCBkZWFkIHpvbmVzIHdoZW4gY2xpY2tpbmdcclxuICAgIGNvbnN0IHJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoIHt9ICk7XHJcblxyXG4gICAgdGhpcy5jaGlsZHJlbiA9IFtcclxuICAgICAgY2hlY2tib3hOb2RlLFxyXG4gICAgICBjb250ZW50LFxyXG4gICAgICByZWN0YW5nbGVcclxuICAgIF07XHJcblxyXG4gICAgdGhpcy5jb25zdHJhaW50ID0gbmV3IENoZWNrYm94Q29uc3RyYWludCggdGhpcywgY2hlY2tib3hOb2RlLCB0aGlzLmNoZWNrZWROb2RlLCBjb250ZW50LCByZWN0YW5nbGUsIG9wdGlvbnMgKTtcclxuICAgIHRoaXMuY29uc3RyYWludC51cGRhdGVMYXlvdXQoKTtcclxuXHJcbiAgICBjb250ZW50LnBpY2thYmxlID0gZmFsc2U7IC8vIHNpbmNlIHRoZXJlJ3MgYSBwaWNrYWJsZSByZWN0YW5nbGUgb24gdG9wIG9mIGNvbnRlbnRcclxuXHJcbiAgICAvLyBJbiBjYXNlIHRoZSBjb250ZW50IGlzIGFuIGluc3RhbmNlIG9mIGEgZm9jdXNhYmxlIE5vZGUuIENoZWNrYm94IGljb24gc2hvdWxkIG5vdCBiZSBpbiB0aGUgdHJhdmVyc2FsIG9yZGVyLlxyXG4gICAgY29udGVudC5wZG9tVmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgIC8vIGludGVyYWN0aXZpdHlcclxuICAgIGNvbnN0IGZpcmVMaXN0ZW5lciA9IG5ldyBGaXJlTGlzdGVuZXIoIHtcclxuICAgICAgZmlyZTogKCkgPT4gdG9nZ2xlQWN0aW9uLmV4ZWN1dGUoKSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdmaXJlTGlzdGVuZXInIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggZmlyZUxpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gc3luYyB3aXRoIHByb3BlcnR5XHJcbiAgICBjb25zdCBjaGVja2JveENoZWNrZWRMaXN0ZW5lciA9ICggY2hlY2tlZDogYm9vbGVhbiApID0+IHtcclxuICAgICAgdGhpcy5jaGVja2VkTm9kZS52aXNpYmxlID0gY2hlY2tlZDtcclxuICAgICAgdGhpcy51bmNoZWNrZWROb2RlLnZpc2libGUgPSAhY2hlY2tlZDtcclxuICAgICAgdGhpcy5wZG9tQ2hlY2tlZCA9IGNoZWNrZWQ7XHJcbiAgICB9O1xyXG4gICAgcHJvcGVydHkubGluayggY2hlY2tib3hDaGVja2VkTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBBcHBseSBhZGRpdGlvbmFsIG9wdGlvbnNcclxuICAgIHRoaXMubXV0YXRlKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gcGRvbSAtIHRvIHByZXZlbnQgYSBidWcgd2l0aCBOVkRBIGFuZCBGaXJlZm94IHdoZXJlIHRoZSBsYWJlbCBzaWJsaW5nIHJlY2VpdmVzIHR3byBjbGljayBldmVudHMsIHNlZVxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2dyYXZpdHktZm9yY2UtbGFiL2lzc3Vlcy8yNTdcclxuICAgIHRoaXMuc2V0RXhjbHVkZUxhYmVsU2libGluZ0Zyb21JbnB1dCgpO1xyXG5cclxuICAgIC8vIG11c3QgYmUgYWZ0ZXIgdGhlIENoZWNrYm94IGlzIGluc3RydW1lbnRlZFxyXG4gICAgb3B0aW9ucy5waGV0aW9MaW5rUHJvcGVydHkgJiYgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCBwcm9wZXJ0eSwge1xyXG4gICAgICB0YW5kZW1OYW1lOiAncHJvcGVydHknXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gc3VwcG9ydCBmb3IgYmluZGVyIGRvY3VtZW50YXRpb24sIHN0cmlwcGVkIG91dCBpbiBidWlsZHMgYW5kIG9ubHkgcnVucyB3aGVuID9iaW5kZXIgaXMgc3BlY2lmaWVkXHJcbiAgICBhc3NlcnQgJiYgcGhldD8uY2hpcHBlcj8ucXVlcnlQYXJhbWV0ZXJzPy5iaW5kZXIgJiYgSW5zdGFuY2VSZWdpc3RyeS5yZWdpc3RlckRhdGFVUkwoICdzdW4nLCAnQ2hlY2tib3gnLCB0aGlzICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlQ2hlY2tib3ggPSAoKSA9PiB7XHJcbiAgICAgIHJlY3RhbmdsZS5kaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMuYmFja2dyb3VuZE5vZGUuZGlzcG9zZSgpO1xyXG4gICAgICB0aGlzLnVuY2hlY2tlZE5vZGUuZGlzcG9zZSgpO1xyXG4gICAgICB0aGlzLmNoZWNrZWROb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgY2hlY2tib3hOb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgZmlyZUxpc3RlbmVyLmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgIGlmICggcHJvcGVydHkuaGFzTGlzdGVuZXIoIGNoZWNrYm94Q2hlY2tlZExpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgcHJvcGVydHkudW5saW5rKCBjaGVja2JveENoZWNrZWRMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBQcml2YXRlIHRvIENoZWNrYm94LCBidXQgd2UgbmVlZCB0byBjbGVhbiB1cCB0YW5kZW0uXHJcbiAgICAgIHRvZ2dsZUFjdGlvbi5kaXNwb3NlKCk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbnN0cmFpbnQuZGlzcG9zZSgpO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUNoZWNrYm94KCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBjaGVja2JveC5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0Q2hlY2tib3hDb2xvckJhY2tncm91bmQoIHZhbHVlOiBUUGFpbnQgKTogdm9pZCB7IHRoaXMuYmFja2dyb3VuZE5vZGUuZmlsbCA9IHZhbHVlOyB9XHJcblxyXG4gIHB1YmxpYyBzZXQgY2hlY2tib3hDb2xvckJhY2tncm91bmQoIHZhbHVlOiBUUGFpbnQgKSB7IHRoaXMuc2V0Q2hlY2tib3hDb2xvckJhY2tncm91bmQoIHZhbHVlICk7IH1cclxuXHJcbiAgcHVibGljIGdldCBjaGVja2JveENvbG9yQmFja2dyb3VuZCgpOiBUUGFpbnQgeyByZXR1cm4gdGhpcy5nZXRDaGVja2JveENvbG9yQmFja2dyb3VuZCgpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIGNoZWNrYm94LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRDaGVja2JveENvbG9yQmFja2dyb3VuZCgpOiBUUGFpbnQgeyByZXR1cm4gdGhpcy5iYWNrZ3JvdW5kTm9kZS5maWxsOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIGNvbG9yIG9mIHRoZSBjaGVja2JveC5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0Q2hlY2tib3hDb2xvciggdmFsdWU6IFRQYWludCApOiB2b2lkIHsgdGhpcy5jaGVja2VkTm9kZS5maWxsID0gdGhpcy51bmNoZWNrZWROb2RlLmZpbGwgPSB2YWx1ZTsgfVxyXG5cclxuICBwdWJsaWMgc2V0IGNoZWNrYm94Q29sb3IoIHZhbHVlOiBUUGFpbnQgKSB7IHRoaXMuc2V0Q2hlY2tib3hDb2xvciggdmFsdWUgKTsgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGNoZWNrYm94Q29sb3IoKTogVFBhaW50IHsgcmV0dXJuIHRoaXMuZ2V0Q2hlY2tib3hDb2xvcigpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIGNvbG9yIG9mIHRoZSBjaGVja2JveC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Q2hlY2tib3hDb2xvcigpOiBUUGFpbnQgeyByZXR1cm4gdGhpcy5jaGVja2VkTm9kZS5maWxsOyB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBzZXRNb3VzZUFyZWEoIGFyZWE6IFNoYXBlIHwgQm91bmRzMiB8IG51bGwgKTogdGhpcyB7XHJcbiAgICBpZiAoICF0aGlzLl9pc1NldHRpbmdBcmVhcyApIHtcclxuICAgICAgdGhpcy5faXNNb3VzZUFyZWFDdXN0b21pemVkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdXBlci5zZXRNb3VzZUFyZWEoIGFyZWEgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBzZXRUb3VjaEFyZWEoIGFyZWE6IFNoYXBlIHwgQm91bmRzMiB8IG51bGwgKTogdGhpcyB7XHJcbiAgICBpZiAoICF0aGlzLl9pc1NldHRpbmdBcmVhcyApIHtcclxuICAgICAgdGhpcy5faXNUb3VjaEFyZWFDdXN0b21pemVkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdXBlci5zZXRUb3VjaEFyZWEoIGFyZWEgKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIENoZWNrYm94Q29uc3RyYWludCBleHRlbmRzIExheW91dENvbnN0cmFpbnQge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY2hlY2tib3g6IENoZWNrYm94O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY2hlY2tib3hOb2RlOiBOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY2hlY2tlZE5vZGU6IE5vZGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBjb250ZW50OiBOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVjdGFuZ2xlOiBSZWN0YW5nbGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBSZXF1aXJlZDxTZWxmT3B0aW9ucz47XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggY2hlY2tib3g6IENoZWNrYm94LCBjaGVja2JveE5vZGU6IE5vZGUsIGNoZWNrZWROb2RlOiBOb2RlLCBjb250ZW50OiBOb2RlLCByZWN0YW5nbGU6IFJlY3RhbmdsZSwgb3B0aW9uczogUmVxdWlyZWQ8U2VsZk9wdGlvbnM+ICkge1xyXG4gICAgc3VwZXIoIGNoZWNrYm94ICk7XHJcblxyXG4gICAgdGhpcy5jaGVja2JveCA9IGNoZWNrYm94O1xyXG4gICAgdGhpcy5jaGVja2JveE5vZGUgPSBjaGVja2JveE5vZGU7XHJcbiAgICB0aGlzLmNoZWNrZWROb2RlID0gY2hlY2tlZE5vZGU7XHJcbiAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50O1xyXG4gICAgdGhpcy5yZWN0YW5nbGUgPSByZWN0YW5nbGU7XHJcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xyXG5cclxuICAgIHRoaXMuY2hlY2tib3gubG9jYWxQcmVmZXJyZWRXaWR0aFByb3BlcnR5LmxhenlMaW5rKCB0aGlzLl91cGRhdGVMYXlvdXRMaXN0ZW5lciApO1xyXG5cclxuICAgIHRoaXMuYWRkTm9kZSggY29udGVudCApO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGxheW91dCgpOiB2b2lkIHtcclxuICAgIHN1cGVyLmxheW91dCgpO1xyXG5cclxuICAgIC8vIExheW91dFByb3h5IGhlbHBzIHdpdGggc29tZSBsYXlvdXQgb3BlcmF0aW9ucywgYW5kIHdpbGwgc3VwcG9ydCBhIG5vbi1jaGlsZCBjb250ZW50LlxyXG4gICAgY29uc3QgY29udGVudFByb3h5ID0gdGhpcy5jcmVhdGVMYXlvdXRQcm94eSggdGhpcy5jb250ZW50ICkhO1xyXG5cclxuICAgIGNvbnN0IGNvbnRlbnRXaWR0aCA9IGNvbnRlbnRQcm94eS5taW5pbXVtV2lkdGg7XHJcblxyXG4gICAgLy8gT3VyIGJvdW5kcyBhcmUgYmFzZWQgb24gY2hlY2tib3hOb2RlLCBidXQgb3VyIGxheW91dCBpcyByZWxhdGl2ZSB0byBjaGVja2VkTm9kZVxyXG4gICAgY29uc3QgY2hlY2tib3hXaXRob3V0U3BhY2luZ1dpZHRoID0gKCB0aGlzLmNoZWNrZWROb2RlLnJpZ2h0IC0gdGhpcy5jaGVja2JveE5vZGUubGVmdCApO1xyXG4gICAgY29uc3QgbWluaW11bVdpZHRoID0gY2hlY2tib3hXaXRob3V0U3BhY2luZ1dpZHRoICsgdGhpcy5vcHRpb25zLnNwYWNpbmcgKyBjb250ZW50V2lkdGg7XHJcblxyXG4gICAgY29uc3QgcHJlZmVycmVkV2lkdGggPSBNYXRoLm1heCggbWluaW11bVdpZHRoLCB0aGlzLmNoZWNrYm94LmxvY2FsUHJlZmVycmVkV2lkdGggfHwgMCApO1xyXG5cclxuICAgIC8vIEF0dGVtcHQgdG8gc2V0IGEgcHJlZmVycmVkV2lkdGhcclxuICAgIGlmICggaXNXaWR0aFNpemFibGUoIHRoaXMuY29udGVudCApICYmIHRoaXMuY2hlY2tib3gubG9jYWxQcmVmZXJyZWRXaWR0aCAhPT0gbnVsbCApIHtcclxuICAgICAgY29udGVudFByb3h5LnByZWZlcnJlZFdpZHRoID0gcHJlZmVycmVkV2lkdGggLSBjaGVja2JveFdpdGhvdXRTcGFjaW5nV2lkdGggLSB0aGlzLm9wdGlvbnMuc3BhY2luZztcclxuICAgIH1cclxuXHJcbiAgICAvLyBGb3Igbm93IGp1c3QgcG9zaXRpb24gY29udGVudC4gRnV0dXJlIHVwZGF0ZXMgY291bGQgaW5jbHVkZSB3aWR0aFJlc2l6YWJsZSBjb250ZW50P1xyXG4gICAgY29udGVudFByb3h5LmxlZnQgPSB0aGlzLmNoZWNrZWROb2RlLnJpZ2h0ICsgdGhpcy5vcHRpb25zLnNwYWNpbmc7XHJcbiAgICBjb250ZW50UHJveHkuY2VudGVyWSA9IHRoaXMuY2hlY2tlZE5vZGUuY2VudGVyWTtcclxuXHJcbiAgICAvLyBPdXIgcmVjdGFuZ2xlIGJvdW5kcyB3aWxsIGNvdmVyIHRoZSBjaGVja2JveE5vZGUgYW5kIGNvbnRlbnQsIGFuZCBpZiBuZWNlc3NhcnkgZXhwYW5kIHRvIGluY2x1ZGUgdGhlIGZ1bGxcclxuICAgIC8vIHByZWZlcnJlZFdpZHRoXHJcbiAgICB0aGlzLnJlY3RhbmdsZS5yZWN0Qm91bmRzID0gdGhpcy5jaGVja2JveE5vZGUuYm91bmRzLnVuaW9uKCBjb250ZW50UHJveHkuYm91bmRzICkud2l0aE1heFgoXHJcbiAgICAgIE1hdGgubWF4KCB0aGlzLmNoZWNrYm94Tm9kZS5sZWZ0ICsgcHJlZmVycmVkV2lkdGgsIGNvbnRlbnRQcm94eS5yaWdodCApXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSBwb2ludGVyIGFyZWFzIChpZiB0aGUgY2xpZW50IGhhc24ndCBjdXN0b21pemVkIHRoZW0pXHJcbiAgICB0aGlzLmNoZWNrYm94Ll9pc1NldHRpbmdBcmVhcyA9IHRydWU7XHJcbiAgICBpZiAoICF0aGlzLmNoZWNrYm94Ll9pc1RvdWNoQXJlYUN1c3RvbWl6ZWQgKSB7XHJcbiAgICAgIHRoaXMuY2hlY2tib3gudG91Y2hBcmVhID0gdGhpcy5jaGVja2JveC5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIHRoaXMub3B0aW9ucy50b3VjaEFyZWFYRGlsYXRpb24sIHRoaXMub3B0aW9ucy50b3VjaEFyZWFZRGlsYXRpb24gKTtcclxuICAgIH1cclxuICAgIGlmICggIXRoaXMuY2hlY2tib3guX2lzTW91c2VBcmVhQ3VzdG9taXplZCApIHtcclxuICAgICAgdGhpcy5jaGVja2JveC5tb3VzZUFyZWEgPSB0aGlzLmNoZWNrYm94LmxvY2FsQm91bmRzLmRpbGF0ZWRYWSggdGhpcy5vcHRpb25zLm1vdXNlQXJlYVhEaWxhdGlvbiwgdGhpcy5vcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvbiApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jaGVja2JveC5faXNTZXR0aW5nQXJlYXMgPSBmYWxzZTtcclxuXHJcbiAgICBjb250ZW50UHJveHkuZGlzcG9zZSgpO1xyXG5cclxuICAgIC8vIFNldCB0aGUgbWluaW11bVdpZHRoIGxhc3QsIHNpbmNlIHRoaXMgbWF5IHRyaWdnZXIgYSByZWxheW91dFxyXG4gICAgdGhpcy5jaGVja2JveC5sb2NhbE1pbmltdW1XaWR0aCA9IG1pbmltdW1XaWR0aDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jaGVja2JveC5sb2NhbFByZWZlcnJlZFdpZHRoUHJvcGVydHkudW5saW5rKCB0aGlzLl91cGRhdGVMYXlvdXRMaXN0ZW5lciApO1xyXG5cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnN1bi5yZWdpc3RlciggJ0NoZWNrYm94JywgQ2hlY2tib3ggKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsWUFBWSxNQUFNLGlDQUFpQztBQUMxRCxPQUFPQyxRQUFRLE1BQU0sMkJBQTJCO0FBQ2hELFNBQVNDLEVBQUUsUUFBUSx5QkFBeUI7QUFDNUMsT0FBT0MsZ0JBQWdCLE1BQU0sc0RBQXNEO0FBQ25GLFNBQVNDLFlBQVksRUFBRUMsY0FBYyxFQUFFQyxnQkFBZ0IsRUFBRUMsSUFBSSxFQUFlQyxJQUFJLEVBQUVDLFNBQVMsRUFBRUMsZ0JBQWdCLEVBQVVDLE9BQU8sRUFBa0JDLFlBQVksUUFBNkIsNkJBQTZCO0FBQ3ROLE9BQU9DLG9CQUFvQixNQUFNLHVEQUF1RDtBQUN4RixPQUFPQyxzQkFBc0IsTUFBTSx5REFBeUQ7QUFDNUYsT0FBT0MsMEJBQTBCLE1BQU0sbUVBQW1FO0FBQzFHLE9BQU9DLDRCQUE0QixNQUFNLHFFQUFxRTtBQUM5RyxPQUFPQyxTQUFTLE1BQU0sOEJBQThCO0FBQ3BELE9BQU9DLFlBQVks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