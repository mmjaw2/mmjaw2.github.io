// Copyright 2023-2024, University of Colorado Boulder

/* eslint-env node */

/**
 * Preprocesses a WGSL string into a conditional form, with minification
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

const _ = require('lodash');
const path = require('path');
const importString = '#import ';
const bindingsString = '#bindings';
const ifdefString = '#ifdef ';
const ifndefString = '#ifndef ';
const elseString = '#else';
const endifString = '#endif';
const optionString = '#option ';
const importStringToName = str => {
  const bits = str.split('/');
  return bits[bits.length - 1];
};
const importStringToImportName = str => {
  const bits = str.split('/');
  return `i_${bits[bits.length - 1]}`;
};
class Code {
  constructor(isRoot = false) {
    this.beforeBindings = [];
    this.afterBindings = [];
    this.imports = [];
    if (isRoot) {
      this.isRoot = true;
      this.allImports = [];
      this.options = [];
    }
  }

  // @public
  hasConditionalsOrTemplates() {
    return this.beforeBindings.length > 1 || this.afterBindings.length > 1 || this.beforeBindings.length === 1 && (typeof this.beforeBindings[0] !== 'string' || this.beforeBindings[0].includes('${')) || this.afterBindings.length === 1 && (typeof this.afterBindings[0] !== 'string' || this.afterBindings[0].includes('${'));
  }

  // @public
  isEmpty() {
    return this.beforeBindings.length === 0 && this.afterBindings.length === 0 && this.imports.length === 0;
  }

  // @public
  finalize(minify) {
    for (let i = 0; i < this.beforeBindings.length; i++) {
      const item = this.beforeBindings[i];
      if (typeof item === 'string') {
        this.beforeBindings[i] = minify(item);
      }
    }
    for (let i = 0; i < this.afterBindings.length; i++) {
      const item = this.afterBindings[i];
      if (typeof item === 'string') {
        this.afterBindings[i] = minify(item);
      }
    }
  }

  // @public
  toString(indent, pathToRoot, moduleName, repoName) {
    let result = '';
    if (this.isRoot) {
      result += `// Copyright ${new Date().getFullYear()}, University of Colorado Boulder\n\n`;
      result += `import { u32, i32, f32, u32Hex, i32Hex, ConsoleLogger, ConsoleLoggedLine, ByteEncoder, U32Type, I32Type, Vec2uType, Vec3uType, Vec4uType, getArrayType, U32Order } from '${pathToRoot}alpenglow/js/imports.js'\n`;
      result += `import { ${repoName} } from '${pathToRoot}${repoName}/js/imports.js'\n`;
      const imports = _.uniq(this.allImports).sort();
      imports.forEach(importString => {
        result += `import ${importStringToImportName(importString)} from '${importString}.js';\n`;
      });
      result += '\n';
      result += `const ${moduleName} = ${this.hasConditionalsOrTemplates() ? 'options' : '()'} => `;
    }
    const run = (item, before) => {
      if (typeof item === 'string') {
        result += `${indent}${before ? 'b' : 'a'} += \`${item}\`;\n`;
      } else {
        // a Conditional
        result += item.toString(indent, pathToRoot, moduleName, repoName);
      }
    };
    if (this.isRoot) {
      if (!this.hasConditionalsOrTemplates()) {
        result += '( {\n';
        result += `${indent}before: \`${this.beforeBindings.join('\n')}\`,\n`;
        result += `${indent}after: \`${this.afterBindings.join('\n')}\`,\n`;
        result += `${indent}imports: [ ${this.imports.map(importStringToImportName).join(', ')} ]\n`;
        result += '} )';
      } else {
        result += '{\n';
        result += '  let result = {};\n'; // Might be replaced with a template function!!!
        result += '  const template = f => { result = f; return \'\'; };\n';
        _.uniq(this.allImports).sort().forEach(importString => {
          result += `  const ${importStringToName(importString)} = ${importStringToImportName(importString)}( options );\n`;
        });
        const options = _.uniq(this.options).sort();
        options.forEach(option => {
          result += `  assert && assert( options.${option} !== undefined );\n`;
          result += `  const ${option} = options.${option};\n`;
        });
        result += '  let b = \'\';\n';
        result += '  let a = \'\';\n';
        result += `  const i = [ ${this.imports.map(importStringToImportName).join(', ')} ];\n`;
        this.beforeBindings.forEach(item => run(item, true));
        this.afterBindings.forEach(item => run(item, false));
        result += '  result.before = b;\n';
        result += '  result.after = a;\n';
        result += '  result.imports = _.uniq( i ).sort();\n';
        result += '  return result;\n';
        result += '}';
      }
      result += ';\n';
      result += `export default ${moduleName};\n`;
      result += `${repoName}.register( '${moduleName}', ${moduleName} );\n`;
    } else {
      if (this.imports.length) {
        result += `${indent}i.push( ${this.imports.map(importStringToImportName).join(', ')} );\n`;
      }
      this.beforeBindings.forEach(item => run(item, true));
      this.afterBindings.forEach(item => run(item, false));
    }
    return result;
  }
}
class Conditional {
  constructor(name) {
    this.name = name.trim();
    this.included = new Code();
    this.excluded = new Code();
    if (this.name.includes(' ')) {
      throw new Error('conditionals should not include spaces');
    }
  }

  // @public
  toString(indent, pathToRoot, moduleName, repoName) {
    let result = '';
    if (this.included.isEmpty() && this.excluded.isEmpty()) {
      return result;
    }
    if (this.included.isEmpty()) {
      result += `${indent}if ( !options[ ${JSON.stringify(this.name)} ] ) {\n`;
      result += this.excluded.toString(indent + '  ', pathToRoot, moduleName, repoName);
      result += `${indent}}\n`;
    } else {
      result += `${indent}if ( options[ ${JSON.stringify(this.name)} ] ) {\n`;
      result += this.included.toString(indent + '  ', pathToRoot, moduleName, repoName);
      result += `${indent}}\n`;
      if (!this.excluded.isEmpty()) {
        result += `${indent}else {\n`;
        result += this.excluded.toString(indent + '  ', pathToRoot, moduleName, repoName);
        result += `${indent}}\n`;
      }
    }
    return result;
  }
}
const wgslPreprocess = (str, minify, pathToRoot, targetPath) => {
  // sanity check
  str = str.replace(/\r\n/g, '\n');
  const repoName = path.basename(path.resolve(targetPath, pathToRoot));
  const moduleName = `wgsl_${path.basename(targetPath).split('.')[0]}`;
  const lines = str.split('\n');
  const rootCode = new Code(true);
  const conditionalStack = [];
  const stack = [rootCode];
  let afterBindings = false;
  lines.forEach(line => {
    const topNode = stack[stack.length - 1];
    const array = afterBindings ? topNode.afterBindings : topNode.beforeBindings;
    if (line.startsWith(importString)) {
      const importName = line.substring(importString.length);
      topNode.imports.push(importName);
      rootCode.allImports.push(importName);
    } else if (line.startsWith(optionString)) {
      const optionName = line.substring(optionString.length);
      rootCode.options.push(optionName);
    } else if (line.startsWith(bindingsString)) {
      afterBindings = true;
    } else if (line.startsWith(ifdefString)) {
      const conditional = new Conditional(line.substring(ifdefString.length));
      array.push(conditional);
      conditionalStack.push(conditional);
      stack.push(conditional.included);
    } else if (line.startsWith(ifndefString)) {
      const conditional = new Conditional(line.substring(ifndefString.length));
      array.push(conditional);
      conditionalStack.push(conditional);
      stack.push(conditional.excluded);
    } else if (line.startsWith(elseString)) {
      if (conditionalStack.length === 0) {
        throw new Error('unmatched else');
      }
      const conditional = conditionalStack[conditionalStack.length - 1];
      const oldCode = stack.pop();
      oldCode.finalize(minify);
      stack.push(oldCode === conditional.excluded ? conditional.included : conditional.excluded);
    } else if (line.startsWith(endifString)) {
      if (conditionalStack.length === 0) {
        throw new Error('unmatched endif');
      }
      conditionalStack.pop();
      stack.pop().finalize(minify);
    } else {
      if (array.length && typeof array[array.length - 1] === 'string') {
        array[array.length - 1] += '\n' + line;
      } else {
        array.push(line);
      }
    }
  });
  rootCode.finalize(minify);
  if (conditionalStack.length > 0) {
    throw new Error('unterminated conditional');
  }
  return rootCode.toString('  ', pathToRoot, moduleName, repoName);
};
module.exports = wgslPreprocess;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfIiwicmVxdWlyZSIsInBhdGgiLCJpbXBvcnRTdHJpbmciLCJiaW5kaW5nc1N0cmluZyIsImlmZGVmU3RyaW5nIiwiaWZuZGVmU3RyaW5nIiwiZWxzZVN0cmluZyIsImVuZGlmU3RyaW5nIiwib3B0aW9uU3RyaW5nIiwiaW1wb3J0U3RyaW5nVG9OYW1lIiwic3RyIiwiYml0cyIsInNwbGl0IiwibGVuZ3RoIiwiaW1wb3J0U3RyaW5nVG9JbXBvcnROYW1lIiwiQ29kZSIsImNvbnN0cnVjdG9yIiwiaXNSb290IiwiYmVmb3JlQmluZGluZ3MiLCJhZnRlckJpbmRpbmdzIiwiaW1wb3J0cyIsImFsbEltcG9ydHMiLCJvcHRpb25zIiwiaGFzQ29uZGl0aW9uYWxzT3JUZW1wbGF0ZXMiLCJpbmNsdWRlcyIsImlzRW1wdHkiLCJmaW5hbGl6ZSIsIm1pbmlmeSIsImkiLCJpdGVtIiwidG9TdHJpbmciLCJpbmRlbnQiLCJwYXRoVG9Sb290IiwibW9kdWxlTmFtZSIsInJlcG9OYW1lIiwicmVzdWx0IiwiRGF0ZSIsImdldEZ1bGxZZWFyIiwidW5pcSIsInNvcnQiLCJmb3JFYWNoIiwicnVuIiwiYmVmb3JlIiwiam9pbiIsIm1hcCIsIm9wdGlvbiIsIkNvbmRpdGlvbmFsIiwibmFtZSIsInRyaW0iLCJpbmNsdWRlZCIsImV4Y2x1ZGVkIiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5Iiwid2dzbFByZXByb2Nlc3MiLCJ0YXJnZXRQYXRoIiwicmVwbGFjZSIsImJhc2VuYW1lIiwicmVzb2x2ZSIsImxpbmVzIiwicm9vdENvZGUiLCJjb25kaXRpb25hbFN0YWNrIiwic3RhY2siLCJsaW5lIiwidG9wTm9kZSIsImFycmF5Iiwic3RhcnRzV2l0aCIsImltcG9ydE5hbWUiLCJzdWJzdHJpbmciLCJwdXNoIiwib3B0aW9uTmFtZSIsImNvbmRpdGlvbmFsIiwib2xkQ29kZSIsInBvcCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJ3Z3NsUHJlcHJvY2Vzcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMy0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qIGVzbGludC1lbnYgbm9kZSAqL1xyXG5cclxuLyoqXHJcbiAqIFByZXByb2Nlc3NlcyBhIFdHU0wgc3RyaW5nIGludG8gYSBjb25kaXRpb25hbCBmb3JtLCB3aXRoIG1pbmlmaWNhdGlvblxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XHJcbiAqL1xyXG5cclxuY29uc3QgXyA9IHJlcXVpcmUoICdsb2Rhc2gnICk7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCAncGF0aCcgKTtcclxuXHJcbmNvbnN0IGltcG9ydFN0cmluZyA9ICcjaW1wb3J0ICc7XHJcbmNvbnN0IGJpbmRpbmdzU3RyaW5nID0gJyNiaW5kaW5ncyc7XHJcbmNvbnN0IGlmZGVmU3RyaW5nID0gJyNpZmRlZiAnO1xyXG5jb25zdCBpZm5kZWZTdHJpbmcgPSAnI2lmbmRlZiAnO1xyXG5jb25zdCBlbHNlU3RyaW5nID0gJyNlbHNlJztcclxuY29uc3QgZW5kaWZTdHJpbmcgPSAnI2VuZGlmJztcclxuY29uc3Qgb3B0aW9uU3RyaW5nID0gJyNvcHRpb24gJztcclxuXHJcbmNvbnN0IGltcG9ydFN0cmluZ1RvTmFtZSA9IHN0ciA9PiB7XHJcbiAgY29uc3QgYml0cyA9IHN0ci5zcGxpdCggJy8nICk7XHJcbiAgcmV0dXJuIGJpdHNbIGJpdHMubGVuZ3RoIC0gMSBdO1xyXG59O1xyXG5cclxuY29uc3QgaW1wb3J0U3RyaW5nVG9JbXBvcnROYW1lID0gc3RyID0+IHtcclxuICBjb25zdCBiaXRzID0gc3RyLnNwbGl0KCAnLycgKTtcclxuICByZXR1cm4gYGlfJHtiaXRzWyBiaXRzLmxlbmd0aCAtIDEgXX1gO1xyXG59O1xyXG5cclxuY2xhc3MgQ29kZSB7XHJcbiAgY29uc3RydWN0b3IoIGlzUm9vdCA9IGZhbHNlICkge1xyXG4gICAgdGhpcy5iZWZvcmVCaW5kaW5ncyA9IFtdO1xyXG4gICAgdGhpcy5hZnRlckJpbmRpbmdzID0gW107XHJcbiAgICB0aGlzLmltcG9ydHMgPSBbXTtcclxuXHJcbiAgICBpZiAoIGlzUm9vdCApIHtcclxuICAgICAgdGhpcy5pc1Jvb3QgPSB0cnVlO1xyXG4gICAgICB0aGlzLmFsbEltcG9ydHMgPSBbXTtcclxuICAgICAgdGhpcy5vcHRpb25zID0gW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgaGFzQ29uZGl0aW9uYWxzT3JUZW1wbGF0ZXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5iZWZvcmVCaW5kaW5ncy5sZW5ndGggPiAxIHx8IHRoaXMuYWZ0ZXJCaW5kaW5ncy5sZW5ndGggPiAxIHx8XHJcbiAgICAgICggdGhpcy5iZWZvcmVCaW5kaW5ncy5sZW5ndGggPT09IDEgJiYgKCB0eXBlb2YgdGhpcy5iZWZvcmVCaW5kaW5nc1sgMCBdICE9PSAnc3RyaW5nJyB8fCB0aGlzLmJlZm9yZUJpbmRpbmdzWyAwIF0uaW5jbHVkZXMoICckeycgKSApICkgfHxcclxuICAgICAgKCB0aGlzLmFmdGVyQmluZGluZ3MubGVuZ3RoID09PSAxICYmICggdHlwZW9mIHRoaXMuYWZ0ZXJCaW5kaW5nc1sgMCBdICE9PSAnc3RyaW5nJyB8fCB0aGlzLmFmdGVyQmluZGluZ3NbIDAgXS5pbmNsdWRlcyggJyR7JyApICkgKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBpc0VtcHR5KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuYmVmb3JlQmluZGluZ3MubGVuZ3RoID09PSAwICYmIHRoaXMuYWZ0ZXJCaW5kaW5ncy5sZW5ndGggPT09IDAgJiYgdGhpcy5pbXBvcnRzLmxlbmd0aCA9PT0gMDtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBmaW5hbGl6ZSggbWluaWZ5ICkge1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5iZWZvcmVCaW5kaW5ncy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgaXRlbSA9IHRoaXMuYmVmb3JlQmluZGluZ3NbIGkgXTtcclxuICAgICAgaWYgKCB0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycgKSB7XHJcbiAgICAgICAgdGhpcy5iZWZvcmVCaW5kaW5nc1sgaSBdID0gbWluaWZ5KCBpdGVtICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuYWZ0ZXJCaW5kaW5ncy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgaXRlbSA9IHRoaXMuYWZ0ZXJCaW5kaW5nc1sgaSBdO1xyXG4gICAgICBpZiAoIHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyApIHtcclxuICAgICAgICB0aGlzLmFmdGVyQmluZGluZ3NbIGkgXSA9IG1pbmlmeSggaXRlbSApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgdG9TdHJpbmcoIGluZGVudCwgcGF0aFRvUm9vdCwgbW9kdWxlTmFtZSwgcmVwb05hbWUgKSB7XHJcbiAgICBsZXQgcmVzdWx0ID0gJyc7XHJcblxyXG4gICAgaWYgKCB0aGlzLmlzUm9vdCApIHtcclxuICAgICAgcmVzdWx0ICs9IGAvLyBDb3B5cmlnaHQgJHtuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCl9LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcXG5cXG5gO1xyXG5cclxuICAgICAgcmVzdWx0ICs9IGBpbXBvcnQgeyB1MzIsIGkzMiwgZjMyLCB1MzJIZXgsIGkzMkhleCwgQ29uc29sZUxvZ2dlciwgQ29uc29sZUxvZ2dlZExpbmUsIEJ5dGVFbmNvZGVyLCBVMzJUeXBlLCBJMzJUeXBlLCBWZWMydVR5cGUsIFZlYzN1VHlwZSwgVmVjNHVUeXBlLCBnZXRBcnJheVR5cGUsIFUzMk9yZGVyIH0gZnJvbSAnJHtwYXRoVG9Sb290fWFscGVuZ2xvdy9qcy9pbXBvcnRzLmpzJ1xcbmA7XHJcbiAgICAgIHJlc3VsdCArPSBgaW1wb3J0IHsgJHtyZXBvTmFtZX0gfSBmcm9tICcke3BhdGhUb1Jvb3R9JHtyZXBvTmFtZX0vanMvaW1wb3J0cy5qcydcXG5gO1xyXG4gICAgICBjb25zdCBpbXBvcnRzID0gXy51bmlxKCB0aGlzLmFsbEltcG9ydHMgKS5zb3J0KCk7XHJcbiAgICAgIGltcG9ydHMuZm9yRWFjaCggaW1wb3J0U3RyaW5nID0+IHtcclxuICAgICAgICByZXN1bHQgKz0gYGltcG9ydCAke2ltcG9ydFN0cmluZ1RvSW1wb3J0TmFtZSggaW1wb3J0U3RyaW5nICl9IGZyb20gJyR7aW1wb3J0U3RyaW5nfS5qcyc7XFxuYDtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgcmVzdWx0ICs9ICdcXG4nO1xyXG4gICAgICByZXN1bHQgKz0gYGNvbnN0ICR7bW9kdWxlTmFtZX0gPSAke3RoaXMuaGFzQ29uZGl0aW9uYWxzT3JUZW1wbGF0ZXMoKSA/ICdvcHRpb25zJyA6ICcoKSd9ID0+IGA7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcnVuID0gKCBpdGVtLCBiZWZvcmUgKSA9PiB7XHJcbiAgICAgIGlmICggdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnICkge1xyXG4gICAgICAgIHJlc3VsdCArPSBgJHtpbmRlbnR9JHtiZWZvcmUgPyAnYicgOiAnYSd9ICs9IFxcYCR7aXRlbX1cXGA7XFxuYDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyBhIENvbmRpdGlvbmFsXHJcbiAgICAgICAgcmVzdWx0ICs9IGl0ZW0udG9TdHJpbmcoIGluZGVudCwgcGF0aFRvUm9vdCwgbW9kdWxlTmFtZSwgcmVwb05hbWUgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoIHRoaXMuaXNSb290ICkge1xyXG4gICAgICBpZiAoICF0aGlzLmhhc0NvbmRpdGlvbmFsc09yVGVtcGxhdGVzKCkgKSB7XHJcbiAgICAgICAgcmVzdWx0ICs9ICcoIHtcXG4nO1xyXG4gICAgICAgIHJlc3VsdCArPSBgJHtpbmRlbnR9YmVmb3JlOiBcXGAke3RoaXMuYmVmb3JlQmluZGluZ3Muam9pbiggJ1xcbicgKX1cXGAsXFxuYDtcclxuICAgICAgICByZXN1bHQgKz0gYCR7aW5kZW50fWFmdGVyOiBcXGAke3RoaXMuYWZ0ZXJCaW5kaW5ncy5qb2luKCAnXFxuJyApfVxcYCxcXG5gO1xyXG4gICAgICAgIHJlc3VsdCArPSBgJHtpbmRlbnR9aW1wb3J0czogWyAke3RoaXMuaW1wb3J0cy5tYXAoIGltcG9ydFN0cmluZ1RvSW1wb3J0TmFtZSApLmpvaW4oICcsICcgKX0gXVxcbmA7XHJcbiAgICAgICAgcmVzdWx0ICs9ICd9ICknO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJlc3VsdCArPSAne1xcbic7XHJcbiAgICAgICAgcmVzdWx0ICs9ICcgIGxldCByZXN1bHQgPSB7fTtcXG4nOyAvLyBNaWdodCBiZSByZXBsYWNlZCB3aXRoIGEgdGVtcGxhdGUgZnVuY3Rpb24hISFcclxuICAgICAgICByZXN1bHQgKz0gJyAgY29uc3QgdGVtcGxhdGUgPSBmID0+IHsgcmVzdWx0ID0gZjsgcmV0dXJuIFxcJ1xcJzsgfTtcXG4nO1xyXG5cclxuICAgICAgICBfLnVuaXEoIHRoaXMuYWxsSW1wb3J0cyApLnNvcnQoKS5mb3JFYWNoKCBpbXBvcnRTdHJpbmcgPT4ge1xyXG4gICAgICAgICAgcmVzdWx0ICs9IGAgIGNvbnN0ICR7aW1wb3J0U3RyaW5nVG9OYW1lKCBpbXBvcnRTdHJpbmcgKX0gPSAke2ltcG9ydFN0cmluZ1RvSW1wb3J0TmFtZSggaW1wb3J0U3RyaW5nICl9KCBvcHRpb25zICk7XFxuYDtcclxuICAgICAgICB9ICk7XHJcblxyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBfLnVuaXEoIHRoaXMub3B0aW9ucyApLnNvcnQoKTtcclxuICAgICAgICBvcHRpb25zLmZvckVhY2goIG9wdGlvbiA9PiB7XHJcbiAgICAgICAgICByZXN1bHQgKz0gYCAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy4ke29wdGlvbn0gIT09IHVuZGVmaW5lZCApO1xcbmA7XHJcbiAgICAgICAgICByZXN1bHQgKz0gYCAgY29uc3QgJHtvcHRpb259ID0gb3B0aW9ucy4ke29wdGlvbn07XFxuYDtcclxuICAgICAgICB9ICk7XHJcblxyXG4gICAgICAgIHJlc3VsdCArPSAnICBsZXQgYiA9IFxcJ1xcJztcXG4nO1xyXG4gICAgICAgIHJlc3VsdCArPSAnICBsZXQgYSA9IFxcJ1xcJztcXG4nO1xyXG4gICAgICAgIHJlc3VsdCArPSBgICBjb25zdCBpID0gWyAke3RoaXMuaW1wb3J0cy5tYXAoIGltcG9ydFN0cmluZ1RvSW1wb3J0TmFtZSApLmpvaW4oICcsICcgKX0gXTtcXG5gO1xyXG5cclxuICAgICAgICB0aGlzLmJlZm9yZUJpbmRpbmdzLmZvckVhY2goIGl0ZW0gPT4gcnVuKCBpdGVtLCB0cnVlICkgKTtcclxuICAgICAgICB0aGlzLmFmdGVyQmluZGluZ3MuZm9yRWFjaCggaXRlbSA9PiBydW4oIGl0ZW0sIGZhbHNlICkgKTtcclxuXHJcbiAgICAgICAgcmVzdWx0ICs9ICcgIHJlc3VsdC5iZWZvcmUgPSBiO1xcbic7XHJcbiAgICAgICAgcmVzdWx0ICs9ICcgIHJlc3VsdC5hZnRlciA9IGE7XFxuJztcclxuICAgICAgICByZXN1bHQgKz0gJyAgcmVzdWx0LmltcG9ydHMgPSBfLnVuaXEoIGkgKS5zb3J0KCk7XFxuJztcclxuICAgICAgICByZXN1bHQgKz0gJyAgcmV0dXJuIHJlc3VsdDtcXG4nO1xyXG4gICAgICAgIHJlc3VsdCArPSAnfSc7XHJcbiAgICAgIH1cclxuICAgICAgcmVzdWx0ICs9ICc7XFxuJztcclxuXHJcbiAgICAgIHJlc3VsdCArPSBgZXhwb3J0IGRlZmF1bHQgJHttb2R1bGVOYW1lfTtcXG5gO1xyXG4gICAgICByZXN1bHQgKz0gYCR7cmVwb05hbWV9LnJlZ2lzdGVyKCAnJHttb2R1bGVOYW1lfScsICR7bW9kdWxlTmFtZX0gKTtcXG5gO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGlmICggdGhpcy5pbXBvcnRzLmxlbmd0aCApIHtcclxuICAgICAgICByZXN1bHQgKz0gYCR7aW5kZW50fWkucHVzaCggJHt0aGlzLmltcG9ydHMubWFwKCBpbXBvcnRTdHJpbmdUb0ltcG9ydE5hbWUgKS5qb2luKCAnLCAnICl9ICk7XFxuYDtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmJlZm9yZUJpbmRpbmdzLmZvckVhY2goIGl0ZW0gPT4gcnVuKCBpdGVtLCB0cnVlICkgKTtcclxuICAgICAgdGhpcy5hZnRlckJpbmRpbmdzLmZvckVhY2goIGl0ZW0gPT4gcnVuKCBpdGVtLCBmYWxzZSApICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIENvbmRpdGlvbmFsIHtcclxuICBjb25zdHJ1Y3RvciggbmFtZSApIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWUudHJpbSgpO1xyXG4gICAgdGhpcy5pbmNsdWRlZCA9IG5ldyBDb2RlKCk7XHJcbiAgICB0aGlzLmV4Y2x1ZGVkID0gbmV3IENvZGUoKTtcclxuXHJcbiAgICBpZiAoIHRoaXMubmFtZS5pbmNsdWRlcyggJyAnICkgKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvciggJ2NvbmRpdGlvbmFscyBzaG91bGQgbm90IGluY2x1ZGUgc3BhY2VzJyApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIHRvU3RyaW5nKCBpbmRlbnQsIHBhdGhUb1Jvb3QsIG1vZHVsZU5hbWUsIHJlcG9OYW1lICkge1xyXG4gICAgbGV0IHJlc3VsdCA9ICcnO1xyXG5cclxuICAgIGlmICggdGhpcy5pbmNsdWRlZC5pc0VtcHR5KCkgJiYgdGhpcy5leGNsdWRlZC5pc0VtcHR5KCkgKSB7XHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCB0aGlzLmluY2x1ZGVkLmlzRW1wdHkoKSApIHtcclxuICAgICAgcmVzdWx0ICs9IGAke2luZGVudH1pZiAoICFvcHRpb25zWyAke0pTT04uc3RyaW5naWZ5KCB0aGlzLm5hbWUgKX0gXSApIHtcXG5gO1xyXG4gICAgICByZXN1bHQgKz0gdGhpcy5leGNsdWRlZC50b1N0cmluZyggaW5kZW50ICsgJyAgJywgcGF0aFRvUm9vdCwgbW9kdWxlTmFtZSwgcmVwb05hbWUgKTtcclxuICAgICAgcmVzdWx0ICs9IGAke2luZGVudH19XFxuYDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXN1bHQgKz0gYCR7aW5kZW50fWlmICggb3B0aW9uc1sgJHtKU09OLnN0cmluZ2lmeSggdGhpcy5uYW1lICl9IF0gKSB7XFxuYDtcclxuICAgICAgcmVzdWx0ICs9IHRoaXMuaW5jbHVkZWQudG9TdHJpbmcoIGluZGVudCArICcgICcsIHBhdGhUb1Jvb3QsIG1vZHVsZU5hbWUsIHJlcG9OYW1lICk7XHJcbiAgICAgIHJlc3VsdCArPSBgJHtpbmRlbnR9fVxcbmA7XHJcbiAgICAgIGlmICggIXRoaXMuZXhjbHVkZWQuaXNFbXB0eSgpICkge1xyXG4gICAgICAgIHJlc3VsdCArPSBgJHtpbmRlbnR9ZWxzZSB7XFxuYDtcclxuICAgICAgICByZXN1bHQgKz0gdGhpcy5leGNsdWRlZC50b1N0cmluZyggaW5kZW50ICsgJyAgJywgcGF0aFRvUm9vdCwgbW9kdWxlTmFtZSwgcmVwb05hbWUgKTtcclxuICAgICAgICByZXN1bHQgKz0gYCR7aW5kZW50fX1cXG5gO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHdnc2xQcmVwcm9jZXNzID0gKCBzdHIsIG1pbmlmeSwgcGF0aFRvUm9vdCwgdGFyZ2V0UGF0aCApID0+IHtcclxuXHJcbiAgLy8gc2FuaXR5IGNoZWNrXHJcbiAgc3RyID0gc3RyLnJlcGxhY2UoIC9cXHJcXG4vZywgJ1xcbicgKTtcclxuXHJcbiAgY29uc3QgcmVwb05hbWUgPSBwYXRoLmJhc2VuYW1lKCBwYXRoLnJlc29sdmUoIHRhcmdldFBhdGgsIHBhdGhUb1Jvb3QgKSApO1xyXG4gIGNvbnN0IG1vZHVsZU5hbWUgPSBgd2dzbF8ke3BhdGguYmFzZW5hbWUoIHRhcmdldFBhdGggKS5zcGxpdCggJy4nIClbIDAgXX1gO1xyXG5cclxuICBjb25zdCBsaW5lcyA9IHN0ci5zcGxpdCggJ1xcbicgKTtcclxuXHJcbiAgY29uc3Qgcm9vdENvZGUgPSBuZXcgQ29kZSggdHJ1ZSApO1xyXG4gIGNvbnN0IGNvbmRpdGlvbmFsU3RhY2sgPSBbXTtcclxuICBjb25zdCBzdGFjayA9IFsgcm9vdENvZGUgXTtcclxuXHJcbiAgbGV0IGFmdGVyQmluZGluZ3MgPSBmYWxzZTtcclxuXHJcbiAgbGluZXMuZm9yRWFjaCggbGluZSA9PiB7XHJcbiAgICBjb25zdCB0b3BOb2RlID0gc3RhY2tbIHN0YWNrLmxlbmd0aCAtIDEgXTtcclxuICAgIGNvbnN0IGFycmF5ID0gYWZ0ZXJCaW5kaW5ncyA/IHRvcE5vZGUuYWZ0ZXJCaW5kaW5ncyA6IHRvcE5vZGUuYmVmb3JlQmluZGluZ3M7XHJcblxyXG4gICAgaWYgKCBsaW5lLnN0YXJ0c1dpdGgoIGltcG9ydFN0cmluZyApICkge1xyXG4gICAgICBjb25zdCBpbXBvcnROYW1lID0gbGluZS5zdWJzdHJpbmcoIGltcG9ydFN0cmluZy5sZW5ndGggKTtcclxuICAgICAgdG9wTm9kZS5pbXBvcnRzLnB1c2goIGltcG9ydE5hbWUgKTtcclxuICAgICAgcm9vdENvZGUuYWxsSW1wb3J0cy5wdXNoKCBpbXBvcnROYW1lICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbGluZS5zdGFydHNXaXRoKCBvcHRpb25TdHJpbmcgKSApIHtcclxuICAgICAgY29uc3Qgb3B0aW9uTmFtZSA9IGxpbmUuc3Vic3RyaW5nKCBvcHRpb25TdHJpbmcubGVuZ3RoICk7XHJcbiAgICAgIHJvb3RDb2RlLm9wdGlvbnMucHVzaCggb3B0aW9uTmFtZSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIGxpbmUuc3RhcnRzV2l0aCggYmluZGluZ3NTdHJpbmcgKSApIHtcclxuICAgICAgYWZ0ZXJCaW5kaW5ncyA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbGluZS5zdGFydHNXaXRoKCBpZmRlZlN0cmluZyApICkge1xyXG4gICAgICBjb25zdCBjb25kaXRpb25hbCA9IG5ldyBDb25kaXRpb25hbCggbGluZS5zdWJzdHJpbmcoIGlmZGVmU3RyaW5nLmxlbmd0aCApICk7XHJcbiAgICAgIGFycmF5LnB1c2goIGNvbmRpdGlvbmFsICk7XHJcbiAgICAgIGNvbmRpdGlvbmFsU3RhY2sucHVzaCggY29uZGl0aW9uYWwgKTtcclxuICAgICAgc3RhY2sucHVzaCggY29uZGl0aW9uYWwuaW5jbHVkZWQgKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBsaW5lLnN0YXJ0c1dpdGgoIGlmbmRlZlN0cmluZyApICkge1xyXG4gICAgICBjb25zdCBjb25kaXRpb25hbCA9IG5ldyBDb25kaXRpb25hbCggbGluZS5zdWJzdHJpbmcoIGlmbmRlZlN0cmluZy5sZW5ndGggKSApO1xyXG4gICAgICBhcnJheS5wdXNoKCBjb25kaXRpb25hbCApO1xyXG4gICAgICBjb25kaXRpb25hbFN0YWNrLnB1c2goIGNvbmRpdGlvbmFsICk7XHJcbiAgICAgIHN0YWNrLnB1c2goIGNvbmRpdGlvbmFsLmV4Y2x1ZGVkICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbGluZS5zdGFydHNXaXRoKCBlbHNlU3RyaW5nICkgKSB7XHJcbiAgICAgIGlmICggY29uZGl0aW9uYWxTdGFjay5sZW5ndGggPT09IDAgKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAndW5tYXRjaGVkIGVsc2UnICk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgY29uZGl0aW9uYWwgPSBjb25kaXRpb25hbFN0YWNrWyBjb25kaXRpb25hbFN0YWNrLmxlbmd0aCAtIDEgXTtcclxuICAgICAgY29uc3Qgb2xkQ29kZSA9IHN0YWNrLnBvcCgpO1xyXG4gICAgICBvbGRDb2RlLmZpbmFsaXplKCBtaW5pZnkgKTtcclxuICAgICAgc3RhY2sucHVzaCggb2xkQ29kZSA9PT0gY29uZGl0aW9uYWwuZXhjbHVkZWQgPyBjb25kaXRpb25hbC5pbmNsdWRlZCA6IGNvbmRpdGlvbmFsLmV4Y2x1ZGVkICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbGluZS5zdGFydHNXaXRoKCBlbmRpZlN0cmluZyApICkge1xyXG4gICAgICBpZiAoIGNvbmRpdGlvbmFsU3RhY2subGVuZ3RoID09PSAwICkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvciggJ3VubWF0Y2hlZCBlbmRpZicgKTtcclxuICAgICAgfVxyXG4gICAgICBjb25kaXRpb25hbFN0YWNrLnBvcCgpO1xyXG4gICAgICBzdGFjay5wb3AoKS5maW5hbGl6ZSggbWluaWZ5ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgaWYgKCBhcnJheS5sZW5ndGggJiYgdHlwZW9mIGFycmF5WyBhcnJheS5sZW5ndGggLSAxIF0gPT09ICdzdHJpbmcnICkge1xyXG4gICAgICAgIGFycmF5WyBhcnJheS5sZW5ndGggLSAxIF0gKz0gJ1xcbicgKyBsaW5lO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGFycmF5LnB1c2goIGxpbmUgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0gKTtcclxuXHJcbiAgcm9vdENvZGUuZmluYWxpemUoIG1pbmlmeSApO1xyXG5cclxuICBpZiAoIGNvbmRpdGlvbmFsU3RhY2subGVuZ3RoID4gMCApIHtcclxuICAgIHRocm93IG5ldyBFcnJvciggJ3VudGVybWluYXRlZCBjb25kaXRpb25hbCcgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiByb290Q29kZS50b1N0cmluZyggJyAgJywgcGF0aFRvUm9vdCwgbW9kdWxlTmFtZSwgcmVwb05hbWUgKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gd2dzbFByZXByb2Nlc3M7Il0sIm1hcHBpbmdz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TUFDckM7TUFDQSxNQUFNb0IsV0FBVyxHQUFHVixnQkFBZ0IsQ0FBRUEsZ0JBQWdCLENBQUNoRCxNQUFNLEdBQUcsQ0FBQyxDQUFFO01BQ25FLE1BQU0yRCxPQUFPLEdBQUdWLEtBQUssQ0FBQ1csR0FBRyxDQUFDLENBQUM7TUFDM0JELE9BQU8sQ0FBQzlDLFFBQVEsQ0FBRUMsTUFBTyxDQUFDO01BQzFCbUMsS0FBSyxDQUFDTyxJQUFJLENBQUVHLE9BQU8sS0FBS0QsV0FBVyxDQUFDckIsUUFBUSxHQUFHcUIsV0FBVyxDQUFDdEIsUUFBUSxHQUFHc0IsV0FBVyxDQUFDckIsUUFBUyxDQUFDO0lBQzlGLENBQUMsTUFDSSxJQUFLYSxJQUFJLENBQUNHLFVBQVUsQ0FBRTNELFdBQVksQ0FBQyxFQUFHO01BQ3pDLElBQUtzRCxnQkFBZ0IsQ0FBQ2hELE1BQU0sS0FBSyxDQUFDLEVBQUc7UUFDbkMsTUFBTSxJQUFJc0MsS0FBSyxDQUFFLGlCQUFrQixDQUFDO01BQ3RDO01BQ0FVLGdCQUFnQixDQUFDWSxHQUFHLENBQUMsQ0FBQztNQUN0QlgsS0FBSyxDQUFDVyxHQUFHLENBQUMsQ0FBQyxDQUFDL0MsUUFBUSxDQUFFQyxNQUFPLENBQUM7SUFDaEMsQ0FBQyxNQUNJO01BQ0gsSUFBS3NDLEtBQUssQ0FBQ3BELE1BQU0sSUFBSSxPQUFPb0QsS0FBSyxDQUFFQSxLQUFLLENBQUNwRCxNQUFNLEdBQUcsQ0FBQyxDQUFFLEtBQUssUUFBUSxFQUFHO1FBQ25Fb0QsS0FBSyxDQUFFQSxLQUFLLENBQUNwRCxNQUFNLEdBQUcsQ0FBQyxDQUFFLElBQUksSUFBSSxHQUFHa0QsSUFBSTtNQUMxQyxDQUFDLE1BQ0k7UUFDSEUsS0FBSyxDQUFDSSxJQUFJLENBQUVOLElBQUssQ0FBQztNQUNwQjtJQUNGO0VBQ0YsQ0FBRSxDQUFDO0VBRUhILFFBQVEsQ0FBQ2xDLFFBQVEsQ0FBRUMsTUFBTyxDQUFDO0VBRTNCLElBQUtrQyxnQkFBZ0IsQ0FBQ2hELE1BQU0sR0FBRyxDQUFDLEVBQUc7SUFDakMsTUFBTSxJQUFJc0MsS0FBSyxDQUFFLDBCQUEyQixDQUFDO0VBQy9DO0VBRUEsT0FBT1MsUUFBUSxDQUFDOUIsUUFBUSxDQUFFLElBQUksRUFBRUUsVUFBVSxFQUFFQyxVQUFVLEVBQUVDLFFBQVMsQ0FBQztBQUNwRSxDQUFDO0FBRUR3QyxNQUFNLENBQUNDLE9BQU8sR0FBR3JCLGNBQWMiLCJpZ25vcmVMaXN0IjpbXX0=