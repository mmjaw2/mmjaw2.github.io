// Copyright 2024, University of Colorado Boulder

/**
 * Analyzes the file size of a built file (that has been built with --profileFileSize), and prints out the results.
 *
 * To profile a sim, go to the sim directory and run:
 *
 * grunt --allHTML --locales=* --brands=phet --profileFileSize
 * grunt profile-file-size
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

const fs = require('fs');
const zlib = require('zlib');
const _ = require('lodash');

/**
 * @param {string} repo
 */
module.exports = async function (repo) {
  const file = fs.readFileSync(`../${repo}/build/phet/${repo}_all_phet.html`, 'utf-8');
  const rootSection = parseToSections(file);
  const size = rootSection.getSize();
  const gzippedSize = rootSection.getGzippedSize();
  const printString = (name, string) => {
    console.log(`${name}: ${getSizeString(string, size, gzippedSize)}`);
  };
  const printFilter = (name, filter) => {
    printString(name, rootSection.getApproxFilteredString(filter));
  };
  console.log('summary:\n');
  printString('TOTAL', rootSection.getApproxString());
  console.log('');
  printString('images', rootSection.getApproxImagesString());
  printString('sounds', rootSection.getApproxSoundsString());
  printFilter('webpack (includes assets)', section => section.type === 'WEBPACK');
  printFilter('preload', section => section.type === 'PRELOAD');
  printFilter('strings', section => section.type === 'STRINGS');
  printFilter('license', section => section.type === 'LICENSE');
  for (const repo of rootSection.getRepos().sort()) {
    printString(`js ${repo}`, rootSection.getApproxRepoString(repo));
  }
  console.log('\ndetails:\n');
  console.log(rootSection.toReportString(true, size, gzippedSize));
};
class TagMatch {
  constructor(startIndex, endIndex, isStart, type, name) {
    this.startIndex = startIndex;
    this.endIndex = endIndex;
    this.isStart = isStart;
    this.type = type;
    this.name = name || null;
  }
}
class TaggedSection {
  constructor(type, name) {
    this.type = type;
    this.name = name || null;
    this.children = []; // ( TaggedSection | string )[]
  }

  // @public
  getSize() {
    return getUtf8Length(this.getApproxString());
  }

  // @public
  getGzippedSize() {
    return getGzippedLength(this.getApproxString());
  }

  // @public
  getApproxString() {
    return this.children.map(child => {
      if (typeof child === 'string') {
        return child;
      } else {
        return child.getApproxString();
      }
    }).join('');
  }

  // @public
  getApproxFilteredString(filter) {
    if (filter(this)) {
      return this.getApproxString();
    } else {
      return this.children.map(child => {
        if (typeof child === 'string') {
          return '';
        } else {
          return child.getApproxFilteredString(filter);
        }
      }).join('');
    }
  }

  // @public
  getApproxRepoString(repo) {
    return this.getApproxFilteredString(section => section.type === 'MODULE' && section.name && section.name.includes(`chipper/dist/js/${repo}/`));
  }

  // @public
  getApproxImagesString() {
    return this.getApproxFilteredString(section => section.type === 'MODULE' && section.name && /chipper\/dist\/js\/[^/]+\/(images|mipmaps)\//.test(section.name));
  }

  // @public
  getApproxSoundsString() {
    return this.getApproxFilteredString(section => section.type === 'MODULE' && section.name && /chipper\/dist\/js\/[^/]+\/sounds\//.test(section.name));
  }

  // @public
  getRepos() {
    let repo = null;
    if (this.type === 'MODULE' && this.name && this.name.includes('chipper/dist/js/')) {
      const index = this.name.indexOf('chipper/dist/js/') + 'chipper/dist/js/'.length;
      repo = this.name.slice(index).split('/')[0];
    }
    return _.uniq([...(repo ? [repo] : []), ...this.children.flatMap(child => {
      if (typeof child === 'string') {
        return [];
      } else {
        return child.getRepos();
      }
    })]);
  }

  // @public
  toReportString(sort, size, gzippedSize, indent = '') {
    // TOD: sort by gzipped size?
    const children = sort ? _.sortBy(this.children, child => -(typeof child === 'string' ? getUtf8Length(child) : child.getSize())) : this.children;
    return `${getSizeString(this.getApproxString(), size, gzippedSize)} ${indent}${this.type}${this.name ? ' ' + this.name : ''}\n${children.map(child => {
      if (typeof child === 'string') {
        return '';
      } else {
        return child.toReportString(sort, size, gzippedSize, `${indent}  `);
      }
    }).join('')}`;
  }
}
const findNextMatch = (string, startIndex) => {
  const match = /console\.log\("(START|END)_([A-Z_]+)"(,"([^"]+)")?\)/g.exec(string.slice(startIndex));
  if (match) {
    const matchIndex = match.index + startIndex;
    return new TagMatch(matchIndex, matchIndex + match[0].length, match[1] === 'START', match[2], match[4]);
  } else {
    return null;
  }
};
const getUtf8Length = string => Buffer.from(string, 'utf-8').length;
const getGzippedLength = string => zlib.gzipSync(Buffer.from(string, 'utf-8')).length;
const getSizeString = (string, size, gzippedSize) => {
  const ourSize = getUtf8Length(string);
  const ourGzippedSize = getGzippedLength(string);
  let sizeString = '' + ourSize;
  let gzippedSizeString = '' + ourGzippedSize;
  const sizePercentage = Math.round(ourSize / size * 1000) / 10;
  if (sizePercentage !== 0) {
    sizeString += ` (${sizePercentage}%)`;
  }
  const gzippedSizePercentage = Math.round(ourGzippedSize / gzippedSize * 1000) / 10;
  if (gzippedSizePercentage !== 0) {
    gzippedSizeString += ` (${gzippedSizePercentage}%)`;
  }
  const megabytes = Math.round(ourSize / 1024 / 1024 * 100) / 100;
  if (megabytes !== 0) {
    sizeString += ` ${megabytes} MB`;
  }
  const gzippedMegabytes = Math.round(ourGzippedSize / 1024 / 1024 * 100) / 100;
  if (gzippedMegabytes !== 0) {
    gzippedSizeString += ` ${gzippedMegabytes} MB`;
  }
  return `utf-8: ${sizeString} gzip: ${gzippedSizeString}`;
};
const parseToSections = string => {
  const rootSection = new TaggedSection('ROOT', null);
  const stack = [rootSection];
  let index = 0;
  let match;
  // eslint-disable-next-line no-cond-assign
  while (match = findNextMatch(string, index)) {
    // console.log( match.type, match.name, match.isStart ? 'START' : 'END', match.startIndex, match.endIndex );

    // Append any string before the match
    if (match.startIndex > index) {
      stack[stack.length - 1].children.push(string.slice(index, match.startIndex));
    }
    if (match.isStart) {
      const newSection = new TaggedSection(match.type, match.name);
      stack[stack.length - 1].children.push(newSection);
      stack.push(newSection);
    } else {
      const popped = stack.pop();
      if (popped.type !== match.type || popped.name !== match.name) {
        throw new Error(`Mismatched tags: ${popped.type} ${popped.name} !== ${match.type} ${match.name}`);
      }
    }
    index = match.endIndex;
  }
  if (index < string.length) {
    stack[stack.length - 1].children.push(string.slice(index));
  }
  return rootSection;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJ6bGliIiwiXyIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZXBvIiwiZmlsZSIsInJlYWRGaWxlU3luYyIsInJvb3RTZWN0aW9uIiwicGFyc2VUb1NlY3Rpb25zIiwic2l6ZSIsImdldFNpemUiLCJnemlwcGVkU2l6ZSIsImdldEd6aXBwZWRTaXplIiwicHJpbnRTdHJpbmciLCJuYW1lIiwic3RyaW5nIiwiY29uc29sZSIsImxvZyIsImdldFNpemVTdHJpbmciLCJwcmludEZpbHRlciIsImZpbHRlciIsImdldEFwcHJveEZpbHRlcmVkU3RyaW5nIiwiZ2V0QXBwcm94U3RyaW5nIiwiZ2V0QXBwcm94SW1hZ2VzU3RyaW5nIiwiZ2V0QXBwcm94U291bmRzU3RyaW5nIiwic2VjdGlvbiIsInR5cGUiLCJnZXRSZXBvcyIsInNvcnQiLCJnZXRBcHByb3hSZXBvU3RyaW5nIiwidG9SZXBvcnRTdHJpbmciLCJUYWdNYXRjaCIsImNvbnN0cnVjdG9yIiwic3RhcnRJbmRleCIsImVuZEluZGV4IiwiaXNTdGFydCIsIlRhZ2dlZFNlY3Rpb24iLCJjaGlsZHJlbiIsImdldFV0ZjhMZW5ndGgiLCJnZXRHemlwcGVkTGVuZ3RoIiwibWFwIiwiY2hpbGQiLCJqb2luIiwiaW5jbHVkZXMiLCJ0ZXN0IiwiaW5kZXgiLCJpbmRleE9mIiwibGVuZ3RoIiwic2xpY2UiLCJzcGxpdCIsInVuaXEiLCJmbGF0TWFwIiwiaW5kZW50Iiwic29ydEJ5IiwiZmluZE5leHRNYXRjaCIsIm1hdGNoIiwiZXhlYyIsIm1hdGNoSW5kZXgiLCJCdWZmZXIiLCJmcm9tIiwiZ3ppcFN5bmMiLCJvdXJTaXplIiwib3VyR3ppcHBlZFNpemUiLCJzaXplU3RyaW5nIiwiZ3ppcHBlZFNpemVTdHJpbmciLCJzaXplUGVyY2VudGFnZSIsIk1hdGgiLCJyb3VuZCIsImd6aXBwZWRTaXplUGVyY2VudGFnZSIsIm1lZ2FieXRlcyIsImd6aXBwZWRNZWdhYnl0ZXMiLCJzdGFjayIsInB1c2giLCJuZXdTZWN0aW9uIiwicG9wcGVkIiwicG9wIiwiRXJyb3IiXSwic291cmNlcyI6WyJwcm9maWxlRmlsZVNpemUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEFuYWx5emVzIHRoZSBmaWxlIHNpemUgb2YgYSBidWlsdCBmaWxlICh0aGF0IGhhcyBiZWVuIGJ1aWx0IHdpdGggLS1wcm9maWxlRmlsZVNpemUpLCBhbmQgcHJpbnRzIG91dCB0aGUgcmVzdWx0cy5cclxuICpcclxuICogVG8gcHJvZmlsZSBhIHNpbSwgZ28gdG8gdGhlIHNpbSBkaXJlY3RvcnkgYW5kIHJ1bjpcclxuICpcclxuICogZ3J1bnQgLS1hbGxIVE1MIC0tbG9jYWxlcz0qIC0tYnJhbmRzPXBoZXQgLS1wcm9maWxlRmlsZVNpemVcclxuICogZ3J1bnQgcHJvZmlsZS1maWxlLXNpemVcclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcblxyXG5jb25zdCBmcyA9IHJlcXVpcmUoICdmcycgKTtcclxuY29uc3QgemxpYiA9IHJlcXVpcmUoICd6bGliJyApO1xyXG5jb25zdCBfID0gcmVxdWlyZSggJ2xvZGFzaCcgKTtcclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVwb1xyXG4gKi9cclxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyBmdW5jdGlvbiggcmVwbyApIHtcclxuICBjb25zdCBmaWxlID0gZnMucmVhZEZpbGVTeW5jKCBgLi4vJHtyZXBvfS9idWlsZC9waGV0LyR7cmVwb31fYWxsX3BoZXQuaHRtbGAsICd1dGYtOCcgKTtcclxuXHJcbiAgY29uc3Qgcm9vdFNlY3Rpb24gPSBwYXJzZVRvU2VjdGlvbnMoIGZpbGUgKTtcclxuXHJcbiAgY29uc3Qgc2l6ZSA9IHJvb3RTZWN0aW9uLmdldFNpemUoKTtcclxuICBjb25zdCBnemlwcGVkU2l6ZSA9IHJvb3RTZWN0aW9uLmdldEd6aXBwZWRTaXplKCk7XHJcblxyXG4gIGNvbnN0IHByaW50U3RyaW5nID0gKCBuYW1lLCBzdHJpbmcgKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyggYCR7bmFtZX06ICR7Z2V0U2l6ZVN0cmluZyggc3RyaW5nLCBzaXplLCBnemlwcGVkU2l6ZSApfWAgKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBwcmludEZpbHRlciA9ICggbmFtZSwgZmlsdGVyICkgPT4ge1xyXG4gICAgcHJpbnRTdHJpbmcoIG5hbWUsIHJvb3RTZWN0aW9uLmdldEFwcHJveEZpbHRlcmVkU3RyaW5nKCBmaWx0ZXIgKSApO1xyXG4gIH07XHJcblxyXG4gIGNvbnNvbGUubG9nKCAnc3VtbWFyeTpcXG4nICk7XHJcbiAgcHJpbnRTdHJpbmcoICdUT1RBTCcsIHJvb3RTZWN0aW9uLmdldEFwcHJveFN0cmluZygpICk7XHJcbiAgY29uc29sZS5sb2coICcnICk7XHJcbiAgcHJpbnRTdHJpbmcoICdpbWFnZXMnLCByb290U2VjdGlvbi5nZXRBcHByb3hJbWFnZXNTdHJpbmcoKSApO1xyXG4gIHByaW50U3RyaW5nKCAnc291bmRzJywgcm9vdFNlY3Rpb24uZ2V0QXBwcm94U291bmRzU3RyaW5nKCkgKTtcclxuICBwcmludEZpbHRlciggJ3dlYnBhY2sgKGluY2x1ZGVzIGFzc2V0cyknLCBzZWN0aW9uID0+IHNlY3Rpb24udHlwZSA9PT0gJ1dFQlBBQ0snICk7XHJcbiAgcHJpbnRGaWx0ZXIoICdwcmVsb2FkJywgc2VjdGlvbiA9PiBzZWN0aW9uLnR5cGUgPT09ICdQUkVMT0FEJyApO1xyXG4gIHByaW50RmlsdGVyKCAnc3RyaW5ncycsIHNlY3Rpb24gPT4gc2VjdGlvbi50eXBlID09PSAnU1RSSU5HUycgKTtcclxuICBwcmludEZpbHRlciggJ2xpY2Vuc2UnLCBzZWN0aW9uID0+IHNlY3Rpb24udHlwZSA9PT0gJ0xJQ0VOU0UnICk7XHJcblxyXG4gIGZvciAoIGNvbnN0IHJlcG8gb2Ygcm9vdFNlY3Rpb24uZ2V0UmVwb3MoKS5zb3J0KCkgKSB7XHJcbiAgICBwcmludFN0cmluZyggYGpzICR7cmVwb31gLCByb290U2VjdGlvbi5nZXRBcHByb3hSZXBvU3RyaW5nKCByZXBvICkgKTtcclxuICB9XHJcblxyXG4gIGNvbnNvbGUubG9nKCAnXFxuZGV0YWlsczpcXG4nICk7XHJcblxyXG4gIGNvbnNvbGUubG9nKCByb290U2VjdGlvbi50b1JlcG9ydFN0cmluZyggdHJ1ZSwgc2l6ZSwgZ3ppcHBlZFNpemUgKSApO1xyXG59O1xyXG5cclxuY2xhc3MgVGFnTWF0Y2gge1xyXG4gIGNvbnN0cnVjdG9yKCBzdGFydEluZGV4LCBlbmRJbmRleCwgaXNTdGFydCwgdHlwZSwgbmFtZSApIHtcclxuICAgIHRoaXMuc3RhcnRJbmRleCA9IHN0YXJ0SW5kZXg7XHJcbiAgICB0aGlzLmVuZEluZGV4ID0gZW5kSW5kZXg7XHJcbiAgICB0aGlzLmlzU3RhcnQgPSBpc1N0YXJ0O1xyXG4gICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgIHRoaXMubmFtZSA9IG5hbWUgfHwgbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFRhZ2dlZFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKCB0eXBlLCBuYW1lICkge1xyXG4gICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgIHRoaXMubmFtZSA9IG5hbWUgfHwgbnVsbDtcclxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsgLy8gKCBUYWdnZWRTZWN0aW9uIHwgc3RyaW5nIClbXVxyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldFNpemUoKSB7XHJcbiAgICByZXR1cm4gZ2V0VXRmOExlbmd0aCggdGhpcy5nZXRBcHByb3hTdHJpbmcoKSApO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldEd6aXBwZWRTaXplKCkge1xyXG4gICAgcmV0dXJuIGdldEd6aXBwZWRMZW5ndGgoIHRoaXMuZ2V0QXBwcm94U3RyaW5nKCkgKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRBcHByb3hTdHJpbmcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5tYXAoIGNoaWxkID0+IHtcclxuICAgICAgaWYgKCB0eXBlb2YgY2hpbGQgPT09ICdzdHJpbmcnICkge1xyXG4gICAgICAgIHJldHVybiBjaGlsZDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gY2hpbGQuZ2V0QXBwcm94U3RyaW5nKCk7XHJcbiAgICAgIH1cclxuICAgIH0gKS5qb2luKCAnJyApO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldEFwcHJveEZpbHRlcmVkU3RyaW5nKCBmaWx0ZXIgKSB7XHJcbiAgICBpZiAoIGZpbHRlciggdGhpcyApICkge1xyXG4gICAgICByZXR1cm4gdGhpcy5nZXRBcHByb3hTdHJpbmcoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5tYXAoIGNoaWxkID0+IHtcclxuICAgICAgICBpZiAoIHR5cGVvZiBjaGlsZCA9PT0gJ3N0cmluZycgKSB7XHJcbiAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGNoaWxkLmdldEFwcHJveEZpbHRlcmVkU3RyaW5nKCBmaWx0ZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKS5qb2luKCAnJyApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldEFwcHJveFJlcG9TdHJpbmcoIHJlcG8gKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBcHByb3hGaWx0ZXJlZFN0cmluZyggc2VjdGlvbiA9PiBzZWN0aW9uLnR5cGUgPT09ICdNT0RVTEUnICYmIHNlY3Rpb24ubmFtZSAmJiBzZWN0aW9uLm5hbWUuaW5jbHVkZXMoIGBjaGlwcGVyL2Rpc3QvanMvJHtyZXBvfS9gICkgKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRBcHByb3hJbWFnZXNTdHJpbmcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBcHByb3hGaWx0ZXJlZFN0cmluZyggc2VjdGlvbiA9PiBzZWN0aW9uLnR5cGUgPT09ICdNT0RVTEUnICYmIHNlY3Rpb24ubmFtZSAmJiAvY2hpcHBlclxcL2Rpc3RcXC9qc1xcL1teL10rXFwvKGltYWdlc3xtaXBtYXBzKVxcLy8udGVzdCggc2VjdGlvbi5uYW1lICkgKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRBcHByb3hTb3VuZHNTdHJpbmcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBcHByb3hGaWx0ZXJlZFN0cmluZyggc2VjdGlvbiA9PiBzZWN0aW9uLnR5cGUgPT09ICdNT0RVTEUnICYmIHNlY3Rpb24ubmFtZSAmJiAvY2hpcHBlclxcL2Rpc3RcXC9qc1xcL1teL10rXFwvc291bmRzXFwvLy50ZXN0KCBzZWN0aW9uLm5hbWUgKSApO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldFJlcG9zKCkge1xyXG4gICAgbGV0IHJlcG8gPSBudWxsO1xyXG5cclxuICAgIGlmICggdGhpcy50eXBlID09PSAnTU9EVUxFJyAmJiB0aGlzLm5hbWUgJiYgdGhpcy5uYW1lLmluY2x1ZGVzKCAnY2hpcHBlci9kaXN0L2pzLycgKSApIHtcclxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm5hbWUuaW5kZXhPZiggJ2NoaXBwZXIvZGlzdC9qcy8nICkgKyAnY2hpcHBlci9kaXN0L2pzLycubGVuZ3RoO1xyXG4gICAgICByZXBvID0gdGhpcy5uYW1lLnNsaWNlKCBpbmRleCApLnNwbGl0KCAnLycgKVsgMCBdO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBfLnVuaXEoIFtcclxuICAgICAgLi4uKCByZXBvID8gWyByZXBvIF0gOiBbXSApLFxyXG4gICAgICAuLi50aGlzLmNoaWxkcmVuLmZsYXRNYXAoIGNoaWxkID0+IHtcclxuICAgICAgICBpZiAoIHR5cGVvZiBjaGlsZCA9PT0gJ3N0cmluZycgKSB7XHJcbiAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGNoaWxkLmdldFJlcG9zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IClcclxuICAgIF0gKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICB0b1JlcG9ydFN0cmluZyggc29ydCwgc2l6ZSwgZ3ppcHBlZFNpemUsIGluZGVudCA9ICcnICkge1xyXG4gICAgLy8gVE9EOiBzb3J0IGJ5IGd6aXBwZWQgc2l6ZT9cclxuICAgIGNvbnN0IGNoaWxkcmVuID0gc29ydCA/IF8uc29ydEJ5KCB0aGlzLmNoaWxkcmVuLCBjaGlsZCA9PiAtKCB0eXBlb2YgY2hpbGQgPT09ICdzdHJpbmcnID8gZ2V0VXRmOExlbmd0aCggY2hpbGQgKSA6IGNoaWxkLmdldFNpemUoKSApICkgOiB0aGlzLmNoaWxkcmVuO1xyXG4gICAgcmV0dXJuIGAke2dldFNpemVTdHJpbmcoIHRoaXMuZ2V0QXBwcm94U3RyaW5nKCksIHNpemUsIGd6aXBwZWRTaXplICl9ICR7aW5kZW50fSR7dGhpcy50eXBlfSR7dGhpcy5uYW1lID8gJyAnICsgdGhpcy5uYW1lIDogJyd9XFxuJHtjaGlsZHJlbi5tYXAoIGNoaWxkID0+IHtcclxuICAgICAgaWYgKCB0eXBlb2YgY2hpbGQgPT09ICdzdHJpbmcnICkge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gY2hpbGQudG9SZXBvcnRTdHJpbmcoIHNvcnQsIHNpemUsIGd6aXBwZWRTaXplLCBgJHtpbmRlbnR9ICBgICk7XHJcbiAgICAgIH1cclxuICAgIH0gKS5qb2luKCAnJyApfWA7XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBmaW5kTmV4dE1hdGNoID0gKCBzdHJpbmcsIHN0YXJ0SW5kZXggKSA9PiB7XHJcbiAgY29uc3QgbWF0Y2ggPSAoIC9jb25zb2xlXFwubG9nXFwoXCIoU1RBUlR8RU5EKV8oW0EtWl9dKylcIigsXCIoW15cIl0rKVwiKT9cXCkvZyApLmV4ZWMoIHN0cmluZy5zbGljZSggc3RhcnRJbmRleCApICk7XHJcbiAgaWYgKCBtYXRjaCApIHtcclxuICAgIGNvbnN0IG1hdGNoSW5kZXggPSBtYXRjaC5pbmRleCArIHN0YXJ0SW5kZXg7XHJcbiAgICByZXR1cm4gbmV3IFRhZ01hdGNoKCBtYXRjaEluZGV4LCBtYXRjaEluZGV4ICsgbWF0Y2hbIDAgXS5sZW5ndGgsIG1hdGNoWyAxIF0gPT09ICdTVEFSVCcsIG1hdGNoWyAyIF0sIG1hdGNoWyA0IF0gKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBnZXRVdGY4TGVuZ3RoID0gc3RyaW5nID0+IEJ1ZmZlci5mcm9tKCBzdHJpbmcsICd1dGYtOCcgKS5sZW5ndGg7XHJcbmNvbnN0IGdldEd6aXBwZWRMZW5ndGggPSBzdHJpbmcgPT4gemxpYi5nemlwU3luYyggQnVmZmVyLmZyb20oIHN0cmluZywgJ3V0Zi04JyApICkubGVuZ3RoO1xyXG5jb25zdCBnZXRTaXplU3RyaW5nID0gKCBzdHJpbmcsIHNpemUsIGd6aXBwZWRTaXplICkgPT4ge1xyXG4gIGNvbnN0IG91clNpemUgPSBnZXRVdGY4TGVuZ3RoKCBzdHJpbmcgKTtcclxuICBjb25zdCBvdXJHemlwcGVkU2l6ZSA9IGdldEd6aXBwZWRMZW5ndGgoIHN0cmluZyApO1xyXG5cclxuICBsZXQgc2l6ZVN0cmluZyA9ICcnICsgb3VyU2l6ZTtcclxuICBsZXQgZ3ppcHBlZFNpemVTdHJpbmcgPSAnJyArIG91ckd6aXBwZWRTaXplO1xyXG5cclxuXHJcbiAgY29uc3Qgc2l6ZVBlcmNlbnRhZ2UgPSBNYXRoLnJvdW5kKCBvdXJTaXplIC8gc2l6ZSAqIDEwMDAgKSAvIDEwO1xyXG4gIGlmICggc2l6ZVBlcmNlbnRhZ2UgIT09IDAgKSB7XHJcbiAgICBzaXplU3RyaW5nICs9IGAgKCR7c2l6ZVBlcmNlbnRhZ2V9JSlgO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZ3ppcHBlZFNpemVQZXJjZW50YWdlID0gTWF0aC5yb3VuZCggb3VyR3ppcHBlZFNpemUgLyBnemlwcGVkU2l6ZSAqIDEwMDAgKSAvIDEwO1xyXG4gIGlmICggZ3ppcHBlZFNpemVQZXJjZW50YWdlICE9PSAwICkge1xyXG4gICAgZ3ppcHBlZFNpemVTdHJpbmcgKz0gYCAoJHtnemlwcGVkU2l6ZVBlcmNlbnRhZ2V9JSlgO1xyXG4gIH1cclxuXHJcblxyXG4gIGNvbnN0IG1lZ2FieXRlcyA9IE1hdGgucm91bmQoIG91clNpemUgLyAxMDI0IC8gMTAyNCAqIDEwMCApIC8gMTAwO1xyXG4gIGlmICggbWVnYWJ5dGVzICE9PSAwICkge1xyXG4gICAgc2l6ZVN0cmluZyArPSBgICR7bWVnYWJ5dGVzfSBNQmA7XHJcbiAgfVxyXG5cclxuICBjb25zdCBnemlwcGVkTWVnYWJ5dGVzID0gTWF0aC5yb3VuZCggb3VyR3ppcHBlZFNpemUgLyAxMDI0IC8gMTAyNCAqIDEwMCApIC8gMTAwO1xyXG4gIGlmICggZ3ppcHBlZE1lZ2FieXRlcyAhPT0gMCApIHtcclxuICAgIGd6aXBwZWRTaXplU3RyaW5nICs9IGAgJHtnemlwcGVkTWVnYWJ5dGVzfSBNQmA7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYHV0Zi04OiAke3NpemVTdHJpbmd9IGd6aXA6ICR7Z3ppcHBlZFNpemVTdHJpbmd9YDtcclxufTtcclxuXHJcbmNvbnN0IHBhcnNlVG9TZWN0aW9ucyA9IHN0cmluZyA9PiB7XHJcbiAgY29uc3Qgcm9vdFNlY3Rpb24gPSBuZXcgVGFnZ2VkU2VjdGlvbiggJ1JPT1QnLCBudWxsICk7XHJcbiAgY29uc3Qgc3RhY2sgPSBbIHJvb3RTZWN0aW9uIF07XHJcblxyXG4gIGxldCBpbmRleCA9IDA7XHJcbiAgbGV0IG1hdGNoO1xyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25kLWFzc2lnblxyXG4gIHdoaWxlICggbWF0Y2ggPSBmaW5kTmV4dE1hdGNoKCBzdHJpbmcsIGluZGV4ICkgKSB7XHJcblxyXG4gICAgLy8gY29uc29sZS5sb2coIG1hdGNoLnR5cGUsIG1hdGNoLm5hbWUsIG1hdGNoLmlzU3RhcnQgPyAnU1RBUlQnIDogJ0VORCcsIG1hdGNoLnN0YXJ0SW5kZXgsIG1hdGNoLmVuZEluZGV4ICk7XHJcblxyXG4gICAgLy8gQXBwZW5kIGFueSBzdHJpbmcgYmVmb3JlIHRoZSBtYXRjaFxyXG4gICAgaWYgKCBtYXRjaC5zdGFydEluZGV4ID4gaW5kZXggKSB7XHJcbiAgICAgIHN0YWNrWyBzdGFjay5sZW5ndGggLSAxIF0uY2hpbGRyZW4ucHVzaCggc3RyaW5nLnNsaWNlKCBpbmRleCwgbWF0Y2guc3RhcnRJbmRleCApICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCBtYXRjaC5pc1N0YXJ0ICkge1xyXG4gICAgICBjb25zdCBuZXdTZWN0aW9uID0gbmV3IFRhZ2dlZFNlY3Rpb24oIG1hdGNoLnR5cGUsIG1hdGNoLm5hbWUgKTtcclxuICAgICAgc3RhY2tbIHN0YWNrLmxlbmd0aCAtIDEgXS5jaGlsZHJlbi5wdXNoKCBuZXdTZWN0aW9uICk7XHJcbiAgICAgIHN0YWNrLnB1c2goIG5ld1NlY3Rpb24gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zdCBwb3BwZWQgPSBzdGFjay5wb3AoKTtcclxuICAgICAgaWYgKCBwb3BwZWQudHlwZSAhPT0gbWF0Y2gudHlwZSB8fCBwb3BwZWQubmFtZSAhPT0gbWF0Y2gubmFtZSApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGBNaXNtYXRjaGVkIHRhZ3M6ICR7cG9wcGVkLnR5cGV9ICR7cG9wcGVkLm5hbWV9ICE9PSAke21hdGNoLnR5cGV9ICR7bWF0Y2gubmFtZX1gICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpbmRleCA9IG1hdGNoLmVuZEluZGV4O1xyXG4gIH1cclxuXHJcbiAgaWYgKCBpbmRleCA8IHN0cmluZy5sZW5ndGggKSB7XHJcbiAgICBzdGFja1sgc3RhY2subGVuZ3RoIC0gMSBdLmNoaWxkcmVuLnB1c2goIHN0cmluZy5zbGljZSggaW5kZXggKSApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJvb3RTZWN0aW9uO1xyXG59OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsTUFBTUEsRUFBRSxHQUFHQyxPQUFPLENBQUUsSUFBSyxDQUFDO0FBQzFCLE1BQU1DLElBQUksR0FBR0QsT0FBTyxDQUFFLE1BQU8sQ0FBQztBQUM5QixNQUFNRSxDQUFDLEdBQUdGLE9BQU8sQ0FBRSxRQUFTLENBQUM7O0FBRTdCO0FBQ0E7QUFDQTtBQUNBRyxNQUFNLENBQUNDLE9BQU8sR0FBRyxnQkFBZ0JDLElBQUksRUFBRztFQUN0QyxNQUFNQyxJQUFJLEdBQUdQLEVBQUUsQ0FBQ1EsWUFBWSxDQUFHLE1BQUtGLElBQUssZUFBY0EsSUFBSyxnQkFBZSxFQUFFLE9BQVEsQ0FBQztFQUV0RixNQUFNRyxXQUFXLEdBQUdDLGVBQWUsQ0FBRUgsSUFBSyxDQUFDO0VBRTNDLE1BQU1JLElBQUksR0FBR0YsV0FBVyxDQUFDRyxPQUFPLENBQUMsQ0FBQztFQUNsQyxNQUFNQyxXQUFXLEdBQUdKLFdBQVcsQ0FBQ0ssY0FBYyxDQUFDLENBQUM7RUFFaEQsTUFBTUMsV0FBVyxHQUFHQSxDQUFFQyxJQUFJLEVBQUVDLE1BQU0sS0FBTTtJQUN0Q0MsT0FBTyxDQUFDQyxHQUFHLENBQUcsR0FBRUgsSUFBSyxLQUFJSSxhQUFhLENBQUVILE1BQU0sRUFBRU4sSUFBSSxFQUFFRSxXQUFZLENBQUUsRUFBRSxDQUFDO0VBQ3pFLENBQUM7RUFFRCxNQUFNUSxXQUFXLEdBQUdBLENBQUVMLElBQUksRUFBRU0sTUFBTSxLQUFNO0lBQ3RDUCxXQUFXLENBQUVDLElBQUksRUFBRVAsV0FBVyxDQUFDYyx1QkFBdUIsQ0FB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