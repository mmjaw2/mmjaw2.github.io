// Copyright 2017-2024, University of Colorado Boulder

/**
 * Builds standalone JS deliverables (e.g. dot/kite/scenery)
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

// modules
const assert = require('assert');
const fs = require('fs');
const grunt = require('grunt');
const minify = require('./minify');
const webpackBuild = require('./webpackBuild');
const _ = require('lodash');
const getStringMap = require('./getStringMap');
const ChipperConstants = require('../common/ChipperConstants');
const getLocalesFromRepository = require('./getLocalesFromRepository');
const getPhetLibs = require('./getPhetLibs');

/**
 * Builds standalone JS deliverables (e.g. dot/kite/scenery)
 * @public
 *
 * @param {string} repo
 * @param {Object} providedOptions - Passed directly to minify()
 * @returns {Promise<string>}
 */
module.exports = async function (repo, providedOptions) {
  assert(typeof repo === 'string');
  assert(typeof providedOptions === 'object');
  const options = _.merge({
    isDebug: false,
    // {null|string[]} - if provided, exclude these preloads from the built standalone
    omitPreloads: null,
    // For concurrent builds, provide a unique output dir for the webpack process, default to the repo building
    tempOutputDir: repo
  }, providedOptions);
  const packageObject = grunt.file.readJSON(`../${repo}/package.json`);
  assert(packageObject.phet, '`phet` object expected in package.json');
  const webpackResult = await webpackBuild(repo, 'phet', {
    outputDir: options.tempOutputDir,
    profileFileSize: options.profileFileSize
  });
  const webpackJS = webpackResult.js;
  let includedSources = ['../assert/js/assert.js', '../tandem/js/PhetioIDUtils.js'];

  // add repo-specific preloads from package.json
  if (packageObject.phet.preload) {
    assert(Array.isArray(packageObject.phet.preload), 'preload should be an array');
    includedSources = includedSources.concat(packageObject.phet.preload);

    // NOTE: Should find a better way of handling putting these first
    includedSources.forEach((source, index) => {
      if (source.includes('sherpa/lib/lodash-')) {
        includedSources.splice(index, 1);
        includedSources.unshift(source);
      }
    });
    includedSources.forEach((source, index) => {
      if (source.includes('sherpa/lib/jquery-')) {
        includedSources.splice(index, 1);
        includedSources.unshift(source);
      }
    });
  }
  if (options.omitPreloads) {
    includedSources = includedSources.filter(source => !options.omitPreloads.includes(source));
  }
  let includedJS = includedSources.map(file => fs.readFileSync(file, 'utf8')).join('\n');

  // Checks if lodash exists
  const testLodash = '  if ( !window.hasOwnProperty( \'_\' ) ) {\n' + '    throw new Error( \'Underscore/Lodash not found: _\' );\n' + '  }\n';
  // Checks if jQuery exists
  const testJQuery = '  if ( !window.hasOwnProperty( \'$\' ) ) {\n' + '    throw new Error( \'jQuery not found: $\' );\n' + '  }\n';
  const debugJS = '\nwindow.assertions.enableAssert();\n';
  if (options.isDebug) {
    includedJS += debugJS;
  }
  let fullSource = `${includedJS}\n${webpackJS}`;
  if (packageObject.phet.requiresJQuery) {
    fullSource = testJQuery + fullSource;
  }
  if (packageObject.phet.requiresLodash) {
    fullSource = testLodash + fullSource;
  }

  // include globals assignment
  let globals = 'window.phet=window.phet||{}\n;';
  if (packageObject.name === 'phet-lib') {
    globals += `phet.chipper=phet.chipper||{};\nphet.chipper.packageObject=${JSON.stringify(packageObject)};\n`;
    const subRepos = ['scenery', 'sun', 'scenery-phet', 'twixt', 'mobius'];
    const phetLibs = _.uniq(_.flatten(subRepos.map(subRepo => {
      return getPhetLibs(subRepo);
    })).sort());
    const locales = [ChipperConstants.FALLBACK_LOCALE, ..._.flatten(subRepos.map(subRepo => getLocalesFromRepository(subRepo)))];
    const {
      stringMap,
      stringMetadata
    } = getStringMap(repo, locales, phetLibs, webpackResult.usedModules);
    globals += 'phet.chipper.stringPath = \'../\';\n';
    globals += 'phet.chipper.locale = \'en\';\n';
    globals += 'phet.chipper.loadModules = () => {};\n';
    globals += `phet.chipper.strings = ${JSON.stringify(stringMap, null, options.isDebug ? 2 : '')};\n`;
    globals += `phet.chipper.stringMetadata = ${JSON.stringify(stringMetadata, null, options.isDebug ? 2 : '')};\n`;
  }
  fullSource = `\n${globals}\n${fullSource}`;

  // Wrap with an IIFE
  fullSource = `(function() {\n${fullSource}\n}());`;
  fullSource = minify(fullSource, options);
  return fullSource;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhc3NlcnQiLCJyZXF1aXJlIiwiZnMiLCJncnVudCIsIm1pbmlmeSIsIndlYnBhY2tCdWlsZCIsIl8iLCJnZXRTdHJpbmdNYXAiLCJDaGlwcGVyQ29uc3RhbnRzIiwiZ2V0TG9jYWxlc0Zyb21SZXBvc2l0b3J5IiwiZ2V0UGhldExpYnMiLCJtb2R1bGUiLCJleHBvcnRzIiwicmVwbyIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJtZXJnZSIsImlzRGVidWciLCJvbWl0UHJlbG9hZHMiLCJ0ZW1wT3V0cHV0RGlyIiwicGFja2FnZU9iamVjdCIsImZpbGUiLCJyZWFkSlNPTiIsInBoZXQiLCJ3ZWJwYWNrUmVzdWx0Iiwib3V0cHV0RGlyIiwicHJvZmlsZUZpbGVTaXplIiwid2VicGFja0pTIiwianMiLCJpbmNsdWRlZFNvdXJjZXMiLCJwcmVsb2FkIiwiQXJyYXkiLCJpc0FycmF5IiwiY29uY2F0IiwiZm9yRWFjaCIsInNvdXJjZSIsImluZGV4IiwiaW5jbHVkZXMiLCJzcGxpY2UiLCJ1bnNoaWZ0IiwiZmlsdGVyIiwiaW5jbHVkZWRKUyIsIm1hcCIsInJlYWRGaWxlU3luYyIsImpvaW4iLCJ0ZXN0TG9kYXNoIiwidGVzdEpRdWVyeSIsImRlYnVnSlMiLCJmdWxsU291cmNlIiwicmVxdWlyZXNKUXVlcnkiLCJyZXF1aXJlc0xvZGFzaCIsImdsb2JhbHMiLCJuYW1lIiwiSlNPTiIsInN0cmluZ2lmeSIsInN1YlJlcG9zIiwicGhldExpYnMiLCJ1bmlxIiwiZmxhdHRlbiIsInN1YlJlcG8iLCJzb3J0IiwibG9jYWxlcyIsIkZBTExCQUNLX0xPQ0FMRSIsInN0cmluZ01hcCIsInN0cmluZ01ldGFkYXRhIiwidXNlZE1vZHVsZXMiXSwic291cmNlcyI6WyJidWlsZFN0YW5kYWxvbmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQnVpbGRzIHN0YW5kYWxvbmUgSlMgZGVsaXZlcmFibGVzIChlLmcuIGRvdC9raXRlL3NjZW5lcnkpXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5cclxuLy8gbW9kdWxlc1xyXG5jb25zdCBhc3NlcnQgPSByZXF1aXJlKCAnYXNzZXJ0JyApO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoICdmcycgKTtcclxuY29uc3QgZ3J1bnQgPSByZXF1aXJlKCAnZ3J1bnQnICk7XHJcbmNvbnN0IG1pbmlmeSA9IHJlcXVpcmUoICcuL21pbmlmeScgKTtcclxuY29uc3Qgd2VicGFja0J1aWxkID0gcmVxdWlyZSggJy4vd2VicGFja0J1aWxkJyApO1xyXG5jb25zdCBfID0gcmVxdWlyZSggJ2xvZGFzaCcgKTtcclxuY29uc3QgZ2V0U3RyaW5nTWFwID0gcmVxdWlyZSggJy4vZ2V0U3RyaW5nTWFwJyApO1xyXG5jb25zdCBDaGlwcGVyQ29uc3RhbnRzID0gcmVxdWlyZSggJy4uL2NvbW1vbi9DaGlwcGVyQ29uc3RhbnRzJyApO1xyXG5jb25zdCBnZXRMb2NhbGVzRnJvbVJlcG9zaXRvcnkgPSByZXF1aXJlKCAnLi9nZXRMb2NhbGVzRnJvbVJlcG9zaXRvcnknICk7XHJcbmNvbnN0IGdldFBoZXRMaWJzID0gcmVxdWlyZSggJy4vZ2V0UGhldExpYnMnICk7XHJcblxyXG4vKipcclxuICogQnVpbGRzIHN0YW5kYWxvbmUgSlMgZGVsaXZlcmFibGVzIChlLmcuIGRvdC9raXRlL3NjZW5lcnkpXHJcbiAqIEBwdWJsaWNcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHJlcG9cclxuICogQHBhcmFtIHtPYmplY3R9IHByb3ZpZGVkT3B0aW9ucyAtIFBhc3NlZCBkaXJlY3RseSB0byBtaW5pZnkoKVxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fVxyXG4gKi9cclxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyBmdW5jdGlvbiggcmVwbywgcHJvdmlkZWRPcHRpb25zICkge1xyXG4gIGFzc2VydCggdHlwZW9mIHJlcG8gPT09ICdzdHJpbmcnICk7XHJcbiAgYXNzZXJ0KCB0eXBlb2YgcHJvdmlkZWRPcHRpb25zID09PSAnb2JqZWN0JyApO1xyXG5cclxuICBjb25zdCBvcHRpb25zID0gXy5tZXJnZSgge1xyXG4gICAgaXNEZWJ1ZzogZmFsc2UsXHJcblxyXG4gICAgLy8ge251bGx8c3RyaW5nW119IC0gaWYgcHJvdmlkZWQsIGV4Y2x1ZGUgdGhlc2UgcHJlbG9hZHMgZnJvbSB0aGUgYnVpbHQgc3RhbmRhbG9uZVxyXG4gICAgb21pdFByZWxvYWRzOiBudWxsLFxyXG5cclxuICAgIC8vIEZvciBjb25jdXJyZW50IGJ1aWxkcywgcHJvdmlkZSBhIHVuaXF1ZSBvdXRwdXQgZGlyIGZvciB0aGUgd2VicGFjayBwcm9jZXNzLCBkZWZhdWx0IHRvIHRoZSByZXBvIGJ1aWxkaW5nXHJcbiAgICB0ZW1wT3V0cHV0RGlyOiByZXBvXHJcbiAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gIGNvbnN0IHBhY2thZ2VPYmplY3QgPSBncnVudC5maWxlLnJlYWRKU09OKCBgLi4vJHtyZXBvfS9wYWNrYWdlLmpzb25gICk7XHJcbiAgYXNzZXJ0KCBwYWNrYWdlT2JqZWN0LnBoZXQsICdgcGhldGAgb2JqZWN0IGV4cGVjdGVkIGluIHBhY2thZ2UuanNvbicgKTtcclxuXHJcbiAgY29uc3Qgd2VicGFja1Jlc3VsdCA9ICggYXdhaXQgd2VicGFja0J1aWxkKCByZXBvLCAncGhldCcsIHtcclxuICAgIG91dHB1dERpcjogb3B0aW9ucy50ZW1wT3V0cHV0RGlyLFxyXG4gICAgcHJvZmlsZUZpbGVTaXplOiBvcHRpb25zLnByb2ZpbGVGaWxlU2l6ZVxyXG4gIH0gKSApO1xyXG5cclxuICBjb25zdCB3ZWJwYWNrSlMgPSB3ZWJwYWNrUmVzdWx0LmpzO1xyXG5cclxuICBsZXQgaW5jbHVkZWRTb3VyY2VzID0gW1xyXG4gICAgJy4uL2Fzc2VydC9qcy9hc3NlcnQuanMnLFxyXG4gICAgJy4uL3RhbmRlbS9qcy9QaGV0aW9JRFV0aWxzLmpzJ1xyXG4gIF07XHJcblxyXG4gIC8vIGFkZCByZXBvLXNwZWNpZmljIHByZWxvYWRzIGZyb20gcGFja2FnZS5qc29uXHJcbiAgaWYgKCBwYWNrYWdlT2JqZWN0LnBoZXQucHJlbG9hZCApIHtcclxuICAgIGFzc2VydCggQXJyYXkuaXNBcnJheSggcGFja2FnZU9iamVjdC5waGV0LnByZWxvYWQgKSwgJ3ByZWxvYWQgc2hvdWxkIGJlIGFuIGFycmF5JyApO1xyXG4gICAgaW5jbHVkZWRTb3VyY2VzID0gaW5jbHVkZWRTb3VyY2VzLmNvbmNhdCggcGFja2FnZU9iamVjdC5waGV0LnByZWxvYWQgKTtcclxuXHJcbiAgICAvLyBOT1RFOiBTaG91bGQgZmluZCBhIGJldHRlciB3YXkgb2YgaGFuZGxpbmcgcHV0dGluZyB0aGVzZSBmaXJzdFxyXG4gICAgaW5jbHVkZWRTb3VyY2VzLmZvckVhY2goICggc291cmNlLCBpbmRleCApID0+IHtcclxuICAgICAgaWYgKCBzb3VyY2UuaW5jbHVkZXMoICdzaGVycGEvbGliL2xvZGFzaC0nICkgKSB7XHJcbiAgICAgICAgaW5jbHVkZWRTb3VyY2VzLnNwbGljZSggaW5kZXgsIDEgKTtcclxuICAgICAgICBpbmNsdWRlZFNvdXJjZXMudW5zaGlmdCggc291cmNlICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIGluY2x1ZGVkU291cmNlcy5mb3JFYWNoKCAoIHNvdXJjZSwgaW5kZXggKSA9PiB7XHJcbiAgICAgIGlmICggc291cmNlLmluY2x1ZGVzKCAnc2hlcnBhL2xpYi9qcXVlcnktJyApICkge1xyXG4gICAgICAgIGluY2x1ZGVkU291cmNlcy5zcGxpY2UoIGluZGV4LCAxICk7XHJcbiAgICAgICAgaW5jbHVkZWRTb3VyY2VzLnVuc2hpZnQoIHNvdXJjZSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG4gIGlmICggb3B0aW9ucy5vbWl0UHJlbG9hZHMgKSB7XHJcbiAgICBpbmNsdWRlZFNvdXJjZXMgPSBpbmNsdWRlZFNvdXJjZXMuZmlsdGVyKCBzb3VyY2UgPT4gIW9wdGlvbnMub21pdFByZWxvYWRzLmluY2x1ZGVzKCBzb3VyY2UgKSApO1xyXG4gIH1cclxuXHJcbiAgbGV0IGluY2x1ZGVkSlMgPSBpbmNsdWRlZFNvdXJjZXMubWFwKCBmaWxlID0+IGZzLnJlYWRGaWxlU3luYyggZmlsZSwgJ3V0ZjgnICkgKS5qb2luKCAnXFxuJyApO1xyXG5cclxuICAvLyBDaGVja3MgaWYgbG9kYXNoIGV4aXN0c1xyXG4gIGNvbnN0IHRlc3RMb2Rhc2ggPSAnICBpZiAoICF3aW5kb3cuaGFzT3duUHJvcGVydHkoIFxcJ19cXCcgKSApIHtcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgJyAgICB0aHJvdyBuZXcgRXJyb3IoIFxcJ1VuZGVyc2NvcmUvTG9kYXNoIG5vdCBmb3VuZDogX1xcJyApO1xcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAnICB9XFxuJztcclxuICAvLyBDaGVja3MgaWYgalF1ZXJ5IGV4aXN0c1xyXG4gIGNvbnN0IHRlc3RKUXVlcnkgPSAnICBpZiAoICF3aW5kb3cuaGFzT3duUHJvcGVydHkoIFxcJyRcXCcgKSApIHtcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgJyAgICB0aHJvdyBuZXcgRXJyb3IoIFxcJ2pRdWVyeSBub3QgZm91bmQ6ICRcXCcgKTtcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgJyAgfVxcbic7XHJcblxyXG4gIGNvbnN0IGRlYnVnSlMgPSAnXFxud2luZG93LmFzc2VydGlvbnMuZW5hYmxlQXNzZXJ0KCk7XFxuJztcclxuICBpZiAoIG9wdGlvbnMuaXNEZWJ1ZyApIHtcclxuICAgIGluY2x1ZGVkSlMgKz0gZGVidWdKUztcclxuICB9XHJcblxyXG4gIGxldCBmdWxsU291cmNlID0gYCR7aW5jbHVkZWRKU31cXG4ke3dlYnBhY2tKU31gO1xyXG4gIGlmICggcGFja2FnZU9iamVjdC5waGV0LnJlcXVpcmVzSlF1ZXJ5ICkge1xyXG4gICAgZnVsbFNvdXJjZSA9IHRlc3RKUXVlcnkgKyBmdWxsU291cmNlO1xyXG4gIH1cclxuICBpZiAoIHBhY2thZ2VPYmplY3QucGhldC5yZXF1aXJlc0xvZGFzaCApIHtcclxuICAgIGZ1bGxTb3VyY2UgPSB0ZXN0TG9kYXNoICsgZnVsbFNvdXJjZTtcclxuICB9XHJcblxyXG4gIC8vIGluY2x1ZGUgZ2xvYmFscyBhc3NpZ25tZW50XHJcbiAgbGV0IGdsb2JhbHMgPSAnd2luZG93LnBoZXQ9d2luZG93LnBoZXR8fHt9XFxuOyc7XHJcbiAgaWYgKCBwYWNrYWdlT2JqZWN0Lm5hbWUgPT09ICdwaGV0LWxpYicgKSB7XHJcbiAgICBnbG9iYWxzICs9IGBwaGV0LmNoaXBwZXI9cGhldC5jaGlwcGVyfHx7fTtcXG5waGV0LmNoaXBwZXIucGFja2FnZU9iamVjdD0ke0pTT04uc3RyaW5naWZ5KCBwYWNrYWdlT2JqZWN0ICl9O1xcbmA7XHJcblxyXG4gICAgY29uc3Qgc3ViUmVwb3MgPSBbICdzY2VuZXJ5JywgJ3N1bicsICdzY2VuZXJ5LXBoZXQnLCAndHdpeHQnLCAnbW9iaXVzJyBdO1xyXG5cclxuICAgIGNvbnN0IHBoZXRMaWJzID0gXy51bmlxKCBfLmZsYXR0ZW4oIHN1YlJlcG9zLm1hcCggc3ViUmVwbyA9PiB7XHJcbiAgICAgIHJldHVybiBnZXRQaGV0TGlicyggc3ViUmVwbyApO1xyXG4gICAgfSApICkuc29ydCgpICk7XHJcbiAgICBjb25zdCBsb2NhbGVzID0gW1xyXG4gICAgICBDaGlwcGVyQ29uc3RhbnRzLkZBTExCQUNLX0xPQ0FMRSxcclxuICAgICAgLi4uXy5mbGF0dGVuKCBzdWJSZXBvcy5tYXAoIHN1YlJlcG8gPT4gZ2V0TG9jYWxlc0Zyb21SZXBvc2l0b3J5KCBzdWJSZXBvICkgKSApXHJcbiAgICBdO1xyXG4gICAgY29uc3QgeyBzdHJpbmdNYXAsIHN0cmluZ01ldGFkYXRhIH0gPSBnZXRTdHJpbmdNYXAoIHJlcG8sIGxvY2FsZXMsIHBoZXRMaWJzLCB3ZWJwYWNrUmVzdWx0LnVzZWRNb2R1bGVzICk7XHJcblxyXG4gICAgZ2xvYmFscyArPSAncGhldC5jaGlwcGVyLnN0cmluZ1BhdGggPSBcXCcuLi9cXCc7XFxuJztcclxuICAgIGdsb2JhbHMgKz0gJ3BoZXQuY2hpcHBlci5sb2NhbGUgPSBcXCdlblxcJztcXG4nO1xyXG4gICAgZ2xvYmFscyArPSAncGhldC5jaGlwcGVyLmxvYWRNb2R1bGVzID0gKCkgPT4ge307XFxuJztcclxuICAgIGdsb2JhbHMgKz0gYHBoZXQuY2hpcHBlci5zdHJpbmdzID0gJHtKU09OLnN0cmluZ2lmeSggc3RyaW5nTWFwLCBudWxsLCBvcHRpb25zLmlzRGVidWcgPyAyIDogJycgKX07XFxuYDtcclxuICAgIGdsb2JhbHMgKz0gYHBoZXQuY2hpcHBlci5zdHJpbmdNZXRhZGF0YSA9ICR7SlNPTi5zdHJpbmdpZnkoIHN0cmluZ01ldGFkYXRhLCBudWxsLCBvcHRpb25zLmlzRGVidWcgPyAyIDogJycgKX07XFxuYDtcclxuICB9XHJcbiAgZnVsbFNvdXJjZSA9IGBcXG4ke2dsb2JhbHN9XFxuJHtmdWxsU291cmNlfWA7XHJcblxyXG4gIC8vIFdyYXAgd2l0aCBhbiBJSUZFXHJcbiAgZnVsbFNvdXJjZSA9IGAoZnVuY3Rpb24oKSB7XFxuJHtmdWxsU291cmNlfVxcbn0oKSk7YDtcclxuXHJcbiAgZnVsbFNvdXJjZSA9IG1pbmlmeSggZnVsbFNvdXJjZSwgb3B0aW9ucyApO1xyXG5cclxuICByZXR1cm4gZnVsbFNvdXJjZTtcclxufTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBRSxRQUFTLENBQUM7QUFDbEMsTUFBTUMsRUFBRSxHQUFHRCxPQUFPLENBQUUsSUFBSyxDQUFDO0FBQzFCLE1BQU1FLEtBQUssR0FBR0YsT0FBTyxDQUFFLE9BQVEsQ0FBQztBQUNoQyxNQUFNRyxNQUFNLEdBQUdILE9BQU8sQ0FBRSxVQUFXLENBQUM7QUFDcEMsTUFBTUksWUFBWSxHQUFHSixPQUFPLENBQUUsZ0JBQWlCLENBQUM7QUFDaEQsTUFBTUssQ0FBQyxHQUFHTCxPQUFPLENBQUUsUUFBUyxDQUFDO0FBQzdCLE1BQU1NLFlBQVksR0FBR04sT0FBTyxDQUFFLGdCQUFpQixDQUFDO0FBQ2hELE1BQU1PLGdCQUFnQixHQUFHUCxPQUFPLENBQUUsNEJBQTZCLENBQUM7QUFDaEUsTUFBTVEsd0JBQXdCLEdBQUdSLE9BQU8sQ0FBRSw0QkFBNkIsQ0FBQztBQUN4RSxNQUFNUyxXQUFXLEdBQUdULE9BQU8sQ0FBRSxlQUFnQixDQUFDOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FVLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHLGdCQUFnQkMsSUFBSSxFQUFFQyxlQUFlLEVBQUc7RUFDdkRkLE1BQU0sQ0FBRSxPQUFPYSxJQUFJLEtBQUssUUFBUyxDQUFDO0VBQ2xDYixNQUFNLENBQUUsT0FBT2MsZUFBZSxLQUFLLFFBQVMsQ0FBQztFQUU3QyxNQUFNQyxPQUFPLEdBQUdULENBQUMsQ0FBQ1UsS0FBSyxDQUFFO0lBQ3ZCQyxPQUFPLEVBQUUsS0FBSztJQUVkO0lBQ0FDLFlBQVksRUFBRSxJQUFJO0lBRWxCO0lBQ0FDLGFBQWEsRUFBRU47RUFDakIsQ0FBQyxFQUFFQyxlQUFnQixDQUFDO0VBRXBCLE1BQU1NLGFBQWEsR0FBR2pCLEtBQUssQ0FBQ2tCLElBQUksQ0FBQ0MsUUFBUSxDQUFHLE1BQUtULElBQUssZUFBZSxDQUFDO0VBQ3RFYixNQUFNLENBQUVvQixhQUFhLENBQUNHLElBQUksRUFBRSx3Q0FBeUMsQ0FBQztFQUV0RSxNQUFNQyxhQUFhLEdBQUssTUFBTW5CLFlBQVksQ0FBRVEsSUFBSSxFQUFFLE1BQU0sRUFBRTtJQUN4RFksU0FBUyxFQUFFVixPQUFPLENBQUNJLGFBQWE7SUFDaENPLGVBQWUsRUFBRVgsT0FBTyxDQUFDVztFQUMzQixDQUFFLENBQUc7RUFFTCxNQUFNQyxTQUFTLEdBQUdILGFBQWEsQ0FBQ0ksRUFBRTtFQUVsQyxJQUFJQyxlQUFlLEdBQUcsQ0FDcEIsd0JBQXdCLEVBQ3hCLCtCQUErQixDQUNoQzs7RUFFRDtFQUNBLElBQUtULGFBQWEsQ0FBQ0csSUFBSSxDQUFDTyxPQUFPLEVBQUc7SUFDaEM5QixNQUFNLENBQUUrQixLQUFLLENBQUNDLE9BQU8sQ0FBRVosYUFBYSxDQUFDRyxJQUFJLENBQUNPLE9BQVEsQ0FBQyxFQUFFLDRCQUE2QixDQUFDO0lBQ25GRCxlQUFlLEdBQUdBLGVBQWUsQ0FBQ0ksTUFBTSxDQUFFYixhQUFhLENBQUNHLElBQUksQ0FBQ08sT0FBUSxDQUFDOztJQUV0RTtJQUNBRCxlQUFlLENBQUNLLE9BQU8sQ0FBRSxDQUFFQyxNQUFNLEVBQUVDLEtBQUssS0FBTTtNQUM1QyxJQUFLRCxNQUFNLENBQUNFLFFBQVEsQ0FBRSxvQkFBcUIsQ0FBQyxFQUFHO1FBQzdDUixlQUFlLENBQUNTLE1BQU0sQ0FBRUYsS0FBSyxFQUFFLENBQUUsQ0FBQztRQUNsQ1AsZUFBZSxDQUFDVSxPQUFPLENBQUVKLE1BQU8sQ0FBQztNQUNuQztJQUNGLENBQUUsQ0FBQztJQUNITixlQUFlLENBQUNLLE9BQU8sQ0FBRSxDQUFFQyxNQUFNLEVBQUVDLEtBQUssS0FBTTtNQUM1QyxJQUFLRCxNQUFNLENBQUNFLFFBQVEsQ0FBRSxvQkFBcUIsQ0FBQyxFQUFHO1FBQzdDUixlQUFlLENBQUNTLE1BQU0sQ0FBRUYsS0FBSyxFQUFFLENBQUUsQ0FBQztRQUNsQ1AsZUFBZSxDQUFDVSxPQUFPLENBQUVKLE1BQU8sQ0FBQztNQUNuQztJQUNGLENBQUUsQ0FBQztFQUNMO0VBQ0EsSUFBS3BCLE9BQU8sQ0FBQ0csWUFBWSxFQUFHO0lBQzFCVyxlQUFlLEdBQUdBLGVBQWUsQ0FBQ1csTUFBTSxDQUFFTCxNQUFNLElBQUksQ0FBQ3BCLE9BQU8sQ0FBQ0csWUFBWSxDQUFDbUIsUUFBUSxDQUFFRixNQUFPLENBQUUsQ0FBQztFQUNoRztFQUVBLElBQUlNLFVBQVUsR0FBR1osZUFBZSxDQUFDYSxHQUFHLENBQUVyQixJQUFJLElBQUluQixFQUFFLENBQUN5QyxZQUFZLENBQUV0QixJQUFJLEVBQUUsTUFBTyxDQUFFLENBQUMsQ0FBQ3VCLElBQUksQ0FBRSxJQUFLLENBQUM7O0VBRTVGO0VBQ0EsTUFBTUMsVUFBVSxHQUFHLDhDQUE4QyxHQUM5Qyw4REFBOEQsR0FDOUQsT0FBTztFQUMxQjtFQUNBLE1BQU1DLFVBQVUsR0FBRyw4Q0FBOEMsR0FDOUMsbURBQW1ELEdBQ25ELE9BQU87RUFFMUIsTUFBTUMsT0FBTyxHQUFHLHVDQUF1QztFQUN2RCxJQUFLaEMsT0FBTyxDQUFDRSxPQUFPLEVBQUc7SUFDckJ3QixVQUFVLElBQUlNLE9BQU87RUFDdkI7RUFFQSxJQUFJQyxVQUFVLEdBQUksR0FBRVAsVUFBVyxLQUFJZCxTQUFVLEVBQUM7RUFDOUMsSUFBS1AsYUFBYSxDQUFDRyxJQUFJLENBQUMwQixjQUFjLEVBQUc7SUFDdkNELFVBQVUsR0FBR0YsVUFBVSxHQUFHRSxVQUFVO0VBQ3RDO0VBQ0EsSUFBSzVCLGFBQWEsQ0FBQ0csSUFBSSxDQUFDMkIsY0FBYyxFQUFHO0lBQ3ZDRixVQUFVLEdBQUdILFVBQVUsR0FBR0csVUFBVTtFQUN0Qzs7RUFFQTtFQUNBLElBQUlHLE9BQU8sR0FBRyxnQ0FBZ0M7RUFDOUMsSUFBSy9CLGFBQWEsQ0FBQ2dDLElBQUksS0FBSyxVQUFVLEVBQUc7SUFDdkNELE9BQU8sSUFBSyw4REFBNkRFLElBQUksQ0FBQ0MsU0FBUyxDQUFFbEMsYUFBYyxDQUFFLEtBQUk7SUFFN0csTUFBTW1DLFFBQVEsR0FBRyxDQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUU7SUFFeEUsTUFBTUMsUUFBUSxHQUFHbEQsQ0FBQyxDQUFDbUQsSUFBSSxDQUFFbkQsQ0FBQyxDQUFDb0QsT0FBTyxDQUFFSCxRQUFRLENBQUNiLEdBQUcsQ0FBRWlCLE9BQU8sSUFBSTtNQUMzRCxPQUFPakQsV0FBVyxDQUFFaUQsT0FBUSxDQUFDO0lBQy9CLENBQUUsQ0FBRSxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUFFLENBQUM7SUFDZCxNQUFNQyxPQUFPLEdBQUcsQ0FDZHJELGdCQUFnQixDQUFDc0QsZUFBZSxFQUNoQyxHQUFHeEQsQ0FBQyxDQUFDb0QsT0FBTyxDQUFFSCxRQUFRLENBQUNiLEdBQUcsQ0FBRWlCLE9BQU8sSUFBSWxELHdCQUF3QixDQUFFa0QsT0FBUSxDQUFFLENBQUUsQ0FBQyxDQUMvRTtJQUNELE1BQU07TUFBRUksU0FBUztNQUFFQztJQUFlLENBQUMsR0FBR3pELFlBQVksQ0FBRU0sSUFBSSxFQUFFZ0QsT0FBTyxFQUFFTCxRQUFRLEVBQUVoQyxhQUFhLENBQUN5QyxXQUFZLENBQUM7SUFFeEdkLE9BQU8sSUFBSSxzQ0FBc0M7SUFDakRBLE9BQU8sSUFBSSxpQ0FBaUM7SUFDNUNBLE9BQU8sSUFBSSx3Q0FBd0M7SUFDbkRBLE9BQU8sSUFBSywwQkFBeUJFLElBQUksQ0FBQ0MsU0FBUyxDQUFFUyxTQUFTLEVBQUUsSUFBSSxFQUFFaEQsT0FBTyxDQUFDRSxPQUFPLEdBQUcsQ0FBQyxHQUFHLEVBQUcsQ0FBRSxLQUFJO0lBQ3JHa0MsT0FBTyxJQUFLLGlDQUFnQ0UsSUFBSSxDQUFDQyxTQUFTLENBQUVVLGNBQWMsRUFBRSxJQUFJLEVBQUVqRCxPQUFPLENBQUNFLE9BQU8sR0FBRyxDQUFDLEdBQUcsRUFBRyxDQUFFLEtBQUk7RUFDbkg7RUFDQStCLFVBQVUsR0FBSSxLQUFJRyxPQUFRLEtBQUlILFVBQVcsRUFBQzs7RUFFMUM7RUFDQUEsVUFBVSxHQUFJLGtCQUFpQkEsVUFBVyxTQUFRO0VBRWxEQSxVQUFVLEdBQUc1QyxNQUFNLENBQUU0QyxVQUFVLEVBQUVqQyxPQUFRLENBQUM7RUFFMUMsT0FBT2lDLFVBQVU7QUFDbkIsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==