// Copyright 2018-2024, University of Colorado Boulder

/**
 * white noise generator with optional low- and high-pass filters
 *
 * @author John Blanco
 */

import dotRandom from '../../../dot/js/dotRandom.js';
import optionize from '../../../phet-core/js/optionize.js';
import audioContextStateChangeMonitor from '../audioContextStateChangeMonitor.js';
import soundConstants from '../soundConstants.js';
import tambo from '../tambo.js';
import SoundGenerator from './SoundGenerator.js';
// constants
const NOISE_BUFFER_SECONDS = 2;
const PARAMETER_CHANGE_TIME_CONSTANT = soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT;
const LFO_DEPTH_CHANGE_TIME_CONSTANT = 0.05;
class NoiseGenerator extends SoundGenerator {
  // filter that is potentially used on the noise signal

  // buffer that holds the noise samples

  // the source node from which the noise is played, set when play is called

  // the low frequency oscillator that can be used to do amplitude modulation on the noise signal

  // gain node that is used to implement amplitude modulation

  // gain node that controls the amount of low-frequency amplitude modulation

  // point where the noise source connects

  // flag that indicates whether the noise is playing

  // time at which a play request occurred that couldn't be performed and was subsequently deferred

  // function that handles changes to the audio context

  constructor(providedOptions) {
    const options = optionize()({
      noiseType: 'pink',
      lowPassCutoffFrequency: null,
      highPassCutoffFrequency: null,
      centerFrequency: null,
      qFactor: 1,
      lfoInitiallyEnabled: false,
      lfoInitialFrequency: 2,
      lfoInitialDepth: 1,
      lfoType: 'sine'
    }, providedOptions);
    assert && assert(['white', 'pink', 'brown'].includes(options.noiseType), `invalid noise type: ${options.noiseType}`);
    assert && assert(options.lfoInitialDepth >= 0 && options.lfoInitialDepth <= 1, `invalid value for lfoInitialDepth: ${options.lfoInitialDepth}`);
    super(options);
    const now = this.audioContext.currentTime;

    // if specified, create the low-pass filter
    let lowPassFilter;
    if (options.lowPassCutoffFrequency) {
      lowPassFilter = this.audioContext.createBiquadFilter();
      lowPassFilter.type = 'lowpass';
      lowPassFilter.frequency.setValueAtTime(options.lowPassCutoffFrequency, now);
    }

    // if specified, create the high-pass filter
    let highPassFilter;
    if (options.highPassCutoffFrequency) {
      highPassFilter = this.audioContext.createBiquadFilter();
      highPassFilter.type = 'highpass';
      highPassFilter.frequency.setValueAtTime(options.highPassCutoffFrequency, now);
    }

    // if specified, create the band-pass filter
    if (options.qFactor && options.centerFrequency) {
      this.bandPassFilter = this.audioContext.createBiquadFilter();
      this.bandPassFilter.type = 'bandpass';
      this.bandPassFilter.frequency.setValueAtTime(options.centerFrequency, now);
      this.bandPassFilter.Q.setValueAtTime(options.qFactor, now);
    } else {
      this.bandPassFilter = null;
    }

    // define the noise data
    const noiseBufferSize = NOISE_BUFFER_SECONDS * this.audioContext.sampleRate;
    this.noiseBuffer = this.audioContext.createBuffer(1, noiseBufferSize, this.audioContext.sampleRate);
    const data = this.noiseBuffer.getChannelData(0);

    // fill in the sample buffer based on the noise type
    let white;
    if (options.noiseType === 'white') {
      for (let i = 0; i < noiseBufferSize; i++) {
        data[i] = dotRandom.nextDouble() * 2 - 1;
      }
    } else if (options.noiseType === 'pink') {
      let b0 = 0;
      let b1 = 0;
      let b2 = 0;
      let b3 = 0;
      let b4 = 0;
      let b5 = 0;
      let b6 = 0;
      for (let i = 0; i < noiseBufferSize; i++) {
        white = dotRandom.nextDouble() * 2 - 1;
        b0 = 0.99886 * b0 + white * 0.0555179;
        b1 = 0.99332 * b1 + white * 0.0750759;
        b2 = 0.96900 * b2 + white * 0.1538520;
        b3 = 0.86650 * b3 + white * 0.3104856;
        b4 = 0.55000 * b4 + white * 0.5329522;
        b5 = -0.7616 * b5 - white * 0.0168980;
        data[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
        data[i] *= 0.11; // adjust to 0dB, empirically determined, will be approximate due to randomness of data
        b6 = white * 0.115926;
      }
    } else if (options.noiseType === 'brown') {
      let lastOut = 0;
      for (let i = 0; i < noiseBufferSize; i++) {
        white = dotRandom.nextDouble() * 2 - 1;
        data[i] = (lastOut + 0.02 * white) / 1.02;
        lastOut = data[i];
        data[i] *= 3.5; // adjust to 0dB, empirically determined, will be approximate due to randomness of data
      }
    } else {
      throw new Error(`unexpected value for noiseType: ${options.noiseType}`);
    }

    // the source node from which the noise is played, set when play is called
    this.noiseSource = null;

    // set up the low frequency oscillator (LFO) for amplitude modulation
    this.lfo = this.audioContext.createOscillator();
    this.lfo.type = options.lfoType;

    // initialize LFO frequency, updated through methods defined below
    this.lfo.frequency.setValueAtTime(options.lfoInitialFrequency, now);
    this.lfo.start();

    // set up the gain stage that will attenuate the LFO output so that it will range from -0.5 to +0.5
    this.lfoAttenuatorGainNode = this.audioContext.createGain();
    this.lfoAttenuatorGainNode.gain.value = options.lfoInitialDepth / 2;
    this.lfo.connect(this.lfoAttenuatorGainNode);

    // set up the gain stage for the LFO - the main sound path will run through here
    this.lfoControlledGainNode = this.audioContext.createGain();
    this.lfoControlledGainNode.gain.value = 0.5; // this value is added to the attenuated LFO output value

    // set the initial enabled state of the LFO
    if (options.lfoInitiallyEnabled) {
      this.lfoAttenuatorGainNode.gain.setTargetAtTime(0.5, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
      this.lfoAttenuatorGainNode.connect(this.lfoControlledGainNode.gain);
    } else {
      this.lfoAttenuatorGainNode.gain.setTargetAtTime(1, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
    }

    // wire up the audio path, working our way from the output back to the sound source(s)
    this.lfoControlledGainNode.connect(this.soundSourceDestination);
    let nextOutputToConnect = this.lfoControlledGainNode;
    if (highPassFilter) {
      highPassFilter.connect(nextOutputToConnect);
      nextOutputToConnect = highPassFilter;
    }
    if (lowPassFilter) {
      lowPassFilter.connect(nextOutputToConnect);
      nextOutputToConnect = lowPassFilter;
    }
    if (this.bandPassFilter) {
      this.bandPassFilter.connect(nextOutputToConnect);
      nextOutputToConnect = this.bandPassFilter;
    }
    this.noiseSourceConnectionPoint = nextOutputToConnect;
    this._isPlaying = false;
    this.timeOfDeferredStartRequest = Number.NEGATIVE_INFINITY;

    // define the listener for audio context state transitions
    this.audioContextStateChangeListener = state => {
      if (state === 'running' && this._isPlaying) {
        this.start();

        // automatically remove after firing
        audioContextStateChangeMonitor.removeStateChangeListener(this.audioContext, this.audioContextStateChangeListener);
      }
    };
  }

  /**
   * Get a value that indicates whether noise is currently being played.
   */
  get isPlaying() {
    return this._isPlaying;
  }

  /**
   * Start the noise source.
   * @param [delay] - optional delay for when to start the noise source, in seconds
   */
  start(delay = 0) {
    if (this.audioContext.state === 'running') {
      const now = this.audioContext.currentTime;

      // only do something if not already playing, otherwise ignore this request
      if (!this._isPlaying) {
        this.noiseSource = this.audioContext.createBufferSource();
        this.noiseSource.buffer = this.noiseBuffer;
        this.noiseSource.loop = true;
        this.noiseSource.connect(this.noiseSourceConnectionPoint);
        this.noiseSource.start(now + delay);
      }
    } else {
      // This method was called when the audio context was not yet running, so add a listener to start if and when the
      // audio context state changes.
      this.timeOfDeferredStartRequest = Date.now();
      if (!audioContextStateChangeMonitor.hasListener(this.audioContext, this.audioContextStateChangeListener)) {
        audioContextStateChangeMonitor.addStateChangeListener(this.audioContext, this.audioContextStateChangeListener);
      }
    }

    // set the flag even if the start is deferred, since it is used to decide whether to do a deferred start
    this._isPlaying = true;
  }

  /**
   * Stop the noise source.
   * @param [time] - optional audio context time at which this should be stopped
   */
  stop(time = 0) {
    // only stop if playing, otherwise ignore
    if (this._isPlaying && this.noiseSource) {
      this.noiseSource.stop(time);
      this.noiseSource = null;
    }
    this._isPlaying = false;
  }

  /**
   * Set the frequency of the low frequency amplitude modulator (LFO).
   */
  setLfoFrequency(frequency) {
    this.lfo.frequency.setTargetAtTime(frequency, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
  }

  /**
   * Set the depth of the LFO modulator.
   * @param depth - depth value from 0 (no modulation) to 1 (max modulation)
   */
  setLfoDepth(depth) {
    this.lfoAttenuatorGainNode.gain.setTargetAtTime(depth / 2, this.audioContext.currentTime, LFO_DEPTH_CHANGE_TIME_CONSTANT);
  }

  /**
   * Turn the low frequency amplitude modulation on/off.
   */
  setLfoEnabled(enabled) {
    if (enabled) {
      this.lfoAttenuatorGainNode.gain.setTargetAtTime(0.5, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
      this.lfoAttenuatorGainNode.connect(this.lfoControlledGainNode.gain);
    } else {
      this.lfoAttenuatorGainNode.disconnect(this.lfoControlledGainNode.gain);
      this.lfoAttenuatorGainNode.gain.setTargetAtTime(1, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
    }
  }

  /**
   * set the Q value for the band pass filter, assumes that noise generator was created with this filter enabled
   */
  setBandpassFilterCenterFrequency(frequency, timeConstant = PARAMETER_CHANGE_TIME_CONSTANT) {
    if (this.bandPassFilter !== null) {
      this.bandPassFilter.frequency.setTargetAtTime(frequency, this.audioContext.currentTime, timeConstant);
    }
  }
}
tambo.register('NoiseGenerator', NoiseGenerator);
export default NoiseGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJvcHRpb25pemUiLCJhdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IiLCJzb3VuZENvbnN0YW50cyIsInRhbWJvIiwiU291bmRHZW5lcmF0b3IiLCJOT0lTRV9CVUZGRVJfU0VDT05EUyIsIlBBUkFNRVRFUl9DSEFOR0VfVElNRV9DT05TVEFOVCIsIkRFRkFVTFRfUEFSQU1fQ0hBTkdFX1RJTUVfQ09OU1RBTlQiLCJMRk9fREVQVEhfQ0hBTkdFX1RJTUVfQ09OU1RBTlQiLCJOb2lzZUdlbmVyYXRvciIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsIm5vaXNlVHlwZSIsImxvd1Bhc3NDdXRvZmZGcmVxdWVuY3kiLCJoaWdoUGFzc0N1dG9mZkZyZXF1ZW5jeSIsImNlbnRlckZyZXF1ZW5jeSIsInFGYWN0b3IiLCJsZm9Jbml0aWFsbHlFbmFibGVkIiwibGZvSW5pdGlhbEZyZXF1ZW5jeSIsImxmb0luaXRpYWxEZXB0aCIsImxmb1R5cGUiLCJhc3NlcnQiLCJpbmNsdWRlcyIsIm5vdyIsImF1ZGlvQ29udGV4dCIsImN1cnJlbnRUaW1lIiwibG93UGFzc0ZpbHRlciIsImNyZWF0ZUJpcXVhZEZpbHRlciIsInR5cGUiLCJmcmVxdWVuY3kiLCJzZXRWYWx1ZUF0VGltZSIsImhpZ2hQYXNzRmlsdGVyIiwiYmFuZFBhc3NGaWx0ZXIiLCJRIiwibm9pc2VCdWZmZXJTaXplIiwic2FtcGxlUmF0ZSIsIm5vaXNlQnVmZmVyIiwiY3JlYXRlQnVmZmVyIiwiZGF0YSIsImdldENoYW5uZWxEYXRhIiwid2hpdGUiLCJpIiwibmV4dERvdWJsZSIsImIwIiwiYjEiLCJiMiIsImIzIiwiYjQiLCJiNSIsImI2IiwibGFzdE91dCIsIkVycm9yIiwibm9pc2VTb3VyY2UiLCJsZm8iLCJjcmVhdGVPc2NpbGxhdG9yIiwic3RhcnQiLCJsZm9BdHRlbnVhdG9yR2Fpbk5vZGUiLCJjcmVhdGVHYWluIiwiZ2FpbiIsInZhbHVlIiwiY29ubmVjdCIsImxmb0NvbnRyb2xsZWRHYWluTm9kZSIsInNldFRhcmdldEF0VGltZSIsInNvdW5kU291cmNlRGVzdGluYXRpb24iLCJuZXh0T3V0cHV0VG9Db25uZWN0Iiwibm9pc2VTb3VyY2VDb25uZWN0aW9uUG9pbnQiLCJfaXNQbGF5aW5nIiwidGltZU9mRGVmZXJyZWRTdGFydFJlcXVlc3QiLCJOdW1iZXIiLCJORUdBVElWRV9JTkZJTklUWSIsImF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTGlzdGVuZXIiLCJzdGF0ZSIsInJlbW92ZVN0YXRlQ2hhbmdlTGlzdGVuZXIiLCJpc1BsYXlpbmciLCJkZWxheSIsImNyZWF0ZUJ1ZmZlclNvdXJjZSIsImJ1ZmZlciIsImxvb3AiLCJEYXRlIiwiaGFzTGlzdGVuZXIiLCJhZGRTdGF0ZUNoYW5nZUxpc3RlbmVyIiwic3RvcCIsInRpbWUiLCJzZXRMZm9GcmVxdWVuY3kiLCJzZXRMZm9EZXB0aCIsImRlcHRoIiwic2V0TGZvRW5hYmxlZCIsImVuYWJsZWQiLCJkaXNjb25uZWN0Iiwic2V0QmFuZHBhc3NGaWx0ZXJDZW50ZXJGcmVxdWVuY3kiLCJ0aW1lQ29uc3RhbnQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk5vaXNlR2VuZXJhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIHdoaXRlIG5vaXNlIGdlbmVyYXRvciB3aXRoIG9wdGlvbmFsIGxvdy0gYW5kIGhpZ2gtcGFzcyBmaWx0ZXJzXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICovXHJcblxyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgYXVkaW9Db250ZXh0U3RhdGVDaGFuZ2VNb25pdG9yIGZyb20gJy4uL2F1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTW9uaXRvci5qcyc7XHJcbmltcG9ydCBzb3VuZENvbnN0YW50cyBmcm9tICcuLi9zb3VuZENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCB0YW1ibyBmcm9tICcuLi90YW1iby5qcyc7XHJcbmltcG9ydCBTb3VuZEdlbmVyYXRvciwgeyBTb3VuZEdlbmVyYXRvck9wdGlvbnMgfSBmcm9tICcuL1NvdW5kR2VuZXJhdG9yLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgbm9pc2VUeXBlPzogJ3BpbmsnIHwgJ3doaXRlJyB8ICdicm93bic7XHJcblxyXG4gIC8vIGxvdyBwYXNzIHZhbHVlIGluIEh6LCBudWxsIChvciBhbnkgZmFsc2V5IHZhbHVlIGluY2x1ZGluZyB6ZXJvKSBtZWFucyBubyBsb3cgcGFzcyBmaWx0ZXIgaXMgYWRkZWRcclxuICBsb3dQYXNzQ3V0b2ZmRnJlcXVlbmN5PzogbnVtYmVyIHwgbnVsbDtcclxuXHJcbiAgLy8gaGlnaCBwYXNzIHZhbHVlIGluIEh6LCBudWxsIChvciBhbnkgZmFsc2V5IHZhbHVlIGluY2x1ZGluZyB6ZXJvKSBtZWFucyBubyBoaWdoIHBhc3MgZmlsdGVyIGlzIGFkZGVkXHJcbiAgaGlnaFBhc3NDdXRvZmZGcmVxdWVuY3k/OiBudW1iZXIgfCBudWxsO1xyXG5cclxuICAvLyBjZW50ZXIgZnJlcXVlbmN5IGZvciBiYW5kIHBhc3MgZmlsdGVyIHZhbHVlIGluIEh6LCBudWxsIChvciBhbnkgZmFsc2V5IHZhbHVlIGluY2x1ZGluZyB6ZXJvKSBtZWFucyBubyBiYW5kIHBhc3NcclxuICAvLyBmaWx0ZXIgaXMgYWRkZWRcclxuICBjZW50ZXJGcmVxdWVuY3k/OiBudW1iZXIgfCBudWxsO1xyXG5cclxuICAvLyBRIGZhY3RvciwgYWthIHF1YWxpdHkgZmFjdG9yLCBmb3IgYmFuZHBhc3MgZmlsdGVyIGlmIHByZXNlbnQsIHNlZSBXZWIgQXVkaW8gQmlxdWFkRmlsdGVyTm9kZSBmb3IgbW9yZSBpbmZvcm1hdGlvblxyXG4gIHFGYWN0b3I/OiBudW1iZXI7XHJcblxyXG4gIC8vIHBhcmFtZXRlcnMgdGhhdCBjb250cm9sIHRoZSBiZWhhdmlvciBvZiB0aGUgbG93IGZyZXF1ZW5jeSBvc2NpbGxhdG9yIChMRk8pLCB3aGljaCBkb2VzIGFtcGxpdHVkZSBtb2R1bGF0aW9uIG9uXHJcbiAgLy8gdGhlIG5vaXNlXHJcbiAgbGZvSW5pdGlhbGx5RW5hYmxlZD86IGJvb2xlYW47XHJcbiAgbGZvSW5pdGlhbEZyZXF1ZW5jeT86IG51bWJlcjsgLy8gaW4gSHpcclxuICBsZm9Jbml0aWFsRGVwdGg/OiBudW1iZXI7IC8vIHZhbGlkIHZhbHVlcyBhcmUgZnJvbSAwIHRvIDFcclxuICBsZm9UeXBlPzogT3NjaWxsYXRvclR5cGU7XHJcbn07XHJcbmV4cG9ydCB0eXBlIE5vaXNlR2VuZXJhdG9yT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU291bmRHZW5lcmF0b3JPcHRpb25zO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE5PSVNFX0JVRkZFUl9TRUNPTkRTID0gMjtcclxuY29uc3QgUEFSQU1FVEVSX0NIQU5HRV9USU1FX0NPTlNUQU5UID0gc291bmRDb25zdGFudHMuREVGQVVMVF9QQVJBTV9DSEFOR0VfVElNRV9DT05TVEFOVDtcclxuY29uc3QgTEZPX0RFUFRIX0NIQU5HRV9USU1FX0NPTlNUQU5UID0gMC4wNTtcclxuXHJcbmNsYXNzIE5vaXNlR2VuZXJhdG9yIGV4dGVuZHMgU291bmRHZW5lcmF0b3Ige1xyXG5cclxuICAvLyBmaWx0ZXIgdGhhdCBpcyBwb3RlbnRpYWxseSB1c2VkIG9uIHRoZSBub2lzZSBzaWduYWxcclxuICBwcml2YXRlIHJlYWRvbmx5IGJhbmRQYXNzRmlsdGVyOiBCaXF1YWRGaWx0ZXJOb2RlIHwgbnVsbDtcclxuXHJcbiAgLy8gYnVmZmVyIHRoYXQgaG9sZHMgdGhlIG5vaXNlIHNhbXBsZXNcclxuICBwcml2YXRlIHJlYWRvbmx5IG5vaXNlQnVmZmVyOiBBdWRpb0J1ZmZlcjtcclxuXHJcbiAgLy8gdGhlIHNvdXJjZSBub2RlIGZyb20gd2hpY2ggdGhlIG5vaXNlIGlzIHBsYXllZCwgc2V0IHdoZW4gcGxheSBpcyBjYWxsZWRcclxuICBwcml2YXRlIG5vaXNlU291cmNlOiBBdWRpb0J1ZmZlclNvdXJjZU5vZGUgfCBudWxsO1xyXG5cclxuICAvLyB0aGUgbG93IGZyZXF1ZW5jeSBvc2NpbGxhdG9yIHRoYXQgY2FuIGJlIHVzZWQgdG8gZG8gYW1wbGl0dWRlIG1vZHVsYXRpb24gb24gdGhlIG5vaXNlIHNpZ25hbFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbGZvOiBPc2NpbGxhdG9yTm9kZTtcclxuXHJcbiAgLy8gZ2FpbiBub2RlIHRoYXQgaXMgdXNlZCB0byBpbXBsZW1lbnQgYW1wbGl0dWRlIG1vZHVsYXRpb25cclxuICBwcml2YXRlIHJlYWRvbmx5IGxmb0F0dGVudWF0b3JHYWluTm9kZTogR2Fpbk5vZGU7XHJcblxyXG4gIC8vIGdhaW4gbm9kZSB0aGF0IGNvbnRyb2xzIHRoZSBhbW91bnQgb2YgbG93LWZyZXF1ZW5jeSBhbXBsaXR1ZGUgbW9kdWxhdGlvblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbGZvQ29udHJvbGxlZEdhaW5Ob2RlOiBHYWluTm9kZTtcclxuXHJcbiAgLy8gcG9pbnQgd2hlcmUgdGhlIG5vaXNlIHNvdXJjZSBjb25uZWN0c1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbm9pc2VTb3VyY2VDb25uZWN0aW9uUG9pbnQ6IEF1ZGlvTm9kZTtcclxuXHJcbiAgLy8gZmxhZyB0aGF0IGluZGljYXRlcyB3aGV0aGVyIHRoZSBub2lzZSBpcyBwbGF5aW5nXHJcbiAgcHJpdmF0ZSBfaXNQbGF5aW5nOiBib29sZWFuO1xyXG5cclxuICAvLyB0aW1lIGF0IHdoaWNoIGEgcGxheSByZXF1ZXN0IG9jY3VycmVkIHRoYXQgY291bGRuJ3QgYmUgcGVyZm9ybWVkIGFuZCB3YXMgc3Vic2VxdWVudGx5IGRlZmVycmVkXHJcbiAgcHJpdmF0ZSB0aW1lT2ZEZWZlcnJlZFN0YXJ0UmVxdWVzdDogbnVtYmVyO1xyXG5cclxuICAvLyBmdW5jdGlvbiB0aGF0IGhhbmRsZXMgY2hhbmdlcyB0byB0aGUgYXVkaW8gY29udGV4dFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgYXVkaW9Db250ZXh0U3RhdGVDaGFuZ2VMaXN0ZW5lcjogKCBzdGF0ZTogc3RyaW5nICkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBOb2lzZUdlbmVyYXRvck9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxOb2lzZUdlbmVyYXRvck9wdGlvbnMsIFNlbGZPcHRpb25zLCBTb3VuZEdlbmVyYXRvck9wdGlvbnM+KCkoIHtcclxuICAgICAgbm9pc2VUeXBlOiAncGluaycsXHJcbiAgICAgIGxvd1Bhc3NDdXRvZmZGcmVxdWVuY3k6IG51bGwsXHJcbiAgICAgIGhpZ2hQYXNzQ3V0b2ZmRnJlcXVlbmN5OiBudWxsLFxyXG4gICAgICBjZW50ZXJGcmVxdWVuY3k6IG51bGwsXHJcbiAgICAgIHFGYWN0b3I6IDEsXHJcbiAgICAgIGxmb0luaXRpYWxseUVuYWJsZWQ6IGZhbHNlLFxyXG4gICAgICBsZm9Jbml0aWFsRnJlcXVlbmN5OiAyLFxyXG4gICAgICBsZm9Jbml0aWFsRGVwdGg6IDEsXHJcbiAgICAgIGxmb1R5cGU6ICdzaW5lJ1xyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydChcclxuICAgICAgWyAnd2hpdGUnLCAncGluaycsICdicm93bicgXS5pbmNsdWRlcyggb3B0aW9ucy5ub2lzZVR5cGUgKSxcclxuICAgICAgYGludmFsaWQgbm9pc2UgdHlwZTogJHtvcHRpb25zLm5vaXNlVHlwZX1gXHJcbiAgICApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoXHJcbiAgICBvcHRpb25zLmxmb0luaXRpYWxEZXB0aCA+PSAwICYmIG9wdGlvbnMubGZvSW5pdGlhbERlcHRoIDw9IDEsXHJcbiAgICAgIGBpbnZhbGlkIHZhbHVlIGZvciBsZm9Jbml0aWFsRGVwdGg6ICR7b3B0aW9ucy5sZm9Jbml0aWFsRGVwdGh9YFxyXG4gICAgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IG5vdyA9IHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lO1xyXG5cclxuICAgIC8vIGlmIHNwZWNpZmllZCwgY3JlYXRlIHRoZSBsb3ctcGFzcyBmaWx0ZXJcclxuICAgIGxldCBsb3dQYXNzRmlsdGVyO1xyXG4gICAgaWYgKCBvcHRpb25zLmxvd1Bhc3NDdXRvZmZGcmVxdWVuY3kgKSB7XHJcbiAgICAgIGxvd1Bhc3NGaWx0ZXIgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTtcclxuICAgICAgbG93UGFzc0ZpbHRlci50eXBlID0gJ2xvd3Bhc3MnO1xyXG4gICAgICBsb3dQYXNzRmlsdGVyLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSggb3B0aW9ucy5sb3dQYXNzQ3V0b2ZmRnJlcXVlbmN5LCBub3cgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpZiBzcGVjaWZpZWQsIGNyZWF0ZSB0aGUgaGlnaC1wYXNzIGZpbHRlclxyXG4gICAgbGV0IGhpZ2hQYXNzRmlsdGVyO1xyXG4gICAgaWYgKCBvcHRpb25zLmhpZ2hQYXNzQ3V0b2ZmRnJlcXVlbmN5ICkge1xyXG4gICAgICBoaWdoUGFzc0ZpbHRlciA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUJpcXVhZEZpbHRlcigpO1xyXG4gICAgICBoaWdoUGFzc0ZpbHRlci50eXBlID0gJ2hpZ2hwYXNzJztcclxuICAgICAgaGlnaFBhc3NGaWx0ZXIuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKCBvcHRpb25zLmhpZ2hQYXNzQ3V0b2ZmRnJlcXVlbmN5LCBub3cgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpZiBzcGVjaWZpZWQsIGNyZWF0ZSB0aGUgYmFuZC1wYXNzIGZpbHRlclxyXG4gICAgaWYgKCBvcHRpb25zLnFGYWN0b3IgJiYgb3B0aW9ucy5jZW50ZXJGcmVxdWVuY3kgKSB7XHJcbiAgICAgIHRoaXMuYmFuZFBhc3NGaWx0ZXIgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTtcclxuICAgICAgdGhpcy5iYW5kUGFzc0ZpbHRlci50eXBlID0gJ2JhbmRwYXNzJztcclxuICAgICAgdGhpcy5iYW5kUGFzc0ZpbHRlci5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoIG9wdGlvbnMuY2VudGVyRnJlcXVlbmN5LCBub3cgKTtcclxuICAgICAgdGhpcy5iYW5kUGFzc0ZpbHRlci5RLnNldFZhbHVlQXRUaW1lKCBvcHRpb25zLnFGYWN0b3IsIG5vdyApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuYmFuZFBhc3NGaWx0ZXIgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGRlZmluZSB0aGUgbm9pc2UgZGF0YVxyXG4gICAgY29uc3Qgbm9pc2VCdWZmZXJTaXplID0gTk9JU0VfQlVGRkVSX1NFQ09ORFMgKiB0aGlzLmF1ZGlvQ29udGV4dC5zYW1wbGVSYXRlO1xyXG4gICAgdGhpcy5ub2lzZUJ1ZmZlciA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUJ1ZmZlciggMSwgbm9pc2VCdWZmZXJTaXplLCB0aGlzLmF1ZGlvQ29udGV4dC5zYW1wbGVSYXRlICk7XHJcbiAgICBjb25zdCBkYXRhID0gdGhpcy5ub2lzZUJ1ZmZlci5nZXRDaGFubmVsRGF0YSggMCApO1xyXG5cclxuICAgIC8vIGZpbGwgaW4gdGhlIHNhbXBsZSBidWZmZXIgYmFzZWQgb24gdGhlIG5vaXNlIHR5cGVcclxuICAgIGxldCB3aGl0ZTtcclxuICAgIGlmICggb3B0aW9ucy5ub2lzZVR5cGUgPT09ICd3aGl0ZScgKSB7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG5vaXNlQnVmZmVyU2l6ZTsgaSsrICkge1xyXG4gICAgICAgIGRhdGFbIGkgXSA9IGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiAyIC0gMTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIG9wdGlvbnMubm9pc2VUeXBlID09PSAncGluaycgKSB7XHJcbiAgICAgIGxldCBiMCA9IDA7XHJcbiAgICAgIGxldCBiMSA9IDA7XHJcbiAgICAgIGxldCBiMiA9IDA7XHJcbiAgICAgIGxldCBiMyA9IDA7XHJcbiAgICAgIGxldCBiNCA9IDA7XHJcbiAgICAgIGxldCBiNSA9IDA7XHJcbiAgICAgIGxldCBiNiA9IDA7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG5vaXNlQnVmZmVyU2l6ZTsgaSsrICkge1xyXG4gICAgICAgIHdoaXRlID0gZG90UmFuZG9tLm5leHREb3VibGUoKSAqIDIgLSAxO1xyXG4gICAgICAgIGIwID0gMC45OTg4NiAqIGIwICsgd2hpdGUgKiAwLjA1NTUxNzk7XHJcbiAgICAgICAgYjEgPSAwLjk5MzMyICogYjEgKyB3aGl0ZSAqIDAuMDc1MDc1OTtcclxuICAgICAgICBiMiA9IDAuOTY5MDAgKiBiMiArIHdoaXRlICogMC4xNTM4NTIwO1xyXG4gICAgICAgIGIzID0gMC44NjY1MCAqIGIzICsgd2hpdGUgKiAwLjMxMDQ4NTY7XHJcbiAgICAgICAgYjQgPSAwLjU1MDAwICogYjQgKyB3aGl0ZSAqIDAuNTMyOTUyMjtcclxuICAgICAgICBiNSA9IC0wLjc2MTYgKiBiNSAtIHdoaXRlICogMC4wMTY4OTgwO1xyXG4gICAgICAgIGRhdGFbIGkgXSA9IGIwICsgYjEgKyBiMiArIGIzICsgYjQgKyBiNSArIGI2ICsgd2hpdGUgKiAwLjUzNjI7XHJcbiAgICAgICAgZGF0YVsgaSBdICo9IDAuMTE7IC8vIGFkanVzdCB0byAwZEIsIGVtcGlyaWNhbGx5IGRldGVybWluZWQsIHdpbGwgYmUgYXBwcm94aW1hdGUgZHVlIHRvIHJhbmRvbW5lc3Mgb2YgZGF0YVxyXG4gICAgICAgIGI2ID0gd2hpdGUgKiAwLjExNTkyNjtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIG9wdGlvbnMubm9pc2VUeXBlID09PSAnYnJvd24nICkge1xyXG4gICAgICBsZXQgbGFzdE91dCA9IDA7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG5vaXNlQnVmZmVyU2l6ZTsgaSsrICkge1xyXG4gICAgICAgIHdoaXRlID0gZG90UmFuZG9tLm5leHREb3VibGUoKSAqIDIgLSAxO1xyXG4gICAgICAgIGRhdGFbIGkgXSA9ICggbGFzdE91dCArICggMC4wMiAqIHdoaXRlICkgKSAvIDEuMDI7XHJcbiAgICAgICAgbGFzdE91dCA9IGRhdGFbIGkgXTtcclxuICAgICAgICBkYXRhWyBpIF0gKj0gMy41OyAvLyBhZGp1c3QgdG8gMGRCLCBlbXBpcmljYWxseSBkZXRlcm1pbmVkLCB3aWxsIGJlIGFwcHJveGltYXRlIGR1ZSB0byByYW5kb21uZXNzIG9mIGRhdGFcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvciggYHVuZXhwZWN0ZWQgdmFsdWUgZm9yIG5vaXNlVHlwZTogJHtvcHRpb25zLm5vaXNlVHlwZX1gICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdGhlIHNvdXJjZSBub2RlIGZyb20gd2hpY2ggdGhlIG5vaXNlIGlzIHBsYXllZCwgc2V0IHdoZW4gcGxheSBpcyBjYWxsZWRcclxuICAgIHRoaXMubm9pc2VTb3VyY2UgPSBudWxsO1xyXG5cclxuICAgIC8vIHNldCB1cCB0aGUgbG93IGZyZXF1ZW5jeSBvc2NpbGxhdG9yIChMRk8pIGZvciBhbXBsaXR1ZGUgbW9kdWxhdGlvblxyXG4gICAgdGhpcy5sZm8gPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVPc2NpbGxhdG9yKCk7XHJcbiAgICB0aGlzLmxmby50eXBlID0gb3B0aW9ucy5sZm9UeXBlO1xyXG5cclxuICAgIC8vIGluaXRpYWxpemUgTEZPIGZyZXF1ZW5jeSwgdXBkYXRlZCB0aHJvdWdoIG1ldGhvZHMgZGVmaW5lZCBiZWxvd1xyXG4gICAgdGhpcy5sZm8uZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKCBvcHRpb25zLmxmb0luaXRpYWxGcmVxdWVuY3ksIG5vdyApO1xyXG4gICAgdGhpcy5sZm8uc3RhcnQoKTtcclxuXHJcbiAgICAvLyBzZXQgdXAgdGhlIGdhaW4gc3RhZ2UgdGhhdCB3aWxsIGF0dGVudWF0ZSB0aGUgTEZPIG91dHB1dCBzbyB0aGF0IGl0IHdpbGwgcmFuZ2UgZnJvbSAtMC41IHRvICswLjVcclxuICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlR2FpbigpO1xyXG4gICAgdGhpcy5sZm9BdHRlbnVhdG9yR2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IG9wdGlvbnMubGZvSW5pdGlhbERlcHRoIC8gMjtcclxuICAgIHRoaXMubGZvLmNvbm5lY3QoIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlICk7XHJcblxyXG4gICAgLy8gc2V0IHVwIHRoZSBnYWluIHN0YWdlIGZvciB0aGUgTEZPIC0gdGhlIG1haW4gc291bmQgcGF0aCB3aWxsIHJ1biB0aHJvdWdoIGhlcmVcclxuICAgIHRoaXMubGZvQ29udHJvbGxlZEdhaW5Ob2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlR2FpbigpO1xyXG4gICAgdGhpcy5sZm9Db250cm9sbGVkR2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDAuNTsgLy8gdGhpcyB2YWx1ZSBpcyBhZGRlZCB0byB0aGUgYXR0ZW51YXRlZCBMRk8gb3V0cHV0IHZhbHVlXHJcblxyXG4gICAgLy8gc2V0IHRoZSBpbml0aWFsIGVuYWJsZWQgc3RhdGUgb2YgdGhlIExGT1xyXG4gICAgaWYgKCBvcHRpb25zLmxmb0luaXRpYWxseUVuYWJsZWQgKSB7XHJcbiAgICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKCAwLjUsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lLCBQQVJBTUVURVJfQ0hBTkdFX1RJTUVfQ09OU1RBTlQgKTtcclxuICAgICAgdGhpcy5sZm9BdHRlbnVhdG9yR2Fpbk5vZGUuY29ubmVjdCggdGhpcy5sZm9Db250cm9sbGVkR2Fpbk5vZGUuZ2FpbiApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKCAxLCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSwgUEFSQU1FVEVSX0NIQU5HRV9USU1FX0NPTlNUQU5UICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gd2lyZSB1cCB0aGUgYXVkaW8gcGF0aCwgd29ya2luZyBvdXIgd2F5IGZyb20gdGhlIG91dHB1dCBiYWNrIHRvIHRoZSBzb3VuZCBzb3VyY2UocylcclxuICAgIHRoaXMubGZvQ29udHJvbGxlZEdhaW5Ob2RlLmNvbm5lY3QoIHRoaXMuc291bmRTb3VyY2VEZXN0aW5hdGlvbiApO1xyXG4gICAgbGV0IG5leHRPdXRwdXRUb0Nvbm5lY3QgPSB0aGlzLmxmb0NvbnRyb2xsZWRHYWluTm9kZTtcclxuICAgIGlmICggaGlnaFBhc3NGaWx0ZXIgKSB7XHJcbiAgICAgIGhpZ2hQYXNzRmlsdGVyLmNvbm5lY3QoIG5leHRPdXRwdXRUb0Nvbm5lY3QgKTtcclxuICAgICAgbmV4dE91dHB1dFRvQ29ubmVjdCA9IGhpZ2hQYXNzRmlsdGVyO1xyXG4gICAgfVxyXG4gICAgaWYgKCBsb3dQYXNzRmlsdGVyICkge1xyXG4gICAgICBsb3dQYXNzRmlsdGVyLmNvbm5lY3QoIG5leHRPdXRwdXRUb0Nvbm5lY3QgKTtcclxuICAgICAgbmV4dE91dHB1dFRvQ29ubmVjdCA9IGxvd1Bhc3NGaWx0ZXI7XHJcbiAgICB9XHJcbiAgICBpZiAoIHRoaXMuYmFuZFBhc3NGaWx0ZXIgKSB7XHJcbiAgICAgIHRoaXMuYmFuZFBhc3NGaWx0ZXIuY29ubmVjdCggbmV4dE91dHB1dFRvQ29ubmVjdCApO1xyXG4gICAgICBuZXh0T3V0cHV0VG9Db25uZWN0ID0gdGhpcy5iYW5kUGFzc0ZpbHRlcjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm5vaXNlU291cmNlQ29ubmVjdGlvblBvaW50ID0gbmV4dE91dHB1dFRvQ29ubmVjdDtcclxuICAgIHRoaXMuX2lzUGxheWluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy50aW1lT2ZEZWZlcnJlZFN0YXJ0UmVxdWVzdCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTtcclxuXHJcbiAgICAvLyBkZWZpbmUgdGhlIGxpc3RlbmVyIGZvciBhdWRpbyBjb250ZXh0IHN0YXRlIHRyYW5zaXRpb25zXHJcbiAgICB0aGlzLmF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTGlzdGVuZXIgPSBzdGF0ZSA9PiB7XHJcblxyXG4gICAgICBpZiAoIHN0YXRlID09PSAncnVubmluZycgJiYgdGhpcy5faXNQbGF5aW5nICkge1xyXG5cclxuICAgICAgICB0aGlzLnN0YXJ0KCk7XHJcblxyXG4gICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgcmVtb3ZlIGFmdGVyIGZpcmluZ1xyXG4gICAgICAgIGF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTW9uaXRvci5yZW1vdmVTdGF0ZUNoYW5nZUxpc3RlbmVyKFxyXG4gICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHQsXHJcbiAgICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTGlzdGVuZXJcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGEgdmFsdWUgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciBub2lzZSBpcyBjdXJyZW50bHkgYmVpbmcgcGxheWVkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgaXNQbGF5aW5nKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2lzUGxheWluZztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0IHRoZSBub2lzZSBzb3VyY2UuXHJcbiAgICogQHBhcmFtIFtkZWxheV0gLSBvcHRpb25hbCBkZWxheSBmb3Igd2hlbiB0byBzdGFydCB0aGUgbm9pc2Ugc291cmNlLCBpbiBzZWNvbmRzXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXJ0KCBkZWxheSA9IDAgKTogdm9pZCB7XHJcblxyXG4gICAgaWYgKCB0aGlzLmF1ZGlvQ29udGV4dC5zdGF0ZSA9PT0gJ3J1bm5pbmcnICkge1xyXG5cclxuICAgICAgY29uc3Qgbm93ID0gdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWU7XHJcblxyXG4gICAgICAvLyBvbmx5IGRvIHNvbWV0aGluZyBpZiBub3QgYWxyZWFkeSBwbGF5aW5nLCBvdGhlcndpc2UgaWdub3JlIHRoaXMgcmVxdWVzdFxyXG4gICAgICBpZiAoICF0aGlzLl9pc1BsYXlpbmcgKSB7XHJcbiAgICAgICAgdGhpcy5ub2lzZVNvdXJjZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xyXG4gICAgICAgIHRoaXMubm9pc2VTb3VyY2UuYnVmZmVyID0gdGhpcy5ub2lzZUJ1ZmZlcjtcclxuICAgICAgICB0aGlzLm5vaXNlU291cmNlLmxvb3AgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMubm9pc2VTb3VyY2UuY29ubmVjdCggdGhpcy5ub2lzZVNvdXJjZUNvbm5lY3Rpb25Qb2ludCApO1xyXG4gICAgICAgIHRoaXMubm9pc2VTb3VyY2Uuc3RhcnQoIG5vdyArIGRlbGF5ICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG5cclxuICAgICAgLy8gVGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB3aGVuIHRoZSBhdWRpbyBjb250ZXh0IHdhcyBub3QgeWV0IHJ1bm5pbmcsIHNvIGFkZCBhIGxpc3RlbmVyIHRvIHN0YXJ0IGlmIGFuZCB3aGVuIHRoZVxyXG4gICAgICAvLyBhdWRpbyBjb250ZXh0IHN0YXRlIGNoYW5nZXMuXHJcbiAgICAgIHRoaXMudGltZU9mRGVmZXJyZWRTdGFydFJlcXVlc3QgPSBEYXRlLm5vdygpO1xyXG4gICAgICBpZiAoICFhdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IuaGFzTGlzdGVuZXIoIHRoaXMuYXVkaW9Db250ZXh0LCB0aGlzLmF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTGlzdGVuZXIgKSApIHtcclxuICAgICAgICBhdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IuYWRkU3RhdGVDaGFuZ2VMaXN0ZW5lcihcclxuICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0LFxyXG4gICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHRTdGF0ZUNoYW5nZUxpc3RlbmVyXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIHNldCB0aGUgZmxhZyBldmVuIGlmIHRoZSBzdGFydCBpcyBkZWZlcnJlZCwgc2luY2UgaXQgaXMgdXNlZCB0byBkZWNpZGUgd2hldGhlciB0byBkbyBhIGRlZmVycmVkIHN0YXJ0XHJcbiAgICB0aGlzLl9pc1BsYXlpbmcgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcCB0aGUgbm9pc2Ugc291cmNlLlxyXG4gICAqIEBwYXJhbSBbdGltZV0gLSBvcHRpb25hbCBhdWRpbyBjb250ZXh0IHRpbWUgYXQgd2hpY2ggdGhpcyBzaG91bGQgYmUgc3RvcHBlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdG9wKCB0aW1lID0gMCApOiB2b2lkIHtcclxuXHJcbiAgICAvLyBvbmx5IHN0b3AgaWYgcGxheWluZywgb3RoZXJ3aXNlIGlnbm9yZVxyXG4gICAgaWYgKCB0aGlzLl9pc1BsYXlpbmcgJiYgdGhpcy5ub2lzZVNvdXJjZSApIHtcclxuICAgICAgdGhpcy5ub2lzZVNvdXJjZS5zdG9wKCB0aW1lICk7XHJcbiAgICAgIHRoaXMubm9pc2VTb3VyY2UgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgdGhpcy5faXNQbGF5aW5nID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIGZyZXF1ZW5jeSBvZiB0aGUgbG93IGZyZXF1ZW5jeSBhbXBsaXR1ZGUgbW9kdWxhdG9yIChMRk8pLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRMZm9GcmVxdWVuY3koIGZyZXF1ZW5jeTogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy5sZm8uZnJlcXVlbmN5LnNldFRhcmdldEF0VGltZSggZnJlcXVlbmN5LCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSwgUEFSQU1FVEVSX0NIQU5HRV9USU1FX0NPTlNUQU5UICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIGRlcHRoIG9mIHRoZSBMRk8gbW9kdWxhdG9yLlxyXG4gICAqIEBwYXJhbSBkZXB0aCAtIGRlcHRoIHZhbHVlIGZyb20gMCAobm8gbW9kdWxhdGlvbikgdG8gMSAobWF4IG1vZHVsYXRpb24pXHJcbiAgICovXHJcbiAgcHVibGljIHNldExmb0RlcHRoKCBkZXB0aDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy5sZm9BdHRlbnVhdG9yR2Fpbk5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoIGRlcHRoIC8gMiwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUsIExGT19ERVBUSF9DSEFOR0VfVElNRV9DT05TVEFOVCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHVybiB0aGUgbG93IGZyZXF1ZW5jeSBhbXBsaXR1ZGUgbW9kdWxhdGlvbiBvbi9vZmYuXHJcbiAgICovXHJcbiAgcHVibGljIHNldExmb0VuYWJsZWQoIGVuYWJsZWQ6IGJvb2xlYW4gKTogdm9pZCB7XHJcbiAgICBpZiAoIGVuYWJsZWQgKSB7XHJcbiAgICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKCAwLjUsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lLCBQQVJBTUVURVJfQ0hBTkdFX1RJTUVfQ09OU1RBTlQgKTtcclxuICAgICAgdGhpcy5sZm9BdHRlbnVhdG9yR2Fpbk5vZGUuY29ubmVjdCggdGhpcy5sZm9Db250cm9sbGVkR2Fpbk5vZGUuZ2FpbiApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlLmRpc2Nvbm5lY3QoIHRoaXMubGZvQ29udHJvbGxlZEdhaW5Ob2RlLmdhaW4gKTtcclxuICAgICAgdGhpcy5sZm9BdHRlbnVhdG9yR2Fpbk5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoIDEsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lLCBQQVJBTUVURVJfQ0hBTkdFX1RJTUVfQ09OU1RBTlQgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHNldCB0aGUgUSB2YWx1ZSBmb3IgdGhlIGJhbmQgcGFzcyBmaWx0ZXIsIGFzc3VtZXMgdGhhdCBub2lzZSBnZW5lcmF0b3Igd2FzIGNyZWF0ZWQgd2l0aCB0aGlzIGZpbHRlciBlbmFibGVkXHJcbiAgICovXHJcbiAgcHVibGljIHNldEJhbmRwYXNzRmlsdGVyQ2VudGVyRnJlcXVlbmN5KCBmcmVxdWVuY3k6IG51bWJlciwgdGltZUNvbnN0YW50ID0gUEFSQU1FVEVSX0NIQU5HRV9USU1FX0NPTlNUQU5UICk6IHZvaWQge1xyXG4gICAgaWYgKCB0aGlzLmJhbmRQYXNzRmlsdGVyICE9PSBudWxsICkge1xyXG4gICAgICB0aGlzLmJhbmRQYXNzRmlsdGVyLmZyZXF1ZW5jeS5zZXRUYXJnZXRBdFRpbWUoIGZyZXF1ZW5jeSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUsIHRpbWVDb25zdGFudCApO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxudGFtYm8ucmVnaXN0ZXIoICdOb2lzZUdlbmVyYXRvcicsIE5vaXNlR2VuZXJhdG9yICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBOb2lzZUdlbmVyYXRvcjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLDhCQUE4QjtBQUNwRCxPQUFP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