// Copyright 2016-2024, University of Colorado Boulder

/**
 * A drawer that opens/closes to show/hide its contents.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../axon/js/BooleanProperty.js';
import stepTimer from '../../axon/js/stepTimer.js';
import Dimension2 from '../../dot/js/Dimension2.js';
import { Shape } from '../../kite/js/imports.js';
import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize from '../../phet-core/js/optionize.js';
import { Node, Path, PressListener, Rectangle } from '../../scenery/js/imports.js';
import Animation from '../../twixt/js/Animation.js';
import Easing from '../../twixt/js/Easing.js';
import sceneryPhet from './sceneryPhet.js';
export default class Drawer extends Node {
  // is the drawer open?

  // what's in the drawer

  // whether the drawer animates open/closed

  /**
   * @param contentsNode - contents of the drawer
   * @param provideOptions
   */
  constructor(contentsNode, provideOptions) {
    const options = optionize()({
      // SelfOptions
      size: null,
      cornerRadius: 0,
      xMargin: 0,
      yMargin: 0,
      open: true,
      handlePosition: 'top',
      handleSize: new Dimension2(70, 20),
      handleCornerRadius: 5,
      handleFill: 'rgb( 230, 230, 230 )',
      handleTouchAreaXDilation: 0,
      handleTouchAreaYDilation: 0,
      handleMouseAreaXDilation: 0,
      handleMouseAreaYDilation: 0,
      grippyDotRadius: 1,
      grippyDotColor: 'black',
      grippyDotRows: 2,
      grippyDotColumns: 4,
      grippyDotXSpacing: 9,
      grippyDotYSpacing: 5,
      beforeOpen: () => {
        contentsNode.visible = true;
      },
      afterClose: () => {
        contentsNode.visible = false;
      },
      animationEnabled: true,
      animationDuration: 0.5,
      stepEmitter: stepTimer
    }, provideOptions);

    // size of contents, adjusted for margins
    const CONTENTS_WIDTH = contentsNode.width + 2 * options.xMargin;
    const CONTENTS_HEIGHT = contentsNode.height + 2 * options.yMargin;

    // size of container
    const CONTAINER_WIDTH = options.size ? options.size.width : CONTENTS_WIDTH;
    const CONTAINER_HEIGHT = options.size ? options.size.height : CONTENTS_HEIGHT;

    // background
    const backgroundNode = new Rectangle(0, 0, CONTAINER_WIDTH, CONTAINER_HEIGHT, {
      fill: 'white',
      cornerRadius: options.cornerRadius
    });

    // border
    const borderNode = new Rectangle(0, 0, CONTAINER_WIDTH, CONTAINER_HEIGHT, {
      stroke: 'black',
      cornerRadius: options.cornerRadius
    });

    // scale contents to fit the container
    if (options.size) {
      const scale = Math.min(1, Math.min(CONTAINER_WIDTH / CONTENTS_WIDTH, CONTAINER_HEIGHT / CONTENTS_HEIGHT));
      contentsNode.setScaleMagnitude(scale);
    }

    // handle, rectangle with top or bottom corners rounded, the other corners square
    const HANDLE_RADII = options.handlePosition === 'top' ? {
      topLeft: options.handleCornerRadius,
      topRight: options.handleCornerRadius
    } : {
      bottomLeft: options.handleCornerRadius,
      bottomRight: options.handleCornerRadius
    };
    const handleShape = Shape.roundedRectangleWithRadii(0, 0, options.handleSize.width, options.handleSize.height, HANDLE_RADII);
    const handleNode = new Path(handleShape, {
      cursor: 'pointer',
      fill: options.handleFill,
      stroke: 'black'
    });

    // grippy dots on the handle
    const grippyDotsShape = new Shape();
    let grippyX = 0;
    let grippyY = 0;
    for (let row = 0; row < options.grippyDotRows; row++) {
      for (let column = 0; column < options.grippyDotColumns; column++) {
        grippyX = column * options.grippyDotXSpacing;
        grippyY = row * options.grippyDotYSpacing;
        grippyDotsShape.moveTo(grippyX, grippyY);
        grippyDotsShape.arc(grippyX, grippyY, options.grippyDotRadius, 0, 2 * Math.PI);
      }
    }
    const grippyDotsNode = new Path(grippyDotsShape, {
      fill: options.grippyDotColor,
      center: handleNode.center
    });
    handleNode.addChild(grippyDotsNode);

    // handle pointerArea
    if (options.handleTouchAreaXDilation !== 0 || options.handleTouchAreaYDilation !== 0) {
      const touchAreaShiftY = options.handlePosition === 'top' ? -options.handleTouchAreaYDilation : options.handleTouchAreaYDilation;
      handleNode.touchArea = handleNode.localBounds.dilatedXY(options.handleTouchAreaXDilation, options.handleTouchAreaYDilation).shiftedY(touchAreaShiftY);
    }
    if (options.handleMouseAreaXDilation !== 0 || options.handleMouseAreaYDilation !== 0) {
      const mouseAreaShiftY = options.handlePosition === 'top' ? -options.handleMouseAreaYDilation : options.handleMouseAreaYDilation;
      handleNode.mouseArea = handleNode.localBounds.dilatedXY(options.handleMouseAreaXDilation, options.handleMouseAreaYDilation).shiftedY(mouseAreaShiftY);
    }

    // layout, position the handle at center-top or center-bottom
    backgroundNode.x = 0;
    handleNode.centerX = backgroundNode.centerX;
    if (options.handlePosition === 'top') {
      handleNode.top = 0;
      backgroundNode.top = handleNode.bottom - 1;
    } else {
      backgroundNode.top = 0;
      handleNode.top = backgroundNode.bottom - 1;
    }
    borderNode.center = backgroundNode.center;
    contentsNode.center = backgroundNode.center;

    // put all of the moving pieces together
    const drawerNode = new Node({
      children: [handleNode, backgroundNode, contentsNode, borderNode]
    });

    // wrap the drawer with a clipping area, to show/hide the container
    options.children = [drawerNode];
    options.clipArea = Shape.bounds(drawerNode.bounds);
    super(options);
    this.contentsNode = contentsNode;
    this._animationEnabled = options.animationEnabled;
    const yOpen = 0;
    const yClosed = options.handlePosition === 'top' ? backgroundNode.height : -backgroundNode.height;
    drawerNode.y = options.open ? yOpen : yClosed;
    let animation = null; // animation that opens/closes the drawer

    this.openProperty = new BooleanProperty(options.open);

    // click on the handle to toggle between open and closed
    handleNode.addInputListener(new PressListener({
      press: (event, trail) => this.openProperty.set(!this.openProperty.get())
    }));

    // open/close the drawer
    const openObserver = open => {
      // stop any animation that's in progress
      animation && animation.stop();
      open && options.beforeOpen && options.beforeOpen();
      if (this._animationEnabled) {
        // Animate opening and closing of the drawer.
        animation = new Animation({
          stepEmitter: options.stepEmitter,
          duration: options.animationDuration,
          easing: Easing.QUADRATIC_IN_OUT,
          setValue: value => {
            drawerNode.y = value;
          },
          getValue: () => drawerNode.y,
          to: open ? yOpen : yClosed
        });
        animation.start();
      } else {
        // animation disabled, move immediately to new state
        drawerNode.y = open ? yOpen : yClosed;
        !open && options.afterClose && options.afterClose();
      }
    };
    this.openProperty.lazyLink(openObserver); // unlink in dispose

    this.disposeDrawer = () => {
      this.openProperty.unlink(openObserver);
      this.openProperty.dispose(); // will fail if clients haven't removed observers
    };

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet?.chipper?.queryParameters?.binder && InstanceRegistry.registerDataURL('scenery-phet', 'Drawer', this);
  }
  dispose() {
    this.disposeDrawer();
    super.dispose();
  }

  /**
   * @param [animationEnabled]
   */
  reset(animationEnabled) {
    animationEnabled = animationEnabled === undefined ? this.animationEnabled : animationEnabled;

    // set the drawer to it's initial open/closed state, with or without animation
    const saveAnimationEnabled = this.animationEnabled;
    this.animationEnabled = animationEnabled;
    this.openProperty.reset();
    this.animationEnabled = saveAnimationEnabled;
  }

  /**
   * Determines whether animation is enabled for opening/closing drawer.
   */
  setAnimationEnabled(animationEnabled) {
    this._animationEnabled = animationEnabled;
  }
  set animationEnabled(value) {
    this.setAnimationEnabled(value);
  }
  get animationEnabled() {
    return this.getAnimationEnabled();
  }

  /**
   * Is animation enabled for opening/closing drawer?
   */
  getAnimationEnabled() {
    return this._animationEnabled;
  }
}
sceneryPhet.register('Drawer', Drawer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJzdGVwVGltZXIiLCJEaW1lbnNpb24yIiwiU2hhcGUiLCJJbnN0YW5jZVJlZ2lzdHJ5Iiwib3B0aW9uaXplIiwiTm9kZSIsIlBhdGgiLCJQcmVzc0xpc3RlbmVyIiwiUmVjdGFuZ2xlIiwiQW5pbWF0aW9uIiwiRWFzaW5nIiwic2NlbmVyeVBoZXQiLCJEcmF3ZXIiLCJjb25zdHJ1Y3RvciIsImNvbnRlbnRzTm9kZSIsInByb3ZpZGVPcHRpb25zIiwib3B0aW9ucyIsInNpemUiLCJjb3JuZXJSYWRpdXMiLCJ4TWFyZ2luIiwieU1hcmdpbiIsIm9wZW4iLCJoYW5kbGVQb3NpdGlvbiIsImhhbmRsZVNpemUiLCJoYW5kbGVDb3JuZXJSYWRpdXMiLCJoYW5kbGVGaWxsIiwiaGFuZGxlVG91Y2hBcmVhWERpbGF0aW9uIiwiaGFuZGxlVG91Y2hBcmVhWURpbGF0aW9uIiwiaGFuZGxlTW91c2VBcmVhWERpbGF0aW9uIiwiaGFuZGxlTW91c2VBcmVhWURpbGF0aW9uIiwiZ3JpcHB5RG90UmFkaXVzIiwiZ3JpcHB5RG90Q29sb3IiLCJncmlwcHlEb3RSb3dzIiwiZ3JpcHB5RG90Q29sdW1ucyIsImdyaXBweURvdFhTcGFjaW5nIiwiZ3JpcHB5RG90WVNwYWNpbmciLCJiZWZvcmVPcGVuIiwidmlzaWJsZSIsImFmdGVyQ2xvc2UiLCJhbmltYXRpb25FbmFibGVkIiwiYW5pbWF0aW9uRHVyYXRpb24iLCJzdGVwRW1pdHRlciIsIkNPTlRFTlRTX1dJRFRIIiwid2lkdGgiLCJDT05URU5UU19IRUlHSFQiLCJoZWlnaHQiLCJDT05UQUlORVJfV0lEVEgiLCJDT05UQUlORVJfSEVJR0hUIiwiYmFja2dyb3VuZE5vZGUiLCJmaWxsIiwiYm9yZGVyTm9kZSIsInN0cm9rZSIsInNjYWxlIiwiTWF0aCIsIm1pbiIsInNldFNjYWxlTWFnbml0dWRlIiwiSEFORExFX1JBRElJIiwidG9wTGVmdCIsInRvcFJpZ2h0IiwiYm90dG9tTGVmdCIsImJvdHRvbVJpZ2h0IiwiaGFuZGxlU2hhcGUiLCJyb3VuZGVkUmVjdGFuZ2xlV2l0aFJhZGlpIiwiaGFuZGxlTm9kZSIsImN1cnNvciIsImdyaXBweURvdHNTaGFwZSIsImdyaXBweVgiLCJncmlwcHlZIiwicm93IiwiY29sdW1uIiwibW92ZVRvIiwiYXJjIiwiUEkiLCJncmlwcHlEb3RzTm9kZSIsImNlbnRlciIsImFkZENoaWxkIiwidG91Y2hBcmVhU2hpZnRZIiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkWFkiLCJzaGlmdGVkWSIsIm1vdXNlQXJlYVNoaWZ0WSIsIm1vdXNlQXJlYSIsIngiLCJjZW50ZXJYIiwidG9wIiwiYm90dG9tIiwiZHJhd2VyTm9kZSIsImNoaWxkcmVuIiwiY2xpcEFyZWEiLCJib3VuZHMiLCJfYW5pbWF0aW9uRW5hYmxlZCIsInlPcGVuIiwieUNsb3NlZCIsInkiLCJhbmltYXRpb24iLCJvcGVuUHJvcGVydHkiLCJhZGRJbnB1dExpc3RlbmVyIiwicHJlc3MiLCJldmVudCIsInRyYWlsIiwic2V0IiwiZ2V0Iiwib3Blbk9ic2VydmVyIiwic3RvcCIsImR1cmF0aW9uIiwiZWFzaW5nIiwiUVVBRFJBVElDX0lOX09VVCIsInNldFZhbHVlIiwidmFsdWUiLCJnZXRWYWx1ZSIsInRvIiwic3RhcnQiLCJsYXp5TGluayIsImRpc3Bvc2VEcmF3ZXIiLCJ1bmxpbmsiLCJkaXNwb3NlIiwiYXNzZXJ0IiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJiaW5kZXIiLCJyZWdpc3RlckRhdGFVUkwiLCJyZXNldCIsInVuZGVmaW5lZCIsInNhdmVBbmltYXRpb25FbmFibGVkIiwic2V0QW5pbWF0aW9uRW5hYmxlZCIsImdldEFuaW1hdGlvbkVuYWJsZWQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkRyYXdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNi0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIGRyYXdlciB0aGF0IG9wZW5zL2Nsb3NlcyB0byBzaG93L2hpZGUgaXRzIGNvbnRlbnRzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IHN0ZXBUaW1lciBmcm9tICcuLi8uLi9heG9uL2pzL3N0ZXBUaW1lci5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgSW5zdGFuY2VSZWdpc3RyeSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvZG9jdW1lbnRhdGlvbi9JbnN0YW5jZVJlZ2lzdHJ5LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgTm9kZU9wdGlvbnMsIFBhdGgsIFByZXNzTGlzdGVuZXIsIFJlY3RhbmdsZSwgVENvbG9yIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEFuaW1hdGlvbiBmcm9tICcuLi8uLi90d2l4dC9qcy9BbmltYXRpb24uanMnO1xyXG5pbXBvcnQgRWFzaW5nIGZyb20gJy4uLy4uL3R3aXh0L2pzL0Vhc2luZy5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcclxuaW1wb3J0IHsgVFJlYWRPbmx5RW1pdHRlciB9IGZyb20gJy4uLy4uL2F4b24vanMvVEVtaXR0ZXIuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gZHJhd2VyXHJcbiAgc2l6ZT86IERpbWVuc2lvbjIgfCBudWxsOyAvLyAhbnVsbDogY29udGVudHMgc2l6ZWQgdG8gZml0IGluIGNvbnRhaW5lciwgbnVsbDogY29udGFpbmVyIHNpemVkIHRvIGZpdCBjb250ZW50c1xyXG4gIGNvcm5lclJhZGl1cz86IG51bWJlcjtcclxuICB4TWFyZ2luPzogbnVtYmVyO1xyXG4gIHlNYXJnaW4/OiBudW1iZXI7XHJcbiAgb3Blbj86IGJvb2xlYW47IC8vIGlzIHRoZSBkcmF3ZXIgaW5pdGlhbGx5IG9wZW4/XHJcblxyXG4gIC8vIGhhbmRsZVxyXG4gIGhhbmRsZVBvc2l0aW9uPzogJ3RvcCcgfCAnYm90dG9tJztcclxuICBoYW5kbGVTaXplPzogRGltZW5zaW9uMjtcclxuICBoYW5kbGVDb3JuZXJSYWRpdXM/OiBudW1iZXI7XHJcbiAgaGFuZGxlRmlsbD86IFRDb2xvcjtcclxuICBoYW5kbGVUb3VjaEFyZWFYRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgaGFuZGxlVG91Y2hBcmVhWURpbGF0aW9uPzogbnVtYmVyO1xyXG4gIGhhbmRsZU1vdXNlQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICBoYW5kbGVNb3VzZUFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcblxyXG4gIC8vIGdyaXBweSBkb3RzIG9uIGhhbmRsZVxyXG4gIGdyaXBweURvdFJhZGl1cz86IG51bWJlcjtcclxuICBncmlwcHlEb3RDb2xvcj86IFRDb2xvcjtcclxuICBncmlwcHlEb3RSb3dzPzogbnVtYmVyO1xyXG4gIGdyaXBweURvdENvbHVtbnM/OiBudW1iZXI7XHJcbiAgZ3JpcHB5RG90WFNwYWNpbmc/OiBudW1iZXI7XHJcbiAgZ3JpcHB5RG90WVNwYWNpbmc/OiBudW1iZXI7XHJcblxyXG4gIC8vIENhbGxiYWNrcy4gVGhlIGRlZmF1bHQgYmVoYXZpb3IgaXMgdG8gbWFrZSBjb250ZW50Tm9kZSB2aXNpYmxlIG9ubHkgd2hpbGUgdGhlIGRyYXdlciBpcyBvcGVuLlxyXG4gIC8vIFRoaXMgY2FuIHByb3ZpZGUgcGVyZm9ybWFuY2UgZ2FpbnMgaWYgeW91ciBjb250ZW50Tm9kZSB1cGRhdGVzIG9ubHkgd2hpbGUgdmlzaWJsZS5cclxuICBiZWZvcmVPcGVuPzogKCkgPT4gdm9pZDsgLy8gY2FsbGVkIGltbWVkaWF0ZWx5IGJlZm9yZSB0aGUgZHJhd2VyIGlzIG9wZW5lZFxyXG4gIGFmdGVyQ2xvc2U/OiAoKSA9PiB2b2lkOyAvLyBjYWxsZWQgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIGRyYXdlciBpcyBjbG9zZWRcclxuXHJcbiAgLy8gYW5pbWF0aW9uXHJcbiAgYW5pbWF0aW9uRW5hYmxlZD86IGJvb2xlYW47IC8vIGlzIGFuaW1hdGlvbiBlbmFibGVkIHdoZW4gb3BlbmluZy9jbG9zaW5nIHRoZSBkcmF3ZXI/XHJcbiAgYW5pbWF0aW9uRHVyYXRpb24/OiBudW1iZXI7IC8vIGR1cmF0aW9uIG9mIGFuaW1hdGlvbiAoZHJhd2VyIG9wZW5pbmcgYW5kIGNsb3NpbmcpIGluIHNlY29uZHNcclxuICBzdGVwRW1pdHRlcj86IFRSZWFkT25seUVtaXR0ZXI8WyBudW1iZXIgXT4gfCBudWxsOyAvLyBzZWUgQW5pbWF0aW9uIG9wdGlvbnMuc3RlcEVtaXR0ZXJcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIERyYXdlck9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8Tm9kZU9wdGlvbnMsICdjaGlsZHJlbicgfCAnY2xpcEFyZWEnPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERyYXdlciBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvLyBpcyB0aGUgZHJhd2VyIG9wZW4/XHJcbiAgcHVibGljIHJlYWRvbmx5IG9wZW5Qcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIHdoYXQncyBpbiB0aGUgZHJhd2VyXHJcbiAgcHVibGljIHJlYWRvbmx5IGNvbnRlbnRzTm9kZTogTm9kZTtcclxuXHJcbiAgLy8gd2hldGhlciB0aGUgZHJhd2VyIGFuaW1hdGVzIG9wZW4vY2xvc2VkXHJcbiAgcHJpdmF0ZSBfYW5pbWF0aW9uRW5hYmxlZDogYm9vbGVhbjtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlRHJhd2VyOiAoKSA9PiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gY29udGVudHNOb2RlIC0gY29udGVudHMgb2YgdGhlIGRyYXdlclxyXG4gICAqIEBwYXJhbSBwcm92aWRlT3B0aW9uc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggY29udGVudHNOb2RlOiBOb2RlLCBwcm92aWRlT3B0aW9ucz86IERyYXdlck9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxEcmF3ZXJPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIHNpemU6IG51bGwsXHJcbiAgICAgIGNvcm5lclJhZGl1czogMCxcclxuICAgICAgeE1hcmdpbjogMCxcclxuICAgICAgeU1hcmdpbjogMCxcclxuICAgICAgb3BlbjogdHJ1ZSxcclxuICAgICAgaGFuZGxlUG9zaXRpb246ICd0b3AnLFxyXG4gICAgICBoYW5kbGVTaXplOiBuZXcgRGltZW5zaW9uMiggNzAsIDIwICksXHJcbiAgICAgIGhhbmRsZUNvcm5lclJhZGl1czogNSxcclxuICAgICAgaGFuZGxlRmlsbDogJ3JnYiggMjMwLCAyMzAsIDIzMCApJyxcclxuICAgICAgaGFuZGxlVG91Y2hBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICBoYW5kbGVUb3VjaEFyZWFZRGlsYXRpb246IDAsXHJcbiAgICAgIGhhbmRsZU1vdXNlQXJlYVhEaWxhdGlvbjogMCxcclxuICAgICAgaGFuZGxlTW91c2VBcmVhWURpbGF0aW9uOiAwLFxyXG4gICAgICBncmlwcHlEb3RSYWRpdXM6IDEsXHJcbiAgICAgIGdyaXBweURvdENvbG9yOiAnYmxhY2snLFxyXG4gICAgICBncmlwcHlEb3RSb3dzOiAyLFxyXG4gICAgICBncmlwcHlEb3RDb2x1bW5zOiA0LFxyXG4gICAgICBncmlwcHlEb3RYU3BhY2luZzogOSxcclxuICAgICAgZ3JpcHB5RG90WVNwYWNpbmc6IDUsXHJcbiAgICAgIGJlZm9yZU9wZW46ICgpID0+IHsgY29udGVudHNOb2RlLnZpc2libGUgPSB0cnVlOyB9LFxyXG4gICAgICBhZnRlckNsb3NlOiAoKSA9PiB7IGNvbnRlbnRzTm9kZS52aXNpYmxlID0gZmFsc2U7IH0sXHJcbiAgICAgIGFuaW1hdGlvbkVuYWJsZWQ6IHRydWUsXHJcbiAgICAgIGFuaW1hdGlvbkR1cmF0aW9uOiAwLjUsXHJcbiAgICAgIHN0ZXBFbWl0dGVyOiBzdGVwVGltZXJcclxuICAgIH0sIHByb3ZpZGVPcHRpb25zICk7XHJcblxyXG4gICAgLy8gc2l6ZSBvZiBjb250ZW50cywgYWRqdXN0ZWQgZm9yIG1hcmdpbnNcclxuICAgIGNvbnN0IENPTlRFTlRTX1dJRFRIID0gY29udGVudHNOb2RlLndpZHRoICsgKCAyICogb3B0aW9ucy54TWFyZ2luICk7XHJcbiAgICBjb25zdCBDT05URU5UU19IRUlHSFQgPSBjb250ZW50c05vZGUuaGVpZ2h0ICsgKCAyICogb3B0aW9ucy55TWFyZ2luICk7XHJcblxyXG4gICAgLy8gc2l6ZSBvZiBjb250YWluZXJcclxuICAgIGNvbnN0IENPTlRBSU5FUl9XSURUSCA9IG9wdGlvbnMuc2l6ZSA/IG9wdGlvbnMuc2l6ZS53aWR0aCA6IENPTlRFTlRTX1dJRFRIO1xyXG4gICAgY29uc3QgQ09OVEFJTkVSX0hFSUdIVCA9IG9wdGlvbnMuc2l6ZSA/IG9wdGlvbnMuc2l6ZS5oZWlnaHQgOiBDT05URU5UU19IRUlHSFQ7XHJcblxyXG4gICAgLy8gYmFja2dyb3VuZFxyXG4gICAgY29uc3QgYmFja2dyb3VuZE5vZGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBDT05UQUlORVJfV0lEVEgsIENPTlRBSU5FUl9IRUlHSFQsIHtcclxuICAgICAgZmlsbDogJ3doaXRlJyxcclxuICAgICAgY29ybmVyUmFkaXVzOiBvcHRpb25zLmNvcm5lclJhZGl1c1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGJvcmRlclxyXG4gICAgY29uc3QgYm9yZGVyTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIENPTlRBSU5FUl9XSURUSCwgQ09OVEFJTkVSX0hFSUdIVCwge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGNvcm5lclJhZGl1czogb3B0aW9ucy5jb3JuZXJSYWRpdXNcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBzY2FsZSBjb250ZW50cyB0byBmaXQgdGhlIGNvbnRhaW5lclxyXG4gICAgaWYgKCBvcHRpb25zLnNpemUgKSB7XHJcbiAgICAgIGNvbnN0IHNjYWxlID0gTWF0aC5taW4oIDEsIE1hdGgubWluKCBDT05UQUlORVJfV0lEVEggLyBDT05URU5UU19XSURUSCwgQ09OVEFJTkVSX0hFSUdIVCAvIENPTlRFTlRTX0hFSUdIVCApICk7XHJcbiAgICAgIGNvbnRlbnRzTm9kZS5zZXRTY2FsZU1hZ25pdHVkZSggc2NhbGUgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBoYW5kbGUsIHJlY3RhbmdsZSB3aXRoIHRvcCBvciBib3R0b20gY29ybmVycyByb3VuZGVkLCB0aGUgb3RoZXIgY29ybmVycyBzcXVhcmVcclxuICAgIGNvbnN0IEhBTkRMRV9SQURJSSA9ICggb3B0aW9ucy5oYW5kbGVQb3NpdGlvbiA9PT0gJ3RvcCcgKSA/IHtcclxuICAgICAgdG9wTGVmdDogb3B0aW9ucy5oYW5kbGVDb3JuZXJSYWRpdXMsXHJcbiAgICAgIHRvcFJpZ2h0OiBvcHRpb25zLmhhbmRsZUNvcm5lclJhZGl1c1xyXG4gICAgfSA6IHtcclxuICAgICAgYm90dG9tTGVmdDogb3B0aW9ucy5oYW5kbGVDb3JuZXJSYWRpdXMsXHJcbiAgICAgIGJvdHRvbVJpZ2h0OiBvcHRpb25zLmhhbmRsZUNvcm5lclJhZGl1c1xyXG4gICAgfTtcclxuICAgIGNvbnN0IGhhbmRsZVNoYXBlID0gU2hhcGUucm91bmRlZFJlY3RhbmdsZVdpdGhSYWRpaSggMCwgMCwgb3B0aW9ucy5oYW5kbGVTaXplLndpZHRoLCBvcHRpb25zLmhhbmRsZVNpemUuaGVpZ2h0LCBIQU5ETEVfUkFESUkgKTtcclxuICAgIGNvbnN0IGhhbmRsZU5vZGUgPSBuZXcgUGF0aCggaGFuZGxlU2hhcGUsIHtcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIGZpbGw6IG9wdGlvbnMuaGFuZGxlRmlsbCxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gZ3JpcHB5IGRvdHMgb24gdGhlIGhhbmRsZVxyXG4gICAgY29uc3QgZ3JpcHB5RG90c1NoYXBlID0gbmV3IFNoYXBlKCk7XHJcbiAgICBsZXQgZ3JpcHB5WCA9IDA7XHJcbiAgICBsZXQgZ3JpcHB5WSA9IDA7XHJcbiAgICBmb3IgKCBsZXQgcm93ID0gMDsgcm93IDwgb3B0aW9ucy5ncmlwcHlEb3RSb3dzOyByb3crKyApIHtcclxuICAgICAgZm9yICggbGV0IGNvbHVtbiA9IDA7IGNvbHVtbiA8IG9wdGlvbnMuZ3JpcHB5RG90Q29sdW1uczsgY29sdW1uKysgKSB7XHJcbiAgICAgICAgZ3JpcHB5WCA9IGNvbHVtbiAqIG9wdGlvbnMuZ3JpcHB5RG90WFNwYWNpbmc7XHJcbiAgICAgICAgZ3JpcHB5WSA9IHJvdyAqIG9wdGlvbnMuZ3JpcHB5RG90WVNwYWNpbmc7XHJcbiAgICAgICAgZ3JpcHB5RG90c1NoYXBlLm1vdmVUbyggZ3JpcHB5WCwgZ3JpcHB5WSApO1xyXG4gICAgICAgIGdyaXBweURvdHNTaGFwZS5hcmMoIGdyaXBweVgsIGdyaXBweVksIG9wdGlvbnMuZ3JpcHB5RG90UmFkaXVzLCAwLCAyICogTWF0aC5QSSApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBncmlwcHlEb3RzTm9kZSA9IG5ldyBQYXRoKCBncmlwcHlEb3RzU2hhcGUsIHtcclxuICAgICAgZmlsbDogb3B0aW9ucy5ncmlwcHlEb3RDb2xvcixcclxuICAgICAgY2VudGVyOiBoYW5kbGVOb2RlLmNlbnRlclxyXG4gICAgfSApO1xyXG4gICAgaGFuZGxlTm9kZS5hZGRDaGlsZCggZ3JpcHB5RG90c05vZGUgKTtcclxuXHJcbiAgICAvLyBoYW5kbGUgcG9pbnRlckFyZWFcclxuICAgIGlmICggb3B0aW9ucy5oYW5kbGVUb3VjaEFyZWFYRGlsYXRpb24gIT09IDAgfHwgb3B0aW9ucy5oYW5kbGVUb3VjaEFyZWFZRGlsYXRpb24gIT09IDAgKSB7XHJcbiAgICAgIGNvbnN0IHRvdWNoQXJlYVNoaWZ0WSA9ICggb3B0aW9ucy5oYW5kbGVQb3NpdGlvbiA9PT0gJ3RvcCcgKSA/IC1vcHRpb25zLmhhbmRsZVRvdWNoQXJlYVlEaWxhdGlvbiA6IG9wdGlvbnMuaGFuZGxlVG91Y2hBcmVhWURpbGF0aW9uO1xyXG4gICAgICBoYW5kbGVOb2RlLnRvdWNoQXJlYSA9IGhhbmRsZU5vZGUubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCBvcHRpb25zLmhhbmRsZVRvdWNoQXJlYVhEaWxhdGlvbiwgb3B0aW9ucy5oYW5kbGVUb3VjaEFyZWFZRGlsYXRpb24gKS5zaGlmdGVkWSggdG91Y2hBcmVhU2hpZnRZICk7XHJcbiAgICB9XHJcbiAgICBpZiAoIG9wdGlvbnMuaGFuZGxlTW91c2VBcmVhWERpbGF0aW9uICE9PSAwIHx8IG9wdGlvbnMuaGFuZGxlTW91c2VBcmVhWURpbGF0aW9uICE9PSAwICkge1xyXG4gICAgICBjb25zdCBtb3VzZUFyZWFTaGlmdFkgPSAoIG9wdGlvbnMuaGFuZGxlUG9zaXRpb24gPT09ICd0b3AnICkgPyAtb3B0aW9ucy5oYW5kbGVNb3VzZUFyZWFZRGlsYXRpb24gOiBvcHRpb25zLmhhbmRsZU1vdXNlQXJlYVlEaWxhdGlvbjtcclxuICAgICAgaGFuZGxlTm9kZS5tb3VzZUFyZWEgPSBoYW5kbGVOb2RlLmxvY2FsQm91bmRzLmRpbGF0ZWRYWSggb3B0aW9ucy5oYW5kbGVNb3VzZUFyZWFYRGlsYXRpb24sIG9wdGlvbnMuaGFuZGxlTW91c2VBcmVhWURpbGF0aW9uICkuc2hpZnRlZFkoIG1vdXNlQXJlYVNoaWZ0WSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGxheW91dCwgcG9zaXRpb24gdGhlIGhhbmRsZSBhdCBjZW50ZXItdG9wIG9yIGNlbnRlci1ib3R0b21cclxuICAgIGJhY2tncm91bmROb2RlLnggPSAwO1xyXG4gICAgaGFuZGxlTm9kZS5jZW50ZXJYID0gYmFja2dyb3VuZE5vZGUuY2VudGVyWDtcclxuICAgIGlmICggb3B0aW9ucy5oYW5kbGVQb3NpdGlvbiA9PT0gJ3RvcCcgKSB7XHJcbiAgICAgIGhhbmRsZU5vZGUudG9wID0gMDtcclxuICAgICAgYmFja2dyb3VuZE5vZGUudG9wID0gaGFuZGxlTm9kZS5ib3R0b20gLSAxO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGJhY2tncm91bmROb2RlLnRvcCA9IDA7XHJcbiAgICAgIGhhbmRsZU5vZGUudG9wID0gYmFja2dyb3VuZE5vZGUuYm90dG9tIC0gMTtcclxuICAgIH1cclxuICAgIGJvcmRlck5vZGUuY2VudGVyID0gYmFja2dyb3VuZE5vZGUuY2VudGVyO1xyXG4gICAgY29udGVudHNOb2RlLmNlbnRlciA9IGJhY2tncm91bmROb2RlLmNlbnRlcjtcclxuXHJcbiAgICAvLyBwdXQgYWxsIG9mIHRoZSBtb3ZpbmcgcGllY2VzIHRvZ2V0aGVyXHJcbiAgICBjb25zdCBkcmF3ZXJOb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgaGFuZGxlTm9kZSwgYmFja2dyb3VuZE5vZGUsIGNvbnRlbnRzTm9kZSwgYm9yZGVyTm9kZSBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gd3JhcCB0aGUgZHJhd2VyIHdpdGggYSBjbGlwcGluZyBhcmVhLCB0byBzaG93L2hpZGUgdGhlIGNvbnRhaW5lclxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgZHJhd2VyTm9kZSBdO1xyXG4gICAgb3B0aW9ucy5jbGlwQXJlYSA9IFNoYXBlLmJvdW5kcyggZHJhd2VyTm9kZS5ib3VuZHMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuY29udGVudHNOb2RlID0gY29udGVudHNOb2RlO1xyXG4gICAgdGhpcy5fYW5pbWF0aW9uRW5hYmxlZCA9IG9wdGlvbnMuYW5pbWF0aW9uRW5hYmxlZDtcclxuXHJcbiAgICBjb25zdCB5T3BlbiA9IDA7XHJcbiAgICBjb25zdCB5Q2xvc2VkID0gKCBvcHRpb25zLmhhbmRsZVBvc2l0aW9uID09PSAndG9wJyApID8gYmFja2dyb3VuZE5vZGUuaGVpZ2h0IDogLWJhY2tncm91bmROb2RlLmhlaWdodDtcclxuICAgIGRyYXdlck5vZGUueSA9IG9wdGlvbnMub3BlbiA/IHlPcGVuIDogeUNsb3NlZDtcclxuXHJcbiAgICBsZXQgYW5pbWF0aW9uOiBBbmltYXRpb24gfCBudWxsID0gbnVsbDsgLy8gYW5pbWF0aW9uIHRoYXQgb3BlbnMvY2xvc2VzIHRoZSBkcmF3ZXJcclxuXHJcbiAgICB0aGlzLm9wZW5Qcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIG9wdGlvbnMub3BlbiApO1xyXG5cclxuICAgIC8vIGNsaWNrIG9uIHRoZSBoYW5kbGUgdG8gdG9nZ2xlIGJldHdlZW4gb3BlbiBhbmQgY2xvc2VkXHJcbiAgICBoYW5kbGVOb2RlLmFkZElucHV0TGlzdGVuZXIoIG5ldyBQcmVzc0xpc3RlbmVyKCB7XHJcbiAgICAgIHByZXNzOiAoIGV2ZW50LCB0cmFpbCApID0+IHRoaXMub3BlblByb3BlcnR5LnNldCggIXRoaXMub3BlblByb3BlcnR5LmdldCgpIClcclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIG9wZW4vY2xvc2UgdGhlIGRyYXdlclxyXG4gICAgY29uc3Qgb3Blbk9ic2VydmVyID0gKCBvcGVuOiBib29sZWFuICkgPT4ge1xyXG5cclxuICAgICAgLy8gc3RvcCBhbnkgYW5pbWF0aW9uIHRoYXQncyBpbiBwcm9ncmVzc1xyXG4gICAgICBhbmltYXRpb24gJiYgYW5pbWF0aW9uLnN0b3AoKTtcclxuXHJcbiAgICAgIG9wZW4gJiYgb3B0aW9ucy5iZWZvcmVPcGVuICYmIG9wdGlvbnMuYmVmb3JlT3BlbigpO1xyXG5cclxuICAgICAgaWYgKCB0aGlzLl9hbmltYXRpb25FbmFibGVkICkge1xyXG5cclxuICAgICAgICAvLyBBbmltYXRlIG9wZW5pbmcgYW5kIGNsb3Npbmcgb2YgdGhlIGRyYXdlci5cclxuICAgICAgICBhbmltYXRpb24gPSBuZXcgQW5pbWF0aW9uKCB7XHJcbiAgICAgICAgICBzdGVwRW1pdHRlcjogb3B0aW9ucy5zdGVwRW1pdHRlcixcclxuICAgICAgICAgIGR1cmF0aW9uOiBvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uLFxyXG4gICAgICAgICAgZWFzaW5nOiBFYXNpbmcuUVVBRFJBVElDX0lOX09VVCxcclxuICAgICAgICAgIHNldFZhbHVlOiAoIHZhbHVlOiBudW1iZXIgKSA9PiB7IGRyYXdlck5vZGUueSA9IHZhbHVlOyB9LFxyXG4gICAgICAgICAgZ2V0VmFsdWU6ICgpID0+IGRyYXdlck5vZGUueSxcclxuICAgICAgICAgIHRvOiBvcGVuID8geU9wZW4gOiB5Q2xvc2VkXHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIGFuaW1hdGlvbi5zdGFydCgpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBhbmltYXRpb24gZGlzYWJsZWQsIG1vdmUgaW1tZWRpYXRlbHkgdG8gbmV3IHN0YXRlXHJcbiAgICAgICAgZHJhd2VyTm9kZS55ID0gb3BlbiA/IHlPcGVuIDogeUNsb3NlZDtcclxuICAgICAgICAhb3BlbiAmJiBvcHRpb25zLmFmdGVyQ2xvc2UgJiYgb3B0aW9ucy5hZnRlckNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLm9wZW5Qcm9wZXJ0eS5sYXp5TGluayggb3Blbk9ic2VydmVyICk7IC8vIHVubGluayBpbiBkaXNwb3NlXHJcblxyXG4gICAgdGhpcy5kaXNwb3NlRHJhd2VyID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLm9wZW5Qcm9wZXJ0eS51bmxpbmsoIG9wZW5PYnNlcnZlciApO1xyXG4gICAgICB0aGlzLm9wZW5Qcm9wZXJ0eS5kaXNwb3NlKCk7IC8vIHdpbGwgZmFpbCBpZiBjbGllbnRzIGhhdmVuJ3QgcmVtb3ZlZCBvYnNlcnZlcnNcclxuICAgIH07XHJcblxyXG4gICAgLy8gc3VwcG9ydCBmb3IgYmluZGVyIGRvY3VtZW50YXRpb24sIHN0cmlwcGVkIG91dCBpbiBidWlsZHMgYW5kIG9ubHkgcnVucyB3aGVuID9iaW5kZXIgaXMgc3BlY2lmaWVkXHJcbiAgICBhc3NlcnQgJiYgcGhldD8uY2hpcHBlcj8ucXVlcnlQYXJhbWV0ZXJzPy5iaW5kZXIgJiYgSW5zdGFuY2VSZWdpc3RyeS5yZWdpc3RlckRhdGFVUkwoICdzY2VuZXJ5LXBoZXQnLCAnRHJhd2VyJywgdGhpcyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VEcmF3ZXIoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBbYW5pbWF0aW9uRW5hYmxlZF1cclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXQoIGFuaW1hdGlvbkVuYWJsZWQ/OiBib29sZWFuICk6IHZvaWQge1xyXG5cclxuICAgIGFuaW1hdGlvbkVuYWJsZWQgPSAoIGFuaW1hdGlvbkVuYWJsZWQgPT09IHVuZGVmaW5lZCApID8gdGhpcy5hbmltYXRpb25FbmFibGVkIDogYW5pbWF0aW9uRW5hYmxlZDtcclxuXHJcbiAgICAvLyBzZXQgdGhlIGRyYXdlciB0byBpdCdzIGluaXRpYWwgb3Blbi9jbG9zZWQgc3RhdGUsIHdpdGggb3Igd2l0aG91dCBhbmltYXRpb25cclxuICAgIGNvbnN0IHNhdmVBbmltYXRpb25FbmFibGVkID0gdGhpcy5hbmltYXRpb25FbmFibGVkO1xyXG4gICAgdGhpcy5hbmltYXRpb25FbmFibGVkID0gYW5pbWF0aW9uRW5hYmxlZDtcclxuICAgIHRoaXMub3BlblByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmFuaW1hdGlvbkVuYWJsZWQgPSBzYXZlQW5pbWF0aW9uRW5hYmxlZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERldGVybWluZXMgd2hldGhlciBhbmltYXRpb24gaXMgZW5hYmxlZCBmb3Igb3BlbmluZy9jbG9zaW5nIGRyYXdlci5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0QW5pbWF0aW9uRW5hYmxlZCggYW5pbWF0aW9uRW5hYmxlZDogYm9vbGVhbiApOiB2b2lkIHtcclxuICAgIHRoaXMuX2FuaW1hdGlvbkVuYWJsZWQgPSBhbmltYXRpb25FbmFibGVkO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBhbmltYXRpb25FbmFibGVkKCB2YWx1ZTogYm9vbGVhbiApIHsgdGhpcy5zZXRBbmltYXRpb25FbmFibGVkKCB2YWx1ZSApOyB9XHJcblxyXG4gIHB1YmxpYyBnZXQgYW5pbWF0aW9uRW5hYmxlZCgpOiBib29sZWFuIHsgcmV0dXJuIHRoaXMuZ2V0QW5pbWF0aW9uRW5hYmxlZCgpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIElzIGFuaW1hdGlvbiBlbmFibGVkIGZvciBvcGVuaW5nL2Nsb3NpbmcgZHJhd2VyP1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRBbmltYXRpb25FbmFibGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2FuaW1hdGlvbkVuYWJsZWQ7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuc2NlbmVyeVBoZXQucmVnaXN0ZXIoICdEcmF3ZXInLCBEcmF3ZXIgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFB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