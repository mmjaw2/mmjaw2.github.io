// Copyright 2015-2024, University of Colorado Boulder

/**
 * Front of the HeaterCoolerNode.  It is independent from the HeaterCoolerBack so that one can easily layer objects
 * inside of the HeaterCoolerNode.  The HeaterCoolerFront contains the heater body, labels, and control slider.
 *
 * @author Siddhartha Chinthapally (Actual Concepts) on 20-11-2014.
 * @author Jesse Greenberg
 *
 */

import BooleanProperty from '../../axon/js/BooleanProperty.js';
import Dimension2 from '../../dot/js/Dimension2.js';
import Range from '../../dot/js/Range.js';
import { Shape } from '../../kite/js/imports.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { Color, KeyboardListener, LinearGradient, Node, Path, Text } from '../../scenery/js/imports.js';
import VSlider from '../../sun/js/VSlider.js';
import Tandem from '../../tandem/js/Tandem.js';
import HeaterCoolerBack from './HeaterCoolerBack.js';
import PhetFont from './PhetFont.js';
import sceneryPhet from './sceneryPhet.js';
import SceneryPhetStrings from './SceneryPhetStrings.js';
const DEFAULT_WIDTH = 120; // in screen coords, much of the rest of the size of the stove derives from this value

export default class HeaterCoolerFront extends Node {
  // please use judiciously, see https://github.com/phetsims/scenery-phet/issues/442

  static DEFAULT_BASE_COLOR = 'rgb( 159, 182, 205 )';

  /**
   * @param heatCoolAmountProperty +1 for max heating, -1 for max cooling
   * @param providedOptions
   */
  constructor(heatCoolAmountProperty, providedOptions) {
    super();
    const options = optionize()({
      // SelfOptions
      baseColor: HeaterCoolerFront.DEFAULT_BASE_COLOR,
      width: 120,
      heatEnabled: true,
      coolEnabled: true,
      snapToZero: true,
      snapToZeroThreshold: 0.1,
      heatString: SceneryPhetStrings.heatStringProperty,
      coolString: SceneryPhetStrings.coolStringProperty,
      labelFont: new PhetFont(14),
      labelMaxWidth: 35,
      thumbSize: new Dimension2(45, 22),
      thumbTouchAreaXDilation: 11,
      thumbTouchAreaYDilation: 11,
      thumbMouseAreaXDilation: 0,
      thumbMouseAreaYDilation: 0,
      thumbFill: '#71edff',
      thumbFillHighlighted: '#bff7ff',
      heaterCoolerBack: null,
      sliderOptions: {
        trackSize: new Dimension2(10, DEFAULT_WIDTH / 2),
        // height of the track depends on the width
        trackFillEnabled: new LinearGradient(0, 0, DEFAULT_WIDTH / 2, 0).addColorStop(0, '#0A00F0').addColorStop(1, '#EF000F'),
        thumbLineWidth: 1.4,
        thumbCenterLineStroke: 'black',
        majorTickLength: 15,
        minorTickLength: 12
      },
      snapToZeroPropertyOptions: {
        phetioDocumentation: 'whether the slider will snap to the off position when released',
        phetioFeatured: true
      },
      phetioInstrument: true,
      // NodeOptions
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'HeaterCoolerNode',
      phetioType: Node.NodeIO
    }, providedOptions);
    assert && assert(options.heatEnabled || options.coolEnabled, 'Either heat or cool must be enabled.');
    assert && assert(options.snapToZeroThreshold >= 0 && options.snapToZeroThreshold <= 1, `options.snapToZeroThreshold must be between 0 and 1: ${options.snapToZeroThreshold}`);

    // Dimensions for the rest of the stove, dependent on the specified stove width.  Empirically determined, and could
    // be made into options if needed.
    const height = DEFAULT_WIDTH * 0.75;
    const burnerOpeningHeight = DEFAULT_WIDTH * HeaterCoolerBack.OPENING_HEIGHT_SCALE;
    const bottomWidth = DEFAULT_WIDTH * 0.80;

    // Create the body of the stove.
    const stoveBodyShape = new Shape().ellipticalArc(DEFAULT_WIDTH / 2, burnerOpeningHeight / 4, DEFAULT_WIDTH / 2, burnerOpeningHeight / 2, 0, 0, Math.PI, false).lineTo((DEFAULT_WIDTH - bottomWidth) / 2, height + burnerOpeningHeight / 2).ellipticalArc(DEFAULT_WIDTH / 2, height + burnerOpeningHeight / 4, bottomWidth / 2, burnerOpeningHeight, 0, Math.PI, 0, true).lineTo(DEFAULT_WIDTH, burnerOpeningHeight / 2);
    const stoveBaseColor = Color.toColor(options.baseColor);
    const stoveBody = new Path(stoveBodyShape, {
      stroke: 'black',
      fill: new LinearGradient(0, 0, DEFAULT_WIDTH, 0).addColorStop(0, stoveBaseColor.brighterColor(0.5)).addColorStop(1, stoveBaseColor.darkerColor(0.5))
    });
    this.snapToZeroProperty = new BooleanProperty(options.snapToZero, combineOptions({
      tandem: options.tandem.createTandem('snapToZeroProperty')
    }, options.snapToZeroPropertyOptions));
    const sliderRange = new Range(options.coolEnabled ? -1 : 0, options.heatEnabled ? 1 : 0);

    /**
     * determines if the slider is close enough to zero to snap to zero (even when snapToZeroProperty is false). It's
     * only applicable when both heating and cooling are enabled because that is the only configuration where it was
     * difficult for a user to set the slider to 0. This feature was requested by designers,
     * see https://github.com/phetsims/scenery-phet/issues/568.
     */
    const sliderIsCloseToZero = () => {
      return options.coolEnabled && options.heatEnabled && (heatCoolAmountProperty.value < 0 && heatCoolAmountProperty.value / sliderRange.min < options.snapToZeroThreshold || heatCoolAmountProperty.value > 0 && heatCoolAmountProperty.value / sliderRange.max < options.snapToZeroThreshold);
    };
    const setSliderToZero = () => {
      heatCoolAmountProperty.set(0);
    };
    this.slider = new VSlider(heatCoolAmountProperty, sliderRange, combineOptions({
      thumbTouchAreaXDilation: options.thumbTouchAreaXDilation,
      thumbTouchAreaYDilation: options.thumbTouchAreaYDilation,
      thumbMouseAreaXDilation: options.thumbMouseAreaXDilation,
      thumbMouseAreaYDilation: options.thumbMouseAreaYDilation,
      thumbFill: options.thumbFill,
      thumbSize: options.thumbSize,
      thumbFillHighlighted: options.thumbFillHighlighted,
      endDrag: event => {
        // This only happens for mouse/touch events because it is a poor user experience to reset back to zero
        // every time a key is released. For keyboard input, it is reset to zero when the slider loses focus.
        const isFromPDOM = event && event.isFromPDOM();
        if (!isFromPDOM && this.snapToZeroProperty.value || sliderIsCloseToZero()) {
          setSliderToZero();
        }
      },
      centerY: stoveBody.centerY,
      right: stoveBody.right - DEFAULT_WIDTH / 8,
      tandem: options.tandem.createTandem('slider')
    }, options.sliderOptions));

    // Set the slider back to zero when it loses focus.
    this.slider.addInputListener({
      blur: setSliderToZero
    });

    // A shortcut to easily return the value to zero when using the keyboard.
    const keyboardListener = new KeyboardListener({
      keys: ['0'],
      fire: setSliderToZero
    });
    this.slider.addInputListener(keyboardListener);

    // Create the tick labels.
    const labelOptions = {
      font: options.labelFont,
      maxWidth: options.labelMaxWidth
    };
    let heatTickText;
    if (options.heatEnabled) {
      heatTickText = new Text(options.heatString, labelOptions); // dispose required, may link to a StringProperty
      this.slider.addMajorTick(1, heatTickText);
    }
    this.slider.addMinorTick(0);
    let coolTickText;
    if (options.coolEnabled) {
      coolTickText = new Text(options.coolString, labelOptions); // dispose required, may link to a StringProperty
      this.slider.addMajorTick(-1, coolTickText);
    }
    this.addChild(stoveBody);
    this.addChild(this.slider);
    if (!options.phetioInstrument) {
      options.tandem = Tandem.OPT_OUT;
    }
    this.mutate(options);

    // update the back component if provided
    if (options.heaterCoolerBack) {
      const heaterCoolerBack = options.heaterCoolerBack;
      this.opacityProperty.lazyLink(opacity => {
        heaterCoolerBack.opacity = opacity;
      });
      this.pickableProperty.lazyLink(pickable => {
        heaterCoolerBack.pickable = pickable;
      });
      this.visibleProperty.lazyLink(visible => {
        heaterCoolerBack.visible = visible;
      });
    }

    // return the slider to its origin if snapToZero is changed to true
    this.snapToZeroProperty.link(snapToZero => {
      snapToZero && setSliderToZero();
    });
    this.disposeHeaterCoolerFront = () => {
      heatTickText && heatTickText.dispose();
      coolTickText && coolTickText.dispose();
      keyboardListener.dispose();
    };
  }
  dispose() {
    this.disposeHeaterCoolerFront();
    super.dispose();
  }
}
sceneryPhet.register('HeaterCoolerFront', HeaterCoolerFront);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEaW1lbnNpb24yIiwiUmFuZ2UiLCJTaGFwZSIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiQ29sb3IiLCJLZXlib2FyZExpc3RlbmVyIiwiTGluZWFyR3JhZGllbnQiLCJOb2RlIiwiUGF0aCIsIlRleHQiLCJWU2xpZGVyIiwiVGFuZGVtIiwiSGVhdGVyQ29vbGVyQmFjayIsIlBoZXRGb250Iiwic2NlbmVyeVBoZXQiLCJTY2VuZXJ5UGhldFN0cmluZ3MiLCJERUZBVUxUX1dJRFRIIiwiSGVhdGVyQ29vbGVyRnJvbnQiLCJERUZBVUxUX0JBU0VfQ09MT1IiLCJjb25zdHJ1Y3RvciIsImhlYXRDb29sQW1vdW50UHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiYmFzZUNvbG9yIiwid2lkdGgiLCJoZWF0RW5hYmxlZCIsImNvb2xFbmFibGVkIiwic25hcFRvWmVybyIsInNuYXBUb1plcm9UaHJlc2hvbGQiLCJoZWF0U3RyaW5nIiwiaGVhdFN0cmluZ1Byb3BlcnR5IiwiY29vbFN0cmluZyIsImNvb2xTdHJpbmdQcm9wZXJ0eSIsImxhYmVsRm9udCIsImxhYmVsTWF4V2lkdGgiLCJ0aHVtYlNpemUiLCJ0aHVtYlRvdWNoQXJlYVhEaWxhdGlvbiIsInRodW1iVG91Y2hBcmVhWURpbGF0aW9uIiwidGh1bWJNb3VzZUFyZWFYRGlsYXRpb24iLCJ0aHVtYk1vdXNlQXJlYVlEaWxhdGlvbiIsInRodW1iRmlsbCIsInRodW1iRmlsbEhpZ2hsaWdodGVkIiwiaGVhdGVyQ29vbGVyQmFjayIsInNsaWRlck9wdGlvbnMiLCJ0cmFja1NpemUiLCJ0cmFja0ZpbGxFbmFibGVkIiwiYWRkQ29sb3JTdG9wIiwidGh1bWJMaW5lV2lkdGgiLCJ0aHVtYkNlbnRlckxpbmVTdHJva2UiLCJtYWpvclRpY2tMZW5ndGgiLCJtaW5vclRpY2tMZW5ndGgiLCJzbmFwVG9aZXJvUHJvcGVydHlPcHRpb25zIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInBoZXRpb0ZlYXR1cmVkIiwicGhldGlvSW5zdHJ1bWVudCIsInRhbmRlbSIsIlJFUVVJUkVEIiwidGFuZGVtTmFtZVN1ZmZpeCIsInBoZXRpb1R5cGUiLCJOb2RlSU8iLCJhc3NlcnQiLCJoZWlnaHQiLCJidXJuZXJPcGVuaW5nSGVpZ2h0IiwiT1BFTklOR19IRUlHSFRfU0NBTEUiLCJib3R0b21XaWR0aCIsInN0b3ZlQm9keVNoYXBlIiwiZWxsaXB0aWNhbEFyYyIsIk1hdGgiLCJQSSIsImxpbmVUbyIsInN0b3ZlQmFzZUNvbG9yIiwidG9Db2xvciIsInN0b3ZlQm9keSIsInN0cm9rZSIsImZpbGwiLCJicmlnaHRlckNvbG9yIiwiZGFya2VyQ29sb3IiLCJzbmFwVG9aZXJvUHJvcGVydHkiLCJjcmVhdGVUYW5kZW0iLCJzbGlkZXJSYW5nZSIsInNsaWRlcklzQ2xvc2VUb1plcm8iLCJ2YWx1ZSIsIm1pbiIsIm1heCIsInNldFNsaWRlclRvWmVybyIsInNldCIsInNsaWRlciIsImVuZERyYWciLCJldmVudCIsImlzRnJvbVBET00iLCJjZW50ZXJZIiwicmlnaHQiLCJhZGRJbnB1dExpc3RlbmVyIiwiYmx1ciIsImtleWJvYXJkTGlzdGVuZXIiLCJrZXlzIiwiZmlyZSIsImxhYmVsT3B0aW9ucyIsImZvbnQiLCJtYXhXaWR0aCIsImhlYXRUaWNrVGV4dCIsImFkZE1ham9yVGljayIsImFkZE1pbm9yVGljayIsImNvb2xUaWNrVGV4dCIsImFkZENoaWxkIiwiT1BUX09VVCIsIm11dGF0ZSIsIm9wYWNpdHlQcm9wZXJ0eSIsImxhenlMaW5rIiwib3BhY2l0eSIsInBpY2thYmxlUHJvcGVydHkiLCJwaWNrYWJsZSIsInZpc2libGVQcm9wZXJ0eSIsInZpc2libGUiLCJsaW5rIiwiZGlzcG9zZUhlYXRlckNvb2xlckZyb250IiwiZGlzcG9zZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiSGVhdGVyQ29vbGVyRnJvbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogRnJvbnQgb2YgdGhlIEhlYXRlckNvb2xlck5vZGUuICBJdCBpcyBpbmRlcGVuZGVudCBmcm9tIHRoZSBIZWF0ZXJDb29sZXJCYWNrIHNvIHRoYXQgb25lIGNhbiBlYXNpbHkgbGF5ZXIgb2JqZWN0c1xyXG4gKiBpbnNpZGUgb2YgdGhlIEhlYXRlckNvb2xlck5vZGUuICBUaGUgSGVhdGVyQ29vbGVyRnJvbnQgY29udGFpbnMgdGhlIGhlYXRlciBib2R5LCBsYWJlbHMsIGFuZCBjb250cm9sIHNsaWRlci5cclxuICpcclxuICogQGF1dGhvciBTaWRkaGFydGhhIENoaW50aGFwYWxseSAoQWN0dWFsIENvbmNlcHRzKSBvbiAyMC0xMS0yMDE0LlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKlxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHksIHsgQm9vbGVhblByb3BlcnR5T3B0aW9ucyB9IGZyb20gJy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBGb250LCBLZXlib2FyZExpc3RlbmVyLCBMaW5lYXJHcmFkaWVudCwgTm9kZSwgTm9kZU9wdGlvbnMsIFBhdGgsIFRDb2xvciwgVGV4dCB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IFNsaWRlck9wdGlvbnMgfSBmcm9tICcuLi8uLi9zdW4vanMvU2xpZGVyLmpzJztcclxuaW1wb3J0IFZTbGlkZXIgZnJvbSAnLi4vLi4vc3VuL2pzL1ZTbGlkZXIuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgSGVhdGVyQ29vbGVyQmFjayBmcm9tICcuL0hlYXRlckNvb2xlckJhY2suanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcclxuaW1wb3J0IFNjZW5lcnlQaGV0U3RyaW5ncyBmcm9tICcuL1NjZW5lcnlQaGV0U3RyaW5ncy5qcyc7XHJcblxyXG5jb25zdCBERUZBVUxUX1dJRFRIID0gMTIwOyAvLyBpbiBzY3JlZW4gY29vcmRzLCBtdWNoIG9mIHRoZSByZXN0IG9mIHRoZSBzaXplIG9mIHRoZSBzdG92ZSBkZXJpdmVzIGZyb20gdGhpcyB2YWx1ZVxyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgYmFzZUNvbG9yPzogQ29sb3IgfCBzdHJpbmc7IC8vIEJhc2UgY29sb3IgdXNlZCBmb3IgdGhlIHN0b3ZlIGJvZHkuXHJcbiAgd2lkdGg/OiBudW1iZXI7IC8vIEluIHNjcmVlbiBjb29yZHMsIG11Y2ggb2YgdGhlIHJlc3Qgb2YgdGhlIHNpemUgb2YgdGhlIHN0b3ZlIGRlcml2ZXMgZnJvbSB0aGlzIHZhbHVlLlxyXG4gIGhlYXRFbmFibGVkPzogYm9vbGVhbjsgLy8gQWxsb3dzIHNsaWRlciB0byByZWFjaCBwb3NpdGl2ZSB2YWx1ZXMgKGNvcnJlc3BvbmRpbmcgdG8gaGVhdGluZylcclxuICBjb29sRW5hYmxlZD86IGJvb2xlYW47IC8vIEFsbG93cyBzbGlkZXIgdG8gcmVhY2ggbmVnYXRpdmUgdmFsdWVzIChjb3JyZXNwb25kaW5nIHRvIGNvb2xpbmcpXHJcbiAgc25hcFRvWmVybz86IGJvb2xlYW47IC8vIHNlZSBkb2MgYXQgdGhpcy5zbmFwVG9aZXJvUHJvcGVydHlcclxuXHJcbiAgLy8gdGhlIHBlcmNlbnRhZ2Ugb2YgdGhlIHNsaWRlcidzIG1pbmltdW0gYW5kIG1heGltdW0gcmFuZ2UgYXQgd2hpY2ggdGhlIHNsaWRlciBzaG91bGQgc25hcCB0byB6ZXJvIHdoZW5cclxuICAvLyByZWxlYXNlZC4gTm90ZSB0aGF0IGl0J3Mgb25seSB1c2VkIHdoZW4gdGhpcy5zbmFwVG9aZXJvUHJvcGVydHkgaXMgZmFsc2UgYW5kIHdoZW4gYm90aCBoZWF0aW5nIGFuZCBjb29saW5nXHJcbiAgLy8gYXJlIGVuYWJsZWQuIEEgdmFsdWUgb2YgMSBpcyB0aGUgc2FtZSBhcyBzbmFwVG9aZXJvOiB0cnVlLCBhbmQgYSB2YWx1ZSBvZiAwIHJlbW92ZXMgc25hcHBpbmcgZW50aXJlbHkuXHJcbiAgLy8gRGVmYXVsdCB2YWx1ZSBlbXBpcmljYWxseSBkZXRlcm1pbmVkLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnktcGhldC9pc3N1ZXMvNTY4XHJcbiAgc25hcFRvWmVyb1RocmVzaG9sZD86IG51bWJlcjtcclxuXHJcbiAgLy8gc2xpZGVyIGxhYmVsIG9wdGlvbnNcclxuICBoZWF0U3RyaW5nPzogc3RyaW5nIHwgVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPjsgLy8gbGFiZWwgZm9yICsxIGVuZCBvZiBzbGlkZXJcclxuICBjb29sU3RyaW5nPzogc3RyaW5nIHwgVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPjsgLy8ge3N0cmluZ30gbGFiZWwgZm9yIC0xIGVuZCBvZiBzbGlkZXJcclxuICBsYWJlbEZvbnQ/OiBGb250O1xyXG4gIGxhYmVsTWF4V2lkdGg/OiBudW1iZXI7IC8vIG1heFdpZHRoIG9mIHRoZSBIZWF0IGFuZCBDb29sIGxhYmVscywgZGV0ZXJtaW5lZCBlbXBpcmljYWxseVxyXG5cclxuICAvLyBzbGlkZXIgb3B0aW9uc1xyXG4gIHRodW1iU2l6ZT86IERpbWVuc2lvbjI7XHJcbiAgdGh1bWJUb3VjaEFyZWFYRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgdGh1bWJUb3VjaEFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgdGh1bWJNb3VzZUFyZWFYRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgdGh1bWJNb3VzZUFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgdGh1bWJGaWxsPzogVENvbG9yO1xyXG4gIHRodW1iRmlsbEhpZ2hsaWdodGVkPzogVENvbG9yO1xyXG5cclxuICAvLyBsaW5rcyB0aGUgTm9kZUlPIFByb3BlcnRpZXMgb2YgdGhlIHByb3ZpZGVkIEhlYXRlckNvb2xlckJhY2sgdG8gdGhpcyBIZWF0ZXJDb29sZXJGcm9udFxyXG4gIGhlYXRlckNvb2xlckJhY2s/OiBIZWF0ZXJDb29sZXJCYWNrIHwgbnVsbDtcclxuXHJcbiAgc2xpZGVyT3B0aW9ucz86IFNsaWRlck9wdGlvbnM7XHJcblxyXG4gIC8vIFBhc3NlZCB0byBzbmFwVG9aZXJvUHJvcGVydHlcclxuICBzbmFwVG9aZXJvUHJvcGVydHlPcHRpb25zPzogQm9vbGVhblByb3BlcnR5T3B0aW9ucztcclxuXHJcbiAgLy8gSGVhdGVyQ29vbGVyRnJvbnQgaXMgc29tZXRpbWVzIGluc3RydW1lbnRlZCBhcyBhIHBhcmVudCBjb21wb25lbnQsIGFuZCBpcyBzb21ldGltZXMgYSBzdWItY29tcG9lbnQgdG9cclxuICAvLyBIZWF0ZXJDb29sZXJOb2RlLmpzLiBUaGlzIG9wdGlvbiBwcm92aWRlcyB0aGUgYWJpbGl0eSB0byBsaW1pdCB0aGUgbnVtYmVyIG9mIGludGVybWVkaWF0ZSBOb2RlcyBpbiB0aGVcclxuICAvLyBpbnN0cnVtZW50ZWQgdHJlZS4gVGhpcyBkb2Vzbid0IGFmZmVjdCB0aGUgaW5zdHJ1bWVudGF0aW9uIG9mIHN1Yi1jb21wb25lbnRzIGxpa2UgdGhlIHNsaWRlci5cclxuICBwaGV0aW9JbnN0cnVtZW50PzogYm9vbGVhbjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEhlYXRlckNvb2xlckZyb250T3B0aW9ucyA9IFNlbGZPcHRpb25zICYgTm9kZU9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIZWF0ZXJDb29sZXJGcm9udCBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvLyBwbGVhc2UgdXNlIGp1ZGljaW91c2x5LCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnktcGhldC9pc3N1ZXMvNDQyXHJcbiAgcHVibGljIHJlYWRvbmx5IHNsaWRlcjogVlNsaWRlcjtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBzbmFwVG9aZXJvUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VIZWF0ZXJDb29sZXJGcm9udDogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBERUZBVUxUX0JBU0VfQ09MT1IgPSAncmdiKCAxNTksIDE4MiwgMjA1ICknO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gaGVhdENvb2xBbW91bnRQcm9wZXJ0eSArMSBmb3IgbWF4IGhlYXRpbmcsIC0xIGZvciBtYXggY29vbGluZ1xyXG4gICAqIEBwYXJhbSBwcm92aWRlZE9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGhlYXRDb29sQW1vdW50UHJvcGVydHk6IE51bWJlclByb3BlcnR5LCBwcm92aWRlZE9wdGlvbnM/OiBIZWF0ZXJDb29sZXJGcm9udE9wdGlvbnMgKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8SGVhdGVyQ29vbGVyRnJvbnRPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIGJhc2VDb2xvcjogSGVhdGVyQ29vbGVyRnJvbnQuREVGQVVMVF9CQVNFX0NPTE9SLFxyXG4gICAgICB3aWR0aDogMTIwLFxyXG4gICAgICBoZWF0RW5hYmxlZDogdHJ1ZSxcclxuICAgICAgY29vbEVuYWJsZWQ6IHRydWUsXHJcbiAgICAgIHNuYXBUb1plcm86IHRydWUsXHJcbiAgICAgIHNuYXBUb1plcm9UaHJlc2hvbGQ6IDAuMSxcclxuICAgICAgaGVhdFN0cmluZzogU2NlbmVyeVBoZXRTdHJpbmdzLmhlYXRTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgY29vbFN0cmluZzogU2NlbmVyeVBoZXRTdHJpbmdzLmNvb2xTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgbGFiZWxGb250OiBuZXcgUGhldEZvbnQoIDE0ICksXHJcbiAgICAgIGxhYmVsTWF4V2lkdGg6IDM1LFxyXG4gICAgICB0aHVtYlNpemU6IG5ldyBEaW1lbnNpb24yKCA0NSwgMjIgKSxcclxuICAgICAgdGh1bWJUb3VjaEFyZWFYRGlsYXRpb246IDExLFxyXG4gICAgICB0aHVtYlRvdWNoQXJlYVlEaWxhdGlvbjogMTEsXHJcbiAgICAgIHRodW1iTW91c2VBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICB0aHVtYk1vdXNlQXJlYVlEaWxhdGlvbjogMCxcclxuICAgICAgdGh1bWJGaWxsOiAnIzcxZWRmZicsXHJcbiAgICAgIHRodW1iRmlsbEhpZ2hsaWdodGVkOiAnI2JmZjdmZicsXHJcbiAgICAgIGhlYXRlckNvb2xlckJhY2s6IG51bGwsXHJcbiAgICAgIHNsaWRlck9wdGlvbnM6IHtcclxuICAgICAgICB0cmFja1NpemU6IG5ldyBEaW1lbnNpb24yKCAxMCwgREVGQVVMVF9XSURUSCAvIDIgKSwgLy8gaGVpZ2h0IG9mIHRoZSB0cmFjayBkZXBlbmRzIG9uIHRoZSB3aWR0aFxyXG4gICAgICAgIHRyYWNrRmlsbEVuYWJsZWQ6IG5ldyBMaW5lYXJHcmFkaWVudCggMCwgMCwgREVGQVVMVF9XSURUSCAvIDIsIDAgKVxyXG4gICAgICAgICAgLmFkZENvbG9yU3RvcCggMCwgJyMwQTAwRjAnIClcclxuICAgICAgICAgIC5hZGRDb2xvclN0b3AoIDEsICcjRUYwMDBGJyApLFxyXG4gICAgICAgIHRodW1iTGluZVdpZHRoOiAxLjQsXHJcbiAgICAgICAgdGh1bWJDZW50ZXJMaW5lU3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICAgIG1ham9yVGlja0xlbmd0aDogMTUsXHJcbiAgICAgICAgbWlub3JUaWNrTGVuZ3RoOiAxMlxyXG4gICAgICB9LFxyXG4gICAgICBzbmFwVG9aZXJvUHJvcGVydHlPcHRpb25zOiB7XHJcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3doZXRoZXIgdGhlIHNsaWRlciB3aWxsIHNuYXAgdG8gdGhlIG9mZiBwb3NpdGlvbiB3aGVuIHJlbGVhc2VkJyxcclxuICAgICAgICBwaGV0aW9GZWF0dXJlZDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICBwaGV0aW9JbnN0cnVtZW50OiB0cnVlLFxyXG5cclxuICAgICAgLy8gTm9kZU9wdGlvbnNcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXHJcbiAgICAgIHRhbmRlbU5hbWVTdWZmaXg6ICdIZWF0ZXJDb29sZXJOb2RlJyxcclxuICAgICAgcGhldGlvVHlwZTogTm9kZS5Ob2RlSU9cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuaGVhdEVuYWJsZWQgfHwgb3B0aW9ucy5jb29sRW5hYmxlZCwgJ0VpdGhlciBoZWF0IG9yIGNvb2wgbXVzdCBiZSBlbmFibGVkLicgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuc25hcFRvWmVyb1RocmVzaG9sZCA+PSAwICYmIG9wdGlvbnMuc25hcFRvWmVyb1RocmVzaG9sZCA8PSAxLFxyXG4gICAgICBgb3B0aW9ucy5zbmFwVG9aZXJvVGhyZXNob2xkIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxOiAke29wdGlvbnMuc25hcFRvWmVyb1RocmVzaG9sZH1gICk7XHJcblxyXG4gICAgLy8gRGltZW5zaW9ucyBmb3IgdGhlIHJlc3Qgb2YgdGhlIHN0b3ZlLCBkZXBlbmRlbnQgb24gdGhlIHNwZWNpZmllZCBzdG92ZSB3aWR0aC4gIEVtcGlyaWNhbGx5IGRldGVybWluZWQsIGFuZCBjb3VsZFxyXG4gICAgLy8gYmUgbWFkZSBpbnRvIG9wdGlvbnMgaWYgbmVlZGVkLlxyXG4gICAgY29uc3QgaGVpZ2h0ID0gREVGQVVMVF9XSURUSCAqIDAuNzU7XHJcbiAgICBjb25zdCBidXJuZXJPcGVuaW5nSGVpZ2h0ID0gREVGQVVMVF9XSURUSCAqIEhlYXRlckNvb2xlckJhY2suT1BFTklOR19IRUlHSFRfU0NBTEU7XHJcbiAgICBjb25zdCBib3R0b21XaWR0aCA9IERFRkFVTFRfV0lEVEggKiAwLjgwO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgYm9keSBvZiB0aGUgc3RvdmUuXHJcbiAgICBjb25zdCBzdG92ZUJvZHlTaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgIC5lbGxpcHRpY2FsQXJjKCBERUZBVUxUX1dJRFRIIC8gMiwgYnVybmVyT3BlbmluZ0hlaWdodCAvIDQsIERFRkFVTFRfV0lEVEggLyAyLCBidXJuZXJPcGVuaW5nSGVpZ2h0IC8gMiwgMCwgMCwgTWF0aC5QSSwgZmFsc2UgKVxyXG4gICAgICAubGluZVRvKCAoIERFRkFVTFRfV0lEVEggLSBib3R0b21XaWR0aCApIC8gMiwgaGVpZ2h0ICsgYnVybmVyT3BlbmluZ0hlaWdodCAvIDIgKVxyXG4gICAgICAuZWxsaXB0aWNhbEFyYyggREVGQVVMVF9XSURUSCAvIDIsIGhlaWdodCArIGJ1cm5lck9wZW5pbmdIZWlnaHQgLyA0LCBib3R0b21XaWR0aCAvIDIsIGJ1cm5lck9wZW5pbmdIZWlnaHQsXHJcbiAgICAgICAgMCwgTWF0aC5QSSwgMCwgdHJ1ZSApLmxpbmVUbyggREVGQVVMVF9XSURUSCwgYnVybmVyT3BlbmluZ0hlaWdodCAvIDIgKTtcclxuXHJcbiAgICBjb25zdCBzdG92ZUJhc2VDb2xvciA9IENvbG9yLnRvQ29sb3IoIG9wdGlvbnMuYmFzZUNvbG9yICk7XHJcbiAgICBjb25zdCBzdG92ZUJvZHkgPSBuZXcgUGF0aCggc3RvdmVCb2R5U2hhcGUsIHtcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBmaWxsOiBuZXcgTGluZWFyR3JhZGllbnQoIDAsIDAsIERFRkFVTFRfV0lEVEgsIDAgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIDAsIHN0b3ZlQmFzZUNvbG9yLmJyaWdodGVyQ29sb3IoIDAuNSApIClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCAxLCBzdG92ZUJhc2VDb2xvci5kYXJrZXJDb2xvciggMC41ICkgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuc25hcFRvWmVyb1Byb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggb3B0aW9ucy5zbmFwVG9aZXJvLCBjb21iaW5lT3B0aW9uczxCb29sZWFuUHJvcGVydHlPcHRpb25zPigge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NuYXBUb1plcm9Qcm9wZXJ0eScgKVxyXG4gICAgfSwgb3B0aW9ucy5zbmFwVG9aZXJvUHJvcGVydHlPcHRpb25zICkgKTtcclxuXHJcbiAgICBjb25zdCBzbGlkZXJSYW5nZSA9IG5ldyBSYW5nZSggb3B0aW9ucy5jb29sRW5hYmxlZCA/IC0xIDogMCwgb3B0aW9ucy5oZWF0RW5hYmxlZCA/IDEgOiAwICk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBkZXRlcm1pbmVzIGlmIHRoZSBzbGlkZXIgaXMgY2xvc2UgZW5vdWdoIHRvIHplcm8gdG8gc25hcCB0byB6ZXJvIChldmVuIHdoZW4gc25hcFRvWmVyb1Byb3BlcnR5IGlzIGZhbHNlKS4gSXQnc1xyXG4gICAgICogb25seSBhcHBsaWNhYmxlIHdoZW4gYm90aCBoZWF0aW5nIGFuZCBjb29saW5nIGFyZSBlbmFibGVkIGJlY2F1c2UgdGhhdCBpcyB0aGUgb25seSBjb25maWd1cmF0aW9uIHdoZXJlIGl0IHdhc1xyXG4gICAgICogZGlmZmljdWx0IGZvciBhIHVzZXIgdG8gc2V0IHRoZSBzbGlkZXIgdG8gMC4gVGhpcyBmZWF0dXJlIHdhcyByZXF1ZXN0ZWQgYnkgZGVzaWduZXJzLFxyXG4gICAgICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5LXBoZXQvaXNzdWVzLzU2OC5cclxuICAgICAqL1xyXG4gICAgY29uc3Qgc2xpZGVySXNDbG9zZVRvWmVybyA9ICgpID0+IHtcclxuICAgICAgcmV0dXJuIG9wdGlvbnMuY29vbEVuYWJsZWQgJiYgb3B0aW9ucy5oZWF0RW5hYmxlZCAmJiAoXHJcbiAgICAgICAgaGVhdENvb2xBbW91bnRQcm9wZXJ0eS52YWx1ZSA8IDAgJiYgaGVhdENvb2xBbW91bnRQcm9wZXJ0eS52YWx1ZSAvIHNsaWRlclJhbmdlLm1pbiA8IG9wdGlvbnMuc25hcFRvWmVyb1RocmVzaG9sZCB8fFxyXG4gICAgICAgIGhlYXRDb29sQW1vdW50UHJvcGVydHkudmFsdWUgPiAwICYmIGhlYXRDb29sQW1vdW50UHJvcGVydHkudmFsdWUgLyBzbGlkZXJSYW5nZS5tYXggPCBvcHRpb25zLnNuYXBUb1plcm9UaHJlc2hvbGQgKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3Qgc2V0U2xpZGVyVG9aZXJvID0gKCkgPT4ge1xyXG4gICAgICBoZWF0Q29vbEFtb3VudFByb3BlcnR5LnNldCggMCApO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnNsaWRlciA9IG5ldyBWU2xpZGVyKCBoZWF0Q29vbEFtb3VudFByb3BlcnR5LCBzbGlkZXJSYW5nZSwgY29tYmluZU9wdGlvbnM8U2xpZGVyT3B0aW9ucz4oIHtcclxuICAgICAgdGh1bWJUb3VjaEFyZWFYRGlsYXRpb246IG9wdGlvbnMudGh1bWJUb3VjaEFyZWFYRGlsYXRpb24sXHJcbiAgICAgIHRodW1iVG91Y2hBcmVhWURpbGF0aW9uOiBvcHRpb25zLnRodW1iVG91Y2hBcmVhWURpbGF0aW9uLFxyXG4gICAgICB0aHVtYk1vdXNlQXJlYVhEaWxhdGlvbjogb3B0aW9ucy50aHVtYk1vdXNlQXJlYVhEaWxhdGlvbixcclxuICAgICAgdGh1bWJNb3VzZUFyZWFZRGlsYXRpb246IG9wdGlvbnMudGh1bWJNb3VzZUFyZWFZRGlsYXRpb24sXHJcbiAgICAgIHRodW1iRmlsbDogb3B0aW9ucy50aHVtYkZpbGwsXHJcbiAgICAgIHRodW1iU2l6ZTogb3B0aW9ucy50aHVtYlNpemUsXHJcbiAgICAgIHRodW1iRmlsbEhpZ2hsaWdodGVkOiBvcHRpb25zLnRodW1iRmlsbEhpZ2hsaWdodGVkLFxyXG4gICAgICBlbmREcmFnOiBldmVudCA9PiB7XHJcblxyXG4gICAgICAgIC8vIFRoaXMgb25seSBoYXBwZW5zIGZvciBtb3VzZS90b3VjaCBldmVudHMgYmVjYXVzZSBpdCBpcyBhIHBvb3IgdXNlciBleHBlcmllbmNlIHRvIHJlc2V0IGJhY2sgdG8gemVyb1xyXG4gICAgICAgIC8vIGV2ZXJ5IHRpbWUgYSBrZXkgaXMgcmVsZWFzZWQuIEZvciBrZXlib2FyZCBpbnB1dCwgaXQgaXMgcmVzZXQgdG8gemVybyB3aGVuIHRoZSBzbGlkZXIgbG9zZXMgZm9jdXMuXHJcbiAgICAgICAgY29uc3QgaXNGcm9tUERPTSA9IGV2ZW50ICYmIGV2ZW50LmlzRnJvbVBET00oKTtcclxuICAgICAgICBpZiAoICFpc0Zyb21QRE9NICYmIHRoaXMuc25hcFRvWmVyb1Byb3BlcnR5LnZhbHVlIHx8IHNsaWRlcklzQ2xvc2VUb1plcm8oKSApIHtcclxuICAgICAgICAgIHNldFNsaWRlclRvWmVybygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgY2VudGVyWTogc3RvdmVCb2R5LmNlbnRlclksXHJcbiAgICAgIHJpZ2h0OiBzdG92ZUJvZHkucmlnaHQgLSBERUZBVUxUX1dJRFRIIC8gOCxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdzbGlkZXInIClcclxuICAgIH0sIG9wdGlvbnMuc2xpZGVyT3B0aW9ucyApICk7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBzbGlkZXIgYmFjayB0byB6ZXJvIHdoZW4gaXQgbG9zZXMgZm9jdXMuXHJcbiAgICB0aGlzLnNsaWRlci5hZGRJbnB1dExpc3RlbmVyKCB7XHJcbiAgICAgIGJsdXI6IHNldFNsaWRlclRvWmVyb1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEEgc2hvcnRjdXQgdG8gZWFzaWx5IHJldHVybiB0aGUgdmFsdWUgdG8gemVybyB3aGVuIHVzaW5nIHRoZSBrZXlib2FyZC5cclxuICAgIGNvbnN0IGtleWJvYXJkTGlzdGVuZXIgPSBuZXcgS2V5Ym9hcmRMaXN0ZW5lcigge1xyXG4gICAgICBrZXlzOiBbICcwJyBdLFxyXG4gICAgICBmaXJlOiBzZXRTbGlkZXJUb1plcm9cclxuICAgIH0gKTtcclxuICAgIHRoaXMuc2xpZGVyLmFkZElucHV0TGlzdGVuZXIoIGtleWJvYXJkTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIHRpY2sgbGFiZWxzLlxyXG4gICAgY29uc3QgbGFiZWxPcHRpb25zID0ge1xyXG4gICAgICBmb250OiBvcHRpb25zLmxhYmVsRm9udCxcclxuICAgICAgbWF4V2lkdGg6IG9wdGlvbnMubGFiZWxNYXhXaWR0aFxyXG4gICAgfTtcclxuICAgIGxldCBoZWF0VGlja1RleHQ6IE5vZGU7XHJcbiAgICBpZiAoIG9wdGlvbnMuaGVhdEVuYWJsZWQgKSB7XHJcbiAgICAgIGhlYXRUaWNrVGV4dCA9IG5ldyBUZXh0KCBvcHRpb25zLmhlYXRTdHJpbmcsIGxhYmVsT3B0aW9ucyApOyAvLyBkaXNwb3NlIHJlcXVpcmVkLCBtYXkgbGluayB0byBhIFN0cmluZ1Byb3BlcnR5XHJcbiAgICAgIHRoaXMuc2xpZGVyLmFkZE1ham9yVGljayggMSwgaGVhdFRpY2tUZXh0ICk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNsaWRlci5hZGRNaW5vclRpY2soIDAgKTtcclxuICAgIGxldCBjb29sVGlja1RleHQ6IE5vZGU7XHJcbiAgICBpZiAoIG9wdGlvbnMuY29vbEVuYWJsZWQgKSB7XHJcbiAgICAgIGNvb2xUaWNrVGV4dCA9IG5ldyBUZXh0KCBvcHRpb25zLmNvb2xTdHJpbmcsIGxhYmVsT3B0aW9ucyApOyAvLyBkaXNwb3NlIHJlcXVpcmVkLCBtYXkgbGluayB0byBhIFN0cmluZ1Byb3BlcnR5XHJcbiAgICAgIHRoaXMuc2xpZGVyLmFkZE1ham9yVGljayggLTEsIGNvb2xUaWNrVGV4dCApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHN0b3ZlQm9keSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5zbGlkZXIgKTtcclxuXHJcbiAgICBpZiAoICFvcHRpb25zLnBoZXRpb0luc3RydW1lbnQgKSB7XHJcbiAgICAgIG9wdGlvbnMudGFuZGVtID0gVGFuZGVtLk9QVF9PVVQ7XHJcbiAgICB9XHJcbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgYmFjayBjb21wb25lbnQgaWYgcHJvdmlkZWRcclxuICAgIGlmICggb3B0aW9ucy5oZWF0ZXJDb29sZXJCYWNrICkge1xyXG4gICAgICBjb25zdCBoZWF0ZXJDb29sZXJCYWNrID0gb3B0aW9ucy5oZWF0ZXJDb29sZXJCYWNrO1xyXG4gICAgICB0aGlzLm9wYWNpdHlQcm9wZXJ0eS5sYXp5TGluayggb3BhY2l0eSA9PiB7XHJcbiAgICAgICAgaGVhdGVyQ29vbGVyQmFjay5vcGFjaXR5ID0gb3BhY2l0eTtcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLnBpY2thYmxlUHJvcGVydHkubGF6eUxpbmsoIHBpY2thYmxlID0+IHtcclxuICAgICAgICBoZWF0ZXJDb29sZXJCYWNrLnBpY2thYmxlID0gcGlja2FibGU7XHJcbiAgICAgIH0gKTtcclxuICAgICAgdGhpcy52aXNpYmxlUHJvcGVydHkubGF6eUxpbmsoIHZpc2libGUgPT4ge1xyXG4gICAgICAgIGhlYXRlckNvb2xlckJhY2sudmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyByZXR1cm4gdGhlIHNsaWRlciB0byBpdHMgb3JpZ2luIGlmIHNuYXBUb1plcm8gaXMgY2hhbmdlZCB0byB0cnVlXHJcbiAgICB0aGlzLnNuYXBUb1plcm9Qcm9wZXJ0eS5saW5rKCBzbmFwVG9aZXJvID0+IHtcclxuICAgICAgc25hcFRvWmVybyAmJiBzZXRTbGlkZXJUb1plcm8oKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VIZWF0ZXJDb29sZXJGcm9udCA9ICgpID0+IHtcclxuICAgICAgaGVhdFRpY2tUZXh0ICYmIGhlYXRUaWNrVGV4dC5kaXNwb3NlKCk7XHJcbiAgICAgIGNvb2xUaWNrVGV4dCAmJiBjb29sVGlja1RleHQuZGlzcG9zZSgpO1xyXG4gICAgICBrZXlib2FyZExpc3RlbmVyLmRpc3Bvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUhlYXRlckNvb2xlckZyb250KCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ0hlYXRlckNvb2xlckZyb250JywgSGVhdGVyQ29vbGVyRnJvbnQgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFrQyxrQ0FBa0M7QUFJMUYsT0FBT0MsVUFBVSxNQUFNLDRCQUE0QjtBQUNuRCxPQUFPQyxLQUFLLE1BQU0sdUJBQXVCO0FBQ3pDLFNBQVNDLEtB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