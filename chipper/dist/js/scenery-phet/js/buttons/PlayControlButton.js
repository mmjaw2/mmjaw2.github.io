// Copyright 2014-2024, University of Colorado Boulder

/**
 * A round toggle button that displays some custom icon when playing and a triangular "Play" icon when not playing.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import optionize from '../../../phet-core/js/optionize.js';
import { Circle, KeyboardListener, Path } from '../../../scenery/js/imports.js';
import BooleanRoundToggleButton from '../../../sun/js/buttons/BooleanRoundToggleButton.js';
import pauseSoundPlayer from '../../../tambo/js/shared-sound-players/pauseSoundPlayer.js';
import playSoundPlayer from '../../../tambo/js/shared-sound-players/playSoundPlayer.js';
import PlayIconShape from '../PlayIconShape.js';
import sceneryPhet from '../sceneryPhet.js';
import SceneryPhetConstants from '../SceneryPhetConstants.js';
import SceneryPhetStrings from '../SceneryPhetStrings.js';
export default class PlayControlButton extends BooleanRoundToggleButton {
  /**
   * @param isPlayingProperty
   * @param endPlayingIcon - icon for the button when pressing it will stop play
   * @param providedOptions
   */
  constructor(isPlayingProperty, endPlayingIcon, providedOptions) {
    const options = optionize()({
      // SelfOptions
      radius: SceneryPhetConstants.PLAY_CONTROL_BUTTON_RADIUS,
      scaleFactorWhenNotPlaying: 1,
      includeGlobalHotkey: false,
      startPlayingLabel: SceneryPhetStrings.a11y.playControlButton.playStringProperty,
      endPlayingLabel: null,
      valueOffSoundPlayer: pauseSoundPlayer,
      valueOnSoundPlayer: playSoundPlayer,
      // It's dimensions are calculated dynamically based on radius below to make sure the play and pause buttons are
      // in sync.
      xMargin: 0,
      yMargin: 0
    }, providedOptions);
    assert && assert(options.scaleFactorWhenNotPlaying > 0, 'button scale factor must be greater than 0');

    // play and pause icons are sized relative to the radius
    const playWidth = options.radius * 0.8;
    const playHeight = options.radius;
    const playPath = new Path(new PlayIconShape(playWidth, playHeight), {
      fill: 'black',
      centerX: options.radius * 0.05,
      // move to right slightly since we don't want it exactly centered
      centerY: 0
    });

    // put the play and stop symbols inside circles so they have the same bounds,
    // otherwise BooleanToggleNode will re-adjust their positions relative to each other
    const playCircle = new Circle(options.radius, {
      children: [playPath]
    });
    endPlayingIcon.centerX = 0;
    endPlayingIcon.centerY = 0;
    const endPlayingCircle = new Circle(options.radius, {
      children: [endPlayingIcon]
    });
    super(isPlayingProperty, endPlayingCircle, playCircle, options);
    const isPlayingListener = (isPlaying, oldValue) => {
      // pdom - accessible name for the button
      this.innerContent = isPlaying ? options.endPlayingLabel : options.startPlayingLabel;

      // so we don't scale down the button immediately if isPlayingProperty is initially false
      const runningScale = oldValue === null ? 1 : 1 / options.scaleFactorWhenNotPlaying;
      this.scale(isPlaying ? runningScale : options.scaleFactorWhenNotPlaying);
    };
    isPlayingProperty.link(isPlayingListener);

    // a listener that toggles the isPlayingProperty with hotkey Alt+K, regardless of where focus is in the document
    let globalKeyboardListener = null;
    if (options.includeGlobalHotkey && phet.chipper.queryParameters.supportsInteractiveDescription) {
      globalKeyboardListener = KeyboardListener.createGlobal(this, {
        keys: ['alt+k'],
        fireOnDown: false,
        fire: () => {
          isPlayingProperty.set(!isPlayingProperty.get());
          const soundPlayer = isPlayingProperty.get() ? options.valueOnSoundPlayer : options.valueOffSoundPlayer;
          if (soundPlayer) {
            soundPlayer.play();
          }
        }
      });
    }
    this.disposePlayStopButton = () => {
      if (isPlayingProperty.hasListener(isPlayingListener)) {
        isPlayingProperty.unlink(isPlayingListener);
      }
      if (globalKeyboardListener) {
        globalKeyboardListener.dispose();
      }
    };
  }
  dispose() {
    this.disposePlayStopButton();
    super.dispose();
  }
}
sceneryPhet.register('PlayControlButton', PlayControlButton);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJvcHRpb25pemUiLCJDaXJjbGUiLCJLZXlib2FyZExpc3RlbmVyIiwiUGF0aCIsIkJvb2xlYW5Sb3VuZFRvZ2dsZUJ1dHRvbiIsInBhdXNlU291bmRQbGF5ZXIiLCJwbGF5U291bmRQbGF5ZXIiLCJQbGF5SWNvblNoYXBlIiwic2NlbmVyeVBoZXQiLCJTY2VuZXJ5UGhldENvbnN0YW50cyIsIlNjZW5lcnlQaGV0U3RyaW5ncyIsIlBsYXlDb250cm9sQnV0dG9uIiwiY29uc3RydWN0b3IiLCJpc1BsYXlpbmdQcm9wZXJ0eSIsImVuZFBsYXlpbmdJY29uIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInJhZGl1cyIsIlBMQVlfQ09OVFJPTF9CVVRUT05fUkFESVVTIiwic2NhbGVGYWN0b3JXaGVuTm90UGxheWluZyIsImluY2x1ZGVHbG9iYWxIb3RrZXkiLCJzdGFydFBsYXlpbmdMYWJlbCIsImExMXkiLCJwbGF5Q29udHJvbEJ1dHRvbiIsInBsYXlTdHJpbmdQcm9wZXJ0eSIsImVuZFBsYXlpbmdMYWJlbCIsInZhbHVlT2ZmU291bmRQbGF5ZXIiLCJ2YWx1ZU9uU291bmRQbGF5ZXIiLCJ4TWFyZ2luIiwieU1hcmdpbiIsImFzc2VydCIsInBsYXlXaWR0aCIsInBsYXlIZWlnaHQiLCJwbGF5UGF0aCIsImZpbGwiLCJjZW50ZXJYIiwiY2VudGVyWSIsInBsYXlDaXJjbGUiLCJjaGlsZHJlbiIsImVuZFBsYXlpbmdDaXJjbGUiLCJpc1BsYXlpbmdMaXN0ZW5lciIsImlzUGxheWluZyIsIm9sZFZhbHVlIiwiaW5uZXJDb250ZW50IiwicnVubmluZ1NjYWxlIiwic2NhbGUiLCJsaW5rIiwiZ2xvYmFsS2V5Ym9hcmRMaXN0ZW5lciIsInBoZXQiLCJjaGlwcGVyIiwicXVlcnlQYXJhbWV0ZXJzIiwic3VwcG9ydHNJbnRlcmFjdGl2ZURlc2NyaXB0aW9uIiwiY3JlYXRlR2xvYmFsIiwia2V5cyIsImZpcmVPbkRvd24iLCJmaXJlIiwic2V0IiwiZ2V0Iiwic291bmRQbGF5ZXIiLCJwbGF5IiwiZGlzcG9zZVBsYXlTdG9wQnV0dG9uIiwiaGFzTGlzdGVuZXIiLCJ1bmxpbmsiLCJkaXNwb3NlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQbGF5Q29udHJvbEJ1dHRvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIHJvdW5kIHRvZ2dsZSBidXR0b24gdGhhdCBkaXNwbGF5cyBzb21lIGN1c3RvbSBpY29uIHdoZW4gcGxheWluZyBhbmQgYSB0cmlhbmd1bGFyIFwiUGxheVwiIGljb24gd2hlbiBub3QgcGxheWluZy5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIEtleWJvYXJkTGlzdGVuZXIsIE5vZGUsIE9uZUtleVN0cm9rZSwgUGF0aCwgUERPTVZhbHVlVHlwZSB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBCb29sZWFuUm91bmRUb2dnbGVCdXR0b24sIHsgQm9vbGVhblJvdW5kVG9nZ2xlQnV0dG9uT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3N1bi9qcy9idXR0b25zL0Jvb2xlYW5Sb3VuZFRvZ2dsZUJ1dHRvbi5qcyc7XHJcbmltcG9ydCBUU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vLi4vdGFtYm8vanMvVFNvdW5kUGxheWVyLmpzJztcclxuaW1wb3J0IHBhdXNlU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vLi4vdGFtYm8vanMvc2hhcmVkLXNvdW5kLXBsYXllcnMvcGF1c2VTb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBwbGF5U291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vLi4vdGFtYm8vanMvc2hhcmVkLXNvdW5kLXBsYXllcnMvcGxheVNvdW5kUGxheWVyLmpzJztcclxuaW1wb3J0IFBsYXlJY29uU2hhcGUgZnJvbSAnLi4vUGxheUljb25TaGFwZS5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuLi9zY2VuZXJ5UGhldC5qcyc7XHJcbmltcG9ydCBTY2VuZXJ5UGhldENvbnN0YW50cyBmcm9tICcuLi9TY2VuZXJ5UGhldENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBTY2VuZXJ5UGhldFN0cmluZ3MgZnJvbSAnLi4vU2NlbmVyeVBoZXRTdHJpbmdzLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIHJhZGl1cz86IG51bWJlcjtcclxuXHJcbiAgLy8ge1NjYWxlIGZhY3RvciBhcHBsaWVkIHRvIHRoZSBidXR0b24gd2hlbiB0aGUgXCJQbGF5XCIgYnV0dG9uIGlzIHNob3duIChpc1BsYXlpbmdQcm9wZXJ0eSBpcyBmYWxzZSkuXHJcbiAgLy8gUGhFVCBjb252ZW50aW9uIGlzIHRvIGluY3JlYXNlIHRoZSBzaXplIG9mIHRoZSBcIlBsYXlcIiBidXR0b24gd2hlbiBpbnRlcmFjdGlvbiB3aXRoIHRoZSBzaW0gZG9lcyBOT1QgdW5wYXVzZSB0aGUgc2ltLlxyXG4gIHNjYWxlRmFjdG9yV2hlbk5vdFBsYXlpbmc/OiBudW1iZXI7XHJcblxyXG4gIC8vIHBkb206IElmIHRydWUsIGxpc3RlbmVyIGlzIGFkZGVkIHRvIHRvZ2dsZSBpc1BsYXlpbmdQcm9wZXJ0eSB3aXRoIGtleSBjb21tYW5kIFwiYWx0ICsga1wiIHJlZ2FyZGxlc3NcclxuICAvLyBvZiB3aGVyZSBmb2N1cyBpcyBpbiB0aGUgZG9jdW1lbnQuIE9ubHkgaWYgdGhlIHNpbSBzdXBwb3J0cyBJbnRlcmFjdGl2ZSBEZXNjcmlwdGlvbi5cclxuICBpbmNsdWRlR2xvYmFsSG90a2V5PzogYm9vbGVhbjtcclxuXHJcbiAgLy8gTGFiZWwgZm9yIHRoZSBidXR0b24gaW4gdGhlIFBET00gd2hlbiB0aGUgYnV0dG9uIHdpbGwgc2V0IGlzUGxheWluZ1Byb3BlcnR5IHRvIHRydWVcclxuICBzdGFydFBsYXlpbmdMYWJlbD86IFBET01WYWx1ZVR5cGU7XHJcblxyXG4gIC8vIExhYmVsIGZvciB0aGUgYnV0dG9uIGluIHRoZSBQRE9NIHdoZW4gdGhlIGJ1dHRvbiB3aWxsIHNldCBpc1BsYXlpbmdQcm9wZXJ0eSB0byBmYWxzZVxyXG4gIGVuZFBsYXlpbmdMYWJlbD86IFBET01WYWx1ZVR5cGUgfCBudWxsO1xyXG5cclxuICAvLyBzb3VuZCBnZW5lcmF0aW9uXHJcbiAgdmFsdWVPZmZTb3VuZFBsYXllcj86IFRTb3VuZFBsYXllcjtcclxuICB2YWx1ZU9uU291bmRQbGF5ZXI/OiBUU291bmRQbGF5ZXI7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBQbGF5Q29udHJvbEJ1dHRvbk9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIEJvb2xlYW5Sb3VuZFRvZ2dsZUJ1dHRvbk9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQbGF5Q29udHJvbEJ1dHRvbiBleHRlbmRzIEJvb2xlYW5Sb3VuZFRvZ2dsZUJ1dHRvbiB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVBsYXlTdG9wQnV0dG9uOiAoKSA9PiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gaXNQbGF5aW5nUHJvcGVydHlcclxuICAgKiBAcGFyYW0gZW5kUGxheWluZ0ljb24gLSBpY29uIGZvciB0aGUgYnV0dG9uIHdoZW4gcHJlc3NpbmcgaXQgd2lsbCBzdG9wIHBsYXlcclxuICAgKiBAcGFyYW0gcHJvdmlkZWRPcHRpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBpc1BsYXlpbmdQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4sIGVuZFBsYXlpbmdJY29uOiBOb2RlLCBwcm92aWRlZE9wdGlvbnM/OiBQbGF5Q29udHJvbEJ1dHRvbk9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxQbGF5Q29udHJvbEJ1dHRvbk9wdGlvbnMsIFNlbGZPcHRpb25zLCBCb29sZWFuUm91bmRUb2dnbGVCdXR0b25PcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBTZWxmT3B0aW9uc1xyXG4gICAgICByYWRpdXM6IFNjZW5lcnlQaGV0Q29uc3RhbnRzLlBMQVlfQ09OVFJPTF9CVVRUT05fUkFESVVTLFxyXG4gICAgICBzY2FsZUZhY3RvcldoZW5Ob3RQbGF5aW5nOiAxLFxyXG4gICAgICBpbmNsdWRlR2xvYmFsSG90a2V5OiBmYWxzZSxcclxuICAgICAgc3RhcnRQbGF5aW5nTGFiZWw6IFNjZW5lcnlQaGV0U3RyaW5ncy5hMTF5LnBsYXlDb250cm9sQnV0dG9uLnBsYXlTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgZW5kUGxheWluZ0xhYmVsOiBudWxsLFxyXG4gICAgICB2YWx1ZU9mZlNvdW5kUGxheWVyOiBwYXVzZVNvdW5kUGxheWVyLFxyXG4gICAgICB2YWx1ZU9uU291bmRQbGF5ZXI6IHBsYXlTb3VuZFBsYXllcixcclxuXHJcbiAgICAgIC8vIEl0J3MgZGltZW5zaW9ucyBhcmUgY2FsY3VsYXRlZCBkeW5hbWljYWxseSBiYXNlZCBvbiByYWRpdXMgYmVsb3cgdG8gbWFrZSBzdXJlIHRoZSBwbGF5IGFuZCBwYXVzZSBidXR0b25zIGFyZVxyXG4gICAgICAvLyBpbiBzeW5jLlxyXG4gICAgICB4TWFyZ2luOiAwLFxyXG4gICAgICB5TWFyZ2luOiAwXHJcblxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5zY2FsZUZhY3RvcldoZW5Ob3RQbGF5aW5nID4gMCwgJ2J1dHRvbiBzY2FsZSBmYWN0b3IgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCcgKTtcclxuXHJcbiAgICAvLyBwbGF5IGFuZCBwYXVzZSBpY29ucyBhcmUgc2l6ZWQgcmVsYXRpdmUgdG8gdGhlIHJhZGl1c1xyXG4gICAgY29uc3QgcGxheVdpZHRoID0gb3B0aW9ucy5yYWRpdXMgKiAwLjg7XHJcbiAgICBjb25zdCBwbGF5SGVpZ2h0ID0gb3B0aW9ucy5yYWRpdXM7XHJcblxyXG4gICAgY29uc3QgcGxheVBhdGggPSBuZXcgUGF0aCggbmV3IFBsYXlJY29uU2hhcGUoIHBsYXlXaWR0aCwgcGxheUhlaWdodCApLCB7XHJcbiAgICAgIGZpbGw6ICdibGFjaycsXHJcbiAgICAgIGNlbnRlclg6IG9wdGlvbnMucmFkaXVzICogMC4wNSwgLy8gbW92ZSB0byByaWdodCBzbGlnaHRseSBzaW5jZSB3ZSBkb24ndCB3YW50IGl0IGV4YWN0bHkgY2VudGVyZWRcclxuICAgICAgY2VudGVyWTogMFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHB1dCB0aGUgcGxheSBhbmQgc3RvcCBzeW1ib2xzIGluc2lkZSBjaXJjbGVzIHNvIHRoZXkgaGF2ZSB0aGUgc2FtZSBib3VuZHMsXHJcbiAgICAvLyBvdGhlcndpc2UgQm9vbGVhblRvZ2dsZU5vZGUgd2lsbCByZS1hZGp1c3QgdGhlaXIgcG9zaXRpb25zIHJlbGF0aXZlIHRvIGVhY2ggb3RoZXJcclxuICAgIGNvbnN0IHBsYXlDaXJjbGUgPSBuZXcgQ2lyY2xlKCBvcHRpb25zLnJhZGl1cywge1xyXG4gICAgICBjaGlsZHJlbjogWyBwbGF5UGF0aCBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgZW5kUGxheWluZ0ljb24uY2VudGVyWCA9IDA7XHJcbiAgICBlbmRQbGF5aW5nSWNvbi5jZW50ZXJZID0gMDtcclxuXHJcbiAgICBjb25zdCBlbmRQbGF5aW5nQ2lyY2xlID0gbmV3IENpcmNsZSggb3B0aW9ucy5yYWRpdXMsIHtcclxuICAgICAgY2hpbGRyZW46IFsgZW5kUGxheWluZ0ljb24gXVxyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCBpc1BsYXlpbmdQcm9wZXJ0eSwgZW5kUGxheWluZ0NpcmNsZSwgcGxheUNpcmNsZSwgb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IGlzUGxheWluZ0xpc3RlbmVyID0gKCBpc1BsYXlpbmc6IGJvb2xlYW4sIG9sZFZhbHVlOiBib29sZWFuIHwgbnVsbCApID0+IHtcclxuXHJcbiAgICAgIC8vIHBkb20gLSBhY2Nlc3NpYmxlIG5hbWUgZm9yIHRoZSBidXR0b25cclxuICAgICAgdGhpcy5pbm5lckNvbnRlbnQgPSBpc1BsYXlpbmcgPyBvcHRpb25zLmVuZFBsYXlpbmdMYWJlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG9wdGlvbnMuc3RhcnRQbGF5aW5nTGFiZWw7XHJcblxyXG4gICAgICAvLyBzbyB3ZSBkb24ndCBzY2FsZSBkb3duIHRoZSBidXR0b24gaW1tZWRpYXRlbHkgaWYgaXNQbGF5aW5nUHJvcGVydHkgaXMgaW5pdGlhbGx5IGZhbHNlXHJcbiAgICAgIGNvbnN0IHJ1bm5pbmdTY2FsZSA9IG9sZFZhbHVlID09PSBudWxsID8gMSA6IDEgLyBvcHRpb25zLnNjYWxlRmFjdG9yV2hlbk5vdFBsYXlpbmc7XHJcbiAgICAgIHRoaXMuc2NhbGUoIGlzUGxheWluZyA/IHJ1bm5pbmdTY2FsZSA6IG9wdGlvbnMuc2NhbGVGYWN0b3JXaGVuTm90UGxheWluZyApO1xyXG4gICAgfTtcclxuICAgIGlzUGxheWluZ1Byb3BlcnR5LmxpbmsoIGlzUGxheWluZ0xpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gYSBsaXN0ZW5lciB0aGF0IHRvZ2dsZXMgdGhlIGlzUGxheWluZ1Byb3BlcnR5IHdpdGggaG90a2V5IEFsdCtLLCByZWdhcmRsZXNzIG9mIHdoZXJlIGZvY3VzIGlzIGluIHRoZSBkb2N1bWVudFxyXG4gICAgbGV0IGdsb2JhbEtleWJvYXJkTGlzdGVuZXI6IEtleWJvYXJkTGlzdGVuZXI8T25lS2V5U3Ryb2tlW10+IHwgbnVsbCA9IG51bGw7XHJcbiAgICBpZiAoIG9wdGlvbnMuaW5jbHVkZUdsb2JhbEhvdGtleSAmJiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnN1cHBvcnRzSW50ZXJhY3RpdmVEZXNjcmlwdGlvbiApIHtcclxuICAgICAgZ2xvYmFsS2V5Ym9hcmRMaXN0ZW5lciA9IEtleWJvYXJkTGlzdGVuZXIuY3JlYXRlR2xvYmFsKCB0aGlzLCB7XHJcbiAgICAgICAga2V5czogWyAnYWx0K2snIF0gYXMgY29uc3QsXHJcbiAgICAgICAgZmlyZU9uRG93bjogZmFsc2UsXHJcbiAgICAgICAgZmlyZTogKCkgPT4ge1xyXG4gICAgICAgICAgaXNQbGF5aW5nUHJvcGVydHkuc2V0KCAhaXNQbGF5aW5nUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgICAgICAgIGNvbnN0IHNvdW5kUGxheWVyID0gaXNQbGF5aW5nUHJvcGVydHkuZ2V0KCkgPyBvcHRpb25zLnZhbHVlT25Tb3VuZFBsYXllciA6IG9wdGlvbnMudmFsdWVPZmZTb3VuZFBsYXllcjtcclxuICAgICAgICAgIGlmICggc291bmRQbGF5ZXIgKSB7IHNvdW5kUGxheWVyLnBsYXkoKTsgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGlzcG9zZVBsYXlTdG9wQnV0dG9uID0gKCkgPT4ge1xyXG4gICAgICBpZiAoIGlzUGxheWluZ1Byb3BlcnR5Lmhhc0xpc3RlbmVyKCBpc1BsYXlpbmdMaXN0ZW5lciApICkge1xyXG4gICAgICAgIGlzUGxheWluZ1Byb3BlcnR5LnVubGluayggaXNQbGF5aW5nTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIGdsb2JhbEtleWJvYXJkTGlzdGVuZXIgKSB7XHJcbiAgICAgICAgZ2xvYmFsS2V5Ym9hcmRMaXN0ZW5lci5kaXNwb3NlKCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZVBsYXlTdG9wQnV0dG9uKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ1BsYXlDb250cm9sQnV0dG9uJywgUGxheUNvbnRyb2xCdXR0b24gKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxPQUFPQSxTQUFTLE1BQU0sb0NBQW9DO0FBQzFELFNBQVNDLE1BQU0sRUFBRUMsZ0JBQWdCLEVBQXNCQyxJQUFJLFFBQXVCLGdDQUFnQztBQUNsSCxPQUFPQyx3QkFBd0IsTUFBMkMscURBQXFEO0FBRS9ILE9BQU9DLGdCQUFnQixNQUFNLDREQUE0RDtBQUN6RixPQUFPQyxlQUFlLE1BQU0sMkRBQTJEO0FBQ3ZGLE9BQU9DLGFBQWEsTUFBTSxxQkFBcUI7QUFDL0MsT0FBT0MsV0FBVyxNQUFNLG1CQUFtQjtBQUMzQyxPQUFPQyxvQkFBb0IsTUFBTSw0QkFBNEI7QUFDN0QsT0FBT0Msa0JBQWtCLE1BQU0sMEJBQTBCO0FBMkJ6RCxlQUFlLE1BQU1DLGlCQUFpQixTQUFTUCx3QkFBd0IsQ0FBQztFQUl0RTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ1NRLFdBQVdBLENBQUVDLGlCQUFvQyxFQUFFQyxjQUFvQixFQUFFQyxlQUEwQyxFQUFHO0lBRTNILE1BQU1DLE9BQU8sR0FBR2hCLFNBQVMsQ0FBeUUsQ0FBQyxDQUFFO01BRW5HO01BQ0FpQixNQUFNLEVBQUVSLG9CQUFvQixDQUFDUywwQkFBMEI7TUFDdkRDLHlCQUF5QixFQUFFLENBQUM7TUFDNUJDLG1CQUFtQixFQUFFLEtBQUs7TUFDMUJDLGlCQUFpQixFQUFFWCxrQkFBa0IsQ0FBQ1ksSUFBSSxDQUFDQyxpQkFBaUIsQ0FBQ0Msa0JBQWtCO01BQy9FQyxlQUFlLEVBQUUsSUFBSTtNQUNyQkMsbUJBQW1CLEVBQUVyQixnQkFBZ0I7TUFDckNzQixrQkFBa0IsRUFB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