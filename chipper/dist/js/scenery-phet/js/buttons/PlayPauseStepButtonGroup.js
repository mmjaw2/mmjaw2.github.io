// Copyright 2022-2023, University of Colorado Boulder

/**
 * PlayPauseStepButtonGroup has a play & pause button, optional step-forward button, and optional step-back button.
 * It's typically a subcomponent of TimeControlNode, and was originally an inner class of TimeControlNode.
 *
 * @author Denzell Barnett (PhET Interactive Simulations)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import SceneryPhetConstants from '../SceneryPhetConstants.js';
import PlayPauseButton from './PlayPauseButton.js';
import StepBackwardButton from './StepBackwardButton.js';
import StepForwardButton from './StepForwardButton.js';
import sceneryPhet from '../sceneryPhet.js';
import { HBox } from '../../../scenery/js/imports.js';
import optionize, { combineOptions } from '../../../phet-core/js/optionize.js';
import Tandem from '../../../tandem/js/Tandem.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import BooleanIO from '../../../tandem/js/types/BooleanIO.js';
import SceneryPhetStrings from '../SceneryPhetStrings.js';
const DEFAULT_STEP_BUTTON_RADIUS = 15;
const DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION = 5;
export default class PlayPauseStepButtonGroup extends HBox {
  constructor(isPlayingProperty, providedOptions) {
    const options = optionize()({
      // {boolean} - if true, a StepForwardButton is included in the button group
      includeStepForwardButton: true,
      // {boolean} - if true, a StepBackwardButton is included in the button group
      includeStepBackwardButton: false,
      // {number} horizontal space between Play/Pause and Step buttons
      playPauseStepXSpacing: 10,
      // Options for the PlayPauseButton
      playPauseButtonOptions: {
        radius: SceneryPhetConstants.DEFAULT_BUTTON_RADIUS,
        touchAreaDilation: 5
      },
      // Options for the StepBackwardButton
      stepBackwardButtonOptions: {
        radius: DEFAULT_STEP_BUTTON_RADIUS,
        touchAreaDilation: DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION
      },
      // Options for the StepForwardButton
      stepForwardButtonOptions: {
        radius: DEFAULT_STEP_BUTTON_RADIUS,
        touchAreaDilation: DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION
      },
      // HBoxOptions
      resize: false,
      // don't change layout if playPauseButton resizes with scaleFactorWhenNotPlaying

      // phet-io
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'ButtonGroup',
      // pdom
      tagName: 'div',
      // so that it can receive descriptions
      appendDescription: true,
      playingDescription: SceneryPhetStrings.a11y.playPauseStepButtonGroup.playingDescriptionStringProperty,
      pausedDescription: SceneryPhetStrings.a11y.playPauseStepButtonGroup.pausedDescriptionStringProperty
    }, providedOptions);

    // by default, the step buttons are enabled when isPlayingProperty is false, but only create a PhET-iO instrumented
    // Property if it is going to be used
    if (!options.stepForwardButtonOptions.enabledProperty || !options.stepBackwardButtonOptions.enabledProperty) {
      // This is clearer than having the variable names match exactly. Opt out below
      // eslint-disable-next-line tandem-name-should-match
      const defaultEnabledProperty = DerivedProperty.not(isPlayingProperty, {
        tandem: options.tandem.createTandem('enabledProperty'),
        phetioValueType: BooleanIO
      });
      if (!options.stepForwardButtonOptions.enabledProperty) {
        options.stepForwardButtonOptions.enabledProperty = defaultEnabledProperty;
      }
      if (!options.stepBackwardButtonOptions.enabledProperty) {
        options.stepBackwardButtonOptions.enabledProperty = defaultEnabledProperty;
      }
    }
    const children = [];
    const playPauseButton = new PlayPauseButton(isPlayingProperty, combineOptions({
      tandem: options.tandem.createTandem('playPauseButton'),
      phetioDocumentation: 'Button to control the animation in the simulation. This will also stop the model from stepping.'
    }, options.playPauseButtonOptions));
    children.push(playPauseButton);
    let stepForwardButton = null;
    if (options.includeStepForwardButton) {
      stepForwardButton = new StepForwardButton(combineOptions({
        tandem: options.tandem.createTandem('stepForwardButton'),
        phetioDocumentation: 'Progress the simulation a single model step forwards.'
      }, options.stepForwardButtonOptions));
      children.push(stepForwardButton);
    }
    let stepBackwardButton = null;
    if (options.includeStepBackwardButton) {
      stepBackwardButton = new StepBackwardButton(combineOptions({
        phetioDocumentation: 'Progress the simulation a single model step backwards.',
        tandem: options.tandem.createTandem('stepBackwardButton')
      }, options.stepBackwardButtonOptions));
      children.unshift(stepBackwardButton);
    }
    options.spacing = options.playPauseStepXSpacing;
    options.children = children;
    super(options);
    this.playPauseButton = playPauseButton;
    const playingListener = playing => {
      this.descriptionContent = playing ? options.playingDescription : options.pausedDescription;
    };
    isPlayingProperty.link(playingListener);
    this.disposePlayPauseStepButtonGroup = () => {
      isPlayingProperty.unlink(playingListener);
      playPauseButton.dispose();
      stepForwardButton && stepForwardButton.dispose();
      stepBackwardButton && stepBackwardButton.dispose();
    };
  }

  /**
   * Get the center of the PlayPauseButton, in the local coordinate frame of the PlayPauseStepButtonGroup.
   */
  getPlayPauseButtonCenter() {
    return this.playPauseButton.center;
  }
  dispose() {
    this.disposePlayPauseStepButtonGroup();
    super.dispose();
  }
}
sceneryPhet.register('PlayPauseStepButtonGroup', PlayPauseStepButtonGroup);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY2VuZXJ5UGhldENvbnN0YW50cyIsIlBsYXlQYXVzZUJ1dHRvbiIsIlN0ZXBCYWNrd2FyZEJ1dHRvbiIsIlN0ZXBGb3J3YXJkQnV0dG9uIiwic2NlbmVyeVBoZXQiLCJIQm94Iiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJUYW5kZW0iLCJEZXJpdmVkUHJvcGVydHkiLCJCb29sZWFuSU8iLCJTY2VuZXJ5UGhldFN0cmluZ3MiLCJERUZBVUxUX1NURVBfQlVUVE9OX1JBRElVUyIsIkRFRkFVTFRfU1RFUF9CVVRUT05fVE9VQ0hfQVJFQV9ESUxBVElPTiIsIlBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCIsImNvbnN0cnVjdG9yIiwiaXNQbGF5aW5nUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaW5jbHVkZVN0ZXBGb3J3YXJkQnV0dG9uIiwiaW5jbHVkZVN0ZXBCYWNrd2FyZEJ1dHRvbiIsInBsYXlQYXVzZVN0ZXBYU3BhY2luZyIsInBsYXlQYXVzZUJ1dHRvbk9wdGlvbnMiLCJyYWRpdXMiLCJERUZBVUxUX0JVVFRPTl9SQURJVVMiLCJ0b3VjaEFyZWFEaWxhdGlvbiIsInN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMiLCJzdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnMiLCJyZXNpemUiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInRhbmRlbU5hbWVTdWZmaXgiLCJ0YWdOYW1lIiwiYXBwZW5kRGVzY3JpcHRpb24iLCJwbGF5aW5nRGVzY3JpcHRpb24iLCJhMTF5IiwicGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwIiwicGxheWluZ0Rlc2NyaXB0aW9uU3RyaW5nUHJvcGVydHkiLCJwYXVzZWREZXNjcmlwdGlvbiIsInBhdXNlZERlc2NyaXB0aW9uU3RyaW5nUHJvcGVydHkiLCJlbmFibGVkUHJvcGVydHkiLCJkZWZhdWx0RW5hYmxlZFByb3BlcnR5Iiwibm90IiwiY3JlYXRlVGFuZGVtIiwicGhldGlvVmFsdWVUeXBlIiwiY2hpbGRyZW4iLCJwbGF5UGF1c2VCdXR0b24iLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwicHVzaCIsInN0ZXBGb3J3YXJkQnV0dG9uIiwic3RlcEJhY2t3YXJkQnV0dG9uIiwidW5zaGlmdCIsInNwYWNpbmciLCJwbGF5aW5nTGlzdGVuZXIiLCJwbGF5aW5nIiwiZGVzY3JpcHRpb25Db250ZW50IiwibGluayIsImRpc3Bvc2VQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAiLCJ1bmxpbmsiLCJkaXNwb3NlIiwiZ2V0UGxheVBhdXNlQnV0dG9uQ2VudGVyIiwiY2VudGVyIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjItMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwIGhhcyBhIHBsYXkgJiBwYXVzZSBidXR0b24sIG9wdGlvbmFsIHN0ZXAtZm9yd2FyZCBidXR0b24sIGFuZCBvcHRpb25hbCBzdGVwLWJhY2sgYnV0dG9uLlxyXG4gKiBJdCdzIHR5cGljYWxseSBhIHN1YmNvbXBvbmVudCBvZiBUaW1lQ29udHJvbE5vZGUsIGFuZCB3YXMgb3JpZ2luYWxseSBhbiBpbm5lciBjbGFzcyBvZiBUaW1lQ29udHJvbE5vZGUuXHJcbiAqXHJcbiAqIEBhdXRob3IgRGVuemVsbCBCYXJuZXR0IChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBTY2VuZXJ5UGhldENvbnN0YW50cyBmcm9tICcuLi9TY2VuZXJ5UGhldENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IFBsYXlQYXVzZUJ1dHRvbiwgeyBQbGF5UGF1c2VCdXR0b25PcHRpb25zIH0gZnJvbSAnLi9QbGF5UGF1c2VCdXR0b24uanMnO1xyXG5pbXBvcnQgU3RlcEJhY2t3YXJkQnV0dG9uLCB7IFN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMgfSBmcm9tICcuL1N0ZXBCYWNrd2FyZEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBTdGVwRm9yd2FyZEJ1dHRvbiwgeyBTdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnMgfSBmcm9tICcuL1N0ZXBGb3J3YXJkQnV0dG9uLmpzJztcclxuaW1wb3J0IHNjZW5lcnlQaGV0IGZyb20gJy4uL3NjZW5lcnlQaGV0LmpzJztcclxuaW1wb3J0IHsgSEJveCwgSEJveE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm9vbGVhbklPIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9Cb29sZWFuSU8uanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFNjZW5lcnlQaGV0U3RyaW5ncyBmcm9tICcuLi9TY2VuZXJ5UGhldFN0cmluZ3MuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcblxyXG5jb25zdCBERUZBVUxUX1NURVBfQlVUVE9OX1JBRElVUyA9IDE1O1xyXG5jb25zdCBERUZBVUxUX1NURVBfQlVUVE9OX1RPVUNIX0FSRUFfRElMQVRJT04gPSA1O1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gaWYgdHJ1ZSwgYSBTdGVwRm9yd2FyZEJ1dHRvbiBpcyBpbmNsdWRlZCBpbiB0aGUgYnV0dG9uIGdyb3VwXHJcbiAgaW5jbHVkZVN0ZXBGb3J3YXJkQnV0dG9uPzogYm9vbGVhbjtcclxuXHJcbiAgLy8gaWYgdHJ1ZSwgYSBTdGVwQmFja3dhcmRCdXR0b24gaXMgaW5jbHVkZWQgaW4gdGhlIGJ1dHRvbiBncm91cFxyXG4gIGluY2x1ZGVTdGVwQmFja3dhcmRCdXR0b24/OiBib29sZWFuO1xyXG5cclxuICAvLyBob3Jpem9udGFsIHNwYWNlIGJldHdlZW4gUGxheS9QYXVzZSBhbmQgU3RlcCBidXR0b25zXHJcbiAgcGxheVBhdXNlU3RlcFhTcGFjaW5nPzogbnVtYmVyO1xyXG5cclxuICAvLyBvcHRpb25zIGZvciBidXR0b24gc3ViY29tcG9uZW50c1xyXG4gIHBsYXlQYXVzZUJ1dHRvbk9wdGlvbnM/OiBTdHJpY3RPbWl0PFBsYXlQYXVzZUJ1dHRvbk9wdGlvbnMsICd0YW5kZW0nIHwgJ3BoZXRpb0RvY3VtZW50YXRpb24nPjtcclxuICBzdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnM/OiBTdHJpY3RPbWl0PFN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucywgJ3RhbmRlbScgfCAncGhldGlvRG9jdW1lbnRhdGlvbic+O1xyXG4gIHN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnM/OiBTdHJpY3RPbWl0PFN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMsICd0YW5kZW0nIHwgJ3BoZXRpb0RvY3VtZW50YXRpb24nPjtcclxuXHJcbiAgLy8gcGRvbSAtIGRlc2NyaXB0aW9uIGZvciB0aGlzIGJ1dHRvbiBncm91cCBpbiBpdHMgcGxheWluZyBvciBwYXVzZWQgc3RhdGUgZnJvbSB0aGUgaXNQbGF5aW5nUHJvcGVydHlcclxuICBwbGF5aW5nRGVzY3JpcHRpb24/OiBzdHJpbmcgfCBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+O1xyXG4gIHBhdXNlZERlc2NyaXB0aW9uPzogc3RyaW5nIHwgVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8SEJveE9wdGlvbnMsICdzcGFjaW5nJyB8ICdjaGlsZHJlbic+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwIGV4dGVuZHMgSEJveCB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGxheVBhdXNlQnV0dG9uOiBQbGF5UGF1c2VCdXR0b247XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGlzUGxheWluZ1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPiwgcHJvdmlkZWRPcHRpb25zPzogUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cE9wdGlvbnMsIFNlbGZPcHRpb25zLCBIQm94T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8ge2Jvb2xlYW59IC0gaWYgdHJ1ZSwgYSBTdGVwRm9yd2FyZEJ1dHRvbiBpcyBpbmNsdWRlZCBpbiB0aGUgYnV0dG9uIGdyb3VwXHJcbiAgICAgIGluY2x1ZGVTdGVwRm9yd2FyZEJ1dHRvbjogdHJ1ZSxcclxuXHJcbiAgICAgIC8vIHtib29sZWFufSAtIGlmIHRydWUsIGEgU3RlcEJhY2t3YXJkQnV0dG9uIGlzIGluY2x1ZGVkIGluIHRoZSBidXR0b24gZ3JvdXBcclxuICAgICAgaW5jbHVkZVN0ZXBCYWNrd2FyZEJ1dHRvbjogZmFsc2UsXHJcblxyXG4gICAgICAvLyB7bnVtYmVyfSBob3Jpem9udGFsIHNwYWNlIGJldHdlZW4gUGxheS9QYXVzZSBhbmQgU3RlcCBidXR0b25zXHJcbiAgICAgIHBsYXlQYXVzZVN0ZXBYU3BhY2luZzogMTAsXHJcblxyXG4gICAgICAvLyBPcHRpb25zIGZvciB0aGUgUGxheVBhdXNlQnV0dG9uXHJcbiAgICAgIHBsYXlQYXVzZUJ1dHRvbk9wdGlvbnM6IHtcclxuICAgICAgICByYWRpdXM6IFNjZW5lcnlQaGV0Q29uc3RhbnRzLkRFRkFVTFRfQlVUVE9OX1JBRElVUyxcclxuICAgICAgICB0b3VjaEFyZWFEaWxhdGlvbjogNVxyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gT3B0aW9ucyBmb3IgdGhlIFN0ZXBCYWNrd2FyZEJ1dHRvblxyXG4gICAgICBzdGVwQmFja3dhcmRCdXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgcmFkaXVzOiBERUZBVUxUX1NURVBfQlVUVE9OX1JBRElVUyxcclxuICAgICAgICB0b3VjaEFyZWFEaWxhdGlvbjogREVGQVVMVF9TVEVQX0JVVFRPTl9UT1VDSF9BUkVBX0RJTEFUSU9OXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBPcHRpb25zIGZvciB0aGUgU3RlcEZvcndhcmRCdXR0b25cclxuICAgICAgc3RlcEZvcndhcmRCdXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgcmFkaXVzOiBERUZBVUxUX1NURVBfQlVUVE9OX1JBRElVUyxcclxuICAgICAgICB0b3VjaEFyZWFEaWxhdGlvbjogREVGQVVMVF9TVEVQX0JVVFRPTl9UT1VDSF9BUkVBX0RJTEFUSU9OXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBIQm94T3B0aW9uc1xyXG4gICAgICByZXNpemU6IGZhbHNlLCAvLyBkb24ndCBjaGFuZ2UgbGF5b3V0IGlmIHBsYXlQYXVzZUJ1dHRvbiByZXNpemVzIHdpdGggc2NhbGVGYWN0b3JXaGVuTm90UGxheWluZ1xyXG5cclxuICAgICAgLy8gcGhldC1pb1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRCxcclxuICAgICAgdGFuZGVtTmFtZVN1ZmZpeDogJ0J1dHRvbkdyb3VwJyxcclxuXHJcbiAgICAgIC8vIHBkb21cclxuICAgICAgdGFnTmFtZTogJ2RpdicsIC8vIHNvIHRoYXQgaXQgY2FuIHJlY2VpdmUgZGVzY3JpcHRpb25zXHJcbiAgICAgIGFwcGVuZERlc2NyaXB0aW9uOiB0cnVlLFxyXG4gICAgICBwbGF5aW5nRGVzY3JpcHRpb246IFNjZW5lcnlQaGV0U3RyaW5ncy5hMTF5LnBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cC5wbGF5aW5nRGVzY3JpcHRpb25TdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgcGF1c2VkRGVzY3JpcHRpb246IFNjZW5lcnlQaGV0U3RyaW5ncy5hMTF5LnBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cC5wYXVzZWREZXNjcmlwdGlvblN0cmluZ1Byb3BlcnR5XHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBieSBkZWZhdWx0LCB0aGUgc3RlcCBidXR0b25zIGFyZSBlbmFibGVkIHdoZW4gaXNQbGF5aW5nUHJvcGVydHkgaXMgZmFsc2UsIGJ1dCBvbmx5IGNyZWF0ZSBhIFBoRVQtaU8gaW5zdHJ1bWVudGVkXHJcbiAgICAvLyBQcm9wZXJ0eSBpZiBpdCBpcyBnb2luZyB0byBiZSB1c2VkXHJcbiAgICBpZiAoICggIW9wdGlvbnMuc3RlcEZvcndhcmRCdXR0b25PcHRpb25zLmVuYWJsZWRQcm9wZXJ0eSApIHx8ICggIW9wdGlvbnMuc3RlcEJhY2t3YXJkQnV0dG9uT3B0aW9ucy5lbmFibGVkUHJvcGVydHkgKSApIHtcclxuXHJcbiAgICAgIC8vIFRoaXMgaXMgY2xlYXJlciB0aGFuIGhhdmluZyB0aGUgdmFyaWFibGUgbmFtZXMgbWF0Y2ggZXhhY3RseS4gT3B0IG91dCBiZWxvd1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgdGFuZGVtLW5hbWUtc2hvdWxkLW1hdGNoXHJcbiAgICAgIGNvbnN0IGRlZmF1bHRFbmFibGVkUHJvcGVydHkgPSBEZXJpdmVkUHJvcGVydHkubm90KCBpc1BsYXlpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZW5hYmxlZFByb3BlcnR5JyApLFxyXG4gICAgICAgIHBoZXRpb1ZhbHVlVHlwZTogQm9vbGVhbklPXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGlmICggIW9wdGlvbnMuc3RlcEZvcndhcmRCdXR0b25PcHRpb25zLmVuYWJsZWRQcm9wZXJ0eSApIHtcclxuXHJcbiAgICAgICAgb3B0aW9ucy5zdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ID0gZGVmYXVsdEVuYWJsZWRQcm9wZXJ0eTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoICFvcHRpb25zLnN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ICkge1xyXG5cclxuICAgICAgICBvcHRpb25zLnN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ID0gZGVmYXVsdEVuYWJsZWRQcm9wZXJ0eTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoaWxkcmVuID0gW107XHJcblxyXG4gICAgY29uc3QgcGxheVBhdXNlQnV0dG9uID0gbmV3IFBsYXlQYXVzZUJ1dHRvbiggaXNQbGF5aW5nUHJvcGVydHksXHJcbiAgICAgIGNvbWJpbmVPcHRpb25zPFBsYXlQYXVzZUJ1dHRvbk9wdGlvbnM+KCB7XHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwbGF5UGF1c2VCdXR0b24nICksXHJcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ0J1dHRvbiB0byBjb250cm9sIHRoZSBhbmltYXRpb24gaW4gdGhlIHNpbXVsYXRpb24uIFRoaXMgd2lsbCBhbHNvIHN0b3AgdGhlIG1vZGVsIGZyb20gc3RlcHBpbmcuJ1xyXG4gICAgICB9LCBvcHRpb25zLnBsYXlQYXVzZUJ1dHRvbk9wdGlvbnMgKSApO1xyXG4gICAgY2hpbGRyZW4ucHVzaCggcGxheVBhdXNlQnV0dG9uICk7XHJcblxyXG4gICAgbGV0IHN0ZXBGb3J3YXJkQnV0dG9uOiBTdGVwRm9yd2FyZEJ1dHRvbiB8IG51bGwgPSBudWxsO1xyXG4gICAgaWYgKCBvcHRpb25zLmluY2x1ZGVTdGVwRm9yd2FyZEJ1dHRvbiApIHtcclxuICAgICAgc3RlcEZvcndhcmRCdXR0b24gPSBuZXcgU3RlcEZvcndhcmRCdXR0b24oXHJcbiAgICAgICAgY29tYmluZU9wdGlvbnM8U3RlcEZvcndhcmRCdXR0b25PcHRpb25zPigge1xyXG4gICAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdzdGVwRm9yd2FyZEJ1dHRvbicgKSxcclxuICAgICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdQcm9ncmVzcyB0aGUgc2ltdWxhdGlvbiBhIHNpbmdsZSBtb2RlbCBzdGVwIGZvcndhcmRzLidcclxuICAgICAgICB9LCBvcHRpb25zLnN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucyApICk7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIHN0ZXBGb3J3YXJkQnV0dG9uICk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHN0ZXBCYWNrd2FyZEJ1dHRvbjogU3RlcEJhY2t3YXJkQnV0dG9uIHwgbnVsbCA9IG51bGw7XHJcbiAgICBpZiAoIG9wdGlvbnMuaW5jbHVkZVN0ZXBCYWNrd2FyZEJ1dHRvbiApIHtcclxuICAgICAgc3RlcEJhY2t3YXJkQnV0dG9uID0gbmV3IFN0ZXBCYWNrd2FyZEJ1dHRvbihcclxuICAgICAgICBjb21iaW5lT3B0aW9uczxTdGVwQmFja3dhcmRCdXR0b25PcHRpb25zPigge1xyXG4gICAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1Byb2dyZXNzIHRoZSBzaW11bGF0aW9uIGEgc2luZ2xlIG1vZGVsIHN0ZXAgYmFja3dhcmRzLicsXHJcbiAgICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3N0ZXBCYWNrd2FyZEJ1dHRvbicgKVxyXG4gICAgICAgIH0sIG9wdGlvbnMuc3RlcEJhY2t3YXJkQnV0dG9uT3B0aW9ucyApICk7XHJcbiAgICAgIGNoaWxkcmVuLnVuc2hpZnQoIHN0ZXBCYWNrd2FyZEJ1dHRvbiApO1xyXG4gICAgfVxyXG5cclxuICAgIG9wdGlvbnMuc3BhY2luZyA9IG9wdGlvbnMucGxheVBhdXNlU3RlcFhTcGFjaW5nO1xyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IGNoaWxkcmVuO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5wbGF5UGF1c2VCdXR0b24gPSBwbGF5UGF1c2VCdXR0b247XHJcblxyXG4gICAgY29uc3QgcGxheWluZ0xpc3RlbmVyID0gKCBwbGF5aW5nOiBib29sZWFuICkgPT4ge1xyXG4gICAgICB0aGlzLmRlc2NyaXB0aW9uQ29udGVudCA9IHBsYXlpbmcgPyBvcHRpb25zLnBsYXlpbmdEZXNjcmlwdGlvbiA6IG9wdGlvbnMucGF1c2VkRGVzY3JpcHRpb247XHJcbiAgICB9O1xyXG4gICAgaXNQbGF5aW5nUHJvcGVydHkubGluayggcGxheWluZ0xpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwID0gKCkgPT4ge1xyXG4gICAgICBpc1BsYXlpbmdQcm9wZXJ0eS51bmxpbmsoIHBsYXlpbmdMaXN0ZW5lciApO1xyXG5cclxuICAgICAgcGxheVBhdXNlQnV0dG9uLmRpc3Bvc2UoKTtcclxuICAgICAgc3RlcEZvcndhcmRCdXR0b24gJiYgc3RlcEZvcndhcmRCdXR0b24uZGlzcG9zZSgpO1xyXG4gICAgICBzdGVwQmFja3dhcmRCdXR0b24gJiYgc3RlcEJhY2t3YXJkQnV0dG9uLmRpc3Bvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIGNlbnRlciBvZiB0aGUgUGxheVBhdXNlQnV0dG9uLCBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZSBvZiB0aGUgUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQbGF5UGF1c2VCdXR0b25DZW50ZXIoKTogVmVjdG9yMiB7XHJcbiAgICByZXR1cm4gdGhpcy5wbGF5UGF1c2VCdXR0b24uY2VudGVyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnlQaGV0LnJlZ2lzdGVyKCAnUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwJywgUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0Esb0JBQW9CLE1BQU0sNEJBQTRCO0FBRTdELE9BQU9DLGVBQWUsTUFBa0Msc0JBQXNCO0FBQzlFLE9BQU9DLGtCQUFrQixNQUFxQyx5QkFBeUI7QUFDdkYsT0FBT0MsaUJBQWlCLE1BQW9DLHdCQUF3QjtBQUNwRixPQUFPQyxXQUFXLE1BQU0sbUJBQW1CO0FBQzNDLFNBQVNDLElBQUksUUFBcUIsZ0NBQWdDO0FBQ2xFLE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLG9DQUFvQztBQUM5RSxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBQ2pE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