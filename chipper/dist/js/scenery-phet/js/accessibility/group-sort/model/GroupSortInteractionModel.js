// Copyright 2024, University of Colorado Boulder

/**
 * "Group Sort Interaction" overview:
 * Model type for the "group sort" interaction. This interaction behaves as such:
 * - Alt input treats the entire group as a single entity. Instead of using scenery focus control, it is handled internally.
 * - Focusing on the group highlights a "selected" group item. The interaction starts in "selection" state.
 * - Interaction keys change the "selection" (focus) of a group item. Focus highlight around the selected item is solid.
 * - The selected item is grabbable (see note below).
 * - Space/enter are used to "grab" the selection, turning the interaction state to "sorting" state. Pressing again
 *   toggles back to "selection" state. In sorting state, the focus highlight is dashed.
 * - Interaction keys in "sorting" state sort the group item, which changes the value of that group item.
 *
 * NOTE: "focus" in this interaction is called "selection" as to not overload the term. This is because the
 * "focused" group item is stored and changed even when it doesn't have browser focus on it. See selectedGroupItemProperty.
 *
 * Class Overview:
 * This class holds model information about the state of the group sort interaction. This includes specifics about
 * whether the interaction is in "selection" or "sorting" state. Also about if portions of the interaction have
 * "successfully" occurred such that hint cues don't need to be displayed anymore.
 *
 * A note about mouse input:
 * All group sort instances thus far have been accompanied by mouse/touch input as well. Though this goes beyond the
 * scope of group sort to implement, there are mouse-specific Properties here in the model that help sync group
 * sort state/cueing with the visual cueing too. Please follow instructions below to make sure those are used
 * appropriately.
 *
 * A note about using with scenes:
 * In general, there is just one instance of this per model, and not per scene. This is because if someone can
 * successfully grab and sort in one scene, then that learned understanding about the interaction should transfer to
 * the next scene.
 *
 * A note about PhET-iO:
 * Properties that handle visual cue states are not PhET-iO instrumented, because they are considered transient.
 * See showMouseCueProperty for the extent of PhET-iO customization.
 *
 * Implementation steps (these steps apply to the model and view):
 * - use with GroupSortInteractionView
 * - reset selectedGroupItemProperty with a sim-specific heuristic when the underlying model needs to update the best
 *   first selection. (Also see GroupSortInteractionView.getGroupItemToSelect for a hook to apply this on group focus).
 * - the grab/release cue is created for you, and can be repositioned by accessing from your GroupSortInteractionView instance.
 * - Handle your own keyboard and mouse "sort indicator cue node" (see registerUpdateSortCueNode())
 * - use setMouseSortedGroupItem( true ) on mouse/touch sorting interactions to make sure that the mouse sort cue visibility is correct.
 * - mouseSortCueVisibleProperty should be set by client, using mouseSortCueShouldBeVisible() in addition to any sim-specific logic required.
 * - It is best to use one model per screen and one view per scene.
 * - use GroupSortInteractionView.groupSortGroupFocusHighlightPath.shape to set the group highlight dynamically
 * - use positionSortCueNodeEmitter to update the position of the sort cue for the keyboard interaction.
 * - use enabledProperty to control if sorting is enabled. Note that focus and selection are always available (for keyboard tab order consistency)
 * - Note that if GroupSortInteractionModel is PhET-iO instrumented, ItemModel must be a PhetioObject.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Marla Schulz (PhET Interactive Simulations)
 */

import sceneryPhet from '../../../sceneryPhet.js';
import optionize from '../../../../../phet-core/js/optionize.js';
import Property from '../../../../../axon/js/Property.js';
import Tandem from '../../../../../tandem/js/Tandem.js';
import BooleanProperty from '../../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../../axon/js/DerivedProperty.js';
import PhetioObject from '../../../../../tandem/js/PhetioObject.js';
import EnabledComponent from '../../../../../axon/js/EnabledComponent.js';
import IOType from '../../../../../tandem/js/types/IOType.js';
import ReferenceIO from '../../../../../tandem/js/types/ReferenceIO.js';
import NullableIO from '../../../../../tandem/js/types/NullableIO.js';
export default class GroupSortInteractionModel extends EnabledComponent {
  // The group item that is the selected/focused/sorted. If null, then there is nothing to sort (no items?), and the
  // interaction will no-op. Feel free to dynamically change this value to update the realtime selection of the
  // group sort interaction.

  // Whether a group item is being grabbed via keyboard interaction. When true, the focus highlight will display as
  // dashed instead of solid.
  isGroupItemKeyboardGrabbedProperty = new BooleanProperty(false);

  // Whether the 'Press SPACE to Grab or Release' dialog is showing

  // Whether the keyboard sort icon cue is showing

  // Whether the keyboard is currently focused on a sim component
  isKeyboardFocusedProperty = new BooleanProperty(false);

  // Properties that switch to true when the specified action has occurred once.
  hasKeyboardGrabbedGroupItemProperty = new BooleanProperty(false);

  // Whether a group item has been sorted with keyboard input.
  hasKeyboardSortedGroupItemProperty = new BooleanProperty(false);

  // Whether the user has changed the selected group item with the keyboard controls. Note, this will not be true until
  // the selection changes from the default upon focus.
  hasKeyboardSelectedGroupItemProperty = new BooleanProperty(false);

  // Whether the mouse/touch sort icon cue is currently showing on the group item area.
  // Client should set this Property as well as use it for their mouse sort cue node.
  // Client should manually register callbacks to update the visual cue with registerUpdateSortCueNode().

  // A PhET-iO specific Property for opting out of showing the visual mouse cue. This is not reset, and is used to
  // calculate the visibility of the mouse cue. If true, it doesn't mean that the cue is visible, but that it is possible
  // to show the cue when appropriate. Set to false to opt out of cue visibility.

  // Whether a group item has been sorted with mouse/touch (non keyboard) input. This is set to true from outside
  // input (not from keyboard/group sort input), but is important for cue showing.
  hasMouseSortedGroupItemProperty = new BooleanProperty(false);

  // Whether any group item has yet been sorted to a new value, even if not by the "group sort" interaction. This
  // Property should be used to control the mouseSortCueVisibleProperty. The mouse sort cue does not need to be shown
  // if a keyboard sort has occurred (because now the user knows that the group items are sortable).

  constructor(providedOptions) {
    const options = optionize()({
      tandem: Tandem.REQUIRED,
      phetioEnabledPropertyInstrumented: false,
      initialMouseSortCueVisible: false
    }, providedOptions);
    super(options);
    this.getGroupItemValue = options.getGroupItemValue;
    this.selectedGroupItemProperty = new Property(null, {
      isValidValue: x => !!x || x === null,
      tandem: options.tandem.createTandem('selectedGroupItemProperty'),
      phetioValueType: NullableIO(ReferenceIO(IOType.ObjectIO)),
      phetioReadOnly: true,
      phetioDocumentation: 'For PhET-iO internal use only. Tracks the current selection for the interaction. Null means there is no selection.'
    });
    assert && this.selectedGroupItemProperty.lazyLink(selectedGroupItem => {
      // TODO: Turn this on! But we can't until reorganizeStack respects the selection first. Note! This can cause a very weird bug where while sorting, all soccer balls end up in the same stack when using the arrow keys. I believe it is because reorganize stack triggers a call to change the selection to a different ball (keeping it in the large stack) https://github.com/phetsims/soccer-common/issues/7
      // assert && assert( !this.isGroupItemKeyboardGrabbedProperty.value, 'should not change selection when sorting' );

      // If we are PhET-iO instrumented, so should the selection.
      if (Tandem.VALIDATION && selectedGroupItem && options.tandem.supplied) {
        assert && assert(selectedGroupItem instanceof PhetioObject && selectedGroupItem.isPhetioInstrumented(), 'instrumented GroupSortInteractionModels require its group items to be instrumented.');
      }
    });
    this.mouseSortCueVisibleProperty = new Property(options.initialMouseSortCueVisible);
    this.showMouseCueProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('showMouseCueProperty'),
      phetioDocumentation: 'This controls if the visual cue Node for mouse/touch sorting is displayed. Set to false ' + 'to hide the cue. A value of true does not mean the cue is visible, but instead that it can ' + 'be shown when appropriate'
    });
    this.hasGroupItemBeenSortedProperty = new DerivedProperty([this.hasMouseSortedGroupItemProperty, this.hasKeyboardSortedGroupItemProperty, this.showMouseCueProperty], (hasMouseSortedGroupItem, hasKeyboardSortedGroupItem, showMouseCue) => {
      return hasMouseSortedGroupItem || hasKeyboardSortedGroupItem || !showMouseCue;
    });
    this.grabReleaseCueVisibleProperty = new DerivedProperty([this.selectedGroupItemProperty, this.hasKeyboardGrabbedGroupItemProperty, this.isKeyboardFocusedProperty, this.enabledProperty], (selectedGroupItem, hasGrabbedGroupItem, hasKeyboardFocus, enabled) => {
      return selectedGroupItem !== null && !hasGrabbedGroupItem && hasKeyboardFocus && enabled;
    });
    this.keyboardSortCueVisibleProperty = new DerivedProperty([this.selectedGroupItemProperty, this.isGroupItemKeyboardGrabbedProperty, this.isKeyboardFocusedProperty, this.hasKeyboardSortedGroupItemProperty], (selectedGroupItem, isGroupItemKeyboardGrabbed, isKeyboardFocused, hasKeyboardSortedGroupItem) => selectedGroupItem !== null && isGroupItemKeyboardGrabbed && isKeyboardFocused && !hasKeyboardSortedGroupItem);
  }

  // Wrap this in a function to make sure that hasMouseSortedGroupItemProperty is never read or listened to. Instead,
  // listen to hasGroupItemBeenSortedProperty (like to set the mouseSortCueVisibleProperty).
  setMouseSortedGroupItem(sortedByMouse) {
    this.hasMouseSortedGroupItemProperty.value = sortedByMouse;
  }

  // Given the knowledge that GroupSortInteractionModel has, should the mouse sort cue be visible? This most often
  // isn't the complete boolean, since there will be sim-specific knowledge that contributes to the final visibility
  // of the Node.
  mouseSortCueShouldBeVisible() {
    return !this.hasGroupItemBeenSortedProperty.value && !this.isKeyboardFocusedProperty.value && this.enabled;
  }

  /**
   * Reset the interaction without changing the cueing logic. This is best called during a data "erase" and also when
   * switching between scenes.
   */
  resetInteractionState() {
    this.selectedGroupItemProperty.reset();
    this.isGroupItemKeyboardGrabbedProperty.reset();
    this.isKeyboardFocusedProperty.reset();
  }
  reset() {
    this.resetInteractionState();

    // Don't reset showMouseCueProperty because it is set only by PhET-iO, and should persist
    this.hasMouseSortedGroupItemProperty.reset();
    this.hasKeyboardGrabbedGroupItemProperty.reset();
    this.hasKeyboardSelectedGroupItemProperty.reset();
    this.hasKeyboardSortedGroupItemProperty.reset();
    this.mouseSortCueVisibleProperty.reset();
  }

  // Clear the selection state for the interaction (setting to null)
  clearSelection() {
    this.selectedGroupItemProperty.value = null;
  }

  // Register your closure responsible for updating the sort-indicator node. This should be called with a callback that
  // updates mouseSortCueVisibleProperty and maybe does other things. You will likely need to call this update function
  // for sim specific usages as well.
  registerUpdateSortCueNode(updateSortIndicatorNode) {
    this.mouseSortCueVisibleProperty.link(updateSortIndicatorNode);
    this.showMouseCueProperty.link(updateSortIndicatorNode);
    this.enabledProperty.link(updateSortIndicatorNode);
    this.selectedGroupItemProperty.link(updateSortIndicatorNode);
    this.hasGroupItemBeenSortedProperty.link(updateSortIndicatorNode);
    this.isKeyboardFocusedProperty.link(updateSortIndicatorNode);
    Tandem.PHET_IO_ENABLED && phet.phetio.phetioEngine.phetioStateEngine.stateSetEmitter.addListener(updateSortIndicatorNode);
    this.disposeEmitter.addListener(() => {
      Tandem.PHET_IO_ENABLED && phet.phetio.phetioEngine.phetioStateEngine.stateSetEmitter.removeListener(updateSortIndicatorNode);
      this.isKeyboardFocusedProperty.unlink(updateSortIndicatorNode);
      this.hasGroupItemBeenSortedProperty.unlink(updateSortIndicatorNode);
      this.mouseSortCueVisibleProperty.unlink(updateSortIndicatorNode);
      this.enabledProperty.unlink(updateSortIndicatorNode);
      this.showMouseCueProperty.unlink(updateSortIndicatorNode);
      this.selectedGroupItemProperty.unlink(updateSortIndicatorNode);
    });
  }
  dispose() {
    this.selectedGroupItemProperty.dispose();
    this.isGroupItemKeyboardGrabbedProperty.dispose();
    this.grabReleaseCueVisibleProperty.dispose();
    this.keyboardSortCueVisibleProperty.dispose();
    this.isKeyboardFocusedProperty.dispose();
    this.hasKeyboardGrabbedGroupItemProperty.dispose();
    this.hasKeyboardSortedGroupItemProperty.dispose();
    this.hasKeyboardSelectedGroupItemProperty.dispose();
    this.mouseSortCueVisibleProperty.dispose();
    this.hasGroupItemBeenSortedProperty.dispose();
    super.dispose();
  }
}
sceneryPhet.register('GroupSortInteractionModel', GroupSortInteractionModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzY2VuZXJ5UGhldCIsIm9wdGlvbml6ZSIsIlByb3BlcnR5IiwiVGFuZGVtIiwiQm9vbGVhblByb3BlcnR5IiwiRGVyaXZlZFByb3BlcnR5IiwiUGhldGlvT2JqZWN0IiwiRW5hYmxlZENvbXBvbmVudCIsIklPVHlwZSIsIlJlZmVyZW5jZUlPIiwiTnVsbGFibGVJTyIsIkdyb3VwU29ydEludGVyYWN0aW9uTW9kZWwiLCJpc0dyb3VwSXRlbUtleWJvYXJkR3JhYmJlZFByb3BlcnR5IiwiaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eSIsImhhc0tleWJvYXJkR3JhYmJlZEdyb3VwSXRlbVByb3BlcnR5IiwiaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSIsImhhc0tleWJvYXJkU2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSIsImhhc01vdXNlU29ydGVkR3JvdXBJdGVtUHJvcGVydHkiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsImluaXRpYWxNb3VzZVNvcnRDdWVWaXNpYmxlIiwiZ2V0R3JvdXBJdGVtVmFsdWUiLCJzZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5IiwiaXNWYWxpZFZhbHVlIiwieCIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1ZhbHVlVHlwZSIsIk9iamVjdElPIiwicGhldGlvUmVhZE9ubHkiLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwiYXNzZXJ0IiwibGF6eUxpbmsiLCJzZWxlY3RlZEdyb3VwSXRlbSIsIlZBTElEQVRJT04iLCJzdXBwbGllZCIsImlzUGhldGlvSW5zdHJ1bWVudGVkIiwibW91c2VTb3J0Q3VlVmlzaWJsZVByb3BlcnR5Iiwic2hvd01vdXNlQ3VlUHJvcGVydHkiLCJoYXNHcm91cEl0ZW1CZWVuU29ydGVkUHJvcGVydHkiLCJoYXNNb3VzZVNvcnRlZEdyb3VwSXRlbSIsImhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtIiwic2hvd01vdXNlQ3VlIiwiZ3JhYlJlbGVhc2VDdWVWaXNpYmxlUHJvcGVydHkiLCJlbmFibGVkUHJvcGVydHkiLCJoYXNHcmFiYmVkR3JvdXBJdGVtIiwiaGFzS2V5Ym9hcmRGb2N1cyIsImVuYWJsZWQiLCJrZXlib2FyZFNvcnRDdWVWaXNpYmxlUHJvcGVydHkiLCJpc0dyb3VwSXRlbUtleWJvYXJkR3JhYmJlZCIsImlzS2V5Ym9hcmRGb2N1c2VkIiwic2V0TW91c2VTb3J0ZWRHcm91cEl0ZW0iLCJzb3J0ZWRCeU1vdXNlIiwidmFsdWUiLCJtb3VzZVNvcnRDdWVTaG91bGRCZVZpc2libGUiLCJyZXNldEludGVyYWN0aW9uU3RhdGUiLCJyZXNldCIsImNsZWFyU2VsZWN0aW9uIiwicmVnaXN0ZXJVcGRhdGVTb3J0Q3VlTm9kZSIsInVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlIiwibGluayIsIlBIRVRfSU9fRU5BQkxFRCIsInBoZXQiLCJwaGV0aW8iLCJwaGV0aW9FbmdpbmUiLCJwaGV0aW9TdGF0ZUVuZ2luZSIsInN0YXRlU2V0RW1pdHRlciIsImFkZExpc3RlbmVyIiwiZGlzcG9zZUVtaXR0ZXIiLCJyZW1vdmVMaXN0ZW5lciIsInVubGluayIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdyb3VwU29ydEludGVyYWN0aW9uTW9kZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFwiR3JvdXAgU29ydCBJbnRlcmFjdGlvblwiIG92ZXJ2aWV3OlxyXG4gKiBNb2RlbCB0eXBlIGZvciB0aGUgXCJncm91cCBzb3J0XCIgaW50ZXJhY3Rpb24uIFRoaXMgaW50ZXJhY3Rpb24gYmVoYXZlcyBhcyBzdWNoOlxyXG4gKiAtIEFsdCBpbnB1dCB0cmVhdHMgdGhlIGVudGlyZSBncm91cCBhcyBhIHNpbmdsZSBlbnRpdHkuIEluc3RlYWQgb2YgdXNpbmcgc2NlbmVyeSBmb2N1cyBjb250cm9sLCBpdCBpcyBoYW5kbGVkIGludGVybmFsbHkuXHJcbiAqIC0gRm9jdXNpbmcgb24gdGhlIGdyb3VwIGhpZ2hsaWdodHMgYSBcInNlbGVjdGVkXCIgZ3JvdXAgaXRlbS4gVGhlIGludGVyYWN0aW9uIHN0YXJ0cyBpbiBcInNlbGVjdGlvblwiIHN0YXRlLlxyXG4gKiAtIEludGVyYWN0aW9uIGtleXMgY2hhbmdlIHRoZSBcInNlbGVjdGlvblwiIChmb2N1cykgb2YgYSBncm91cCBpdGVtLiBGb2N1cyBoaWdobGlnaHQgYXJvdW5kIHRoZSBzZWxlY3RlZCBpdGVtIGlzIHNvbGlkLlxyXG4gKiAtIFRoZSBzZWxlY3RlZCBpdGVtIGlzIGdyYWJiYWJsZSAoc2VlIG5vdGUgYmVsb3cpLlxyXG4gKiAtIFNwYWNlL2VudGVyIGFyZSB1c2VkIHRvIFwiZ3JhYlwiIHRoZSBzZWxlY3Rpb24sIHR1cm5pbmcgdGhlIGludGVyYWN0aW9uIHN0YXRlIHRvIFwic29ydGluZ1wiIHN0YXRlLiBQcmVzc2luZyBhZ2FpblxyXG4gKiAgIHRvZ2dsZXMgYmFjayB0byBcInNlbGVjdGlvblwiIHN0YXRlLiBJbiBzb3J0aW5nIHN0YXRlLCB0aGUgZm9jdXMgaGlnaGxpZ2h0IGlzIGRhc2hlZC5cclxuICogLSBJbnRlcmFjdGlvbiBrZXlzIGluIFwic29ydGluZ1wiIHN0YXRlIHNvcnQgdGhlIGdyb3VwIGl0ZW0sIHdoaWNoIGNoYW5nZXMgdGhlIHZhbHVlIG9mIHRoYXQgZ3JvdXAgaXRlbS5cclxuICpcclxuICogTk9URTogXCJmb2N1c1wiIGluIHRoaXMgaW50ZXJhY3Rpb24gaXMgY2FsbGVkIFwic2VsZWN0aW9uXCIgYXMgdG8gbm90IG92ZXJsb2FkIHRoZSB0ZXJtLiBUaGlzIGlzIGJlY2F1c2UgdGhlXHJcbiAqIFwiZm9jdXNlZFwiIGdyb3VwIGl0ZW0gaXMgc3RvcmVkIGFuZCBjaGFuZ2VkIGV2ZW4gd2hlbiBpdCBkb2Vzbid0IGhhdmUgYnJvd3NlciBmb2N1cyBvbiBpdC4gU2VlIHNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHkuXHJcbiAqXHJcbiAqIENsYXNzIE92ZXJ2aWV3OlxyXG4gKiBUaGlzIGNsYXNzIGhvbGRzIG1vZGVsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzdGF0ZSBvZiB0aGUgZ3JvdXAgc29ydCBpbnRlcmFjdGlvbi4gVGhpcyBpbmNsdWRlcyBzcGVjaWZpY3MgYWJvdXRcclxuICogd2hldGhlciB0aGUgaW50ZXJhY3Rpb24gaXMgaW4gXCJzZWxlY3Rpb25cIiBvciBcInNvcnRpbmdcIiBzdGF0ZS4gQWxzbyBhYm91dCBpZiBwb3J0aW9ucyBvZiB0aGUgaW50ZXJhY3Rpb24gaGF2ZVxyXG4gKiBcInN1Y2Nlc3NmdWxseVwiIG9jY3VycmVkIHN1Y2ggdGhhdCBoaW50IGN1ZXMgZG9uJ3QgbmVlZCB0byBiZSBkaXNwbGF5ZWQgYW55bW9yZS5cclxuICpcclxuICogQSBub3RlIGFib3V0IG1vdXNlIGlucHV0OlxyXG4gKiBBbGwgZ3JvdXAgc29ydCBpbnN0YW5jZXMgdGh1cyBmYXIgaGF2ZSBiZWVuIGFjY29tcGFuaWVkIGJ5IG1vdXNlL3RvdWNoIGlucHV0IGFzIHdlbGwuIFRob3VnaCB0aGlzIGdvZXMgYmV5b25kIHRoZVxyXG4gKiBzY29wZSBvZiBncm91cCBzb3J0IHRvIGltcGxlbWVudCwgdGhlcmUgYXJlIG1vdXNlLXNwZWNpZmljIFByb3BlcnRpZXMgaGVyZSBpbiB0aGUgbW9kZWwgdGhhdCBoZWxwIHN5bmMgZ3JvdXBcclxuICogc29ydCBzdGF0ZS9jdWVpbmcgd2l0aCB0aGUgdmlzdWFsIGN1ZWluZyB0b28uIFBsZWFzZSBmb2xsb3cgaW5zdHJ1Y3Rpb25zIGJlbG93IHRvIG1ha2Ugc3VyZSB0aG9zZSBhcmUgdXNlZFxyXG4gKiBhcHByb3ByaWF0ZWx5LlxyXG4gKlxyXG4gKiBBIG5vdGUgYWJvdXQgdXNpbmcgd2l0aCBzY2VuZXM6XHJcbiAqIEluIGdlbmVyYWwsIHRoZXJlIGlzIGp1c3Qgb25lIGluc3RhbmNlIG9mIHRoaXMgcGVyIG1vZGVsLCBhbmQgbm90IHBlciBzY2VuZS4gVGhpcyBpcyBiZWNhdXNlIGlmIHNvbWVvbmUgY2FuXHJcbiAqIHN1Y2Nlc3NmdWxseSBncmFiIGFuZCBzb3J0IGluIG9uZSBzY2VuZSwgdGhlbiB0aGF0IGxlYXJuZWQgdW5kZXJzdGFuZGluZyBhYm91dCB0aGUgaW50ZXJhY3Rpb24gc2hvdWxkIHRyYW5zZmVyIHRvXHJcbiAqIHRoZSBuZXh0IHNjZW5lLlxyXG4gKlxyXG4gKiBBIG5vdGUgYWJvdXQgUGhFVC1pTzpcclxuICogUHJvcGVydGllcyB0aGF0IGhhbmRsZSB2aXN1YWwgY3VlIHN0YXRlcyBhcmUgbm90IFBoRVQtaU8gaW5zdHJ1bWVudGVkLCBiZWNhdXNlIHRoZXkgYXJlIGNvbnNpZGVyZWQgdHJhbnNpZW50LlxyXG4gKiBTZWUgc2hvd01vdXNlQ3VlUHJvcGVydHkgZm9yIHRoZSBleHRlbnQgb2YgUGhFVC1pTyBjdXN0b21pemF0aW9uLlxyXG4gKlxyXG4gKiBJbXBsZW1lbnRhdGlvbiBzdGVwcyAodGhlc2Ugc3RlcHMgYXBwbHkgdG8gdGhlIG1vZGVsIGFuZCB2aWV3KTpcclxuICogLSB1c2Ugd2l0aCBHcm91cFNvcnRJbnRlcmFjdGlvblZpZXdcclxuICogLSByZXNldCBzZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5IHdpdGggYSBzaW0tc3BlY2lmaWMgaGV1cmlzdGljIHdoZW4gdGhlIHVuZGVybHlpbmcgbW9kZWwgbmVlZHMgdG8gdXBkYXRlIHRoZSBiZXN0XHJcbiAqICAgZmlyc3Qgc2VsZWN0aW9uLiAoQWxzbyBzZWUgR3JvdXBTb3J0SW50ZXJhY3Rpb25WaWV3LmdldEdyb3VwSXRlbVRvU2VsZWN0IGZvciBhIGhvb2sgdG8gYXBwbHkgdGhpcyBvbiBncm91cCBmb2N1cykuXHJcbiAqIC0gdGhlIGdyYWIvcmVsZWFzZSBjdWUgaXMgY3JlYXRlZCBmb3IgeW91LCBhbmQgY2FuIGJlIHJlcG9zaXRpb25lZCBieSBhY2Nlc3NpbmcgZnJvbSB5b3VyIEdyb3VwU29ydEludGVyYWN0aW9uVmlldyBpbnN0YW5jZS5cclxuICogLSBIYW5kbGUgeW91ciBvd24ga2V5Ym9hcmQgYW5kIG1vdXNlIFwic29ydCBpbmRpY2F0b3IgY3VlIG5vZGVcIiAoc2VlIHJlZ2lzdGVyVXBkYXRlU29ydEN1ZU5vZGUoKSlcclxuICogLSB1c2Ugc2V0TW91c2VTb3J0ZWRHcm91cEl0ZW0oIHRydWUgKSBvbiBtb3VzZS90b3VjaCBzb3J0aW5nIGludGVyYWN0aW9ucyB0byBtYWtlIHN1cmUgdGhhdCB0aGUgbW91c2Ugc29ydCBjdWUgdmlzaWJpbGl0eSBpcyBjb3JyZWN0LlxyXG4gKiAtIG1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eSBzaG91bGQgYmUgc2V0IGJ5IGNsaWVudCwgdXNpbmcgbW91c2VTb3J0Q3VlU2hvdWxkQmVWaXNpYmxlKCkgaW4gYWRkaXRpb24gdG8gYW55IHNpbS1zcGVjaWZpYyBsb2dpYyByZXF1aXJlZC5cclxuICogLSBJdCBpcyBiZXN0IHRvIHVzZSBvbmUgbW9kZWwgcGVyIHNjcmVlbiBhbmQgb25lIHZpZXcgcGVyIHNjZW5lLlxyXG4gKiAtIHVzZSBHcm91cFNvcnRJbnRlcmFjdGlvblZpZXcuZ3JvdXBTb3J0R3JvdXBGb2N1c0hpZ2hsaWdodFBhdGguc2hhcGUgdG8gc2V0IHRoZSBncm91cCBoaWdobGlnaHQgZHluYW1pY2FsbHlcclxuICogLSB1c2UgcG9zaXRpb25Tb3J0Q3VlTm9kZUVtaXR0ZXIgdG8gdXBkYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgc29ydCBjdWUgZm9yIHRoZSBrZXlib2FyZCBpbnRlcmFjdGlvbi5cclxuICogLSB1c2UgZW5hYmxlZFByb3BlcnR5IHRvIGNvbnRyb2wgaWYgc29ydGluZyBpcyBlbmFibGVkLiBOb3RlIHRoYXQgZm9jdXMgYW5kIHNlbGVjdGlvbiBhcmUgYWx3YXlzIGF2YWlsYWJsZSAoZm9yIGtleWJvYXJkIHRhYiBvcmRlciBjb25zaXN0ZW5jeSlcclxuICogLSBOb3RlIHRoYXQgaWYgR3JvdXBTb3J0SW50ZXJhY3Rpb25Nb2RlbCBpcyBQaEVULWlPIGluc3RydW1lbnRlZCwgSXRlbU1vZGVsIG11c3QgYmUgYSBQaGV0aW9PYmplY3QuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBNYXJsYSBTY2h1bHogKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHNjZW5lcnlQaGV0IGZyb20gJy4uLy4uLy4uL3NjZW5lcnlQaGV0LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFBoZXRpb09iamVjdCwgeyBQaGV0aW9PYmplY3RPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1BoZXRpb09iamVjdC5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRW5hYmxlZENvbXBvbmVudCwgeyBFbmFibGVkQ29tcG9uZW50T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvRW5hYmxlZENvbXBvbmVudC5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBSZWZlcmVuY2VJTyBmcm9tICcuLi8uLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvUmVmZXJlbmNlSU8uanMnO1xyXG5pbXBvcnQgTnVsbGFibGVJTyBmcm9tICcuLi8uLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVsbGFibGVJTy5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zPEl0ZW1Nb2RlbD4gPSB7XHJcblxyXG4gIC8vIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBcInZhbHVlXCIgZm9yIGEgZ3JvdXAgaXRlbSBzZXQgdG8gaXQuIFRoZSB2YWx1ZSBpcyB3aGVyZSB0aGUgaXRlbSBzaG91bGQgYmUgc29ydGVkLlxyXG4gIC8vIE51bGwgbWVhbnMgdGhhdCBpdCBpc24ndCBwYXJ0IG9mIHRoaXMgaW50ZXJhY3Rpb24gKGRpZmZlcmVudCBzY2VuZS9ub3QgYWN0aXZlL2V0YykuXHJcbiAgZ2V0R3JvdXBJdGVtVmFsdWU6ICggaXRlbU1vZGVsOiBJdGVtTW9kZWwgKSA9PiBudW1iZXIgfCBudWxsO1xyXG5cclxuICAvLyBEZWZpbmUgdGhlIHN0YXJ0dXAgdmFsdWUgb2YgdGhlIG1vdXNlU29ydEN1ZS4gRmFsc2UgYnkgZGVmYXVsdC5cclxuICBpbml0aWFsTW91c2VTb3J0Q3VlVmlzaWJsZT86IGJvb2xlYW47XHJcbn0gJiBQaWNrPFBoZXRpb09iamVjdE9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbnR5cGUgUGFyZW50T3B0aW9ucyA9IEVuYWJsZWRDb21wb25lbnRPcHRpb25zO1xyXG5cclxuZXhwb3J0IHR5cGUgR3JvdXBTb3J0SW50ZXJhY3Rpb25Nb2RlbE9wdGlvbnM8SXRlbU1vZGVsPiA9IFNlbGZPcHRpb25zPEl0ZW1Nb2RlbD4gJiBQYXJlbnRPcHRpb25zO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR3JvdXBTb3J0SW50ZXJhY3Rpb25Nb2RlbDxJdGVtTW9kZWw+IGV4dGVuZHMgRW5hYmxlZENvbXBvbmVudCB7XHJcblxyXG4gIC8vIFRoZSBncm91cCBpdGVtIHRoYXQgaXMgdGhlIHNlbGVjdGVkL2ZvY3VzZWQvc29ydGVkLiBJZiBudWxsLCB0aGVuIHRoZXJlIGlzIG5vdGhpbmcgdG8gc29ydCAobm8gaXRlbXM/KSwgYW5kIHRoZVxyXG4gIC8vIGludGVyYWN0aW9uIHdpbGwgbm8tb3AuIEZlZWwgZnJlZSB0byBkeW5hbWljYWxseSBjaGFuZ2UgdGhpcyB2YWx1ZSB0byB1cGRhdGUgdGhlIHJlYWx0aW1lIHNlbGVjdGlvbiBvZiB0aGVcclxuICAvLyBncm91cCBzb3J0IGludGVyYWN0aW9uLlxyXG4gIHB1YmxpYyByZWFkb25seSBzZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5OiBQcm9wZXJ0eTxJdGVtTW9kZWwgfCBudWxsPjtcclxuXHJcbiAgLy8gV2hldGhlciBhIGdyb3VwIGl0ZW0gaXMgYmVpbmcgZ3JhYmJlZCB2aWEga2V5Ym9hcmQgaW50ZXJhY3Rpb24uIFdoZW4gdHJ1ZSwgdGhlIGZvY3VzIGhpZ2hsaWdodCB3aWxsIGRpc3BsYXkgYXNcclxuICAvLyBkYXNoZWQgaW5zdGVhZCBvZiBzb2xpZC5cclxuICBwdWJsaWMgcmVhZG9ubHkgaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcblxyXG4gIC8vIFdoZXRoZXIgdGhlICdQcmVzcyBTUEFDRSB0byBHcmFiIG9yIFJlbGVhc2UnIGRpYWxvZyBpcyBzaG93aW5nXHJcbiAgcHVibGljIHJlYWRvbmx5IGdyYWJSZWxlYXNlQ3VlVmlzaWJsZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gV2hldGhlciB0aGUga2V5Ym9hcmQgc29ydCBpY29uIGN1ZSBpcyBzaG93aW5nXHJcbiAgcHVibGljIHJlYWRvbmx5IGtleWJvYXJkU29ydEN1ZVZpc2libGVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIFdoZXRoZXIgdGhlIGtleWJvYXJkIGlzIGN1cnJlbnRseSBmb2N1c2VkIG9uIGEgc2ltIGNvbXBvbmVudFxyXG4gIHB1YmxpYyByZWFkb25seSBpc0tleWJvYXJkRm9jdXNlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuXHJcbiAgLy8gUHJvcGVydGllcyB0aGF0IHN3aXRjaCB0byB0cnVlIHdoZW4gdGhlIHNwZWNpZmllZCBhY3Rpb24gaGFzIG9jY3VycmVkIG9uY2UuXHJcbiAgcHVibGljIHJlYWRvbmx5IGhhc0tleWJvYXJkR3JhYmJlZEdyb3VwSXRlbVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuXHJcbiAgLy8gV2hldGhlciBhIGdyb3VwIGl0ZW0gaGFzIGJlZW4gc29ydGVkIHdpdGgga2V5Ym9hcmQgaW5wdXQuXHJcbiAgcHVibGljIHJlYWRvbmx5IGhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAvLyBXaGV0aGVyIHRoZSB1c2VyIGhhcyBjaGFuZ2VkIHRoZSBzZWxlY3RlZCBncm91cCBpdGVtIHdpdGggdGhlIGtleWJvYXJkIGNvbnRyb2xzLiBOb3RlLCB0aGlzIHdpbGwgbm90IGJlIHRydWUgdW50aWxcclxuICAvLyB0aGUgc2VsZWN0aW9uIGNoYW5nZXMgZnJvbSB0aGUgZGVmYXVsdCB1cG9uIGZvY3VzLlxyXG4gIHB1YmxpYyByZWFkb25seSBoYXNLZXlib2FyZFNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAvLyBXaGV0aGVyIHRoZSBtb3VzZS90b3VjaCBzb3J0IGljb24gY3VlIGlzIGN1cnJlbnRseSBzaG93aW5nIG9uIHRoZSBncm91cCBpdGVtIGFyZWEuXHJcbiAgLy8gQ2xpZW50IHNob3VsZCBzZXQgdGhpcyBQcm9wZXJ0eSBhcyB3ZWxsIGFzIHVzZSBpdCBmb3IgdGhlaXIgbW91c2Ugc29ydCBjdWUgbm9kZS5cclxuICAvLyBDbGllbnQgc2hvdWxkIG1hbnVhbGx5IHJlZ2lzdGVyIGNhbGxiYWNrcyB0byB1cGRhdGUgdGhlIHZpc3VhbCBjdWUgd2l0aCByZWdpc3RlclVwZGF0ZVNvcnRDdWVOb2RlKCkuXHJcbiAgcHVibGljIHJlYWRvbmx5IG1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIEEgUGhFVC1pTyBzcGVjaWZpYyBQcm9wZXJ0eSBmb3Igb3B0aW5nIG91dCBvZiBzaG93aW5nIHRoZSB2aXN1YWwgbW91c2UgY3VlLiBUaGlzIGlzIG5vdCByZXNldCwgYW5kIGlzIHVzZWQgdG9cclxuICAvLyBjYWxjdWxhdGUgdGhlIHZpc2liaWxpdHkgb2YgdGhlIG1vdXNlIGN1ZS4gSWYgdHJ1ZSwgaXQgZG9lc24ndCBtZWFuIHRoYXQgdGhlIGN1ZSBpcyB2aXNpYmxlLCBidXQgdGhhdCBpdCBpcyBwb3NzaWJsZVxyXG4gIC8vIHRvIHNob3cgdGhlIGN1ZSB3aGVuIGFwcHJvcHJpYXRlLiBTZXQgdG8gZmFsc2UgdG8gb3B0IG91dCBvZiBjdWUgdmlzaWJpbGl0eS5cclxuICBwcml2YXRlIHJlYWRvbmx5IHNob3dNb3VzZUN1ZVByb3BlcnR5OiBUUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIFdoZXRoZXIgYSBncm91cCBpdGVtIGhhcyBiZWVuIHNvcnRlZCB3aXRoIG1vdXNlL3RvdWNoIChub24ga2V5Ym9hcmQpIGlucHV0LiBUaGlzIGlzIHNldCB0byB0cnVlIGZyb20gb3V0c2lkZVxyXG4gIC8vIGlucHV0IChub3QgZnJvbSBrZXlib2FyZC9ncm91cCBzb3J0IGlucHV0KSwgYnV0IGlzIGltcG9ydGFudCBmb3IgY3VlIHNob3dpbmcuXHJcbiAgcHVibGljIHJlYWRvbmx5IGhhc01vdXNlU29ydGVkR3JvdXBJdGVtUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAvLyBXaGV0aGVyIGFueSBncm91cCBpdGVtIGhhcyB5ZXQgYmVlbiBzb3J0ZWQgdG8gYSBuZXcgdmFsdWUsIGV2ZW4gaWYgbm90IGJ5IHRoZSBcImdyb3VwIHNvcnRcIiBpbnRlcmFjdGlvbi4gVGhpc1xyXG4gIC8vIFByb3BlcnR5IHNob3VsZCBiZSB1c2VkIHRvIGNvbnRyb2wgdGhlIG1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eS4gVGhlIG1vdXNlIHNvcnQgY3VlIGRvZXMgbm90IG5lZWQgdG8gYmUgc2hvd25cclxuICAvLyBpZiBhIGtleWJvYXJkIHNvcnQgaGFzIG9jY3VycmVkIChiZWNhdXNlIG5vdyB0aGUgdXNlciBrbm93cyB0aGF0IHRoZSBncm91cCBpdGVtcyBhcmUgc29ydGFibGUpLlxyXG4gIHB1YmxpYyByZWFkb25seSBoYXNHcm91cEl0ZW1CZWVuU29ydGVkUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgZ2V0R3JvdXBJdGVtVmFsdWU6ICggaXRlbU1vZGVsOiBJdGVtTW9kZWwgKSA9PiBudW1iZXIgfCBudWxsO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9ucz86IEdyb3VwU29ydEludGVyYWN0aW9uTW9kZWxPcHRpb25zPEl0ZW1Nb2RlbD4gKSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPEdyb3VwU29ydEludGVyYWN0aW9uTW9kZWxPcHRpb25zPEl0ZW1Nb2RlbD4sIFNlbGZPcHRpb25zPEl0ZW1Nb2RlbD4sIFBhcmVudE9wdGlvbnM+KCkoIHtcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXHJcbiAgICAgIHBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZDogZmFsc2UsXHJcbiAgICAgIGluaXRpYWxNb3VzZVNvcnRDdWVWaXNpYmxlOiBmYWxzZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmdldEdyb3VwSXRlbVZhbHVlID0gb3B0aW9ucy5nZXRHcm91cEl0ZW1WYWx1ZTtcclxuXHJcbiAgICB0aGlzLnNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHkgPSBuZXcgUHJvcGVydHk8SXRlbU1vZGVsIHwgbnVsbD4oIG51bGwsIHtcclxuICAgICAgaXNWYWxpZFZhbHVlOiB4ID0+ICEheCB8fCB4ID09PSBudWxsLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb1ZhbHVlVHlwZTogTnVsbGFibGVJTyggUmVmZXJlbmNlSU8oIElPVHlwZS5PYmplY3RJTyApICksXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnRm9yIFBoRVQtaU8gaW50ZXJuYWwgdXNlIG9ubHkuIFRyYWNrcyB0aGUgY3VycmVudCBzZWxlY3Rpb24gZm9yIHRoZSBpbnRlcmFjdGlvbi4gTnVsbCBtZWFucyB0aGVyZSBpcyBubyBzZWxlY3Rpb24uJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIGFzc2VydCAmJiB0aGlzLnNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHkubGF6eUxpbmsoIHNlbGVjdGVkR3JvdXBJdGVtID0+IHtcclxuICAgICAgLy8gVE9ETzogVHVybiB0aGlzIG9uISBCdXQgd2UgY2FuJ3QgdW50aWwgcmVvcmdhbml6ZVN0YWNrIHJlc3BlY3RzIHRoZSBzZWxlY3Rpb24gZmlyc3QuIE5vdGUhIFRoaXMgY2FuIGNhdXNlIGEgdmVyeSB3ZWlyZCBidWcgd2hlcmUgd2hpbGUgc29ydGluZywgYWxsIHNvY2NlciBiYWxscyBlbmQgdXAgaW4gdGhlIHNhbWUgc3RhY2sgd2hlbiB1c2luZyB0aGUgYXJyb3cga2V5cy4gSSBiZWxpZXZlIGl0IGlzIGJlY2F1c2UgcmVvcmdhbml6ZSBzdGFjayB0cmlnZ2VycyBhIGNhbGwgdG8gY2hhbmdlIHRoZSBzZWxlY3Rpb24gdG8gYSBkaWZmZXJlbnQgYmFsbCAoa2VlcGluZyBpdCBpbiB0aGUgbGFyZ2Ugc3RhY2spIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zb2NjZXItY29tbW9uL2lzc3Vlcy83XHJcbiAgICAgIC8vIGFzc2VydCAmJiBhc3NlcnQoICF0aGlzLmlzR3JvdXBJdGVtS2V5Ym9hcmRHcmFiYmVkUHJvcGVydHkudmFsdWUsICdzaG91bGQgbm90IGNoYW5nZSBzZWxlY3Rpb24gd2hlbiBzb3J0aW5nJyApO1xyXG5cclxuICAgICAgLy8gSWYgd2UgYXJlIFBoRVQtaU8gaW5zdHJ1bWVudGVkLCBzbyBzaG91bGQgdGhlIHNlbGVjdGlvbi5cclxuICAgICAgaWYgKCBUYW5kZW0uVkFMSURBVElPTiAmJiBzZWxlY3RlZEdyb3VwSXRlbSAmJiBvcHRpb25zLnRhbmRlbS5zdXBwbGllZCApIHtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBzZWxlY3RlZEdyb3VwSXRlbSBpbnN0YW5jZW9mIFBoZXRpb09iamVjdCAmJiBzZWxlY3RlZEdyb3VwSXRlbS5pc1BoZXRpb0luc3RydW1lbnRlZCgpLFxyXG4gICAgICAgICAgJ2luc3RydW1lbnRlZCBHcm91cFNvcnRJbnRlcmFjdGlvbk1vZGVscyByZXF1aXJlIGl0cyBncm91cCBpdGVtcyB0byBiZSBpbnN0cnVtZW50ZWQuJyApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tb3VzZVNvcnRDdWVWaXNpYmxlUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIG9wdGlvbnMuaW5pdGlhbE1vdXNlU29ydEN1ZVZpc2libGUgKTtcclxuXHJcbiAgICB0aGlzLnNob3dNb3VzZUN1ZVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Nob3dNb3VzZUN1ZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnVGhpcyBjb250cm9scyBpZiB0aGUgdmlzdWFsIGN1ZSBOb2RlIGZvciBtb3VzZS90b3VjaCBzb3J0aW5nIGlzIGRpc3BsYXllZC4gU2V0IHRvIGZhbHNlICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAndG8gaGlkZSB0aGUgY3VlLiBBIHZhbHVlIG9mIHRydWUgZG9lcyBub3QgbWVhbiB0aGUgY3VlIGlzIHZpc2libGUsIGJ1dCBpbnN0ZWFkIHRoYXQgaXQgY2FuICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnYmUgc2hvd24gd2hlbiBhcHByb3ByaWF0ZSdcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcclxuICAgICAgdGhpcy5oYXNNb3VzZVNvcnRlZEdyb3VwSXRlbVByb3BlcnR5LFxyXG4gICAgICB0aGlzLmhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtUHJvcGVydHksXHJcbiAgICAgIHRoaXMuc2hvd01vdXNlQ3VlUHJvcGVydHlcclxuICAgIF0sICggaGFzTW91c2VTb3J0ZWRHcm91cEl0ZW0sIGhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtLCBzaG93TW91c2VDdWUgKSA9PiB7XHJcbiAgICAgIHJldHVybiBoYXNNb3VzZVNvcnRlZEdyb3VwSXRlbSB8fCBoYXNLZXlib2FyZFNvcnRlZEdyb3VwSXRlbSB8fCAhc2hvd01vdXNlQ3VlO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZ3JhYlJlbGVhc2VDdWVWaXNpYmxlUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbXHJcbiAgICAgIHRoaXMuc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSxcclxuICAgICAgdGhpcy5oYXNLZXlib2FyZEdyYWJiZWRHcm91cEl0ZW1Qcm9wZXJ0eSxcclxuICAgICAgdGhpcy5pc0tleWJvYXJkRm9jdXNlZFByb3BlcnR5LFxyXG4gICAgICB0aGlzLmVuYWJsZWRQcm9wZXJ0eVxyXG4gICAgXSwgKCBzZWxlY3RlZEdyb3VwSXRlbSwgaGFzR3JhYmJlZEdyb3VwSXRlbSwgaGFzS2V5Ym9hcmRGb2N1cywgZW5hYmxlZCApID0+IHtcclxuICAgICAgcmV0dXJuIHNlbGVjdGVkR3JvdXBJdGVtICE9PSBudWxsICYmICFoYXNHcmFiYmVkR3JvdXBJdGVtICYmIGhhc0tleWJvYXJkRm9jdXMgJiYgZW5hYmxlZDtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmtleWJvYXJkU29ydEN1ZVZpc2libGVQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcclxuICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5LFxyXG4gICAgICB0aGlzLmlzR3JvdXBJdGVtS2V5Ym9hcmRHcmFiYmVkUHJvcGVydHksXHJcbiAgICAgIHRoaXMuaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eSxcclxuICAgICAgdGhpcy5oYXNLZXlib2FyZFNvcnRlZEdyb3VwSXRlbVByb3BlcnR5XHJcbiAgICBdLCAoIHNlbGVjdGVkR3JvdXBJdGVtLCBpc0dyb3VwSXRlbUtleWJvYXJkR3JhYmJlZCwgaXNLZXlib2FyZEZvY3VzZWQsIGhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtICkgPT5cclxuICAgICAgc2VsZWN0ZWRHcm91cEl0ZW0gIT09IG51bGwgJiYgaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWQgJiYgaXNLZXlib2FyZEZvY3VzZWQgJiYgIWhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtICk7XHJcbiAgfVxyXG5cclxuICAvLyBXcmFwIHRoaXMgaW4gYSBmdW5jdGlvbiB0byBtYWtlIHN1cmUgdGhhdCBoYXNNb3VzZVNvcnRlZEdyb3VwSXRlbVByb3BlcnR5IGlzIG5ldmVyIHJlYWQgb3IgbGlzdGVuZWQgdG8uIEluc3RlYWQsXHJcbiAgLy8gbGlzdGVuIHRvIGhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eSAobGlrZSB0byBzZXQgdGhlIG1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eSkuXHJcbiAgcHVibGljIHNldE1vdXNlU29ydGVkR3JvdXBJdGVtKCBzb3J0ZWRCeU1vdXNlOiBib29sZWFuICk6IHZvaWQge1xyXG4gICAgdGhpcy5oYXNNb3VzZVNvcnRlZEdyb3VwSXRlbVByb3BlcnR5LnZhbHVlID0gc29ydGVkQnlNb3VzZTtcclxuICB9XHJcblxyXG4gIC8vIEdpdmVuIHRoZSBrbm93bGVkZ2UgdGhhdCBHcm91cFNvcnRJbnRlcmFjdGlvbk1vZGVsIGhhcywgc2hvdWxkIHRoZSBtb3VzZSBzb3J0IGN1ZSBiZSB2aXNpYmxlPyBUaGlzIG1vc3Qgb2Z0ZW5cclxuICAvLyBpc24ndCB0aGUgY29tcGxldGUgYm9vbGVhbiwgc2luY2UgdGhlcmUgd2lsbCBiZSBzaW0tc3BlY2lmaWMga25vd2xlZGdlIHRoYXQgY29udHJpYnV0ZXMgdG8gdGhlIGZpbmFsIHZpc2liaWxpdHlcclxuICAvLyBvZiB0aGUgTm9kZS5cclxuICBwdWJsaWMgbW91c2VTb3J0Q3VlU2hvdWxkQmVWaXNpYmxlKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICF0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eS52YWx1ZSAmJlxyXG4gICAgICAgICAgICF0aGlzLmlzS2V5Ym9hcmRGb2N1c2VkUHJvcGVydHkudmFsdWUgJiZcclxuICAgICAgICAgICB0aGlzLmVuYWJsZWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldCB0aGUgaW50ZXJhY3Rpb24gd2l0aG91dCBjaGFuZ2luZyB0aGUgY3VlaW5nIGxvZ2ljLiBUaGlzIGlzIGJlc3QgY2FsbGVkIGR1cmluZyBhIGRhdGEgXCJlcmFzZVwiIGFuZCBhbHNvIHdoZW5cclxuICAgKiBzd2l0Y2hpbmcgYmV0d2VlbiBzY2VuZXMuXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0SW50ZXJhY3Rpb25TdGF0ZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5pc0dyb3VwSXRlbUtleWJvYXJkR3JhYmJlZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmlzS2V5Ym9hcmRGb2N1c2VkUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMucmVzZXRJbnRlcmFjdGlvblN0YXRlKCk7XHJcblxyXG4gICAgLy8gRG9uJ3QgcmVzZXQgc2hvd01vdXNlQ3VlUHJvcGVydHkgYmVjYXVzZSBpdCBpcyBzZXQgb25seSBieSBQaEVULWlPLCBhbmQgc2hvdWxkIHBlcnNpc3RcclxuICAgIHRoaXMuaGFzTW91c2VTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5oYXNLZXlib2FyZEdyYWJiZWRHcm91cEl0ZW1Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5oYXNLZXlib2FyZFNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5tb3VzZVNvcnRDdWVWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8vIENsZWFyIHRoZSBzZWxlY3Rpb24gc3RhdGUgZm9yIHRoZSBpbnRlcmFjdGlvbiAoc2V0dGluZyB0byBudWxsKVxyXG4gIHB1YmxpYyBjbGVhclNlbGVjdGlvbigpOiB2b2lkIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS52YWx1ZSA9IG51bGw7XHJcbiAgfVxyXG5cclxuICAvLyBSZWdpc3RlciB5b3VyIGNsb3N1cmUgcmVzcG9uc2libGUgZm9yIHVwZGF0aW5nIHRoZSBzb3J0LWluZGljYXRvciBub2RlLiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgd2l0aCBhIGNhbGxiYWNrIHRoYXRcclxuICAvLyB1cGRhdGVzIG1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eSBhbmQgbWF5YmUgZG9lcyBvdGhlciB0aGluZ3MuIFlvdSB3aWxsIGxpa2VseSBuZWVkIHRvIGNhbGwgdGhpcyB1cGRhdGUgZnVuY3Rpb25cclxuICAvLyBmb3Igc2ltIHNwZWNpZmljIHVzYWdlcyBhcyB3ZWxsLlxyXG4gIHB1YmxpYyByZWdpc3RlclVwZGF0ZVNvcnRDdWVOb2RlKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZTogKCkgPT4gdm9pZCApOiB2b2lkIHtcclxuICAgIHRoaXMubW91c2VTb3J0Q3VlVmlzaWJsZVByb3BlcnR5LmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XHJcbiAgICB0aGlzLnNob3dNb3VzZUN1ZVByb3BlcnR5LmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XHJcbiAgICB0aGlzLmVuYWJsZWRQcm9wZXJ0eS5saW5rKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZSApO1xyXG4gICAgdGhpcy5zZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5LmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XHJcbiAgICB0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eS5saW5rKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZSApO1xyXG4gICAgdGhpcy5pc0tleWJvYXJkRm9jdXNlZFByb3BlcnR5LmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XHJcbiAgICBUYW5kZW0uUEhFVF9JT19FTkFCTEVEICYmIHBoZXQucGhldGlvLnBoZXRpb0VuZ2luZVxyXG4gICAgICAucGhldGlvU3RhdGVFbmdpbmUuc3RhdGVTZXRFbWl0dGVyLmFkZExpc3RlbmVyKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgVGFuZGVtLlBIRVRfSU9fRU5BQkxFRCAmJiBwaGV0LnBoZXRpby5waGV0aW9FbmdpbmVcclxuICAgICAgICAucGhldGlvU3RhdGVFbmdpbmUuc3RhdGVTZXRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZSApO1xyXG4gICAgICB0aGlzLmlzS2V5Ym9hcmRGb2N1c2VkUHJvcGVydHkudW5saW5rKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZSApO1xyXG4gICAgICB0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XHJcbiAgICAgIHRoaXMubW91c2VTb3J0Q3VlVmlzaWJsZVByb3BlcnR5LnVubGluayggdXBkYXRlU29ydEluZGljYXRvck5vZGUgKTtcclxuICAgICAgdGhpcy5lbmFibGVkUHJvcGVydHkudW5saW5rKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZSApO1xyXG4gICAgICB0aGlzLnNob3dNb3VzZUN1ZVByb3BlcnR5LnVubGluayggdXBkYXRlU29ydEluZGljYXRvck5vZGUgKTtcclxuICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5LnVubGluayggdXBkYXRlU29ydEluZGljYXRvck5vZGUgKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5zZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWRQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmdyYWJSZWxlYXNlQ3VlVmlzaWJsZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgIHRoaXMua2V5Ym9hcmRTb3J0Q3VlVmlzaWJsZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmhhc0tleWJvYXJkR3JhYmJlZEdyb3VwSXRlbVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmhhc0tleWJvYXJkU2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLm1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ0dyb3VwU29ydEludGVyYWN0aW9uTW9kZWwnLCBHcm91cFNvcnRJbnRlcmFjdGlvbk1vZGVsICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsV0FBVyxNQUFNLHlCQUF5QjtBQUNqRCxPQUFPQyxTQUFTLE1BQU0sMENBQTBDO0FBQ2hFLE9BQU9DLFFBQVEsTUFBTSxvQ0FBb0M7QUFDekQsT0FBT0MsTUFBTSxNQUFNLG9DQUFvQztBQUV2RCxPQUFPQyxlQUFlLE1BQU0sMkNBQTJDO0FBQ3ZFLE9BQU9DLGVBQWUsTUFBTSwyQ0FB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