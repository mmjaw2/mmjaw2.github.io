// Copyright 2022-2024, University of Colorado Boulder

/**
 * KeypadDialog is a Dialog sub-type that handles the creation and management of a Keypad.
 *
 * The KeypadDialog is shown when requested through the beginEdit() method, which occurs when the user presses on a
 * BallValuesPanelNumberDisplay, to allow the user to manipulate a Ball Property. Edits must be within a specified
 * range. There will be a 'Enter' button to allow the user to submit a edit, and edits are canceled if the user hides
 * the Dialog.
 *
 * KeypadDialog is created at the start of the sim and is never disposed, so no dispose method is necessary and
 * internal links are left as-is.
 *
 * @author Brandon Li
 */

import PatternStringProperty from '../../../axon/js/PatternStringProperty.js';
import Keypad from '../../../scenery-phet/js/keypad/Keypad.js';
import PhetFont from '../../../scenery-phet/js/PhetFont.js';
import { Color, KeyboardListener, Node, Rectangle, RichText, Text, VBox } from '../../../scenery/js/imports.js';
import RectangularPushButton from '../../../sun/js/buttons/RectangularPushButton.js';
import Dialog from '../../../sun/js/Dialog.js';
import sceneryPhet from '../sceneryPhet.js';
import optionize, { combineOptions } from '../../../phet-core/js/optionize.js';
import SceneryPhetStrings from '../SceneryPhetStrings.js';
import Tandem from '../../../tandem/js/Tandem.js';
class KeypadDialog extends Dialog {
  // Reference to the function called when a edit in-range successfully occurs. If null, the Keypad dialog is currently
  // not shown.
  editValue = null;

  // Reference to the Range of the value that the Keypad is editing, if non-null.
  valueRange = null;

  // Reference to a potential callback function for when the Keypad is finished editing. This is provided by the client
  // in the beginEdit() method.
  editFinishedCallback = null;

  // The Keypad of the KeypadDialog

  // The Text Node that displays the Range of the current edit.

  // So we can dispose it
  rangeStringProperty = null;

  // The Text Node that shows the current value of the Keypad edit.

  constructor(providedOptions) {
    const options = optionize()({
      font: new PhetFont(15),
      valueBoxWidth: 85,
      valueYMargin: 3,
      contentSpacing: 10,
      useRichTextRange: false,
      keypadLayout: Keypad.PositiveAndNegativeFloatingPointLayout,
      keypadDefaultTextColor: Color.BLACK,
      keypadErrorTextColor: Color.RED,
      enterButtonOptions: {
        // baseColor: CollisionLabColors.KEYPAD_ENTER_BUTTON,
      },
      keypadOptions: {},
      tandem: Tandem.OPTIONAL // TODO: is this optional or required? https://github.com/phetsims/scenery-phet/issues/540
    }, providedOptions);

    //----------------------------------------------------------------------------------------

    // Reference the content of the Dialog. Children are added later.
    const contentNode = new VBox({
      spacing: options.contentSpacing,
      align: 'center'
    });
    const keypad = new Keypad(options.keypadLayout, combineOptions({}, options.keypadOptions, {
      tandem: Tandem.OPT_OUT
    }));
    options.focusOnShowNode = keypad;
    super(contentNode, options);
    this.defaultTextColor = options.keypadDefaultTextColor;
    this.errorTextColor = options.keypadErrorTextColor;
    this.keypad = keypad;
    this.rangeText = options.useRichTextRange ? new RichText('', {
      font: options.font,
      maxWidth: this.keypad.width
    }) : new Text('', {
      font: options.font,
      maxWidth: this.keypad.width
    });
    this.valueText = new Text('', {
      font: options.font
    });

    // Create the Background to the valueText Node.
    const valueBackgroundNode = new Rectangle(0, 0, options.valueBoxWidth, this.height + 2 * options.valueYMargin, {
      cornerRadius: 3,
      fill: Color.WHITE,
      stroke: Color.BLACK
    });
    const valueDisplayBox = new Node({
      children: [valueBackgroundNode, this.valueText]
    });

    // Create the enterButton, which allows the user to submit an Edit.
    const enterText = new Text(SceneryPhetStrings.key.enterStringProperty, {
      font: options.font,
      maxWidth: this.keypad.width // constrain width for i18n
    });
    const enterButton = new RectangularPushButton(combineOptions({
      listener: this.submitEdit.bind(this),
      content: enterText,
      accessibleName: SceneryPhetStrings.key.enterStringProperty,
      tandem: Tandem.OPT_OUT
    }, options.enterButtonOptions));

    // Set the children of the content of the KeypadDialog, in the correct rendering order.
    contentNode.children = [this.rangeText, valueDisplayBox, this.keypad, enterButton];

    //----------------------------------------------------------------------------------------

    // Observe when the Keypad is edited and update our valueText display. Link is never disposed as KeypadDialogs
    // are never disposed.
    this.keypad.stringProperty.link(string => {
      this.valueText.string = string;
      this.valueText.center = valueBackgroundNode.center;
    });

    // Observe when a key is pressed and reset text colors. Link is never disposed.
    this.keypad.accumulatedKeysProperty.link(() => {
      this.valueText.fill = this.defaultTextColor;
      this.rangeText.fill = this.defaultTextColor;
    });
    const submitFromKeypadListener = new KeyboardListener({
      keys: ['space', 'enter'],
      fireOnDown: false,
      fire: () => this.submitEdit()
    });
    this.keypad.addInputListener(submitFromKeypadListener);
    this.disposeKeypadDialog = () => {
      submitFromKeypadListener.dispose();
      this.keypad.dispose();
      this.rangeStringProperty && this.rangeStringProperty.dispose();
      enterText.dispose(); // linked to a translated string Property
    };
  }

  /**
   * Begins an edit by showing the KeypadDialog. Called when the user presses on a BallValuesPanelNumberDisplay to allow
   * the user to manipulate a Ball.
   *
   * @param editValue - the function called when a edit in-range successfully occurs.
   * @param valueRange - the Range that the user can edit the valueProperty
   * @param patternStringProperty - the template string that formats the text on the rangeText.
   * @param editFinishedCallback - callback when edit is entered or canceled.
   */
  beginEdit(editValue, valueRange, patternStringProperty, editFinishedCallback) {
    this.keypad.clear();

    // Update references. These references are released when the edit is canceled or finished.
    this.editValue = editValue;
    this.valueRange = valueRange;
    this.editFinishedCallback = editFinishedCallback;

    // Clear a previous value out if it exists
    this.rangeStringProperty && this.rangeStringProperty.dispose();
    this.rangeStringProperty = new PatternStringProperty(patternStringProperty, {
      min: valueRange.min,
      max: valueRange.max
    }, {
      tandem: Tandem.OPT_OUT
    });
    this.rangeText.mutate({
      stringProperty: this.rangeStringProperty
    });

    // Display the KeypadDialog.
    this.show();
  }

  /**
   * Attempts to submit the current Keypad edit. If the edit is valid, the valueProperty is set and the edit is
   * finished. Otherwise, the edit is invalid, and the warnOutOfRange() method is invoked.
   *
   * This is called when the user presses the 'Enter' button.
   */
  submitEdit() {
    // If the user didn't enter anything, treat this as a cancel.
    if (this.keypad.stringProperty.value === '') {
      this.finishEdit();
      return;
    }

    // Retrieve the value from the Keypad
    const value = this.keypad.valueProperty.value;

    // If the edit is valid, the valueProperty is set and the edit.
    if (value !== null && Number.isFinite(value) && (!this.valueRange || this.valueRange.contains(value))) {
      this.editValue !== null && this.editValue(value);
      this.finishEdit();
    } else {
      this.warnOutOfRange();
    }
  }

  /**
   * Changes the text colors of the Value and the Range Text to indicate that a entered Edit is out of range.
   */
  warnOutOfRange() {
    this.valueText.fill = this.errorTextColor;
    this.rangeText.fill = this.errorTextColor;
    this.keypad.setClearOnNextKeyPress(true);
  }

  /**
   * Convenience method to finish the KeypadDialog.
   *
   * This method is invoked when a edit is canceled or when a valid edit is entered.
   */
  finishEdit() {
    this.hide(); // Hide the KeypadDialog
    this.keypad.clear(); // Clear the Keypad

    // Release references.
    this.valueRange = null;
    this.editFinishedCallback = null;
  }

  /**
   * Hides the dialog. Overridden to also call the editFinishedCallback function when edits are canceled.
   */
  hide() {
    this.editFinishedCallback && this.editFinishedCallback();
    super.hide();
  }
  dispose() {
    this.disposeKeypadDialog();
    super.dispose();
  }
}
sceneryPhet.register('KeypadDialog', KeypadDialog);
export default KeypadDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJLZXlwYWQiLCJQaGV0Rm9udCIsIkNvbG9yIiwiS2V5Ym9hcmRMaXN0ZW5lciIsIk5vZGUiLCJSZWN0YW5nbGUiLCJSaWNoVGV4dCIsIlRleHQiLCJWQm94IiwiUmVjdGFuZ3VsYXJQdXNoQnV0dG9uIiwiRGlhbG9nIiwic2NlbmVyeVBoZXQiLCJvcHRpb25pemUiLCJjb21iaW5lT3B0aW9ucyIsIlNjZW5lcnlQaGV0U3RyaW5ncyIsIlRhbmRlbSIsIktleXBhZERpYWxvZyIsImVkaXRWYWx1ZSIsInZhbHVlUmFuZ2UiLCJlZGl0RmluaXNoZWRDYWxsYmFjayIsInJhbmdlU3RyaW5nUHJvcGVydHkiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJmb250IiwidmFsdWVCb3hXaWR0aCIsInZhbHVlWU1hcmdpbiIsImNvbnRlbnRTcGFjaW5nIiwidXNlUmljaFRleHRSYW5nZSIsImtleXBhZExheW91dCIsIlBvc2l0aXZlQW5kTmVnYXRpdmVGbG9hdGluZ1BvaW50TGF5b3V0Iiwia2V5cGFkRGVmYXVsdFRleHRDb2xvciIsIkJMQUNLIiwia2V5cGFkRXJyb3JUZXh0Q29sb3IiLCJSRUQiLCJlbnRlckJ1dHRvbk9wdGlvbnMiLCJrZXlwYWRPcHRpb25zIiwidGFuZGVtIiwiT1BUSU9OQUwiLCJjb250ZW50Tm9kZSIsInNwYWNpbmciLCJhbGlnbiIsImtleXBhZCIsIk9QVF9PVVQiLCJmb2N1c09uU2hvd05vZGUiLCJkZWZhdWx0VGV4dENvbG9yIiwiZXJyb3JUZXh0Q29sb3IiLCJyYW5nZVRleHQiLCJtYXhXaWR0aCIsIndpZHRoIiwidmFsdWVUZXh0IiwidmFsdWVCYWNrZ3JvdW5kTm9kZSIsImhlaWdodCIsImNvcm5lclJhZGl1cyIsImZpbGwiLCJXSElURSIsInN0cm9rZSIsInZhbHVlRGlzcGxheUJveCIsImNoaWxkcmVuIiwiZW50ZXJUZXh0Iiwia2V5IiwiZW50ZXJTdHJpbmdQcm9wZXJ0eSIsImVudGVyQnV0dG9uIiwibGlzdGVuZXIiLCJzdWJtaXRFZGl0IiwiYmluZCIsImNvbnRlbnQiLCJhY2Nlc3NpYmxlTmFtZSIsInN0cmluZ1Byb3BlcnR5IiwibGluayIsInN0cmluZyIsImNlbnRlciIsImFjY3VtdWxhdGVkS2V5c1Byb3BlcnR5Iiwic3VibWl0RnJvbUtleXBhZExpc3RlbmVyIiwia2V5cyIsImZpcmVPbkRvd24iLCJmaXJlIiwiYWRkSW5wdXRMaXN0ZW5lciIsImRpc3Bvc2VLZXlwYWREaWFsb2ciLCJkaXNwb3NlIiwiYmVnaW5FZGl0IiwicGF0dGVyblN0cmluZ1Byb3BlcnR5IiwiY2xlYXIiLCJtaW4iLCJtYXgiLCJtdXRhdGUiLCJzaG93IiwidmFsdWUiLCJmaW5pc2hFZGl0IiwidmFsdWVQcm9wZXJ0eSIsIk51bWJlciIsImlzRmluaXRlIiwiY29udGFpbnMiLCJ3YXJuT3V0T2ZSYW5nZSIsInNldENsZWFyT25OZXh0S2V5UHJlc3MiLCJoaWRlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJLZXlwYWREaWFsb2cudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjItMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogS2V5cGFkRGlhbG9nIGlzIGEgRGlhbG9nIHN1Yi10eXBlIHRoYXQgaGFuZGxlcyB0aGUgY3JlYXRpb24gYW5kIG1hbmFnZW1lbnQgb2YgYSBLZXlwYWQuXHJcbiAqXHJcbiAqIFRoZSBLZXlwYWREaWFsb2cgaXMgc2hvd24gd2hlbiByZXF1ZXN0ZWQgdGhyb3VnaCB0aGUgYmVnaW5FZGl0KCkgbWV0aG9kLCB3aGljaCBvY2N1cnMgd2hlbiB0aGUgdXNlciBwcmVzc2VzIG9uIGFcclxuICogQmFsbFZhbHVlc1BhbmVsTnVtYmVyRGlzcGxheSwgdG8gYWxsb3cgdGhlIHVzZXIgdG8gbWFuaXB1bGF0ZSBhIEJhbGwgUHJvcGVydHkuIEVkaXRzIG11c3QgYmUgd2l0aGluIGEgc3BlY2lmaWVkXHJcbiAqIHJhbmdlLiBUaGVyZSB3aWxsIGJlIGEgJ0VudGVyJyBidXR0b24gdG8gYWxsb3cgdGhlIHVzZXIgdG8gc3VibWl0IGEgZWRpdCwgYW5kIGVkaXRzIGFyZSBjYW5jZWxlZCBpZiB0aGUgdXNlciBoaWRlc1xyXG4gKiB0aGUgRGlhbG9nLlxyXG4gKlxyXG4gKiBLZXlwYWREaWFsb2cgaXMgY3JlYXRlZCBhdCB0aGUgc3RhcnQgb2YgdGhlIHNpbSBhbmQgaXMgbmV2ZXIgZGlzcG9zZWQsIHNvIG5vIGRpc3Bvc2UgbWV0aG9kIGlzIG5lY2Vzc2FyeSBhbmRcclxuICogaW50ZXJuYWwgbGlua3MgYXJlIGxlZnQgYXMtaXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQnJhbmRvbiBMaVxyXG4gKi9cclxuXHJcbmltcG9ydCBQYXR0ZXJuU3RyaW5nUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9QYXR0ZXJuU3RyaW5nUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IEtleXBhZCwgeyBLZXlwYWRMYXlvdXQsIEtleXBhZE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMva2V5cGFkL0tleXBhZC5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBDb2xvciwgRm9udCwgS2V5Ym9hcmRMaXN0ZW5lciwgTm9kZSwgUmVjdGFuZ2xlLCBSaWNoVGV4dCwgVENvbG9yLCBUZXh0LCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbiwgeyBSZWN0YW5ndWxhclB1c2hCdXR0b25PcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvUmVjdGFuZ3VsYXJQdXNoQnV0dG9uLmpzJztcclxuaW1wb3J0IERpYWxvZywgeyBEaWFsb2dPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vc3VuL2pzL0RpYWxvZy5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuLi9zY2VuZXJ5UGhldC5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgU2NlbmVyeVBoZXRTdHJpbmdzIGZyb20gJy4uL1NjZW5lcnlQaGV0U3RyaW5ncy5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgLy8gRm9udCB1c2VkIGZvciBhbGwgVGV4dCBpbnN0YW5jZXMgd2l0aGluIHRoZSBEaWFsb2cuXHJcbiAgZm9udD86IEZvbnQ7XHJcblxyXG4gIC8vIFdpZHRoIG9mIHRoZSB2YWx1ZSBmaWVsZCwgaGVpZ2h0IGRldGVybWluZWQgYnkgdmFsdWVGb250LlxyXG4gIHZhbHVlQm94V2lkdGg/OiBudW1iZXI7XHJcblxyXG4gIC8vIFZlcnRpY2FsIG1hcmdpbiBpbnNpZGUgdGhlIHZhbHVlIGJveC5cclxuICB2YWx1ZVlNYXJnaW4/OiBudW1iZXI7XHJcblxyXG4gIC8vIFZlcnRpY2FsIHNwYWNpbmcgYmV0d2VlbiB0aGUgY29udGVudCBvZiB0aGUgS2V5cGFkRGlhbG9nLlxyXG4gIGNvbnRlbnRTcGFjaW5nPzogbnVtYmVyO1xyXG5cclxuICAvLyBJZiB0cnVlLCB0aGUgcmFuZ2UgVGV4dCB3aWxsIGJlIGNyZWF0ZWQgYXMgYSBSaWNoVGV4dFxyXG4gIHVzZVJpY2hUZXh0UmFuZ2U/OiBib29sZWFuO1xyXG5cclxuICBrZXlwYWRMYXlvdXQ/OiBLZXlwYWRMYXlvdXQ7XHJcblxyXG4gIGtleXBhZE9wdGlvbnM/OiBTdHJpY3RPbWl0PEtleXBhZE9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbiAgZW50ZXJCdXR0b25PcHRpb25zPzogUmVjdGFuZ3VsYXJQdXNoQnV0dG9uT3B0aW9ucztcclxuXHJcbiAga2V5cGFkRGVmYXVsdFRleHRDb2xvcj86IFRDb2xvcjtcclxuICBrZXlwYWRFcnJvclRleHRDb2xvcj86IFRDb2xvcjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEtleXBhZERpYWxvZ09wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8RGlhbG9nT3B0aW9ucywgJ2ZvY3VzT25TaG93Tm9kZSc+O1xyXG5cclxuY2xhc3MgS2V5cGFkRGlhbG9nIGV4dGVuZHMgRGlhbG9nIHtcclxuXHJcbiAgLy8gUmVmZXJlbmNlIHRvIHRoZSBmdW5jdGlvbiBjYWxsZWQgd2hlbiBhIGVkaXQgaW4tcmFuZ2Ugc3VjY2Vzc2Z1bGx5IG9jY3Vycy4gSWYgbnVsbCwgdGhlIEtleXBhZCBkaWFsb2cgaXMgY3VycmVudGx5XHJcbiAgLy8gbm90IHNob3duLlxyXG4gIHByaXZhdGUgZWRpdFZhbHVlOiAoICggdmFsdWU6IG51bWJlciApID0+IHZvaWQgKSB8IG51bGwgPSBudWxsO1xyXG5cclxuICAvLyBSZWZlcmVuY2UgdG8gdGhlIFJhbmdlIG9mIHRoZSB2YWx1ZSB0aGF0IHRoZSBLZXlwYWQgaXMgZWRpdGluZywgaWYgbm9uLW51bGwuXHJcbiAgcHJpdmF0ZSB2YWx1ZVJhbmdlOiBSYW5nZSB8IG51bGwgPSBudWxsO1xyXG5cclxuICAvLyBSZWZlcmVuY2UgdG8gYSBwb3RlbnRpYWwgY2FsbGJhY2sgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIEtleXBhZCBpcyBmaW5pc2hlZCBlZGl0aW5nLiBUaGlzIGlzIHByb3ZpZGVkIGJ5IHRoZSBjbGllbnRcclxuICAvLyBpbiB0aGUgYmVnaW5FZGl0KCkgbWV0aG9kLlxyXG4gIHByaXZhdGUgZWRpdEZpbmlzaGVkQ2FsbGJhY2s6ICggKCkgPT4gdm9pZCApIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIC8vIFRoZSBLZXlwYWQgb2YgdGhlIEtleXBhZERpYWxvZ1xyXG4gIHByaXZhdGUgcmVhZG9ubHkga2V5cGFkOiBLZXlwYWQ7XHJcblxyXG4gIC8vIFRoZSBUZXh0IE5vZGUgdGhhdCBkaXNwbGF5cyB0aGUgUmFuZ2Ugb2YgdGhlIGN1cnJlbnQgZWRpdC5cclxuICBwcml2YXRlIHJlYWRvbmx5IHJhbmdlVGV4dDogVGV4dCB8IFJpY2hUZXh0O1xyXG5cclxuICAvLyBTbyB3ZSBjYW4gZGlzcG9zZSBpdFxyXG4gIHByaXZhdGUgcmFuZ2VTdHJpbmdQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPiB8IG51bGwgPSBudWxsO1xyXG5cclxuICAvLyBUaGUgVGV4dCBOb2RlIHRoYXQgc2hvd3MgdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIEtleXBhZCBlZGl0LlxyXG4gIHByaXZhdGUgcmVhZG9ubHkgdmFsdWVUZXh0OiBUZXh0O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRlZmF1bHRUZXh0Q29sb3I6IFRDb2xvcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGVycm9yVGV4dENvbG9yOiBUQ29sb3I7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUtleXBhZERpYWxvZzogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBLZXlwYWREaWFsb2dPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8S2V5cGFkRGlhbG9nT3B0aW9ucywgU2VsZk9wdGlvbnMsIERpYWxvZ09wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTUgKSxcclxuXHJcbiAgICAgIHZhbHVlQm94V2lkdGg6IDg1LFxyXG4gICAgICB2YWx1ZVlNYXJnaW46IDMsXHJcbiAgICAgIGNvbnRlbnRTcGFjaW5nOiAxMCxcclxuXHJcbiAgICAgIHVzZVJpY2hUZXh0UmFuZ2U6IGZhbHNlLFxyXG5cclxuICAgICAga2V5cGFkTGF5b3V0OiBLZXlwYWQuUG9zaXRpdmVBbmROZWdhdGl2ZUZsb2F0aW5nUG9pbnRMYXlvdXQsXHJcblxyXG4gICAgICBrZXlwYWREZWZhdWx0VGV4dENvbG9yOiBDb2xvci5CTEFDSyxcclxuICAgICAga2V5cGFkRXJyb3JUZXh0Q29sb3I6IENvbG9yLlJFRCxcclxuXHJcbiAgICAgIGVudGVyQnV0dG9uT3B0aW9uczoge1xyXG4gICAgICAgIC8vIGJhc2VDb2xvcjogQ29sbGlzaW9uTGFiQ29sb3JzLktFWVBBRF9FTlRFUl9CVVRUT04sXHJcbiAgICAgIH0sXHJcbiAgICAgIGtleXBhZE9wdGlvbnM6IHt9LFxyXG5cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUSU9OQUwgLy8gVE9ETzogaXMgdGhpcyBvcHRpb25hbCBvciByZXF1aXJlZD8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnktcGhldC9pc3N1ZXMvNTQwXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAvLyBSZWZlcmVuY2UgdGhlIGNvbnRlbnQgb2YgdGhlIERpYWxvZy4gQ2hpbGRyZW4gYXJlIGFkZGVkIGxhdGVyLlxyXG4gICAgY29uc3QgY29udGVudE5vZGUgPSBuZXcgVkJveCggeyBzcGFjaW5nOiBvcHRpb25zLmNvbnRlbnRTcGFjaW5nLCBhbGlnbjogJ2NlbnRlcicgfSApO1xyXG5cclxuICAgIGNvbnN0IGtleXBhZCA9IG5ldyBLZXlwYWQoIG9wdGlvbnMua2V5cGFkTGF5b3V0LCBjb21iaW5lT3B0aW9uczxLZXlwYWRPcHRpb25zPigge30sIG9wdGlvbnMua2V5cGFkT3B0aW9ucywge1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5PUFRfT1VUXHJcbiAgICB9ICkgKTtcclxuXHJcbiAgICBvcHRpb25zLmZvY3VzT25TaG93Tm9kZSA9IGtleXBhZDtcclxuXHJcbiAgICBzdXBlciggY29udGVudE5vZGUsIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmRlZmF1bHRUZXh0Q29sb3IgPSBvcHRpb25zLmtleXBhZERlZmF1bHRUZXh0Q29sb3I7XHJcbiAgICB0aGlzLmVycm9yVGV4dENvbG9yID0gb3B0aW9ucy5rZXlwYWRFcnJvclRleHRDb2xvcjtcclxuXHJcbiAgICB0aGlzLmtleXBhZCA9IGtleXBhZDtcclxuICAgIHRoaXMucmFuZ2VUZXh0ID0gb3B0aW9ucy51c2VSaWNoVGV4dFJhbmdlXHJcbiAgICAgICAgICAgICAgICAgICAgID8gbmV3IFJpY2hUZXh0KCAnJywgeyBmb250OiBvcHRpb25zLmZvbnQsIG1heFdpZHRoOiB0aGlzLmtleXBhZC53aWR0aCB9IClcclxuICAgICAgICAgICAgICAgICAgICAgOiBuZXcgVGV4dCggJycsIHsgZm9udDogb3B0aW9ucy5mb250LCBtYXhXaWR0aDogdGhpcy5rZXlwYWQud2lkdGggfSApO1xyXG4gICAgdGhpcy52YWx1ZVRleHQgPSBuZXcgVGV4dCggJycsIHsgZm9udDogb3B0aW9ucy5mb250IH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIEJhY2tncm91bmQgdG8gdGhlIHZhbHVlVGV4dCBOb2RlLlxyXG4gICAgY29uc3QgdmFsdWVCYWNrZ3JvdW5kTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIG9wdGlvbnMudmFsdWVCb3hXaWR0aCwgdGhpcy5oZWlnaHQgKyAyICogb3B0aW9ucy52YWx1ZVlNYXJnaW4sIHtcclxuICAgICAgY29ybmVyUmFkaXVzOiAzLFxyXG4gICAgICBmaWxsOiBDb2xvci5XSElURSxcclxuICAgICAgc3Ryb2tlOiBDb2xvci5CTEFDS1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHZhbHVlRGlzcGxheUJveCA9IG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBbIHZhbHVlQmFja2dyb3VuZE5vZGUsIHRoaXMudmFsdWVUZXh0IF0gfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgZW50ZXJCdXR0b24sIHdoaWNoIGFsbG93cyB0aGUgdXNlciB0byBzdWJtaXQgYW4gRWRpdC5cclxuICAgIGNvbnN0IGVudGVyVGV4dCA9IG5ldyBUZXh0KCBTY2VuZXJ5UGhldFN0cmluZ3Mua2V5LmVudGVyU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgZm9udDogb3B0aW9ucy5mb250LFxyXG4gICAgICBtYXhXaWR0aDogdGhpcy5rZXlwYWQud2lkdGggLy8gY29uc3RyYWluIHdpZHRoIGZvciBpMThuXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBlbnRlckJ1dHRvbiA9IG5ldyBSZWN0YW5ndWxhclB1c2hCdXR0b24oIGNvbWJpbmVPcHRpb25zPFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbk9wdGlvbnM+KCB7XHJcbiAgICAgIGxpc3RlbmVyOiB0aGlzLnN1Ym1pdEVkaXQuYmluZCggdGhpcyApLFxyXG5cclxuICAgICAgY29udGVudDogZW50ZXJUZXh0LFxyXG4gICAgICBhY2Nlc3NpYmxlTmFtZTogU2NlbmVyeVBoZXRTdHJpbmdzLmtleS5lbnRlclN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICB0YW5kZW06IFRhbmRlbS5PUFRfT1VUXHJcbiAgICB9LCBvcHRpb25zLmVudGVyQnV0dG9uT3B0aW9ucyApICk7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBjaGlsZHJlbiBvZiB0aGUgY29udGVudCBvZiB0aGUgS2V5cGFkRGlhbG9nLCBpbiB0aGUgY29ycmVjdCByZW5kZXJpbmcgb3JkZXIuXHJcbiAgICBjb250ZW50Tm9kZS5jaGlsZHJlbiA9IFtcclxuICAgICAgdGhpcy5yYW5nZVRleHQsXHJcbiAgICAgIHZhbHVlRGlzcGxheUJveCxcclxuICAgICAgdGhpcy5rZXlwYWQsXHJcbiAgICAgIGVudGVyQnV0dG9uXHJcbiAgICBdO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIC8vIE9ic2VydmUgd2hlbiB0aGUgS2V5cGFkIGlzIGVkaXRlZCBhbmQgdXBkYXRlIG91ciB2YWx1ZVRleHQgZGlzcGxheS4gTGluayBpcyBuZXZlciBkaXNwb3NlZCBhcyBLZXlwYWREaWFsb2dzXHJcbiAgICAvLyBhcmUgbmV2ZXIgZGlzcG9zZWQuXHJcbiAgICB0aGlzLmtleXBhZC5zdHJpbmdQcm9wZXJ0eS5saW5rKCBzdHJpbmcgPT4ge1xyXG4gICAgICB0aGlzLnZhbHVlVGV4dC5zdHJpbmcgPSBzdHJpbmc7XHJcbiAgICAgIHRoaXMudmFsdWVUZXh0LmNlbnRlciA9IHZhbHVlQmFja2dyb3VuZE5vZGUuY2VudGVyO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE9ic2VydmUgd2hlbiBhIGtleSBpcyBwcmVzc2VkIGFuZCByZXNldCB0ZXh0IGNvbG9ycy4gTGluayBpcyBuZXZlciBkaXNwb3NlZC5cclxuICAgIHRoaXMua2V5cGFkLmFjY3VtdWxhdGVkS2V5c1Byb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgdGhpcy52YWx1ZVRleHQuZmlsbCA9IHRoaXMuZGVmYXVsdFRleHRDb2xvcjtcclxuICAgICAgdGhpcy5yYW5nZVRleHQuZmlsbCA9IHRoaXMuZGVmYXVsdFRleHRDb2xvcjtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBzdWJtaXRGcm9tS2V5cGFkTGlzdGVuZXIgPSBuZXcgS2V5Ym9hcmRMaXN0ZW5lcigge1xyXG4gICAgICBrZXlzOiBbICdzcGFjZScsICdlbnRlcicgXSxcclxuICAgICAgZmlyZU9uRG93bjogZmFsc2UsXHJcbiAgICAgIGZpcmU6ICgpID0+IHRoaXMuc3VibWl0RWRpdCgpXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmtleXBhZC5hZGRJbnB1dExpc3RlbmVyKCBzdWJtaXRGcm9tS2V5cGFkTGlzdGVuZXIgKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VLZXlwYWREaWFsb2cgPSAoKSA9PiB7XHJcbiAgICAgIHN1Ym1pdEZyb21LZXlwYWRMaXN0ZW5lci5kaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMua2V5cGFkLmRpc3Bvc2UoKTtcclxuICAgICAgdGhpcy5yYW5nZVN0cmluZ1Byb3BlcnR5ICYmIHRoaXMucmFuZ2VTdHJpbmdQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICAgIGVudGVyVGV4dC5kaXNwb3NlKCk7IC8vIGxpbmtlZCB0byBhIHRyYW5zbGF0ZWQgc3RyaW5nIFByb3BlcnR5XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQmVnaW5zIGFuIGVkaXQgYnkgc2hvd2luZyB0aGUgS2V5cGFkRGlhbG9nLiBDYWxsZWQgd2hlbiB0aGUgdXNlciBwcmVzc2VzIG9uIGEgQmFsbFZhbHVlc1BhbmVsTnVtYmVyRGlzcGxheSB0byBhbGxvd1xyXG4gICAqIHRoZSB1c2VyIHRvIG1hbmlwdWxhdGUgYSBCYWxsLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGVkaXRWYWx1ZSAtIHRoZSBmdW5jdGlvbiBjYWxsZWQgd2hlbiBhIGVkaXQgaW4tcmFuZ2Ugc3VjY2Vzc2Z1bGx5IG9jY3Vycy5cclxuICAgKiBAcGFyYW0gdmFsdWVSYW5nZSAtIHRoZSBSYW5nZSB0aGF0IHRoZSB1c2VyIGNhbiBlZGl0IHRoZSB2YWx1ZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHBhdHRlcm5TdHJpbmdQcm9wZXJ0eSAtIHRoZSB0ZW1wbGF0ZSBzdHJpbmcgdGhhdCBmb3JtYXRzIHRoZSB0ZXh0IG9uIHRoZSByYW5nZVRleHQuXHJcbiAgICogQHBhcmFtIGVkaXRGaW5pc2hlZENhbGxiYWNrIC0gY2FsbGJhY2sgd2hlbiBlZGl0IGlzIGVudGVyZWQgb3IgY2FuY2VsZWQuXHJcbiAgICovXHJcbiAgcHVibGljIGJlZ2luRWRpdCggZWRpdFZhbHVlOiAoIHZhbHVlOiBudW1iZXIgKSA9PiB2b2lkLCB2YWx1ZVJhbmdlOiBSYW5nZSwgcGF0dGVyblN0cmluZ1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+LCBlZGl0RmluaXNoZWRDYWxsYmFjazogKCkgPT4gdm9pZCApOiB2b2lkIHtcclxuXHJcbiAgICB0aGlzLmtleXBhZC5jbGVhcigpO1xyXG5cclxuICAgIC8vIFVwZGF0ZSByZWZlcmVuY2VzLiBUaGVzZSByZWZlcmVuY2VzIGFyZSByZWxlYXNlZCB3aGVuIHRoZSBlZGl0IGlzIGNhbmNlbGVkIG9yIGZpbmlzaGVkLlxyXG4gICAgdGhpcy5lZGl0VmFsdWUgPSBlZGl0VmFsdWU7XHJcbiAgICB0aGlzLnZhbHVlUmFuZ2UgPSB2YWx1ZVJhbmdlO1xyXG4gICAgdGhpcy5lZGl0RmluaXNoZWRDYWxsYmFjayA9IGVkaXRGaW5pc2hlZENhbGxiYWNrO1xyXG5cclxuICAgIC8vIENsZWFyIGEgcHJldmlvdXMgdmFsdWUgb3V0IGlmIGl0IGV4aXN0c1xyXG4gICAgdGhpcy5yYW5nZVN0cmluZ1Byb3BlcnR5ICYmIHRoaXMucmFuZ2VTdHJpbmdQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcblxyXG4gICAgdGhpcy5yYW5nZVN0cmluZ1Byb3BlcnR5ID0gbmV3IFBhdHRlcm5TdHJpbmdQcm9wZXJ0eSggcGF0dGVyblN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIG1pbjogdmFsdWVSYW5nZS5taW4sXHJcbiAgICAgIG1heDogdmFsdWVSYW5nZS5tYXhcclxuICAgIH0sIHsgdGFuZGVtOiBUYW5kZW0uT1BUX09VVCB9ICk7XHJcbiAgICB0aGlzLnJhbmdlVGV4dC5tdXRhdGUoIHtcclxuICAgICAgc3RyaW5nUHJvcGVydHk6IHRoaXMucmFuZ2VTdHJpbmdQcm9wZXJ0eVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIERpc3BsYXkgdGhlIEtleXBhZERpYWxvZy5cclxuICAgIHRoaXMuc2hvdygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQXR0ZW1wdHMgdG8gc3VibWl0IHRoZSBjdXJyZW50IEtleXBhZCBlZGl0LiBJZiB0aGUgZWRpdCBpcyB2YWxpZCwgdGhlIHZhbHVlUHJvcGVydHkgaXMgc2V0IGFuZCB0aGUgZWRpdCBpc1xyXG4gICAqIGZpbmlzaGVkLiBPdGhlcndpc2UsIHRoZSBlZGl0IGlzIGludmFsaWQsIGFuZCB0aGUgd2Fybk91dE9mUmFuZ2UoKSBtZXRob2QgaXMgaW52b2tlZC5cclxuICAgKlxyXG4gICAqIFRoaXMgaXMgY2FsbGVkIHdoZW4gdGhlIHVzZXIgcHJlc3NlcyB0aGUgJ0VudGVyJyBidXR0b24uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdWJtaXRFZGl0KCk6IHZvaWQge1xyXG5cclxuICAgIC8vIElmIHRoZSB1c2VyIGRpZG4ndCBlbnRlciBhbnl0aGluZywgdHJlYXQgdGhpcyBhcyBhIGNhbmNlbC5cclxuICAgIGlmICggdGhpcy5rZXlwYWQuc3RyaW5nUHJvcGVydHkudmFsdWUgPT09ICcnICkge1xyXG4gICAgICB0aGlzLmZpbmlzaEVkaXQoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJldHJpZXZlIHRoZSB2YWx1ZSBmcm9tIHRoZSBLZXlwYWRcclxuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5rZXlwYWQudmFsdWVQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAvLyBJZiB0aGUgZWRpdCBpcyB2YWxpZCwgdGhlIHZhbHVlUHJvcGVydHkgaXMgc2V0IGFuZCB0aGUgZWRpdC5cclxuICAgIGlmICggdmFsdWUgIT09IG51bGwgJiYgTnVtYmVyLmlzRmluaXRlKCB2YWx1ZSApICYmICggIXRoaXMudmFsdWVSYW5nZSB8fCB0aGlzLnZhbHVlUmFuZ2UuY29udGFpbnMoIHZhbHVlICkgKSApIHtcclxuICAgICAgdGhpcy5lZGl0VmFsdWUgIT09IG51bGwgJiYgdGhpcy5lZGl0VmFsdWUoIHZhbHVlICk7XHJcbiAgICAgIHRoaXMuZmluaXNoRWRpdCgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7IHRoaXMud2Fybk91dE9mUmFuZ2UoKTsgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hhbmdlcyB0aGUgdGV4dCBjb2xvcnMgb2YgdGhlIFZhbHVlIGFuZCB0aGUgUmFuZ2UgVGV4dCB0byBpbmRpY2F0ZSB0aGF0IGEgZW50ZXJlZCBFZGl0IGlzIG91dCBvZiByYW5nZS5cclxuICAgKi9cclxuICBwcml2YXRlIHdhcm5PdXRPZlJhbmdlKCk6IHZvaWQge1xyXG4gICAgdGhpcy52YWx1ZVRleHQuZmlsbCA9IHRoaXMuZXJyb3JUZXh0Q29sb3I7XHJcbiAgICB0aGlzLnJhbmdlVGV4dC5maWxsID0gdGhpcy5lcnJvclRleHRDb2xvcjtcclxuICAgIHRoaXMua2V5cGFkLnNldENsZWFyT25OZXh0S2V5UHJlc3MoIHRydWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBmaW5pc2ggdGhlIEtleXBhZERpYWxvZy5cclxuICAgKlxyXG4gICAqIFRoaXMgbWV0aG9kIGlzIGludm9rZWQgd2hlbiBhIGVkaXQgaXMgY2FuY2VsZWQgb3Igd2hlbiBhIHZhbGlkIGVkaXQgaXMgZW50ZXJlZC5cclxuICAgKi9cclxuICBwcml2YXRlIGZpbmlzaEVkaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmhpZGUoKTsgLy8gSGlkZSB0aGUgS2V5cGFkRGlhbG9nXHJcbiAgICB0aGlzLmtleXBhZC5jbGVhcigpOyAvLyBDbGVhciB0aGUgS2V5cGFkXHJcblxyXG4gICAgLy8gUmVsZWFzZSByZWZlcmVuY2VzLlxyXG4gICAgdGhpcy52YWx1ZVJhbmdlID0gbnVsbDtcclxuICAgIHRoaXMuZWRpdEZpbmlzaGVkQ2FsbGJhY2sgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGlkZXMgdGhlIGRpYWxvZy4gT3ZlcnJpZGRlbiB0byBhbHNvIGNhbGwgdGhlIGVkaXRGaW5pc2hlZENhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gZWRpdHMgYXJlIGNhbmNlbGVkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBoaWRlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5lZGl0RmluaXNoZWRDYWxsYmFjayAmJiB0aGlzLmVkaXRGaW5pc2hlZENhbGxiYWNrKCk7XHJcblxyXG4gICAgc3VwZXIuaGlkZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VLZXlwYWREaWFsb2coKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnlQaGV0LnJlZ2lzdGVyKCAnS2V5cGFkRGlhbG9nJywgS2V5cGFkRGlhbG9nICk7XHJcbmV4cG9ydCBkZWZhdWx0IEtleXBhZERpYWxvZzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLHFCQUFxQixNQUFNLDJDQUEyQztBQUU3RSxPQUFPQyxNQUFNLE1BQXVDLDJDQUEyQztBQUMvRixPQUFPQyxRQUFRLE1BQU0sc0NBQXNDO0FBQzNELFNBQVNDLEtBQUssRUFBUUMsZ0JBQWdCLEVBQUVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxRQUFRLEVBQVVDLElBQUksRUFBRUMsSUFBSSxRQUFRLGdDQUFnQztBQUM3SCxPQUFPQyxxQkFBcUIsTUFBd0Msa0RBQWtEO0FBQ3RILE9BQU9DLE1BQU0sTUFBeUIsMkJBQTJCO0FBQ2pFLE9BQU9DLFdBQVcsTUFBTSxtQkFBbUI7QUFDM0MsT0FBT0MsU0FBUyxJQUFJQyxjQUFjLFFBQVEsb0NBQW9DO0FBRTlFLE9BQU9DLGtCQUFrQixNQUFNLDBCQUEwQjtBQUV6RCxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBOEJqRCxNQUFNQyxZQUFZLFNB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