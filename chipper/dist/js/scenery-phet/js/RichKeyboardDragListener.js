// Copyright 2024, University of Colorado Boulder

/**
 * RichKeyboardDragListener extends KeyboardDragListener to integrate PhET-specific features that should be
 * broadly applied to DragListener instances in PhET sims.
 *
 * For grab and release sounds, responsibilities include:
 * - provide default sound files
 * - create SoundClips and register them with soundManager
 * - dispose of SoundClips and deregister them with soundManager
 *
 * @author AgustÃ­n Vallejo
 * @author Michael Kauzmann
 * @author Chris Malley (PixelZoom, Inc.)
 */

import sceneryPhet from './sceneryPhet.js';
import { KeyboardDragListener } from '../../scenery/js/imports.js';
import optionize from '../../phet-core/js/optionize.js';
import SoundClip from '../../tambo/js/sound-generators/SoundClip.js';
import grab_mp3 from '../../tambo/sounds/grab_mp3.js';
import release_mp3 from '../../tambo/sounds/release_mp3.js';
import soundManager from '../../tambo/js/soundManager.js';
const DEFAULT_DRAG_CLIP_OPTIONS = {
  initialOutputLevel: 0.4
};
export default class RichKeyboardDragListener extends KeyboardDragListener {
  constructor(providedOptions) {
    const options = optionize()({
      // SelfOptions
      grabSound: grab_mp3,
      releaseSound: release_mp3,
      grabSoundClipOptions: DEFAULT_DRAG_CLIP_OPTIONS,
      releaseSoundClipOptions: DEFAULT_DRAG_CLIP_OPTIONS,
      grabSoundGeneratorAddOptions: {},
      releaseSoundGeneratorAddOptions: {}
    }, providedOptions);

    // Create the grab SoundClip and wire it into the start function for the drag cycle.
    let grabClip;
    if (options.grabSound) {
      grabClip = new SoundClip(options.grabSound, options.grabSoundClipOptions);
      soundManager.addSoundGenerator(grabClip, options.grabSoundGeneratorAddOptions);
      const previousStart = options.start;
      options.start = (...args) => {
        previousStart && previousStart(...args);
        grabClip.play();
      };
    }

    // Create the release SoundClip and wire it into the end function for the drag cycle.
    let releaseClip;
    if (options.releaseSound) {
      releaseClip = new SoundClip(options.releaseSound, options.releaseSoundClipOptions);
      soundManager.addSoundGenerator(releaseClip, options.releaseSoundGeneratorAddOptions);
      const previousEnd = options.end;
      options.end = (...args) => {
        previousEnd && previousEnd(...args);
        !this.interrupted && releaseClip.play();
      };
    }
    super(options);

    // Clean up SoundClips when this RichKeyboardDragListener is disposed.
    this.disposeEmitter.addListener(() => {
      if (grabClip) {
        grabClip.dispose();
        soundManager.removeSoundGenerator(grabClip);
      }
      if (releaseClip) {
        releaseClip.dispose();
        soundManager.removeSoundGenerator(releaseClip);
      }
    });
  }
}
sceneryPhet.register('RichKeyboardDragListener', RichKeyboardDragListener);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzY2VuZXJ5UGhldCIsIktleWJvYXJkRHJhZ0xpc3RlbmVyIiwib3B0aW9uaXplIiwiU291bmRDbGlwIiwiZ3JhYl9tcDMiLCJyZWxlYXNlX21wMyIsInNvdW5kTWFuYWdlciIsIkRFRkFVTFRfRFJBR19DTElQX09QVElPTlMiLCJpbml0aWFsT3V0cHV0TGV2ZWwiLCJSaWNoS2V5Ym9hcmREcmFnTGlzdGVuZXIiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJncmFiU291bmQiLCJyZWxlYXNlU291bmQiLCJncmFiU291bmRDbGlwT3B0aW9ucyIsInJlbGVhc2VTb3VuZENsaXBPcHRpb25zIiwiZ3JhYlNvdW5kR2VuZXJhdG9yQWRkT3B0aW9ucyIsInJlbGVhc2VTb3VuZEdlbmVyYXRvckFkZE9wdGlvbnMiLCJncmFiQ2xpcCIsImFkZFNvdW5kR2VuZXJhdG9yIiwicHJldmlvdXNTdGFydCIsInN0YXJ0IiwiYXJncyIsInBsYXkiLCJyZWxlYXNlQ2xpcCIsInByZXZpb3VzRW5kIiwiZW5kIiwiaW50ZXJydXB0ZWQiLCJkaXNwb3NlRW1pdHRlciIsImFkZExpc3RlbmVyIiwiZGlzcG9zZSIsInJlbW92ZVNvdW5kR2VuZXJhdG9yIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJSaWNoS2V5Ym9hcmREcmFnTGlzdGVuZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJpY2hLZXlib2FyZERyYWdMaXN0ZW5lciBleHRlbmRzIEtleWJvYXJkRHJhZ0xpc3RlbmVyIHRvIGludGVncmF0ZSBQaEVULXNwZWNpZmljIGZlYXR1cmVzIHRoYXQgc2hvdWxkIGJlXHJcbiAqIGJyb2FkbHkgYXBwbGllZCB0byBEcmFnTGlzdGVuZXIgaW5zdGFuY2VzIGluIFBoRVQgc2ltcy5cclxuICpcclxuICogRm9yIGdyYWIgYW5kIHJlbGVhc2Ugc291bmRzLCByZXNwb25zaWJpbGl0aWVzIGluY2x1ZGU6XHJcbiAqIC0gcHJvdmlkZSBkZWZhdWx0IHNvdW5kIGZpbGVzXHJcbiAqIC0gY3JlYXRlIFNvdW5kQ2xpcHMgYW5kIHJlZ2lzdGVyIHRoZW0gd2l0aCBzb3VuZE1hbmFnZXJcclxuICogLSBkaXNwb3NlIG9mIFNvdW5kQ2xpcHMgYW5kIGRlcmVnaXN0ZXIgdGhlbSB3aXRoIHNvdW5kTWFuYWdlclxyXG4gKlxyXG4gKiBAYXV0aG9yIEFndXN0w61uIFZhbGxlam9cclxuICogQGF1dGhvciBNaWNoYWVsIEthdXptYW5uXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IHNjZW5lcnlQaGV0IGZyb20gJy4vc2NlbmVyeVBoZXQuanMnO1xyXG5pbXBvcnQgeyBLZXlib2FyZERyYWdMaXN0ZW5lciwgS2V5Ym9hcmREcmFnTGlzdGVuZXJPcHRpb25zIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFNvdW5kQ2xpcCwgeyBTb3VuZENsaXBPcHRpb25zIH0gZnJvbSAnLi4vLi4vdGFtYm8vanMvc291bmQtZ2VuZXJhdG9ycy9Tb3VuZENsaXAuanMnO1xyXG5pbXBvcnQgZ3JhYl9tcDMgZnJvbSAnLi4vLi4vdGFtYm8vc291bmRzL2dyYWJfbXAzLmpzJztcclxuaW1wb3J0IHJlbGVhc2VfbXAzIGZyb20gJy4uLy4uL3RhbWJvL3NvdW5kcy9yZWxlYXNlX21wMy5qcyc7XHJcbmltcG9ydCBzb3VuZE1hbmFnZXIsIHsgU291bmRHZW5lcmF0b3JBZGRPcHRpb25zIH0gZnJvbSAnLi4vLi4vdGFtYm8vanMvc291bmRNYW5hZ2VyLmpzJztcclxuaW1wb3J0IFdyYXBwZWRBdWRpb0J1ZmZlciBmcm9tICcuLi8uLi90YW1iby9qcy9XcmFwcGVkQXVkaW9CdWZmZXIuanMnO1xyXG5cclxuY29uc3QgREVGQVVMVF9EUkFHX0NMSVBfT1BUSU9OUzogU291bmRDbGlwT3B0aW9ucyA9IHtcclxuICBpbml0aWFsT3V0cHV0TGV2ZWw6IDAuNFxyXG59O1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gR3JhYiBhbmQgcmVsZWFzZSBzb3VuZHMuIG51bGwgbWVhbnMgbm8gc291bmQuXHJcbiAgZ3JhYlNvdW5kPzogV3JhcHBlZEF1ZGlvQnVmZmVyIHwgbnVsbDtcclxuICByZWxlYXNlU291bmQ/OiBXcmFwcGVkQXVkaW9CdWZmZXIgfCBudWxsO1xyXG5cclxuICAvLyBQYXNzZWQgdG8gdGhlIGdyYWIgYW5kIHJlbGVhc2UgU291bmRDbGlwIGluc3RhbmNlcy5cclxuICBncmFiU291bmRDbGlwT3B0aW9ucz86IFNvdW5kQ2xpcE9wdGlvbnM7XHJcbiAgcmVsZWFzZVNvdW5kQ2xpcE9wdGlvbnM/OiBTb3VuZENsaXBPcHRpb25zO1xyXG5cclxuICAvLyBhZGRTb3VuZEdlbmVyYXRvck9wdGlvbnNcclxuICBncmFiU291bmRHZW5lcmF0b3JBZGRPcHRpb25zPzogU291bmRHZW5lcmF0b3JBZGRPcHRpb25zO1xyXG4gIHJlbGVhc2VTb3VuZEdlbmVyYXRvckFkZE9wdGlvbnM/OiBTb3VuZEdlbmVyYXRvckFkZE9wdGlvbnM7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBSaWNoS2V5Ym9hcmREcmFnTGlzdGVuZXJPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBLZXlib2FyZERyYWdMaXN0ZW5lck9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSaWNoS2V5Ym9hcmREcmFnTGlzdGVuZXIgZXh0ZW5kcyBLZXlib2FyZERyYWdMaXN0ZW5lciB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zOiBSaWNoS2V5Ym9hcmREcmFnTGlzdGVuZXJPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UmljaEtleWJvYXJkRHJhZ0xpc3RlbmVyT3B0aW9ucywgU2VsZk9wdGlvbnMsIEtleWJvYXJkRHJhZ0xpc3RlbmVyT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgZ3JhYlNvdW5kOiBncmFiX21wMyxcclxuICAgICAgcmVsZWFzZVNvdW5kOiByZWxlYXNlX21wMyxcclxuICAgICAgZ3JhYlNvdW5kQ2xpcE9wdGlvbnM6IERFRkFVTFRfRFJBR19DTElQX09QVElPTlMsXHJcbiAgICAgIHJlbGVhc2VTb3VuZENsaXBPcHRpb25zOiBERUZBVUxUX0RSQUdfQ0xJUF9PUFRJT05TLFxyXG4gICAgICBncmFiU291bmRHZW5lcmF0b3JBZGRPcHRpb25zOiB7fSxcclxuICAgICAgcmVsZWFzZVNvdW5kR2VuZXJhdG9yQWRkT3B0aW9uczoge31cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgZ3JhYiBTb3VuZENsaXAgYW5kIHdpcmUgaXQgaW50byB0aGUgc3RhcnQgZnVuY3Rpb24gZm9yIHRoZSBkcmFnIGN5Y2xlLlxyXG4gICAgbGV0IGdyYWJDbGlwOiBTb3VuZENsaXA7XHJcbiAgICBpZiAoIG9wdGlvbnMuZ3JhYlNvdW5kICkge1xyXG4gICAgICBncmFiQ2xpcCA9IG5ldyBTb3VuZENsaXAoIG9wdGlvbnMuZ3JhYlNvdW5kLCBvcHRpb25zLmdyYWJTb3VuZENsaXBPcHRpb25zICk7XHJcbiAgICAgIHNvdW5kTWFuYWdlci5hZGRTb3VuZEdlbmVyYXRvciggZ3JhYkNsaXAsIG9wdGlvbnMuZ3JhYlNvdW5kR2VuZXJhdG9yQWRkT3B0aW9ucyApO1xyXG5cclxuICAgICAgY29uc3QgcHJldmlvdXNTdGFydCA9IG9wdGlvbnMuc3RhcnQ7XHJcbiAgICAgIG9wdGlvbnMuc3RhcnQgPSAoIC4uLmFyZ3MgKSA9PiB7XHJcbiAgICAgICAgcHJldmlvdXNTdGFydCAmJiBwcmV2aW91c1N0YXJ0KCAuLi5hcmdzICk7XHJcbiAgICAgICAgZ3JhYkNsaXAucGxheSgpO1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgcmVsZWFzZSBTb3VuZENsaXAgYW5kIHdpcmUgaXQgaW50byB0aGUgZW5kIGZ1bmN0aW9uIGZvciB0aGUgZHJhZyBjeWNsZS5cclxuICAgIGxldCByZWxlYXNlQ2xpcDogU291bmRDbGlwO1xyXG4gICAgaWYgKCBvcHRpb25zLnJlbGVhc2VTb3VuZCApIHtcclxuICAgICAgcmVsZWFzZUNsaXAgPSBuZXcgU291bmRDbGlwKCBvcHRpb25zLnJlbGVhc2VTb3VuZCwgb3B0aW9ucy5yZWxlYXNlU291bmRDbGlwT3B0aW9ucyApO1xyXG4gICAgICBzb3VuZE1hbmFnZXIuYWRkU291bmRHZW5lcmF0b3IoIHJlbGVhc2VDbGlwLCBvcHRpb25zLnJlbGVhc2VTb3VuZEdlbmVyYXRvckFkZE9wdGlvbnMgKTtcclxuXHJcbiAgICAgIGNvbnN0IHByZXZpb3VzRW5kID0gb3B0aW9ucy5lbmQ7XHJcbiAgICAgIG9wdGlvbnMuZW5kID0gKCAuLi5hcmdzICkgPT4ge1xyXG4gICAgICAgIHByZXZpb3VzRW5kICYmIHByZXZpb3VzRW5kKCAuLi5hcmdzICk7XHJcbiAgICAgICAgIXRoaXMuaW50ZXJydXB0ZWQgJiYgcmVsZWFzZUNsaXAucGxheSgpO1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gQ2xlYW4gdXAgU291bmRDbGlwcyB3aGVuIHRoaXMgUmljaEtleWJvYXJkRHJhZ0xpc3RlbmVyIGlzIGRpc3Bvc2VkLlxyXG4gICAgdGhpcy5kaXNwb3NlRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICBpZiAoIGdyYWJDbGlwICkge1xyXG4gICAgICAgIGdyYWJDbGlwLmRpc3Bvc2UoKTtcclxuICAgICAgICBzb3VuZE1hbmFnZXIucmVtb3ZlU291bmRHZW5lcmF0b3IoIGdyYWJDbGlwICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICggcmVsZWFzZUNsaXAgKSB7XHJcbiAgICAgICAgcmVsZWFzZUNsaXAuZGlzcG9zZSgpO1xyXG4gICAgICAgIHNvdW5kTWFuYWdlci5yZW1vdmVTb3VuZEdlbmVyYXRvciggcmVsZWFzZUNsaXAgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuc2NlbmVyeVBoZXQucmVnaXN0ZXIoICdSaWNoS2V5Ym9hcmREcmFnTGlzdGVuZXInLCBSaWNoS2V5Ym9hcmREcmFnTGlzdGVuZXIgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFdBQVcsTUFBTSxrQkFBa0I7QUFDMUMsU0FBU0Msb0JBQW9CLFFBQXFDLDZCQUE2QjtBQUMvRixPQUFPQyxTQUFTLE1BQU0saUNBQWlDO0FBQ3ZELE9BQU9DLFNBQVMsTUFBNEIsOENBQThDO0FBQzFGLE9BQU9DLFFBQVEsTUFBTSxnQ0FBZ0M7QUFDckQsT0FBT0MsV0FBVyxNQUFNLG1DQUFtQztBQUMzRCxPQUFPQyxZQUFZLE1BQW9DLGdDQUFnQztBQUd2RixNQUFNQyx5QkFBMkMsR0FBRztFQUNsREMsa0JBQWtCLEVBQUU7QUFDdEIsQ0FBQztBQW1CRCxlQUFlLE1BQU1DLHdCQUF3QixTQUFTUixvQkFBb0IsQ0FBQztFQUVsRVMsV0FBV0EsQ0FBRUMsZUFBZ0QsRUFBRztJQUVyRSxNQUFNQyxPQUFPLEdBQUdWLFNBQVMsQ0FBNEUsQ0FBQyxDQUFFO01BRXRHO01BQ0FXLFNBQVMsRUFBRVQsUUFBUTtNQUNuQlUsWUFBWSxFQUFFVCxXQUFXO01BQ3pCVSxvQkFBb0IsRUFBRVIseUJBQXlCO01BQy9DUyx1QkFBdUIsRUFBRVQseUJBQXlCO01BQ2xEVSw0QkFBNEIsRUFBRSxDQUFDLENBQUM7TUFDaENDLCtCQUErQixFQUFFLENBQUM7SUFDcEMsQ0FBQyxFQUFFUCxlQUFnQixDQUFDOztJQUVwQjtJQUNBLElBQUlRLFFBQW1CO0lBQ3ZCLElBQUtQLE9BQU8sQ0FBQ0MsU0FBUyxFQUFHO01BQ3ZCTSxRQUFRLEdBQUcsSUFBSWhCLFNBQVMsQ0FBRVMsT0FBTyxDQUFDQyxTQUFTLEVBQUVELE9BQU8sQ0FBQ0csb0JBQXFCLENBQUM7TUFDM0VULFlBQVksQ0FBQ2MsaUJBQWlCLENBQUVELFFBQVEsRUFBRVAsT0FBTyxDQUFDSyw0QkFBNkIsQ0FBQztNQUVoRixNQUFNSSxhQUFhLEdBQUdULE9BQU8sQ0FBQ1UsS0FBSztNQUNuQ1YsT0FBTyxDQUFDVSxLQUFLLEdBQUcsQ0FBRSxHQUFHQyxJQUFJLEtBQU07UUFDN0JGLGFBQWEsSUFBSUEsYUFBYSxDQUFFLEdBQUdFLElBQUssQ0FBQztRQUN6Q0osUUFBUSxDQUFDSyxJQUFJLENBQUMsQ0FBQztNQUNqQixDQUFDO0lBQ0g7O0lBRUE7SUFDQSxJQUFJQyxXQUFzQjtJQUMxQixJQUFLYixPQUFPLENBQUNFLFlBQVksRUFBRztNQUMxQlcsV0FBVyxHQUFHLElBQUl0QixTQUFTLENBQUVTLE9BQU8sQ0FBQ0UsWUFBWSxFQUFFRixPQUFPLENBQUNJLHVCQUF3QixDQUFDO01BQ3BGVixZQUFZLENBQUNjLGlCQUFpQixDQUFFSyxXQUFXLEVBQUViLE9BQU8sQ0FBQ00sK0JBQWdDLENBQUM7TUFFdEYsTUFBTVEsV0FBVyxHQUFHZCxPQUFPLENBQUNlLEdBQUc7TUFDL0JmLE9BQU8sQ0FBQ2UsR0FBRyxHQUFHLENBQUUsR0FBR0osSUFBSSxLQUFNO1FBQzNCRyxXQUFXLElBQUlBLFdBQVcsQ0FBRSxHQUFHSCxJQUFLLENBQUM7UUFDckMsQ0FBQyxJQUFJLENBQUNLLFdBQVcsSUFBSUgsV0FBVyxDQUFDRCxJQUFJLENBQUMsQ0FBQztNQUN6QyxDQUFDO0lBQ0g7SUFFQSxLQUFLLENBQUVaLE9BQVEsQ0FBQzs7SUFFaEI7SUFDQSxJQUFJLENBQUNpQixjQUFjLENBQUNDLFdBQVcsQ0FBRSxNQUFNO01BQ3JDLElBQUtYLFFBQVEsRUFBRztRQUNkQSxRQUFRLENBQUNZLE9BQU8sQ0FBQyxDQUFDO1FBQ2xCekIsWUFBWSxDQUFDMEIsb0JBQW9CLENBQUViLFFBQVMsQ0FBQztNQUMvQztNQUVBLElBQUtNLFdBQVcsRUFBRztRQUNqQkEsV0FBVyxDQUFDTSxPQUFPLENBQUMsQ0FBQztRQUNyQnpCLFlBQVksQ0FBQzBCLG9CQUFvQixDQUFFUCxXQUFZLENBQUM7TUFDbEQ7SUFDRixDQUFFLENBQUM7RUFDTDtBQUNGO0FBRUF6QixXQUFXLENBQUNpQyxRQUFRLENBQUUsMEJBQTBCLEVBQUV4Qix3QkFBeUIsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==