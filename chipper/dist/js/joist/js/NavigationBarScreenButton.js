// Copyright 2013-2023, University of Colorado Boulder

/**
 * Button for a single screen in the navigation bar, shows the text and the navigation bar icon.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../axon/js/DerivedProperty.js';
import Multilink from '../../axon/js/Multilink.js';
import Utils from '../../dot/js/Utils.js';
import { Shape } from '../../kite/js/imports.js';
import optionize from '../../phet-core/js/optionize.js';
import PhetColorScheme from '../../scenery-phet/js/PhetColorScheme.js';
import PhetFont from '../../scenery-phet/js/PhetFont.js';
import { Color, Node, Rectangle, Text, VBox, Voicing } from '../../scenery/js/imports.js';
import PushButtonModel from '../../sun/js/buttons/PushButtonModel.js';
import HighlightNode from './HighlightNode.js';
import joist from './joist.js';
// constants
const HIGHLIGHT_SPACING = 4;
const getHighlightWidth = overlay => overlay.width + 2 * HIGHLIGHT_SPACING;
class NavigationBarScreenButton extends Voicing(Node) {
  /**
   * @param navigationBarFillProperty - the color of the navbar, as a string.
   * @param screenProperty
   * @param screen
   * @param simScreenIndex - the index (within sim screens only) of the screen corresponding to this button
   * @param navBarHeight
   * @param [providedOptions]
   */
  constructor(navigationBarFillProperty, screenProperty, screen, simScreenIndex, navBarHeight, providedOptions) {
    assert && assert(screen.nameProperty.value, `name is required for screen ${simScreenIndex}`);
    assert && assert(screen.navigationBarIcon, `navigationBarIcon is required for screen ${screen.nameProperty.value}`);
    const options = optionize()({
      cursor: 'pointer',
      phetioDocumentation: `Button in the navigation bar that selects the '${screen.tandem.name}' screen`,
      maxButtonWidth: null,
      // {number|null} the maximum width of the button, causes text and/or icon to be scaled down if necessary

      // pdom
      tagName: 'button',
      containerTagName: 'li',
      descriptionContent: screen.descriptionContent,
      appendDescription: true,
      // voicing
      voicingHintResponse: screen.descriptionContent
    }, providedOptions);
    assert && assert(!options.innerContent, 'NavigationBarScreenButton sets its own innerContent');
    super();
    this.screen = screen;
    screen.pdomDisplayNameProperty.link(name => {
      this.innerContent = name;
      this.voicingNameResponse = name;
    });
    assert && assert(screen.navigationBarIcon, 'navigationBarIcon should exist');
    // icon
    const icon = new Node({
      children: [screen.navigationBarIcon],
      // wrap in case this icon is used in multiple place (eg, home screen and navbar)
      maxHeight: 0.625 * navBarHeight,
      // pdom - the icon may have focusable components in its graphic, but they should be invisible for Interactive
      // Description, all accessibility should go through this button
      pdomVisible: false
    });

    // frame around the icon
    const iconFrame = new Rectangle(0, 0, icon.width, icon.height);
    const iconAndFrame = new Node({
      children: [icon, iconFrame]
    });
    const text = new Text(screen.nameProperty, {
      font: new PhetFont(10)
    });

    // spacing set by Property link below
    const iconAndText = new VBox({
      children: [iconAndFrame, text],
      pickable: false,
      usesOpacity: true,
      // hint, since we change its opacity
      maxHeight: navBarHeight
    });

    // add a transparent overlay for input handling and to size touchArea/mouseArea
    const overlay = new Rectangle({
      rectBounds: iconAndText.bounds
    });

    // highlights
    const highlightWidth = getHighlightWidth(overlay);
    const brightenHighlight = new HighlightNode(highlightWidth, overlay.height, {
      center: iconAndText.center,
      fill: 'white'
    });
    const darkenHighlight = new HighlightNode(highlightWidth, overlay.height, {
      center: iconAndText.center,
      fill: 'black'
    });

    // Is this button's screen selected?
    const selectedProperty = new DerivedProperty([screenProperty], currentScreen => currentScreen === screen);

    // (phet-io) Create the button model, needs to be public so that PhET-iO wrappers can hook up to it if
    // needed. Note it shares a tandem with this, so the emitter will be instrumented as a child of the button.
    // Note that this buttonModel will always be phetioReadOnly false despite the parent value.
    this.buttonModel = new PushButtonModel({
      listener: () => {
        screenProperty.value !== screen && this.voicingSpeakFullResponse({
          objectResponse: null,
          hintResponse: null
        });
        screenProperty.value = screen;
      },
      tandem: options.tandem,
      phetioEnabledPropertyInstrumented: false
    });

    // Hook up the input listener
    const pressListener = this.buttonModel.createPressListener({
      tandem: options.tandem.createTandem('pressListener')
    });
    this.addInputListener(pressListener);
    this.addInputListener({
      focus: () => {
        this.voicingSpeakFullResponse({
          objectResponse: null,
          contextResponse: null
        });
      }
    });

    // manage interaction feedback
    Multilink.multilink([selectedProperty, this.buttonModel.looksPressedProperty, this.buttonModel.looksOverProperty, navigationBarFillProperty, this.buttonModel.enabledProperty], (selected, looksPressed, looksOver, navigationBarFill, enabled) => {
      const useDarkenHighlights = !navigationBarFill.equals(Color.BLACK);

      // Color match yellow with the PhET Logo
      const selectedTextColor = useDarkenHighlights ? 'black' : PhetColorScheme.BUTTON_YELLOW;
      const unselectedTextColor = useDarkenHighlights ? 'gray' : 'white';
      text.fill = selected ? selectedTextColor : unselectedTextColor;
      iconAndText.opacity = selected ? 1.0 : looksPressed ? 0.65 : 0.5;
      brightenHighlight.visible = !useDarkenHighlights && enabled && (looksOver || looksPressed);
      darkenHighlight.visible = useDarkenHighlights && enabled && (looksOver || looksPressed);

      // Put a frame around the screen icon, depending on the navigation bar background color.
      if (screen.showScreenIconFrameForNavigationBarFill === 'black' && navigationBarFill.equals(Color.BLACK)) {
        iconFrame.stroke = PhetColorScheme.SCREEN_ICON_FRAME;
      } else if (screen.showScreenIconFrameForNavigationBarFill === 'white' && navigationBarFill.equals(Color.WHITE)) {
        iconFrame.stroke = 'black'; // black frame on a white navbar
      } else {
        iconFrame.stroke = 'transparent'; // keep the same bounds for simplicity
      }
    });

    // Keep the cursor in sync with if the button is enabled. This doesn't need to be disposed.
    this.buttonModel.enabledProperty.link(enabled => {
      this.cursor = enabled ? options.cursor : null;
    });

    // Update the button's layout
    const updateLayout = () => {
      // adjust the vertical space between icon and text, see https://github.com/phetsims/joist/issues/143
      iconAndText.spacing = Utils.clamp(12 - text.height, 0, 3);

      // adjust the overlay
      overlay.setRectBounds(iconAndText.bounds);

      // adjust the highlights
      brightenHighlight.spacing = darkenHighlight.spacing = getHighlightWidth(overlay);
      brightenHighlight.center = darkenHighlight.center = iconAndText.center;
    };

    // Update the button's layout when the screen name changes
    iconAndText.boundsProperty.lazyLink(updateLayout);
    text.boundsProperty.link(updateLayout);
    this.children = [iconAndText, overlay, brightenHighlight, darkenHighlight];
    const needsIconMaxWidth = options.maxButtonWidth && this.width > options.maxButtonWidth;

    // Constrain text and icon width, if necessary
    if (needsIconMaxWidth) {
      text.maxWidth = icon.maxWidth = options.maxButtonWidth - (this.width - iconAndText.width);
    } else {
      // Don't allow the text to grow larger than the icon if changed later on using PhET-iO, see #438
      // Text is allowed to go beyond the bounds of the icon, hence we use `this.width` instead of `icon.width`
      text.maxWidth = this.width;
    }
    needsIconMaxWidth && assert && assert(Utils.toFixed(this.width, 0) === Utils.toFixed(options.maxButtonWidth, 0), `this.width ${this.width} !== options.maxButtonWidth ${options.maxButtonWidth}`);

    // A custom focus highlight so that the bottom of the highlight does not get cut-off below the navigation bar.
    // Setting to the localBounds directly prevents the default dilation of the highlight. Shape updates with changing
    // bounds to support dynamic layout.
    this.localBoundsProperty.link(localBounds => {
      this.focusHighlight = Shape.bounds(localBounds);
    });
    this.mutate(options);
  }
}
joist.register('NavigationBarScreenButton', NavigationBarScreenButton);
export default NavigationBarScreenButton;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJVdGlscyIsIlNoYXBlIiwib3B0aW9uaXplIiwiUGhldENvbG9yU2NoZW1lIiwiUGhldEZvbnQiLCJDb2xvciIsIk5vZGUiLCJSZWN0YW5nbGUiLCJUZXh0IiwiVkJveCIsIlZvaWNpbmciLCJQdXNoQnV0dG9uTW9kZWwiLCJIaWdobGlnaHROb2RlIiwiam9pc3QiLCJISUdITElHSFRfU1BBQ0lORyIsImdldEhpZ2hsaWdodFdpZHRoIiwib3ZlcmxheSIsIndpZHRoIiwiTmF2aWdhdGlvbkJhclNjcmVlbkJ1dHRvbiIsImNvbnN0cnVjdG9yIiwibmF2aWdhdGlvbkJhckZpbGxQcm9wZXJ0eSIsInNjcmVlblByb3BlcnR5Iiwic2NyZWVuIiwic2ltU2NyZWVuSW5kZXgiLCJuYXZCYXJIZWlnaHQiLCJwcm92aWRlZE9wdGlvbnMiLCJhc3NlcnQiLCJuYW1lUHJvcGVydHkiLCJ2YWx1ZSIsIm5hdmlnYXRpb25CYXJJY29uIiwib3B0aW9ucyIsImN1cnNvciIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJ0YW5kZW0iLCJuYW1lIiwibWF4QnV0dG9uV2lkdGgiLCJ0YWdOYW1lIiwiY29udGFpbmVyVGFnTmFtZSIsImRlc2NyaXB0aW9uQ29udGVudCIsImFwcGVuZERlc2NyaXB0aW9uIiwidm9pY2luZ0hpbnRSZXNwb25zZSIsImlubmVyQ29udGVudCIsInBkb21EaXNwbGF5TmFtZVByb3BlcnR5IiwibGluayIsInZvaWNpbmdOYW1lUmVzcG9uc2UiLCJpY29uIiwiY2hpbGRyZW4iLCJtYXhIZWlnaHQiLCJwZG9tVmlzaWJsZSIsImljb25GcmFtZSIsImhlaWdodCIsImljb25BbmRGcmFtZSIsInRleHQiLCJmb250IiwiaWNvbkFuZFRleHQiLCJwaWNrYWJsZSIsInVzZXNPcGFjaXR5IiwicmVjdEJvdW5kcyIsImJvdW5kcyIsImhpZ2hsaWdodFdpZHRoIiwiYnJpZ2h0ZW5IaWdobGlnaHQiLCJjZW50ZXIiLCJmaWxsIiwiZGFya2VuSGlnaGxpZ2h0Iiwic2VsZWN0ZWRQcm9wZXJ0eSIsImN1cnJlbnRTY3JlZW4iLCJidXR0b25Nb2RlbCIsImxpc3RlbmVyIiwidm9pY2luZ1NwZWFrRnVsbFJlc3BvbnNlIiwib2JqZWN0UmVzcG9uc2UiLCJoaW50UmVzcG9uc2UiLCJwaGV0aW9FbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQiLCJwcmVzc0xpc3RlbmVyIiwiY3JlYXRlUHJlc3NMaXN0ZW5lciIsImNyZWF0ZVRhbmRlbSIsImFkZElucHV0TGlzdGVuZXIiLCJmb2N1cyIsImNvbnRleHRSZXNwb25zZSIsIm11bHRpbGluayIsImxvb2tzUHJlc3NlZFByb3BlcnR5IiwibG9va3NPdmVyUHJvcGVydHkiLCJlbmFibGVkUHJvcGVydHkiLCJzZWxlY3RlZCIsImxvb2tzUHJlc3NlZCIsImxvb2tzT3ZlciIsIm5hdmlnYXRpb25CYXJGaWxsIiwiZW5hYmxlZCIsInVzZURhcmtlbkhpZ2hsaWdodHMiLCJlcXVhbHMiLCJCTEFDSyIsInNlbGVjdGVkVGV4dENvbG9yIiwiQlVUVE9OX1lFTExPVyIsInVuc2VsZWN0ZWRUZXh0Q29sb3IiLCJvcGFjaXR5IiwidmlzaWJsZSIsInNob3dTY3JlZW5JY29uRnJhbWVGb3JOYXZpZ2F0aW9uQmFyRmlsbCIsInN0cm9rZSIsIlNDUkVFTl9JQ09OX0ZSQU1FIiwiV0hJVEUiLCJ1cGRhdGVMYXlvdXQiLCJzcGFjaW5nIiwiY2xhbXAiLCJzZXRSZWN0Qm91bmRzIiwiYm91bmRzUHJvcGVydHkiLCJsYXp5TGluayIsIm5lZWRzSWNvbk1heFdpZHRoIiwibWF4V2lkdGgiLCJ0b0ZpeGVkIiwibG9jYWxCb3VuZHNQcm9wZXJ0eSIsImxvY2FsQm91bmRzIiwiZm9jdXNIaWdobGlnaHQiLCJtdXRhdGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk5hdmlnYXRpb25CYXJTY3JlZW5CdXR0b24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQnV0dG9uIGZvciBhIHNpbmdsZSBzY3JlZW4gaW4gdGhlIG5hdmlnYXRpb24gYmFyLCBzaG93cyB0aGUgdGV4dCBhbmQgdGhlIG5hdmlnYXRpb24gYmFyIGljb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGhldENvbG9yU2NoZW1lIGZyb20gJy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Q29sb3JTY2hlbWUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIE5vZGUsIE5vZGVPcHRpb25zLCBSZWN0YW5nbGUsIFRleHQsIFZCb3gsIFZvaWNpbmcsIFZvaWNpbmdPcHRpb25zIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFB1c2hCdXR0b25Nb2RlbCBmcm9tICcuLi8uLi9zdW4vanMvYnV0dG9ucy9QdXNoQnV0dG9uTW9kZWwuanMnO1xyXG5pbXBvcnQgSGlnaGxpZ2h0Tm9kZSBmcm9tICcuL0hpZ2hsaWdodE5vZGUuanMnO1xyXG5pbXBvcnQgam9pc3QgZnJvbSAnLi9qb2lzdC5qcyc7XHJcbmltcG9ydCB7IEFueVNjcmVlbiB9IGZyb20gJy4vU2NyZWVuLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBISUdITElHSFRfU1BBQ0lORyA9IDQ7XHJcbmNvbnN0IGdldEhpZ2hsaWdodFdpZHRoID0gKCBvdmVybGF5OiBOb2RlICkgPT4gb3ZlcmxheS53aWR0aCArICggMiAqIEhJR0hMSUdIVF9TUEFDSU5HICk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIG1heEJ1dHRvbldpZHRoPzogbnVtYmVyIHwgbnVsbDtcclxufTtcclxudHlwZSBQYXJlbnRPcHRpb25zID0gVm9pY2luZ09wdGlvbnMgJiBOb2RlT3B0aW9ucztcclxudHlwZSBOYXZpZ2F0aW9uQmFyU2NyZWVuQnV0dG9uT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGFyZW50T3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxQYXJlbnRPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5jbGFzcyBOYXZpZ2F0aW9uQmFyU2NyZWVuQnV0dG9uIGV4dGVuZHMgVm9pY2luZyggTm9kZSApIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGJ1dHRvbk1vZGVsOiBQdXNoQnV0dG9uTW9kZWw7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBzY3JlZW46IEFueVNjcmVlbjtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIG5hdmlnYXRpb25CYXJGaWxsUHJvcGVydHkgLSB0aGUgY29sb3Igb2YgdGhlIG5hdmJhciwgYXMgYSBzdHJpbmcuXHJcbiAgICogQHBhcmFtIHNjcmVlblByb3BlcnR5XHJcbiAgICogQHBhcmFtIHNjcmVlblxyXG4gICAqIEBwYXJhbSBzaW1TY3JlZW5JbmRleCAtIHRoZSBpbmRleCAod2l0aGluIHNpbSBzY3JlZW5zIG9ubHkpIG9mIHRoZSBzY3JlZW4gY29ycmVzcG9uZGluZyB0byB0aGlzIGJ1dHRvblxyXG4gICAqIEBwYXJhbSBuYXZCYXJIZWlnaHRcclxuICAgKiBAcGFyYW0gW3Byb3ZpZGVkT3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG5hdmlnYXRpb25CYXJGaWxsUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PENvbG9yPiwgc2NyZWVuUHJvcGVydHk6IFByb3BlcnR5PEFueVNjcmVlbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBzY3JlZW46IEFueVNjcmVlbiwgc2ltU2NyZWVuSW5kZXg6IG51bWJlciwgbmF2QmFySGVpZ2h0OiBudW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM6IE5hdmlnYXRpb25CYXJTY3JlZW5CdXR0b25PcHRpb25zICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHNjcmVlbi5uYW1lUHJvcGVydHkudmFsdWUsIGBuYW1lIGlzIHJlcXVpcmVkIGZvciBzY3JlZW4gJHtzaW1TY3JlZW5JbmRleH1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBzY3JlZW4ubmF2aWdhdGlvbkJhckljb24sIGBuYXZpZ2F0aW9uQmFySWNvbiBpcyByZXF1aXJlZCBmb3Igc2NyZWVuICR7c2NyZWVuLm5hbWVQcm9wZXJ0eS52YWx1ZX1gICk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxOYXZpZ2F0aW9uQmFyU2NyZWVuQnV0dG9uT3B0aW9ucywgU2VsZk9wdGlvbnMsIFBhcmVudE9wdGlvbnM+KCkoIHtcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246IGBCdXR0b24gaW4gdGhlIG5hdmlnYXRpb24gYmFyIHRoYXQgc2VsZWN0cyB0aGUgJyR7c2NyZWVuLnRhbmRlbS5uYW1lfScgc2NyZWVuYCxcclxuICAgICAgbWF4QnV0dG9uV2lkdGg6IG51bGwsIC8vIHtudW1iZXJ8bnVsbH0gdGhlIG1heGltdW0gd2lkdGggb2YgdGhlIGJ1dHRvbiwgY2F1c2VzIHRleHQgYW5kL29yIGljb24gdG8gYmUgc2NhbGVkIGRvd24gaWYgbmVjZXNzYXJ5XHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICdidXR0b24nLFxyXG4gICAgICBjb250YWluZXJUYWdOYW1lOiAnbGknLFxyXG4gICAgICBkZXNjcmlwdGlvbkNvbnRlbnQ6IHNjcmVlbi5kZXNjcmlwdGlvbkNvbnRlbnQsXHJcbiAgICAgIGFwcGVuZERlc2NyaXB0aW9uOiB0cnVlLFxyXG5cclxuICAgICAgLy8gdm9pY2luZ1xyXG4gICAgICB2b2ljaW5nSGludFJlc3BvbnNlOiBzY3JlZW4uZGVzY3JpcHRpb25Db250ZW50XHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy5pbm5lckNvbnRlbnQsICdOYXZpZ2F0aW9uQmFyU2NyZWVuQnV0dG9uIHNldHMgaXRzIG93biBpbm5lckNvbnRlbnQnICk7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICB0aGlzLnNjcmVlbiA9IHNjcmVlbjtcclxuXHJcbiAgICBzY3JlZW4ucGRvbURpc3BsYXlOYW1lUHJvcGVydHkubGluayggbmFtZSA9PiB7XHJcbiAgICAgIHRoaXMuaW5uZXJDb250ZW50ID0gbmFtZTtcclxuICAgICAgdGhpcy52b2ljaW5nTmFtZVJlc3BvbnNlID0gbmFtZTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBzY3JlZW4ubmF2aWdhdGlvbkJhckljb24sICduYXZpZ2F0aW9uQmFySWNvbiBzaG91bGQgZXhpc3QnICk7XHJcbiAgICAvLyBpY29uXHJcbiAgICBjb25zdCBpY29uID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgc2NyZWVuLm5hdmlnYXRpb25CYXJJY29uISBdLCAvLyB3cmFwIGluIGNhc2UgdGhpcyBpY29uIGlzIHVzZWQgaW4gbXVsdGlwbGUgcGxhY2UgKGVnLCBob21lIHNjcmVlbiBhbmQgbmF2YmFyKVxyXG4gICAgICBtYXhIZWlnaHQ6IDAuNjI1ICogbmF2QmFySGVpZ2h0LFxyXG5cclxuICAgICAgLy8gcGRvbSAtIHRoZSBpY29uIG1heSBoYXZlIGZvY3VzYWJsZSBjb21wb25lbnRzIGluIGl0cyBncmFwaGljLCBidXQgdGhleSBzaG91bGQgYmUgaW52aXNpYmxlIGZvciBJbnRlcmFjdGl2ZVxyXG4gICAgICAvLyBEZXNjcmlwdGlvbiwgYWxsIGFjY2Vzc2liaWxpdHkgc2hvdWxkIGdvIHRocm91Z2ggdGhpcyBidXR0b25cclxuICAgICAgcGRvbVZpc2libGU6IGZhbHNlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gZnJhbWUgYXJvdW5kIHRoZSBpY29uXHJcbiAgICBjb25zdCBpY29uRnJhbWUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBpY29uLndpZHRoLCBpY29uLmhlaWdodCApO1xyXG5cclxuICAgIGNvbnN0IGljb25BbmRGcmFtZSA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIGljb24sIGljb25GcmFtZSBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdGV4dCA9IG5ldyBUZXh0KCBzY3JlZW4ubmFtZVByb3BlcnR5LCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTAgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHNwYWNpbmcgc2V0IGJ5IFByb3BlcnR5IGxpbmsgYmVsb3dcclxuICAgIGNvbnN0IGljb25BbmRUZXh0ID0gbmV3IFZCb3goIHtcclxuICAgICAgY2hpbGRyZW46IFsgaWNvbkFuZEZyYW1lLCB0ZXh0IF0sXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuICAgICAgdXNlc09wYWNpdHk6IHRydWUsIC8vIGhpbnQsIHNpbmNlIHdlIGNoYW5nZSBpdHMgb3BhY2l0eVxyXG4gICAgICBtYXhIZWlnaHQ6IG5hdkJhckhlaWdodFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGFkZCBhIHRyYW5zcGFyZW50IG92ZXJsYXkgZm9yIGlucHV0IGhhbmRsaW5nIGFuZCB0byBzaXplIHRvdWNoQXJlYS9tb3VzZUFyZWFcclxuICAgIGNvbnN0IG92ZXJsYXkgPSBuZXcgUmVjdGFuZ2xlKCB7IHJlY3RCb3VuZHM6IGljb25BbmRUZXh0LmJvdW5kcyB9ICk7XHJcblxyXG4gICAgLy8gaGlnaGxpZ2h0c1xyXG4gICAgY29uc3QgaGlnaGxpZ2h0V2lkdGggPSBnZXRIaWdobGlnaHRXaWR0aCggb3ZlcmxheSApO1xyXG4gICAgY29uc3QgYnJpZ2h0ZW5IaWdobGlnaHQgPSBuZXcgSGlnaGxpZ2h0Tm9kZSggaGlnaGxpZ2h0V2lkdGgsIG92ZXJsYXkuaGVpZ2h0LCB7XHJcbiAgICAgIGNlbnRlcjogaWNvbkFuZFRleHQuY2VudGVyLFxyXG4gICAgICBmaWxsOiAnd2hpdGUnXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBkYXJrZW5IaWdobGlnaHQgPSBuZXcgSGlnaGxpZ2h0Tm9kZSggaGlnaGxpZ2h0V2lkdGgsIG92ZXJsYXkuaGVpZ2h0LCB7XHJcbiAgICAgIGNlbnRlcjogaWNvbkFuZFRleHQuY2VudGVyLFxyXG4gICAgICBmaWxsOiAnYmxhY2snXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gSXMgdGhpcyBidXR0b24ncyBzY3JlZW4gc2VsZWN0ZWQ/XHJcbiAgICBjb25zdCBzZWxlY3RlZFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBzY3JlZW5Qcm9wZXJ0eSBdLCBjdXJyZW50U2NyZWVuID0+ICggY3VycmVudFNjcmVlbiA9PT0gc2NyZWVuICkgKTtcclxuXHJcbiAgICAvLyAocGhldC1pbykgQ3JlYXRlIHRoZSBidXR0b24gbW9kZWwsIG5lZWRzIHRvIGJlIHB1YmxpYyBzbyB0aGF0IFBoRVQtaU8gd3JhcHBlcnMgY2FuIGhvb2sgdXAgdG8gaXQgaWZcclxuICAgIC8vIG5lZWRlZC4gTm90ZSBpdCBzaGFyZXMgYSB0YW5kZW0gd2l0aCB0aGlzLCBzbyB0aGUgZW1pdHRlciB3aWxsIGJlIGluc3RydW1lbnRlZCBhcyBhIGNoaWxkIG9mIHRoZSBidXR0b24uXHJcbiAgICAvLyBOb3RlIHRoYXQgdGhpcyBidXR0b25Nb2RlbCB3aWxsIGFsd2F5cyBiZSBwaGV0aW9SZWFkT25seSBmYWxzZSBkZXNwaXRlIHRoZSBwYXJlbnQgdmFsdWUuXHJcbiAgICB0aGlzLmJ1dHRvbk1vZGVsID0gbmV3IFB1c2hCdXR0b25Nb2RlbCgge1xyXG4gICAgICBsaXN0ZW5lcjogKCkgPT4ge1xyXG5cclxuICAgICAgICBzY3JlZW5Qcm9wZXJ0eS52YWx1ZSAhPT0gc2NyZWVuICYmIHRoaXMudm9pY2luZ1NwZWFrRnVsbFJlc3BvbnNlKCB7XHJcbiAgICAgICAgICBvYmplY3RSZXNwb25zZTogbnVsbCxcclxuICAgICAgICAgIGhpbnRSZXNwb25zZTogbnVsbFxyXG4gICAgICAgIH0gKTtcclxuICAgICAgICBzY3JlZW5Qcm9wZXJ0eS52YWx1ZSA9IHNjcmVlbjtcclxuICAgICAgfSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbSxcclxuICAgICAgcGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkOiBmYWxzZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEhvb2sgdXAgdGhlIGlucHV0IGxpc3RlbmVyXHJcbiAgICBjb25zdCBwcmVzc0xpc3RlbmVyID0gdGhpcy5idXR0b25Nb2RlbC5jcmVhdGVQcmVzc0xpc3RlbmVyKCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncHJlc3NMaXN0ZW5lcicgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRJbnB1dExpc3RlbmVyKCBwcmVzc0xpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5hZGRJbnB1dExpc3RlbmVyKCB7XHJcbiAgICAgIGZvY3VzOiAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy52b2ljaW5nU3BlYWtGdWxsUmVzcG9uc2UoIHtcclxuICAgICAgICAgIG9iamVjdFJlc3BvbnNlOiBudWxsLFxyXG4gICAgICAgICAgY29udGV4dFJlc3BvbnNlOiBudWxsXHJcbiAgICAgICAgfSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gbWFuYWdlIGludGVyYWN0aW9uIGZlZWRiYWNrXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKFxyXG4gICAgICBbIHNlbGVjdGVkUHJvcGVydHksIHRoaXMuYnV0dG9uTW9kZWwubG9va3NQcmVzc2VkUHJvcGVydHksIHRoaXMuYnV0dG9uTW9kZWwubG9va3NPdmVyUHJvcGVydHksIG5hdmlnYXRpb25CYXJGaWxsUHJvcGVydHksIHRoaXMuYnV0dG9uTW9kZWwuZW5hYmxlZFByb3BlcnR5IF0sXHJcbiAgICAgICggc2VsZWN0ZWQsIGxvb2tzUHJlc3NlZCwgbG9va3NPdmVyLCBuYXZpZ2F0aW9uQmFyRmlsbCwgZW5hYmxlZCApID0+IHtcclxuXHJcbiAgICAgICAgY29uc3QgdXNlRGFya2VuSGlnaGxpZ2h0cyA9ICFuYXZpZ2F0aW9uQmFyRmlsbC5lcXVhbHMoIENvbG9yLkJMQUNLICk7XHJcblxyXG4gICAgICAgIC8vIENvbG9yIG1hdGNoIHllbGxvdyB3aXRoIHRoZSBQaEVUIExvZ29cclxuICAgICAgICBjb25zdCBzZWxlY3RlZFRleHRDb2xvciA9IHVzZURhcmtlbkhpZ2hsaWdodHMgPyAnYmxhY2snIDogUGhldENvbG9yU2NoZW1lLkJVVFRPTl9ZRUxMT1c7XHJcbiAgICAgICAgY29uc3QgdW5zZWxlY3RlZFRleHRDb2xvciA9IHVzZURhcmtlbkhpZ2hsaWdodHMgPyAnZ3JheScgOiAnd2hpdGUnO1xyXG5cclxuICAgICAgICB0ZXh0LmZpbGwgPSBzZWxlY3RlZCA/IHNlbGVjdGVkVGV4dENvbG9yIDogdW5zZWxlY3RlZFRleHRDb2xvcjtcclxuICAgICAgICBpY29uQW5kVGV4dC5vcGFjaXR5ID0gc2VsZWN0ZWQgPyAxLjAgOiAoIGxvb2tzUHJlc3NlZCA/IDAuNjUgOiAwLjUgKTtcclxuXHJcbiAgICAgICAgYnJpZ2h0ZW5IaWdobGlnaHQudmlzaWJsZSA9ICF1c2VEYXJrZW5IaWdobGlnaHRzICYmIGVuYWJsZWQgJiYgKCBsb29rc092ZXIgfHwgbG9va3NQcmVzc2VkICk7XHJcbiAgICAgICAgZGFya2VuSGlnaGxpZ2h0LnZpc2libGUgPSB1c2VEYXJrZW5IaWdobGlnaHRzICYmIGVuYWJsZWQgJiYgKCBsb29rc092ZXIgfHwgbG9va3NQcmVzc2VkICk7XHJcblxyXG4gICAgICAgIC8vIFB1dCBhIGZyYW1lIGFyb3VuZCB0aGUgc2NyZWVuIGljb24sIGRlcGVuZGluZyBvbiB0aGUgbmF2aWdhdGlvbiBiYXIgYmFja2dyb3VuZCBjb2xvci5cclxuICAgICAgICBpZiAoIHNjcmVlbi5zaG93U2NyZWVuSWNvbkZyYW1lRm9yTmF2aWdhdGlvbkJhckZpbGwgPT09ICdibGFjaycgJiYgbmF2aWdhdGlvbkJhckZpbGwuZXF1YWxzKCBDb2xvci5CTEFDSyApICkge1xyXG4gICAgICAgICAgaWNvbkZyYW1lLnN0cm9rZSA9IFBoZXRDb2xvclNjaGVtZS5TQ1JFRU5fSUNPTl9GUkFNRTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVsc2UgaWYgKCBzY3JlZW4uc2hvd1NjcmVlbkljb25GcmFtZUZvck5hdmlnYXRpb25CYXJGaWxsID09PSAnd2hpdGUnICYmIG5hdmlnYXRpb25CYXJGaWxsLmVxdWFscyggQ29sb3IuV0hJVEUgKSApIHtcclxuICAgICAgICAgIGljb25GcmFtZS5zdHJva2UgPSAnYmxhY2snOyAvLyBibGFjayBmcmFtZSBvbiBhIHdoaXRlIG5hdmJhclxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGljb25GcmFtZS5zdHJva2UgPSAndHJhbnNwYXJlbnQnOyAvLyBrZWVwIHRoZSBzYW1lIGJvdW5kcyBmb3Igc2ltcGxpY2l0eVxyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG5cclxuICAgIC8vIEtlZXAgdGhlIGN1cnNvciBpbiBzeW5jIHdpdGggaWYgdGhlIGJ1dHRvbiBpcyBlbmFibGVkLiBUaGlzIGRvZXNuJ3QgbmVlZCB0byBiZSBkaXNwb3NlZC5cclxuICAgIHRoaXMuYnV0dG9uTW9kZWwuZW5hYmxlZFByb3BlcnR5LmxpbmsoIGVuYWJsZWQgPT4ge1xyXG4gICAgICB0aGlzLmN1cnNvciA9IGVuYWJsZWQgPyBvcHRpb25zLmN1cnNvciA6IG51bGw7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSBidXR0b24ncyBsYXlvdXRcclxuICAgIGNvbnN0IHVwZGF0ZUxheW91dCA9ICgpID0+IHtcclxuXHJcbiAgICAgIC8vIGFkanVzdCB0aGUgdmVydGljYWwgc3BhY2UgYmV0d2VlbiBpY29uIGFuZCB0ZXh0LCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2pvaXN0L2lzc3Vlcy8xNDNcclxuICAgICAgaWNvbkFuZFRleHQuc3BhY2luZyA9IFV0aWxzLmNsYW1wKCAxMiAtIHRleHQuaGVpZ2h0LCAwLCAzICk7XHJcblxyXG4gICAgICAvLyBhZGp1c3QgdGhlIG92ZXJsYXlcclxuICAgICAgb3ZlcmxheS5zZXRSZWN0Qm91bmRzKCBpY29uQW5kVGV4dC5ib3VuZHMgKTtcclxuXHJcbiAgICAgIC8vIGFkanVzdCB0aGUgaGlnaGxpZ2h0c1xyXG4gICAgICBicmlnaHRlbkhpZ2hsaWdodC5zcGFjaW5nID0gZGFya2VuSGlnaGxpZ2h0LnNwYWNpbmcgPSBnZXRIaWdobGlnaHRXaWR0aCggb3ZlcmxheSApO1xyXG4gICAgICBicmlnaHRlbkhpZ2hsaWdodC5jZW50ZXIgPSBkYXJrZW5IaWdobGlnaHQuY2VudGVyID0gaWNvbkFuZFRleHQuY2VudGVyO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIGJ1dHRvbidzIGxheW91dCB3aGVuIHRoZSBzY3JlZW4gbmFtZSBjaGFuZ2VzXHJcbiAgICBpY29uQW5kVGV4dC5ib3VuZHNQcm9wZXJ0eS5sYXp5TGluayggdXBkYXRlTGF5b3V0ICk7XHJcbiAgICB0ZXh0LmJvdW5kc1Byb3BlcnR5LmxpbmsoIHVwZGF0ZUxheW91dCApO1xyXG5cclxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXHJcbiAgICAgIGljb25BbmRUZXh0LFxyXG4gICAgICBvdmVybGF5LFxyXG4gICAgICBicmlnaHRlbkhpZ2hsaWdodCxcclxuICAgICAgZGFya2VuSGlnaGxpZ2h0XHJcbiAgICBdO1xyXG5cclxuICAgIGNvbnN0IG5lZWRzSWNvbk1heFdpZHRoID0gb3B0aW9ucy5tYXhCdXR0b25XaWR0aCAmJiAoIHRoaXMud2lkdGggPiBvcHRpb25zLm1heEJ1dHRvbldpZHRoICk7XHJcblxyXG4gICAgLy8gQ29uc3RyYWluIHRleHQgYW5kIGljb24gd2lkdGgsIGlmIG5lY2Vzc2FyeVxyXG4gICAgaWYgKCBuZWVkc0ljb25NYXhXaWR0aCApIHtcclxuICAgICAgdGV4dC5tYXhXaWR0aCA9IGljb24ubWF4V2lkdGggPSBvcHRpb25zLm1heEJ1dHRvbldpZHRoISAtICggdGhpcy53aWR0aCAtIGljb25BbmRUZXh0LndpZHRoICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgLy8gRG9uJ3QgYWxsb3cgdGhlIHRleHQgdG8gZ3JvdyBsYXJnZXIgdGhhbiB0aGUgaWNvbiBpZiBjaGFuZ2VkIGxhdGVyIG9uIHVzaW5nIFBoRVQtaU8sIHNlZSAjNDM4XHJcbiAgICAgIC8vIFRleHQgaXMgYWxsb3dlZCB0byBnbyBiZXlvbmQgdGhlIGJvdW5kcyBvZiB0aGUgaWNvbiwgaGVuY2Ugd2UgdXNlIGB0aGlzLndpZHRoYCBpbnN0ZWFkIG9mIGBpY29uLndpZHRoYFxyXG4gICAgICB0ZXh0Lm1heFdpZHRoID0gdGhpcy53aWR0aDtcclxuICAgIH1cclxuXHJcbiAgICBuZWVkc0ljb25NYXhXaWR0aCAmJiBhc3NlcnQgJiYgYXNzZXJ0KCBVdGlscy50b0ZpeGVkKCB0aGlzLndpZHRoLCAwICkgPT09IFV0aWxzLnRvRml4ZWQoIG9wdGlvbnMubWF4QnV0dG9uV2lkdGghLCAwICksXHJcbiAgICAgIGB0aGlzLndpZHRoICR7dGhpcy53aWR0aH0gIT09IG9wdGlvbnMubWF4QnV0dG9uV2lkdGggJHtvcHRpb25zLm1heEJ1dHRvbldpZHRofWAgKTtcclxuXHJcbiAgICAvLyBBIGN1c3RvbSBmb2N1cyBoaWdobGlnaHQgc28gdGhhdCB0aGUgYm90dG9tIG9mIHRoZSBoaWdobGlnaHQgZG9lcyBub3QgZ2V0IGN1dC1vZmYgYmVsb3cgdGhlIG5hdmlnYXRpb24gYmFyLlxyXG4gICAgLy8gU2V0dGluZyB0byB0aGUgbG9jYWxCb3VuZHMgZGlyZWN0bHkgcHJldmVudHMgdGhlIGRlZmF1bHQgZGlsYXRpb24gb2YgdGhlIGhpZ2hsaWdodC4gU2hhcGUgdXBkYXRlcyB3aXRoIGNoYW5naW5nXHJcbiAgICAvLyBib3VuZHMgdG8gc3VwcG9ydCBkeW5hbWljIGxheW91dC5cclxuICAgIHRoaXMubG9jYWxCb3VuZHNQcm9wZXJ0eS5saW5rKCBsb2NhbEJvdW5kcyA9PiB7XHJcbiAgICAgIHRoaXMuZm9jdXNIaWdobGlnaHQgPSBTaGFwZS5ib3VuZHMoIGxvY2FsQm91bmRzICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbmpvaXN0LnJlZ2lzdGVyKCAnTmF2aWdhdGlvbkJhclNjcmVlbkJ1dHRvbicsIE5hdmlnYXRpb25CYXJTY3JlZW5CdXR0b24gKTtcclxuZXhwb3J0IGRlZmF1bHQgTmF2aWdhdGlvbkJhclNjcmVlbkJ1dHRvbjsiXSwi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