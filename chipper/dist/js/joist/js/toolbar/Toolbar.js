// Copyright 2021-2023, University of Colorado Boulder

/**
 * The Toolbar along the left edge of the screen with controls related to the sim or active screen. Currently, it
 * only contains controls related to the Voicing feature. It isn't always displayed and the user must request it
 * from the PreferencesDialog. In order to be used, both voicing AND the Toolbar must be enabled by the user.
 * Voicing can be used without this shown.
 *
 * When open, the sim will resize and shift to the right to create space. Screen bounds are adjusted so that
 * simulation components will never overlap with the Toolbar.
 *
 * @author Jesse Greenberg
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../axon/js/NumberProperty.js';
import stepTimer from '../../../axon/js/stepTimer.js';
import Matrix3 from '../../../dot/js/Matrix3.js';
import { Shape } from '../../../kite/js/imports.js';
import optionize from '../../../phet-core/js/optionize.js';
import { Node, Path, Rectangle, voicingManager } from '../../../scenery/js/imports.js';
import ButtonNode from '../../../sun/js/buttons/ButtonNode.js';
import RoundPushButton from '../../../sun/js/buttons/RoundPushButton.js';
import Tandem from '../../../tandem/js/Tandem.js';
import audioManager from '../audioManager.js';
import joist from '../joist.js';
import JoistStrings from '../JoistStrings.js';
import VoicingToolbarAlertManager from './VoicingToolbarAlertManager.js';
import VoicingToolbarItem from './VoicingToolbarItem.js';
// constants
const MAX_ANIMATION_SPEED = 250; // in view coordinates per second, assuming 60 fps
const CONTENT_TOP_MARGIN = 15; // margin between top of Toolbar and contents

// constants
const openToolbarStringProperty = JoistStrings.a11y.toolbar.openToolbarStringProperty;
const closeToolbarStringProperty = JoistStrings.a11y.toolbar.closeToolbarStringProperty;
const hideToolbarStringProperty = JoistStrings.a11y.toolbar.hideToolbarStringProperty;
const showToolbarStringProperty = JoistStrings.a11y.toolbar.showToolbarStringProperty;
const toolbarShownStringProperty = JoistStrings.a11y.toolbar.toolbarShownStringProperty;
const toolbarHiddenStringProperty = JoistStrings.a11y.toolbar.toolbarHiddenStringProperty;
class Toolbar extends Node {
  // Whether the Toolbar is enabled (visible to the user)

  // the Rectangle for the Toolbar that surrounds all content, bounds set once
  // content is created and in layout to fill height of screen

  // The position of the right edge of the backgroundRectangle in local coordinates.
  // This is what controls the position of the Toolbar as it is open/closed/removed/animating.

  // The target position for the rightPositionProperty, to support animation. In step,
  // the rightPositionProperty will be changed until the rightPositionProperty equals the rightDestinationPosition.

  // Whether the Toolbar is open or closed. This is different from whether or not it is showing.

  //  Whether the Toolbar is shown to the user. At this time,
  // that is true if the toolbar is enabled, voicing is enabled, and if all audio is enabled. The Toolbar only
  // includes controls related to audio (voicing) so when audio is disabled there is no need to show it.

  // Scale applied to the Toolbar and its contents in response to layout and window resizing.
  layoutScale = 1;

  // Contents for the Toolbar, currently only controls related to the voicing
  // feature.

  // width of content for the toolbar in the local coordinate frame

  // Margin between toolbar content and edge of the backgroundRectangle, in the local coordinate
  // frame. Also used to determine the right position when closed. This is the width of the button so that when the
  // Toolbar is closed only the button is shown and all other content is hidden.

  constructor(enabledProperty, selectedScreenProperty, lookAndFeel, providedOptions) {
    const options = optionize()({
      // pdom
      tagName: 'div',
      // phet-io
      visiblePropertyOptions: {
        phetioReadOnly: true
      }
    }, providedOptions);
    super(options);
    this.isEnabledProperty = enabledProperty;
    this.backgroundRectangle = new Rectangle(0, 0, 0, 0, {
      fill: lookAndFeel.navigationBarFillProperty
    });
    this.openProperty = new BooleanProperty(true);
    this.isShowingProperty = DerivedProperty.and([this.isEnabledProperty, voicingManager.enabledProperty, audioManager.audioEnabledProperty]);
    const voicingAlertManager = new VoicingToolbarAlertManager(selectedScreenProperty);
    this.menuContent = new VoicingToolbarItem(voicingAlertManager, lookAndFeel, {
      tandem: options.tandem?.createTandem('menuContent')
    });

    // icon for the openButton
    const chevronIcon = new DoubleChevron();
    this.openButton = new RoundPushButton({
      content: chevronIcon,
      listener: () => this.openProperty.toggle(),
      buttonAppearanceStrategy: ButtonNode.FlatAppearanceStrategy,
      baseColor: 'lightgrey',
      // phet-io - opting out of Tandems for now
      tandem: Tandem.OPT_OUT
    });
    this.contentWidth = this.menuContent.localBounds.width;
    this.contentMargin = this.openButton.localBounds.width;

    // The position of the right edge of the backgroundRectangle in local coordinates.
    // This is what controls the position of the Toolbar as it is open/closed/removed/animating.
    this.rightPositionProperty = new NumberProperty(this.getHiddenPosition());

    // The target position for the rightPositionProperty, to support animation. In step,
    // the rightPositionProperty will be changed until the rightPositionProperty equals the rightDestinationPosition.
    this.rightDestinationPosition = 0;

    // a parent for all Nodes of the toolbar, so we can set visibility of this group internally when
    // the isShowingProperty changes
    const contentParent = new Node({
      children: [this.backgroundRectangle, this.menuContent, this.openButton]
    });
    this.addChild(contentParent);

    // move to destination position in the animation frame
    const timerListener = dt => {
      this.step(dt);
    };
    stepTimer.addListener(timerListener);
    const isOpenListener = (open, oldValue) => {
      // rotate chevron to indicate direction of toolbar movement
      chevronIcon.matrix = open ? Matrix3.scaling(-1, 1) : Matrix3.IDENTITY;

      // when closed, menu content should be hidden from screen readers and the navigation order
      this.menuContent.pdomVisible = open;
      this.openButton.innerContent = open ? closeToolbarStringProperty : openToolbarStringProperty;
      this.openButton.voicingNameResponse = open ? hideToolbarStringProperty : showToolbarStringProperty;
      this.updateDestinationPosition();
      if (oldValue !== null) {
        const alertProperty = open ? toolbarShownStringProperty : toolbarHiddenStringProperty;
        this.openButton.voicingSpeakContextResponse({
          contextResponse: alertProperty
        });
        this.alertDescriptionUtterance(alertProperty);
      }
    };
    this.openProperty.link(isOpenListener);

    // when shown or hidden update destination positions so it animates open or close
    const isShowingListener = showing => {
      this.updateDestinationPosition();

      // when now showing, this entire toolbar should be hidden for Interactive Description, but we don't use
      // visibility directly because we want to see the Toolbar animate away
      contentParent.pdomVisible = showing;
    };
    this.isShowingProperty.link(isShowingListener);
    this.disposeToolbar = () => {
      this.isShowingProperty.unlink(isShowingListener);
      this.openProperty.unlink(isOpenListener);
    };
  }

  /**
   * Returns the width of the Toolbar that can be seen on screen. This can be any value from the full width of the
   * Toolbar to zero width, depending on whether it is open, closed, removed entirely, or animating.
   */
  getDisplayedWidth() {
    return this.rightPositionProperty.value * this.layoutScale + this.openButton.width / 2;
  }
  getHiddenPosition() {
    assert && assert(typeof this.contentMargin === 'number');
    return -this.contentMargin / 2;
  }

  /**
   * Update rightDestinationPosition so that the Toolbar will animate towards opening, closing, or being removed
   * entirely from view.
   */
  updateDestinationPosition() {
    if (this.isShowingProperty.value) {
      // the Toolbar is enabled and should either show all content or just the openButton
      this.rightDestinationPosition = this.openProperty.value ? this.contentWidth + this.contentMargin * 2 : this.contentMargin;
    } else {
      // no aspect of the menu should be visible
      this.rightDestinationPosition = this.getHiddenPosition();
    }
  }

  /**
   * Animated the Toolbar as it opens and closes.
   */
  step(dt) {
    const distance = Math.abs(this.rightPositionProperty.value - this.rightDestinationPosition);
    if (distance !== 0) {
      const animationDistance = Math.min(distance, MAX_ANIMATION_SPEED * dt);
      const currentPosition = this.rightPositionProperty.value;
      this.rightPositionProperty.value = this.rightDestinationPosition > currentPosition ? currentPosition + animationDistance : currentPosition - animationDistance;
    }
  }

  /**
   * Layout for the Toolbar, called whenever position changes or window is resized.
   */
  layout(scale, height) {
    this.layoutScale = scale;
    this.menuContent.setScaleMagnitude(scale);
    this.openButton.setScaleMagnitude(scale);
    this.backgroundRectangle.rectWidth = scale * (this.contentWidth + this.contentMargin * 2);
    this.backgroundRectangle.rectHeight = height;
    this.backgroundRectangle.right = this.rightPositionProperty.value * scale;
    this.openButton.center = this.backgroundRectangle.rightCenter;
    this.menuContent.centerTop = this.backgroundRectangle.centerTop.plusXY(0, CONTENT_TOP_MARGIN);
  }
  dispose() {
    this.disposeToolbar();
    super.dispose();
  }
}

/**
 * The icon for the button that opens and closes the Toolbar.
 */
class DoubleChevron extends Path {
  constructor() {
    // spacing and dimensions for the arrows
    const chevronSpacing = 8;
    const chevronWidth = 5;
    const chevronHeight = 12;
    const chevronShape = new Shape();
    for (let i = 0; i < 2; i++) {
      const left = i * chevronSpacing;
      chevronShape.moveTo(left, 0);
      chevronShape.lineTo(left + chevronWidth, chevronHeight / 2);
      chevronShape.lineTo(left, chevronHeight);
    }
    super(chevronShape, {
      stroke: 'black',
      lineWidth: 3.5,
      lineCap: 'round'
    });
  }
}
joist.register('Toolbar', Toolbar);
export default Toolbar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsInN0ZXBUaW1lciIsIk1hdHJpeDMiLCJTaGFwZSIsIm9wdGlvbml6ZSIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwidm9pY2luZ01hbmFnZXIiLCJCdXR0b25Ob2RlIiwiUm91bmRQdXNoQnV0dG9uIiwiVGFuZGVtIiwiYXVkaW9NYW5hZ2VyIiwiam9pc3QiLCJKb2lzdFN0cmluZ3MiLCJWb2ljaW5nVG9vbGJhckFsZXJ0TWFuYWdlciIsIlZvaWNpbmdUb29sYmFySXRlbSIsIk1BWF9BTklNQVRJT05fU1BFRUQiLCJDT05URU5UX1RPUF9NQVJHSU4iLCJvcGVuVG9vbGJhclN0cmluZ1Byb3BlcnR5IiwiYTExeSIsInRvb2xiYXIiLCJjbG9zZVRvb2xiYXJTdHJpbmdQcm9wZXJ0eSIsImhpZGVUb29sYmFyU3RyaW5nUHJvcGVydHkiLCJzaG93VG9vbGJhclN0cmluZ1Byb3BlcnR5IiwidG9vbGJhclNob3duU3RyaW5nUHJvcGVydHkiLCJ0b29sYmFySGlkZGVuU3RyaW5nUHJvcGVydHkiLCJUb29sYmFyIiwibGF5b3V0U2NhbGUiLCJjb25zdHJ1Y3RvciIsImVuYWJsZWRQcm9wZXJ0eSIsInNlbGVjdGVkU2NyZWVuUHJvcGVydHkiLCJsb29rQW5kRmVlbCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ0YWdOYW1lIiwidmlzaWJsZVByb3BlcnR5T3B0aW9ucyIsInBoZXRpb1JlYWRPbmx5IiwiaXNFbmFibGVkUHJvcGVydHkiLCJiYWNrZ3JvdW5kUmVjdGFuZ2xlIiwiZmlsbCIsIm5hdmlnYXRpb25CYXJGaWxsUHJvcGVydHkiLCJvcGVuUHJvcGVydHkiLCJpc1Nob3dpbmdQcm9wZXJ0eSIsImFuZCIsImF1ZGlvRW5hYmxlZFByb3BlcnR5Iiwidm9pY2luZ0FsZXJ0TWFuYWdlciIsIm1lbnVDb250ZW50IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwiY2hldnJvbkljb24iLCJEb3VibGVDaGV2cm9uIiwib3BlbkJ1dHRvbiIsImNvbnRlbnQiLCJsaXN0ZW5lciIsInRvZ2dsZSIsImJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneSIsIkZsYXRBcHBlYXJhbmNlU3RyYXRlZ3kiLCJiYXNlQ29sb3IiLCJPUFRfT1VUIiwiY29udGVudFdpZHRoIiwibG9jYWxCb3VuZHMiLCJ3aWR0aCIsImNvbnRlbnRNYXJnaW4iLCJyaWdodFBvc2l0aW9uUHJvcGVydHkiLCJnZXRIaWRkZW5Qb3NpdGlvbiIsInJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiIsImNvbnRlbnRQYXJlbnQiLCJjaGlsZHJlbiIsImFkZENoaWxkIiwidGltZXJMaXN0ZW5lciIsImR0Iiwic3RlcCIsImFkZExpc3RlbmVyIiwiaXNPcGVuTGlzdGVuZXIiLCJvcGVuIiwib2xkVmFsdWUiLCJtYXRyaXgiLCJzY2FsaW5nIiwiSURFTlRJVFkiLCJwZG9tVmlzaWJsZSIsImlubmVyQ29udGVudCIsInZvaWNpbmdOYW1lUmVzcG9uc2UiLCJ1cGRhdGVEZXN0aW5hdGlvblBvc2l0aW9uIiwiYWxlcnRQcm9wZXJ0eSIsInZvaWNpbmdTcGVha0NvbnRleHRSZXNwb25zZSIsImNvbnRleHRSZXNwb25zZSIsImFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UiLCJsaW5rIiwiaXNTaG93aW5nTGlzdGVuZXIiLCJzaG93aW5nIiwiZGlzcG9zZVRvb2xiYXIiLCJ1bmxpbmsiLCJnZXREaXNwbGF5ZWRXaWR0aCIsInZhbHVlIiwiYXNzZXJ0IiwiZGlzdGFuY2UiLCJNYXRoIiwiYWJzIiwiYW5pbWF0aW9uRGlzdGFuY2UiLCJtaW4iLCJjdXJyZW50UG9zaXRpb24iLCJsYXlvdXQiLCJzY2FsZSIsImhlaWdodCIsInNldFNjYWxlTWFnbml0dWRlIiwicmVjdFdpZHRoIiwicmVjdEhlaWdodCIsInJpZ2h0IiwiY2VudGVyIiwicmlnaHRDZW50ZXIiLCJjZW50ZXJUb3AiLCJwbHVzWFkiLCJkaXNwb3NlIiwiY2hldnJvblNwYWNpbmciLCJjaGV2cm9uV2lkdGgiLCJjaGV2cm9uSGVpZ2h0IiwiY2hldnJvblNoYXBlIiwiaSIsImxlZnQiLCJtb3ZlVG8iLCJsaW5lVG8iLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJsaW5lQ2FwIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUb29sYmFyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoZSBUb29sYmFyIGFsb25nIHRoZSBsZWZ0IGVkZ2Ugb2YgdGhlIHNjcmVlbiB3aXRoIGNvbnRyb2xzIHJlbGF0ZWQgdG8gdGhlIHNpbSBvciBhY3RpdmUgc2NyZWVuLiBDdXJyZW50bHksIGl0XHJcbiAqIG9ubHkgY29udGFpbnMgY29udHJvbHMgcmVsYXRlZCB0byB0aGUgVm9pY2luZyBmZWF0dXJlLiBJdCBpc24ndCBhbHdheXMgZGlzcGxheWVkIGFuZCB0aGUgdXNlciBtdXN0IHJlcXVlc3QgaXRcclxuICogZnJvbSB0aGUgUHJlZmVyZW5jZXNEaWFsb2cuIEluIG9yZGVyIHRvIGJlIHVzZWQsIGJvdGggdm9pY2luZyBBTkQgdGhlIFRvb2xiYXIgbXVzdCBiZSBlbmFibGVkIGJ5IHRoZSB1c2VyLlxyXG4gKiBWb2ljaW5nIGNhbiBiZSB1c2VkIHdpdGhvdXQgdGhpcyBzaG93bi5cclxuICpcclxuICogV2hlbiBvcGVuLCB0aGUgc2ltIHdpbGwgcmVzaXplIGFuZCBzaGlmdCB0byB0aGUgcmlnaHQgdG8gY3JlYXRlIHNwYWNlLiBTY3JlZW4gYm91bmRzIGFyZSBhZGp1c3RlZCBzbyB0aGF0XHJcbiAqIHNpbXVsYXRpb24gY29tcG9uZW50cyB3aWxsIG5ldmVyIG92ZXJsYXAgd2l0aCB0aGUgVG9vbGJhci5cclxuICpcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IHN0ZXBUaW1lciBmcm9tICcuLi8uLi8uLi9heG9uL2pzL3N0ZXBUaW1lci5qcyc7XHJcbmltcG9ydCBNYXRyaXgzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9NYXRyaXgzLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IEVtcHR5U2VsZk9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgTm9kZU9wdGlvbnMsIFBhdGgsIFJlY3RhbmdsZSwgdm9pY2luZ01hbmFnZXIgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgQnV0dG9uTm9kZSBmcm9tICcuLi8uLi8uLi9zdW4vanMvYnV0dG9ucy9CdXR0b25Ob2RlLmpzJztcclxuaW1wb3J0IFJvdW5kUHVzaEJ1dHRvbiBmcm9tICcuLi8uLi8uLi9zdW4vanMvYnV0dG9ucy9Sb3VuZFB1c2hCdXR0b24uanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgYXVkaW9NYW5hZ2VyIGZyb20gJy4uL2F1ZGlvTWFuYWdlci5qcyc7XHJcbmltcG9ydCBqb2lzdCBmcm9tICcuLi9qb2lzdC5qcyc7XHJcbmltcG9ydCBKb2lzdFN0cmluZ3MgZnJvbSAnLi4vSm9pc3RTdHJpbmdzLmpzJztcclxuaW1wb3J0IFZvaWNpbmdUb29sYmFyQWxlcnRNYW5hZ2VyIGZyb20gJy4vVm9pY2luZ1Rvb2xiYXJBbGVydE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgVm9pY2luZ1Rvb2xiYXJJdGVtIGZyb20gJy4vVm9pY2luZ1Rvb2xiYXJJdGVtLmpzJztcclxuaW1wb3J0IExvb2tBbmRGZWVsIGZyb20gJy4uL0xvb2tBbmRGZWVsLmpzJztcclxuaW1wb3J0IHsgQW55U2NyZWVuIH0gZnJvbSAnLi4vU2NyZWVuLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNQVhfQU5JTUFUSU9OX1NQRUVEID0gMjUwOyAvLyBpbiB2aWV3IGNvb3JkaW5hdGVzIHBlciBzZWNvbmQsIGFzc3VtaW5nIDYwIGZwc1xyXG5jb25zdCBDT05URU5UX1RPUF9NQVJHSU4gPSAxNTsgLy8gbWFyZ2luIGJldHdlZW4gdG9wIG9mIFRvb2xiYXIgYW5kIGNvbnRlbnRzXHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3Qgb3BlblRvb2xiYXJTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIub3BlblRvb2xiYXJTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgY2xvc2VUb29sYmFyU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLmNsb3NlVG9vbGJhclN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBoaWRlVG9vbGJhclN0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci5oaWRlVG9vbGJhclN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBzaG93VG9vbGJhclN0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci5zaG93VG9vbGJhclN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCB0b29sYmFyU2hvd25TdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudG9vbGJhclNob3duU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHRvb2xiYXJIaWRkZW5TdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudG9vbGJhckhpZGRlblN0cmluZ1Byb3BlcnR5O1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcbnR5cGUgVG9vbGJhck9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zICYgTm9kZU9wdGlvbnM7XHJcblxyXG5jbGFzcyBUb29sYmFyIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8vIFdoZXRoZXIgdGhlIFRvb2xiYXIgaXMgZW5hYmxlZCAodmlzaWJsZSB0byB0aGUgdXNlcilcclxuICBwcml2YXRlIHJlYWRvbmx5IGlzRW5hYmxlZFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gdGhlIFJlY3RhbmdsZSBmb3IgdGhlIFRvb2xiYXIgdGhhdCBzdXJyb3VuZHMgYWxsIGNvbnRlbnQsIGJvdW5kcyBzZXQgb25jZVxyXG4gIC8vIGNvbnRlbnQgaXMgY3JlYXRlZCBhbmQgaW4gbGF5b3V0IHRvIGZpbGwgaGVpZ2h0IG9mIHNjcmVlblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgYmFja2dyb3VuZFJlY3RhbmdsZTogUmVjdGFuZ2xlO1xyXG5cclxuICAvLyBUaGUgcG9zaXRpb24gb2YgdGhlIHJpZ2h0IGVkZ2Ugb2YgdGhlIGJhY2tncm91bmRSZWN0YW5nbGUgaW4gbG9jYWwgY29vcmRpbmF0ZXMuXHJcbiAgLy8gVGhpcyBpcyB3aGF0IGNvbnRyb2xzIHRoZSBwb3NpdGlvbiBvZiB0aGUgVG9vbGJhciBhcyBpdCBpcyBvcGVuL2Nsb3NlZC9yZW1vdmVkL2FuaW1hdGluZy5cclxuICBwdWJsaWMgcmVhZG9ubHkgcmlnaHRQb3NpdGlvblByb3BlcnR5OiBUUHJvcGVydHk8bnVtYmVyPjtcclxuXHJcbiAgLy8gVGhlIHRhcmdldCBwb3NpdGlvbiBmb3IgdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSwgdG8gc3VwcG9ydCBhbmltYXRpb24uIEluIHN0ZXAsXHJcbiAgLy8gdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSB3aWxsIGJlIGNoYW5nZWQgdW50aWwgdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSBlcXVhbHMgdGhlIHJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbi5cclxuICBwcml2YXRlIHJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbjogbnVtYmVyO1xyXG5cclxuICAvLyBXaGV0aGVyIHRoZSBUb29sYmFyIGlzIG9wZW4gb3IgY2xvc2VkLiBUaGlzIGlzIGRpZmZlcmVudCBmcm9tIHdoZXRoZXIgb3Igbm90IGl0IGlzIHNob3dpbmcuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBvcGVuUHJvcGVydHk6IEJvb2xlYW5Qcm9wZXJ0eTtcclxuXHJcbiAgLy8gIFdoZXRoZXIgdGhlIFRvb2xiYXIgaXMgc2hvd24gdG8gdGhlIHVzZXIuIEF0IHRoaXMgdGltZSxcclxuICAvLyB0aGF0IGlzIHRydWUgaWYgdGhlIHRvb2xiYXIgaXMgZW5hYmxlZCwgdm9pY2luZyBpcyBlbmFibGVkLCBhbmQgaWYgYWxsIGF1ZGlvIGlzIGVuYWJsZWQuIFRoZSBUb29sYmFyIG9ubHlcclxuICAvLyBpbmNsdWRlcyBjb250cm9scyByZWxhdGVkIHRvIGF1ZGlvICh2b2ljaW5nKSBzbyB3aGVuIGF1ZGlvIGlzIGRpc2FibGVkIHRoZXJlIGlzIG5vIG5lZWQgdG8gc2hvdyBpdC5cclxuICBwcml2YXRlIHJlYWRvbmx5IGlzU2hvd2luZ1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gU2NhbGUgYXBwbGllZCB0byB0aGUgVG9vbGJhciBhbmQgaXRzIGNvbnRlbnRzIGluIHJlc3BvbnNlIHRvIGxheW91dCBhbmQgd2luZG93IHJlc2l6aW5nLlxyXG4gIHByaXZhdGUgbGF5b3V0U2NhbGUgPSAxO1xyXG5cclxuICAvLyBDb250ZW50cyBmb3IgdGhlIFRvb2xiYXIsIGN1cnJlbnRseSBvbmx5IGNvbnRyb2xzIHJlbGF0ZWQgdG8gdGhlIHZvaWNpbmdcclxuICAvLyBmZWF0dXJlLlxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbWVudUNvbnRlbnQ6IFZvaWNpbmdUb29sYmFySXRlbTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBvcGVuQnV0dG9uOiBSb3VuZFB1c2hCdXR0b247XHJcblxyXG4gIC8vIHdpZHRoIG9mIGNvbnRlbnQgZm9yIHRoZSB0b29sYmFyIGluIHRoZSBsb2NhbCBjb29yZGluYXRlIGZyYW1lXHJcbiAgcHJpdmF0ZSByZWFkb25seSBjb250ZW50V2lkdGg6IG51bWJlcjtcclxuXHJcbiAgLy8gTWFyZ2luIGJldHdlZW4gdG9vbGJhciBjb250ZW50IGFuZCBlZGdlIG9mIHRoZSBiYWNrZ3JvdW5kUmVjdGFuZ2xlLCBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZVxyXG4gIC8vIGZyYW1lLiBBbHNvIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSByaWdodCBwb3NpdGlvbiB3aGVuIGNsb3NlZC4gVGhpcyBpcyB0aGUgd2lkdGggb2YgdGhlIGJ1dHRvbiBzbyB0aGF0IHdoZW4gdGhlXHJcbiAgLy8gVG9vbGJhciBpcyBjbG9zZWQgb25seSB0aGUgYnV0dG9uIGlzIHNob3duIGFuZCBhbGwgb3RoZXIgY29udGVudCBpcyBoaWRkZW4uXHJcbiAgcHJpdmF0ZSByZWFkb25seSBjb250ZW50TWFyZ2luOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlVG9vbGJhcjogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBlbmFibGVkUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+LCBzZWxlY3RlZFNjcmVlblByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxBbnlTY3JlZW4+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgbG9va0FuZEZlZWw6IExvb2tBbmRGZWVsLCBwcm92aWRlZE9wdGlvbnM/OiBUb29sYmFyT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFRvb2xiYXJPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIHBkb21cclxuICAgICAgdGFnTmFtZTogJ2RpdicsXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eU9wdGlvbnM6IHtcclxuICAgICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuaXNFbmFibGVkUHJvcGVydHkgPSBlbmFibGVkUHJvcGVydHk7XHJcblxyXG4gICAgdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgMCwgMCwge1xyXG4gICAgICBmaWxsOiBsb29rQW5kRmVlbC5uYXZpZ2F0aW9uQmFyRmlsbFByb3BlcnR5XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5vcGVuUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlICk7XHJcblxyXG4gICAgdGhpcy5pc1Nob3dpbmdQcm9wZXJ0eSA9IERlcml2ZWRQcm9wZXJ0eS5hbmQoIFtcclxuICAgICAgdGhpcy5pc0VuYWJsZWRQcm9wZXJ0eSxcclxuICAgICAgdm9pY2luZ01hbmFnZXIuZW5hYmxlZFByb3BlcnR5LFxyXG4gICAgICBhdWRpb01hbmFnZXIuYXVkaW9FbmFibGVkUHJvcGVydHkgXSApO1xyXG5cclxuICAgIGNvbnN0IHZvaWNpbmdBbGVydE1hbmFnZXIgPSBuZXcgVm9pY2luZ1Rvb2xiYXJBbGVydE1hbmFnZXIoIHNlbGVjdGVkU2NyZWVuUHJvcGVydHkgKTtcclxuICAgIHRoaXMubWVudUNvbnRlbnQgPSBuZXcgVm9pY2luZ1Rvb2xiYXJJdGVtKCB2b2ljaW5nQWxlcnRNYW5hZ2VyLCBsb29rQW5kRmVlbCwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtPy5jcmVhdGVUYW5kZW0oICdtZW51Q29udGVudCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGljb24gZm9yIHRoZSBvcGVuQnV0dG9uXHJcbiAgICBjb25zdCBjaGV2cm9uSWNvbiA9IG5ldyBEb3VibGVDaGV2cm9uKCk7XHJcblxyXG4gICAgdGhpcy5vcGVuQnV0dG9uID0gbmV3IFJvdW5kUHVzaEJ1dHRvbigge1xyXG4gICAgICBjb250ZW50OiBjaGV2cm9uSWNvbixcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHRoaXMub3BlblByb3BlcnR5LnRvZ2dsZSgpLFxyXG4gICAgICBidXR0b25BcHBlYXJhbmNlU3RyYXRlZ3k6IEJ1dHRvbk5vZGUuRmxhdEFwcGVhcmFuY2VTdHJhdGVneSxcclxuICAgICAgYmFzZUNvbG9yOiAnbGlnaHRncmV5JyxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW8gLSBvcHRpbmcgb3V0IG9mIFRhbmRlbXMgZm9yIG5vd1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5PUFRfT1VUXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5jb250ZW50V2lkdGggPSB0aGlzLm1lbnVDb250ZW50LmxvY2FsQm91bmRzLndpZHRoO1xyXG5cclxuICAgIHRoaXMuY29udGVudE1hcmdpbiA9IHRoaXMub3BlbkJ1dHRvbi5sb2NhbEJvdW5kcy53aWR0aDtcclxuXHJcbiAgICAvLyBUaGUgcG9zaXRpb24gb2YgdGhlIHJpZ2h0IGVkZ2Ugb2YgdGhlIGJhY2tncm91bmRSZWN0YW5nbGUgaW4gbG9jYWwgY29vcmRpbmF0ZXMuXHJcbiAgICAvLyBUaGlzIGlzIHdoYXQgY29udHJvbHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBUb29sYmFyIGFzIGl0IGlzIG9wZW4vY2xvc2VkL3JlbW92ZWQvYW5pbWF0aW5nLlxyXG4gICAgdGhpcy5yaWdodFBvc2l0aW9uUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIHRoaXMuZ2V0SGlkZGVuUG9zaXRpb24oKSApO1xyXG5cclxuICAgIC8vIFRoZSB0YXJnZXQgcG9zaXRpb24gZm9yIHRoZSByaWdodFBvc2l0aW9uUHJvcGVydHksIHRvIHN1cHBvcnQgYW5pbWF0aW9uLiBJbiBzdGVwLFxyXG4gICAgLy8gdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSB3aWxsIGJlIGNoYW5nZWQgdW50aWwgdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSBlcXVhbHMgdGhlIHJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbi5cclxuICAgIHRoaXMucmlnaHREZXN0aW5hdGlvblBvc2l0aW9uID0gMDtcclxuXHJcbiAgICAvLyBhIHBhcmVudCBmb3IgYWxsIE5vZGVzIG9mIHRoZSB0b29sYmFyLCBzbyB3ZSBjYW4gc2V0IHZpc2liaWxpdHkgb2YgdGhpcyBncm91cCBpbnRlcm5hbGx5IHdoZW5cclxuICAgIC8vIHRoZSBpc1Nob3dpbmdQcm9wZXJ0eSBjaGFuZ2VzXHJcbiAgICBjb25zdCBjb250ZW50UGFyZW50ID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlLCB0aGlzLm1lbnVDb250ZW50LCB0aGlzLm9wZW5CdXR0b24gXVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggY29udGVudFBhcmVudCApO1xyXG5cclxuICAgIC8vIG1vdmUgdG8gZGVzdGluYXRpb24gcG9zaXRpb24gaW4gdGhlIGFuaW1hdGlvbiBmcmFtZVxyXG4gICAgY29uc3QgdGltZXJMaXN0ZW5lciA9ICggZHQ6IG51bWJlciApID0+IHtcclxuICAgICAgdGhpcy5zdGVwKCBkdCApO1xyXG4gICAgfTtcclxuICAgIHN0ZXBUaW1lci5hZGRMaXN0ZW5lciggdGltZXJMaXN0ZW5lciApO1xyXG5cclxuICAgIGNvbnN0IGlzT3Blbkxpc3RlbmVyID0gKCBvcGVuOiBib29sZWFuLCBvbGRWYWx1ZTogYm9vbGVhbiB8IG51bGwgKSA9PiB7XHJcblxyXG4gICAgICAvLyByb3RhdGUgY2hldnJvbiB0byBpbmRpY2F0ZSBkaXJlY3Rpb24gb2YgdG9vbGJhciBtb3ZlbWVudFxyXG4gICAgICBjaGV2cm9uSWNvbi5tYXRyaXggPSBvcGVuID8gTWF0cml4My5zY2FsaW5nKCAtMSwgMSApIDogTWF0cml4My5JREVOVElUWTtcclxuXHJcbiAgICAgIC8vIHdoZW4gY2xvc2VkLCBtZW51IGNvbnRlbnQgc2hvdWxkIGJlIGhpZGRlbiBmcm9tIHNjcmVlbiByZWFkZXJzIGFuZCB0aGUgbmF2aWdhdGlvbiBvcmRlclxyXG4gICAgICB0aGlzLm1lbnVDb250ZW50LnBkb21WaXNpYmxlID0gb3BlbjtcclxuXHJcbiAgICAgIHRoaXMub3BlbkJ1dHRvbi5pbm5lckNvbnRlbnQgPSBvcGVuID8gY2xvc2VUb29sYmFyU3RyaW5nUHJvcGVydHkgOiBvcGVuVG9vbGJhclN0cmluZ1Byb3BlcnR5O1xyXG4gICAgICB0aGlzLm9wZW5CdXR0b24udm9pY2luZ05hbWVSZXNwb25zZSA9IG9wZW4gPyBoaWRlVG9vbGJhclN0cmluZ1Byb3BlcnR5IDogc2hvd1Rvb2xiYXJTdHJpbmdQcm9wZXJ0eTtcclxuXHJcbiAgICAgIHRoaXMudXBkYXRlRGVzdGluYXRpb25Qb3NpdGlvbigpO1xyXG5cclxuICAgICAgaWYgKCBvbGRWYWx1ZSAhPT0gbnVsbCApIHtcclxuICAgICAgICBjb25zdCBhbGVydFByb3BlcnR5ID0gb3BlbiA/IHRvb2xiYXJTaG93blN0cmluZ1Byb3BlcnR5IDogdG9vbGJhckhpZGRlblN0cmluZ1Byb3BlcnR5O1xyXG4gICAgICAgIHRoaXMub3BlbkJ1dHRvbi52b2ljaW5nU3BlYWtDb250ZXh0UmVzcG9uc2UoIHtcclxuICAgICAgICAgIGNvbnRleHRSZXNwb25zZTogYWxlcnRQcm9wZXJ0eVxyXG4gICAgICAgIH0gKTtcclxuXHJcbiAgICAgICAgdGhpcy5hbGVydERlc2NyaXB0aW9uVXR0ZXJhbmNlKCBhbGVydFByb3BlcnR5ICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLm9wZW5Qcm9wZXJ0eS5saW5rKCBpc09wZW5MaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIHdoZW4gc2hvd24gb3IgaGlkZGVuIHVwZGF0ZSBkZXN0aW5hdGlvbiBwb3NpdGlvbnMgc28gaXQgYW5pbWF0ZXMgb3BlbiBvciBjbG9zZVxyXG4gICAgY29uc3QgaXNTaG93aW5nTGlzdGVuZXIgPSAoIHNob3dpbmc6IGJvb2xlYW4gKSA9PiB7XHJcbiAgICAgIHRoaXMudXBkYXRlRGVzdGluYXRpb25Qb3NpdGlvbigpO1xyXG5cclxuICAgICAgLy8gd2hlbiBub3cgc2hvd2luZywgdGhpcyBlbnRpcmUgdG9vbGJhciBzaG91bGQgYmUgaGlkZGVuIGZvciBJbnRlcmFjdGl2ZSBEZXNjcmlwdGlvbiwgYnV0IHdlIGRvbid0IHVzZVxyXG4gICAgICAvLyB2aXNpYmlsaXR5IGRpcmVjdGx5IGJlY2F1c2Ugd2Ugd2FudCB0byBzZWUgdGhlIFRvb2xiYXIgYW5pbWF0ZSBhd2F5XHJcbiAgICAgIGNvbnRlbnRQYXJlbnQucGRvbVZpc2libGUgPSBzaG93aW5nO1xyXG4gICAgfTtcclxuICAgIHRoaXMuaXNTaG93aW5nUHJvcGVydHkubGluayggaXNTaG93aW5nTGlzdGVuZXIgKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VUb29sYmFyID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLmlzU2hvd2luZ1Byb3BlcnR5LnVubGluayggaXNTaG93aW5nTGlzdGVuZXIgKTtcclxuICAgICAgdGhpcy5vcGVuUHJvcGVydHkudW5saW5rKCBpc09wZW5MaXN0ZW5lciApO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHdpZHRoIG9mIHRoZSBUb29sYmFyIHRoYXQgY2FuIGJlIHNlZW4gb24gc2NyZWVuLiBUaGlzIGNhbiBiZSBhbnkgdmFsdWUgZnJvbSB0aGUgZnVsbCB3aWR0aCBvZiB0aGVcclxuICAgKiBUb29sYmFyIHRvIHplcm8gd2lkdGgsIGRlcGVuZGluZyBvbiB3aGV0aGVyIGl0IGlzIG9wZW4sIGNsb3NlZCwgcmVtb3ZlZCBlbnRpcmVseSwgb3IgYW5pbWF0aW5nLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXREaXNwbGF5ZWRXaWR0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMucmlnaHRQb3NpdGlvblByb3BlcnR5LnZhbHVlICogdGhpcy5sYXlvdXRTY2FsZSArIHRoaXMub3BlbkJ1dHRvbi53aWR0aCAvIDI7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEhpZGRlblBvc2l0aW9uKCk6IG51bWJlciB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgdGhpcy5jb250ZW50TWFyZ2luID09PSAnbnVtYmVyJyApO1xyXG4gICAgcmV0dXJuIC10aGlzLmNvbnRlbnRNYXJnaW4gLyAyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiBzbyB0aGF0IHRoZSBUb29sYmFyIHdpbGwgYW5pbWF0ZSB0b3dhcmRzIG9wZW5pbmcsIGNsb3NpbmcsIG9yIGJlaW5nIHJlbW92ZWRcclxuICAgKiBlbnRpcmVseSBmcm9tIHZpZXcuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVEZXN0aW5hdGlvblBvc2l0aW9uKCk6IHZvaWQge1xyXG4gICAgaWYgKCB0aGlzLmlzU2hvd2luZ1Byb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAvLyB0aGUgVG9vbGJhciBpcyBlbmFibGVkIGFuZCBzaG91bGQgZWl0aGVyIHNob3cgYWxsIGNvbnRlbnQgb3IganVzdCB0aGUgb3BlbkJ1dHRvblxyXG4gICAgICB0aGlzLnJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiA9IHRoaXMub3BlblByb3BlcnR5LnZhbHVlID8gdGhpcy5jb250ZW50V2lkdGggKyB0aGlzLmNvbnRlbnRNYXJnaW4gKiAyIDogdGhpcy5jb250ZW50TWFyZ2luO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIC8vIG5vIGFzcGVjdCBvZiB0aGUgbWVudSBzaG91bGQgYmUgdmlzaWJsZVxyXG4gICAgICB0aGlzLnJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiA9IHRoaXMuZ2V0SGlkZGVuUG9zaXRpb24oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFuaW1hdGVkIHRoZSBUb29sYmFyIGFzIGl0IG9wZW5zIGFuZCBjbG9zZXMuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLmFicyggdGhpcy5yaWdodFBvc2l0aW9uUHJvcGVydHkudmFsdWUgLSB0aGlzLnJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiApO1xyXG4gICAgaWYgKCBkaXN0YW5jZSAhPT0gMCApIHtcclxuICAgICAgY29uc3QgYW5pbWF0aW9uRGlzdGFuY2UgPSBNYXRoLm1pbiggZGlzdGFuY2UsIE1BWF9BTklNQVRJT05fU1BFRUQgKiBkdCApO1xyXG4gICAgICBjb25zdCBjdXJyZW50UG9zaXRpb24gPSB0aGlzLnJpZ2h0UG9zaXRpb25Qcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgdGhpcy5yaWdodFBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSB0aGlzLnJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiA+IGN1cnJlbnRQb3NpdGlvbiA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBvc2l0aW9uICsgYW5pbWF0aW9uRGlzdGFuY2UgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3NpdGlvbiAtIGFuaW1hdGlvbkRpc3RhbmNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTGF5b3V0IGZvciB0aGUgVG9vbGJhciwgY2FsbGVkIHdoZW5ldmVyIHBvc2l0aW9uIGNoYW5nZXMgb3Igd2luZG93IGlzIHJlc2l6ZWQuXHJcbiAgICovXHJcbiAgcHVibGljIGxheW91dCggc2NhbGU6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICB0aGlzLmxheW91dFNjYWxlID0gc2NhbGU7XHJcbiAgICB0aGlzLm1lbnVDb250ZW50LnNldFNjYWxlTWFnbml0dWRlKCBzY2FsZSApO1xyXG4gICAgdGhpcy5vcGVuQnV0dG9uLnNldFNjYWxlTWFnbml0dWRlKCBzY2FsZSApO1xyXG4gICAgdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlLnJlY3RXaWR0aCA9IHNjYWxlICogKCB0aGlzLmNvbnRlbnRXaWR0aCArIHRoaXMuY29udGVudE1hcmdpbiAqIDIgKTtcclxuICAgIHRoaXMuYmFja2dyb3VuZFJlY3RhbmdsZS5yZWN0SGVpZ2h0ID0gaGVpZ2h0O1xyXG4gICAgdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlLnJpZ2h0ID0gdGhpcy5yaWdodFBvc2l0aW9uUHJvcGVydHkudmFsdWUgKiBzY2FsZTtcclxuICAgIHRoaXMub3BlbkJ1dHRvbi5jZW50ZXIgPSB0aGlzLmJhY2tncm91bmRSZWN0YW5nbGUucmlnaHRDZW50ZXI7XHJcbiAgICB0aGlzLm1lbnVDb250ZW50LmNlbnRlclRvcCA9IHRoaXMuYmFja2dyb3VuZFJlY3RhbmdsZS5jZW50ZXJUb3AucGx1c1hZKCAwLCBDT05URU5UX1RPUF9NQVJHSU4gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlVG9vbGJhcigpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFRoZSBpY29uIGZvciB0aGUgYnV0dG9uIHRoYXQgb3BlbnMgYW5kIGNsb3NlcyB0aGUgVG9vbGJhci5cclxuICovXHJcbmNsYXNzIERvdWJsZUNoZXZyb24gZXh0ZW5kcyBQYXRoIHtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgLy8gc3BhY2luZyBhbmQgZGltZW5zaW9ucyBmb3IgdGhlIGFycm93c1xyXG4gICAgY29uc3QgY2hldnJvblNwYWNpbmcgPSA4O1xyXG4gICAgY29uc3QgY2hldnJvbldpZHRoID0gNTtcclxuICAgIGNvbnN0IGNoZXZyb25IZWlnaHQgPSAxMjtcclxuXHJcbiAgICBjb25zdCBjaGV2cm9uU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IDI7IGkrKyApIHtcclxuICAgICAgY29uc3QgbGVmdCA9IGkgKiBjaGV2cm9uU3BhY2luZztcclxuICAgICAgY2hldnJvblNoYXBlLm1vdmVUbyggbGVmdCwgMCApO1xyXG4gICAgICBjaGV2cm9uU2hhcGUubGluZVRvKCBsZWZ0ICsgY2hldnJvbldpZHRoLCBjaGV2cm9uSGVpZ2h0IC8gMiApO1xyXG4gICAgICBjaGV2cm9uU2hhcGUubGluZVRvKCBsZWZ0LCBjaGV2cm9uSGVpZ2h0ICk7XHJcbiAgICB9XHJcblxyXG4gICAgc3VwZXIoIGNoZXZyb25TaGFwZSwge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGxpbmVXaWR0aDogMy41LFxyXG4gICAgICBsaW5lQ2FwOiAncm91bmQnXHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5qb2lzdC5yZWdpc3RlciggJ1Rvb2xiYXInLCBUb29sYmFyICk7XHJcbmV4cG9ydCBkZWZhdWx0IFRvb2xiYXI7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSxxQ0FBcUM7QUFDakUsT0FBT0MsZUFBZSxNQUFNLHFDQUFxQztBQUdqRSxPQUFPQyxjQUFjLE1BQU0sb0NBQW9DO0FBQy9ELE9BQU9DLFNBQVMsTUFBTSwrQkFBK0I7QUFDckQsT0FBT0MsT0FBTyxNQUFNLDRCQUE0QjtBQUNoRCxTQUFTQyxLQUFLLFFB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