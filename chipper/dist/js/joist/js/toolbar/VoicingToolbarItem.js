// Copyright 2021-2023, University of Colorado Boulder

/**
 * An item for the Toolbar that includes components related to the voicing feature. Includes a switch to
 * enable/disable all speech, and buttons to hear overview information about the active sim Screen.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import PlayStopButton from '../../../scenery-phet/js/buttons/PlayStopButton.js';
import PhetFont from '../../../scenery-phet/js/PhetFont.js';
import { AlignGroup, Display, HBox, Node, ReadingBlockHighlight, Text, voicingManager, VoicingText, voicingUtteranceQueue } from '../../../scenery/js/imports.js';
import Tandem from '../../../tandem/js/Tandem.js';
import Utterance from '../../../utterance-queue/js/Utterance.js';
import joist from '../joist.js';
import JoistStrings from '../JoistStrings.js';
import PreferencesControl from '../preferences/PreferencesControl.js';
import optionize, { combineOptions } from '../../../phet-core/js/optionize.js';
import ToggleSwitch from '../../../sun/js/ToggleSwitch.js';
import PreferencesDialogConstants from '../preferences/PreferencesDialogConstants.js';

// constants
const CONTENT_VERTICAL_SPACING = 10;
const QUICK_INFO = 20;

// strings - Many of these strings are displayed visually but only when the sim is running in the english locale.
// Voicing is only available in English so these contents are hidden because translators will not be able to test
// them in a translated context. These strings are nested under the a11y key so that they are not available for
// translation.
const titleStringProperty = JoistStrings.a11y.toolbar.voicing.titleStringProperty;
const quickInfoStringProperty = JoistStrings.a11y.toolbar.voicing.quickInfoStringProperty;
const simVoicingOnStringProperty = JoistStrings.a11y.toolbar.voicing.simVoicingOnAlertStringProperty;
const simVoicingOffStringProperty = JoistStrings.a11y.toolbar.voicing.simVoicingOffAlertStringProperty;
const toolbarStringProperty = JoistStrings.a11y.toolbar.titleStringProperty;
const playOverviewStringProperty = JoistStrings.a11y.toolbar.voicing.playOverviewLabelStringProperty;
const playDetailsStringProperty = JoistStrings.a11y.toolbar.voicing.playDetailsLabelStringProperty;
const playHintStringProperty = JoistStrings.a11y.toolbar.voicing.playHintLabelStringProperty;
const overviewStringProperty = JoistStrings.a11y.toolbar.voicing.overviewLabelStringProperty;
const detailsStringProperty = JoistStrings.a11y.toolbar.voicing.detailsLabelStringProperty;
const hintStringProperty = JoistStrings.a11y.toolbar.voicing.hintLabelStringProperty;
class VoicingToolbarItem extends Node {
  constructor(alertManager, lookAndFeel, providedOptions) {
    const options = optionize()({
      // pdom
      tagName: 'section',
      labelTagName: 'h2',
      labelContent: toolbarStringProperty,
      // phet-io
      visiblePropertyOptions: {
        phetioReadOnly: true
      }
    }, providedOptions);
    super(options);
    const titleTextOptions = {
      font: new PhetFont(14),
      fill: lookAndFeel.navigationBarTextFillProperty,
      maxWidth: 90 // i18n, by inspection
    };
    const titleText = new Text(titleStringProperty, titleTextOptions);
    const quickInfoText = new VoicingText(quickInfoStringProperty, titleTextOptions);
    quickInfoText.focusHighlight = new ReadingBlockHighlight(quickInfoText, {
      // the inner stroke is white since the toolbar is on a black background
      innerStroke: 'white'
    });
    const muteSpeechSwitch = new ToggleSwitch(voicingManager.mainWindowVoicingEnabledProperty, false, true, combineOptions({
      a11yName: titleStringProperty,
      rightValueContextResponse: simVoicingOnStringProperty,
      leftValueContextResponse: simVoicingOffStringProperty,
      tandem: options.tandem?.createTandem('muteSpeechSwitch')
    }, PreferencesDialogConstants.TOGGLE_SWITCH_OPTIONS));
    const muteSpeechControl = new PreferencesControl({
      labelNode: titleText,
      controlNode: muteSpeechSwitch,
      tandem: options.tandem?.createTandem('muteSpeechControl')
    });

    // layout
    const labelAlignGroup = new AlignGroup();
    const inputAlignGroup = new AlignGroup();
    const overviewRow = new LabelButtonRow(overviewStringProperty, playOverviewStringProperty, labelAlignGroup, inputAlignGroup, lookAndFeel, alertManager.createOverviewContent.bind(alertManager));
    const detailsRow = new LabelButtonRow(detailsStringProperty, playDetailsStringProperty, labelAlignGroup, inputAlignGroup, lookAndFeel, alertManager.createDetailsContent.bind(alertManager));
    const hintRow = new LabelButtonRow(hintStringProperty, playHintStringProperty, labelAlignGroup, inputAlignGroup, lookAndFeel, alertManager.createHintContent.bind(alertManager));
    this.children = [muteSpeechControl, quickInfoText, overviewRow.content, detailsRow.content, hintRow.content];

    // layout
    quickInfoText.leftTop = muteSpeechControl.leftBottom.plusXY(0, CONTENT_VERTICAL_SPACING);
    overviewRow.content.leftTop = quickInfoText.leftBottom.plusXY(QUICK_INFO, CONTENT_VERTICAL_SPACING);
    detailsRow.content.leftTop = overviewRow.content.leftBottom.plusXY(0, CONTENT_VERTICAL_SPACING);
    hintRow.content.leftTop = detailsRow.content.leftBottom.plusXY(0, CONTENT_VERTICAL_SPACING);
    const rows = [overviewRow, detailsRow, hintRow];
    const playingProperties = [overviewRow.playingProperty, detailsRow.playingProperty, hintRow.playingProperty];
    rows.forEach(row => {
      row.playingProperty.link(playing => {
        row.playContent(playingProperties);
      });
    });
    this.disposeVoicingToolbarItem = () => {
      quickInfoText.dispose();
      titleText.dispose();
    };
  }

  /**
   */
  dispose() {
    this.disposeVoicingToolbarItem();
    super.dispose();
  }
}

/**
 * An inner class that manages a labelled PlayStopButton in the VoicingToolbarItem. Creates the label, button,
 * and adds listeners that generate the alert to be Voiced and toggle the button's playing state when
 * the voicingManager stops speaking.
 */
class LabelButtonRow {
  // A unique Utterance for the object response so that it can be independently cancelled and have a dynamic Priority
  // depending on interaction with the screen.

  // Whether the PlayStopButton has been pressed and the voicingManager is actively speaking this content

  // The Node of content to be displayed in the view, managing layout of the label and button

  /**
   * @param labelString - the visually rendered Text label for the button
   * @param a11yName - the string read in the PDOM and with the Voicing feature that labels this Button
   * @param labelAlignGroup - To align all labels in the VoicingToolbarItem
   * @param inputAlignGroup - To align all inputs in the VoicingToolbarItem
   * @param lookAndFeel
   * @param createAlert - function that creates the alert when the button is pressed
   */
  constructor(labelString, a11yName, labelAlignGroup, inputAlignGroup, lookAndFeel, createAlert) {
    this.lookAndFeel = lookAndFeel;
    this.objectResponseUtterance = new Utterance();
    this.createAlert = createAlert;
    this.playingProperty = new BooleanProperty(false, {
      // Speech is requested from a listener on the isPlayingProperty. But if the browser cannot speak it may
      // immediately cancel speech and set this Property to false again causing reentrancy.
      reentrant: true
    });
    this.playStopButton = new PlayStopButton(this.playingProperty, {
      startPlayingLabel: a11yName,
      // voicing
      voicingNameResponse: a11yName,
      voicingIgnoreVoicingManagerProperties: true,
      radius: 12,
      // phet-io
      tandem: Tandem.OPT_OUT
    });
    const textLabel = new Text(labelString, {
      font: new PhetFont(12),
      fill: this.lookAndFeel.navigationBarTextFillProperty,
      maxWidth: 100 // i18n, by inspection
    });
    const labelBox = labelAlignGroup.createBox(textLabel, {
      xAlign: 'left'
    });
    const inputBox = inputAlignGroup.createBox(this.playStopButton, {
      xAlign: 'right'
    });
    this.content = new HBox({
      children: [labelBox, inputBox],
      spacing: CONTENT_VERTICAL_SPACING
    });
    voicingManager.endSpeakingEmitter.addListener((text, endedUtterance) => {
      if (endedUtterance === this.objectResponseUtterance) {
        this.playingProperty.set(false);

        // Remove if listener wasn't interrupted by Display input.
        if (Display.inputListeners.includes(displayListener)) {
          Display.removeInputListener(displayListener);
        }
      }
    });

    // Reduces the priority of this.utterance as soon as there is an interaction with the screen so that it may
    // be interrupted by simulation responses. See https://github.com/phetsims/joist/issues/752.
    const reducePriorityListener = event => {
      // After a down event it will be possible for this.utterance to be interrupted. That will turn the "Stop" button
      // into a "Play" button. If the mouse is still down in this case the next up event on the "Play" button will
      // immediately play its content which is unexpected. We get around this by not reducing priority if the event
      // is going to this button.
      if (!event.trail.nodes.includes(this.playStopButton)) {
        Display.removeInputListener(displayListener);

        // Wait until the listener is removed before reducing this, this may immediately end the Utterance and remove
        // the listener again in the endSpeakingListener above.
        this.objectResponseUtterance.priorityProperty.value = Utterance.LOW_PRIORITY;
      }
    };
    const displayListener = {
      // The events that indicate some kind of input so we should allow this.utterance to be interrupted.
      down: reducePriorityListener,
      focus: reducePriorityListener
    };
    voicingManager.startSpeakingEmitter.addListener((response, utterance) => {
      if (utterance === this.objectResponseUtterance) {
        Display.addInputListener(displayListener);
      }
    });
  }

  /**
   * Play the Voicing content for this Row.
   */
  playContent(playingProperties) {
    if (this.playingProperty.value) {
      // when one button is pressed, immediately stop any other buttons, only one should be playing at a time
      const otherProperties = _.without(playingProperties, this.playingProperty);
      otherProperties.forEach(property => {
        property.value = false;
      });

      // This utterance is top priority so that it does not get interrupted during responses that happen as
      // the simulation changes. It stays top priority until there is some interaction with the display.
      this.objectResponseUtterance.priorityProperty.value = Utterance.TOP_PRIORITY;
      this.playStopButton.voicingSpeakResponse({
        objectResponse: this.createAlert(),
        // A sepparate Utterance from the default voicingUtterance so that if default responses are cancelled we
        // don't also cancel this content in the listeners related to priorityProperty above.
        utterance: this.objectResponseUtterance
      });
    } else {
      voicingUtteranceQueue.cancelUtterance(this.objectResponseUtterance);
    }
  }
}
joist.register('VoicingToolbarItem', VoicingToolbarItem);
export default VoicingToolbarItem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJQbGF5U3RvcEJ1dHRvbiIsIlBoZXRGb250IiwiQWxpZ25Hcm91cCIsIkRpc3BsYXkiLCJIQm94IiwiTm9kZSIsIlJlYWRpbmdCbG9ja0hpZ2hsaWdodCIsIlRleHQiLCJ2b2ljaW5nTWFuYWdlciIsIlZvaWNpbmdUZXh0Iiwidm9pY2luZ1V0dGVyYW5jZVF1ZXVlIiwiVGFuZGVtIiwiVXR0ZXJhbmNlIiwiam9pc3QiLCJKb2lzdFN0cmluZ3MiLCJQcmVmZXJlbmNlc0NvbnRyb2wiLCJvcHRpb25pemUiLCJjb21iaW5lT3B0aW9ucyIsIlRvZ2dsZVN3aXRjaCIsIlByZWZlcmVuY2VzRGlhbG9nQ29uc3RhbnRzIiwiQ09OVEVOVF9WRVJUSUNBTF9TUEFDSU5HIiwiUVVJQ0tfSU5GTyIsInRpdGxlU3RyaW5nUHJvcGVydHkiLCJhMTF5IiwidG9vbGJhciIsInZvaWNpbmciLCJxdWlja0luZm9TdHJpbmdQcm9wZXJ0eSIsInNpbVZvaWNpbmdPblN0cmluZ1Byb3BlcnR5Iiwic2ltVm9pY2luZ09uQWxlcnRTdHJpbmdQcm9wZXJ0eSIsInNpbVZvaWNpbmdPZmZTdHJpbmdQcm9wZXJ0eSIsInNpbVZvaWNpbmdPZmZBbGVydFN0cmluZ1Byb3BlcnR5IiwidG9vbGJhclN0cmluZ1Byb3BlcnR5IiwicGxheU92ZXJ2aWV3U3RyaW5nUHJvcGVydHkiLCJwbGF5T3ZlcnZpZXdMYWJlbFN0cmluZ1Byb3BlcnR5IiwicGxheURldGFpbHNTdHJpbmdQcm9wZXJ0eSIsInBsYXlEZXRhaWxzTGFiZWxTdHJpbmdQcm9wZXJ0eSIsInBsYXlIaW50U3RyaW5nUHJvcGVydHkiLCJwbGF5SGludExhYmVsU3RyaW5nUHJvcGVydHkiLCJvdmVydmlld1N0cmluZ1Byb3BlcnR5Iiwib3ZlcnZpZXdMYWJlbFN0cmluZ1Byb3BlcnR5IiwiZGV0YWlsc1N0cmluZ1Byb3BlcnR5IiwiZGV0YWlsc0xhYmVsU3RyaW5nUHJvcGVydHkiLCJoaW50U3RyaW5nUHJvcGVydHkiLCJoaW50TGFiZWxTdHJpbmdQcm9wZXJ0eSIsIlZvaWNpbmdUb29sYmFySXRlbSIsImNvbnN0cnVjdG9yIiwiYWxlcnRNYW5hZ2VyIiwibG9va0FuZEZlZWwiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwidGFnTmFtZSIsImxhYmVsVGFnTmFtZSIsImxhYmVsQ29udGVudCIsInZpc2libGVQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9SZWFkT25seSIsInRpdGxlVGV4dE9wdGlvbnMiLCJmb250IiwiZmlsbCIsIm5hdmlnYXRpb25CYXJUZXh0RmlsbFByb3BlcnR5IiwibWF4V2lkdGgiLCJ0aXRsZVRleHQiLCJxdWlja0luZm9UZXh0IiwiZm9jdXNIaWdobGlnaHQiLCJpbm5lclN0cm9rZSIsIm11dGVTcGVlY2hTd2l0Y2giLCJtYWluV2luZG93Vm9pY2luZ0VuYWJsZWRQcm9wZXJ0eSIsImExMXlOYW1lIiwicmlnaHRWYWx1ZUNvbnRleHRSZXNwb25zZSIsImxlZnRWYWx1ZUNvbnRleHRSZXNwb25zZSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsIlRPR0dMRV9TV0lUQ0hfT1BUSU9OUyIsIm11dGVTcGVlY2hDb250cm9sIiwibGFiZWxOb2RlIiwiY29udHJvbE5vZGUiLCJsYWJlbEFsaWduR3JvdXAiLCJpbnB1dEFsaWduR3JvdXAiLCJvdmVydmlld1JvdyIsIkxhYmVsQnV0dG9uUm93IiwiY3JlYXRlT3ZlcnZpZXdDb250ZW50IiwiYmluZCIsImRldGFpbHNSb3ciLCJjcmVhdGVEZXRhaWxzQ29udGVudCIsImhpbnRSb3ciLCJjcmVhdGVIaW50Q29udGVudCIsImNoaWxkcmVuIiwiY29udGVudCIsImxlZnRUb3AiLCJsZWZ0Qm90dG9tIiwicGx1c1hZIiwicm93cyIsInBsYXlpbmdQcm9wZXJ0aWVzIiwicGxheWluZ1Byb3BlcnR5IiwiZm9yRWFjaCIsInJvdyIsImxpbmsiLCJwbGF5aW5nIiwicGxheUNvbnRlbnQiLCJkaXNwb3NlVm9pY2luZ1Rvb2xiYXJJdGVtIiwiZGlzcG9zZSIsImxhYmVsU3RyaW5nIiwiY3JlYXRlQWxlcnQiLCJvYmplY3RSZXNwb25zZVV0dGVyYW5jZSIsInJlZW50cmFudCIsInBsYXlTdG9wQnV0dG9uIiwic3RhcnRQbGF5aW5nTGFiZWwiLCJ2b2ljaW5nTmFtZVJlc3BvbnNlIiwidm9pY2luZ0lnbm9yZVZvaWNpbmdNYW5hZ2VyUHJvcGVydGllcyIsInJhZGl1cyIsIk9QVF9PVVQiLCJ0ZXh0TGFiZWwiLCJsYWJlbEJveCIsImNyZWF0ZUJveCIsInhBbGlnbiIsImlucHV0Qm94Iiwic3BhY2luZyIsImVuZFNwZWFraW5nRW1pdHRlciIsImFkZExpc3RlbmVyIiwidGV4dCIsImVuZGVkVXR0ZXJhbmNlIiwic2V0IiwiaW5wdXRMaXN0ZW5lcnMiLCJpbmNsdWRlcyIsImRpc3BsYXlMaXN0ZW5lciIsInJlbW92ZUlucHV0TGlzdGVuZXIiLCJyZWR1Y2VQcmlvcml0eUxpc3RlbmVyIiwiZXZlbnQiLCJ0cmFpbCIsIm5vZGVzIiwicHJpb3JpdHlQcm9wZXJ0eSIsInZhbHVlIiwiTE9XX1BSSU9SSVRZIiwiZG93biIsImZvY3VzIiwic3RhcnRTcGVha2luZ0VtaXR0ZXIiLCJyZXNwb25zZSIsInV0dGVyYW5jZSIsImFkZElucHV0TGlzdGVuZXIiLCJvdGhlclByb3BlcnRpZXMiLCJfIiwid2l0aG91dCIsInByb3BlcnR5IiwiVE9QX1BSSU9SSVRZIiwidm9pY2luZ1NwZWFrUmVzcG9uc2UiLCJvYmplY3RSZXNwb25zZSIsImNhbmNlbFV0dGVyYW5jZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVm9pY2luZ1Rvb2xiYXJJdGVtLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEFuIGl0ZW0gZm9yIHRoZSBUb29sYmFyIHRoYXQgaW5jbHVkZXMgY29tcG9uZW50cyByZWxhdGVkIHRvIHRoZSB2b2ljaW5nIGZlYXR1cmUuIEluY2x1ZGVzIGEgc3dpdGNoIHRvXHJcbiAqIGVuYWJsZS9kaXNhYmxlIGFsbCBzcGVlY2gsIGFuZCBidXR0b25zIHRvIGhlYXIgb3ZlcnZpZXcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGFjdGl2ZSBzaW0gU2NyZWVuLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IFBsYXlTdG9wQnV0dG9uIGZyb20gJy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1BsYXlTdG9wQnV0dG9uLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEFsaWduR3JvdXAsIERpc3BsYXksIEhCb3gsIE5vZGUsIE5vZGVPcHRpb25zLCBSZWFkaW5nQmxvY2tIaWdobGlnaHQsIFNjZW5lcnlFdmVudCwgVGV4dCwgdm9pY2luZ01hbmFnZXIsIFZvaWNpbmdUZXh0LCB2b2ljaW5nVXR0ZXJhbmNlUXVldWUgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgVXR0ZXJhbmNlIGZyb20gJy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9VdHRlcmFuY2UuanMnO1xyXG5pbXBvcnQgam9pc3QgZnJvbSAnLi4vam9pc3QuanMnO1xyXG5pbXBvcnQgSm9pc3RTdHJpbmdzIGZyb20gJy4uL0pvaXN0U3RyaW5ncy5qcyc7XHJcbmltcG9ydCBQcmVmZXJlbmNlc0NvbnRyb2wgZnJvbSAnLi4vcHJlZmVyZW5jZXMvUHJlZmVyZW5jZXNDb250cm9sLmpzJztcclxuaW1wb3J0IFZvaWNpbmdUb29sYmFyQWxlcnRNYW5hZ2VyIGZyb20gJy4vVm9pY2luZ1Rvb2xiYXJBbGVydE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgTG9va0FuZEZlZWwgZnJvbSAnLi4vTG9va0FuZEZlZWwuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zLCBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgU3BlYWthYmxlUmVzb2x2ZWRSZXNwb25zZSB9IGZyb20gJy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9SZXNwb25zZVBhY2tldC5qcyc7XHJcbmltcG9ydCBUb2dnbGVTd2l0Y2gsIHsgVG9nZ2xlU3dpdGNoT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3N1bi9qcy9Ub2dnbGVTd2l0Y2guanMnO1xyXG5pbXBvcnQgUHJlZmVyZW5jZXNEaWFsb2dDb25zdGFudHMgZnJvbSAnLi4vcHJlZmVyZW5jZXMvUHJlZmVyZW5jZXNEaWFsb2dDb25zdGFudHMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IENPTlRFTlRfVkVSVElDQUxfU1BBQ0lORyA9IDEwO1xyXG5jb25zdCBRVUlDS19JTkZPID0gMjA7XHJcblxyXG4vLyBzdHJpbmdzIC0gTWFueSBvZiB0aGVzZSBzdHJpbmdzIGFyZSBkaXNwbGF5ZWQgdmlzdWFsbHkgYnV0IG9ubHkgd2hlbiB0aGUgc2ltIGlzIHJ1bm5pbmcgaW4gdGhlIGVuZ2xpc2ggbG9jYWxlLlxyXG4vLyBWb2ljaW5nIGlzIG9ubHkgYXZhaWxhYmxlIGluIEVuZ2xpc2ggc28gdGhlc2UgY29udGVudHMgYXJlIGhpZGRlbiBiZWNhdXNlIHRyYW5zbGF0b3JzIHdpbGwgbm90IGJlIGFibGUgdG8gdGVzdFxyXG4vLyB0aGVtIGluIGEgdHJhbnNsYXRlZCBjb250ZXh0LiBUaGVzZSBzdHJpbmdzIGFyZSBuZXN0ZWQgdW5kZXIgdGhlIGExMXkga2V5IHNvIHRoYXQgdGhleSBhcmUgbm90IGF2YWlsYWJsZSBmb3JcclxuLy8gdHJhbnNsYXRpb24uXHJcbmNvbnN0IHRpdGxlU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnZvaWNpbmcudGl0bGVTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgcXVpY2tJbmZvU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnZvaWNpbmcucXVpY2tJbmZvU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNpbVZvaWNpbmdPblN0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci52b2ljaW5nLnNpbVZvaWNpbmdPbkFsZXJ0U3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNpbVZvaWNpbmdPZmZTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudm9pY2luZy5zaW1Wb2ljaW5nT2ZmQWxlcnRTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgdG9vbGJhclN0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci50aXRsZVN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBwbGF5T3ZlcnZpZXdTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudm9pY2luZy5wbGF5T3ZlcnZpZXdMYWJlbFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBwbGF5RGV0YWlsc1N0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci52b2ljaW5nLnBsYXlEZXRhaWxzTGFiZWxTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgcGxheUhpbnRTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudm9pY2luZy5wbGF5SGludExhYmVsU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IG92ZXJ2aWV3U3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnZvaWNpbmcub3ZlcnZpZXdMYWJlbFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBkZXRhaWxzU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnZvaWNpbmcuZGV0YWlsc0xhYmVsU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGhpbnRTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudm9pY2luZy5oaW50TGFiZWxTdHJpbmdQcm9wZXJ0eTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5leHBvcnQgdHlwZSBWb2ljaW5nVG9vbGJhckl0ZW1PcHRpb25zID0gU2VsZk9wdGlvbnMgJiBOb2RlT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxOb2RlT3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuY2xhc3MgVm9pY2luZ1Rvb2xiYXJJdGVtIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVZvaWNpbmdUb29sYmFySXRlbTogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBhbGVydE1hbmFnZXI6IFZvaWNpbmdUb29sYmFyQWxlcnRNYW5hZ2VyLCBsb29rQW5kRmVlbDogTG9va0FuZEZlZWwsIHByb3ZpZGVkT3B0aW9ucz86IFZvaWNpbmdUb29sYmFySXRlbU9wdGlvbnMgKSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFZvaWNpbmdUb29sYmFySXRlbU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gcGRvbVxyXG4gICAgICB0YWdOYW1lOiAnc2VjdGlvbicsXHJcbiAgICAgIGxhYmVsVGFnTmFtZTogJ2gyJyxcclxuICAgICAgbGFiZWxDb250ZW50OiB0b29sYmFyU3RyaW5nUHJvcGVydHksXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eU9wdGlvbnM6IHtcclxuICAgICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHRpdGxlVGV4dE9wdGlvbnMgPSB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTQgKSxcclxuICAgICAgZmlsbDogbG9va0FuZEZlZWwubmF2aWdhdGlvbkJhclRleHRGaWxsUHJvcGVydHksXHJcbiAgICAgIG1heFdpZHRoOiA5MCAvLyBpMThuLCBieSBpbnNwZWN0aW9uXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHRpdGxlVGV4dCA9IG5ldyBUZXh0KCB0aXRsZVN0cmluZ1Byb3BlcnR5LCB0aXRsZVRleHRPcHRpb25zICk7XHJcbiAgICBjb25zdCBxdWlja0luZm9UZXh0ID0gbmV3IFZvaWNpbmdUZXh0KCBxdWlja0luZm9TdHJpbmdQcm9wZXJ0eSwgdGl0bGVUZXh0T3B0aW9ucyApO1xyXG4gICAgcXVpY2tJbmZvVGV4dC5mb2N1c0hpZ2hsaWdodCA9IG5ldyBSZWFkaW5nQmxvY2tIaWdobGlnaHQoIHF1aWNrSW5mb1RleHQsIHtcclxuXHJcbiAgICAgIC8vIHRoZSBpbm5lciBzdHJva2UgaXMgd2hpdGUgc2luY2UgdGhlIHRvb2xiYXIgaXMgb24gYSBibGFjayBiYWNrZ3JvdW5kXHJcbiAgICAgIGlubmVyU3Ryb2tlOiAnd2hpdGUnXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbXV0ZVNwZWVjaFN3aXRjaCA9IG5ldyBUb2dnbGVTd2l0Y2goIHZvaWNpbmdNYW5hZ2VyLm1haW5XaW5kb3dWb2ljaW5nRW5hYmxlZFByb3BlcnR5LCBmYWxzZSwgdHJ1ZSwgY29tYmluZU9wdGlvbnM8VG9nZ2xlU3dpdGNoT3B0aW9ucz4oIHtcclxuICAgICAgYTExeU5hbWU6IHRpdGxlU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIHJpZ2h0VmFsdWVDb250ZXh0UmVzcG9uc2U6IHNpbVZvaWNpbmdPblN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBsZWZ0VmFsdWVDb250ZXh0UmVzcG9uc2U6IHNpbVZvaWNpbmdPZmZTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbT8uY3JlYXRlVGFuZGVtKCAnbXV0ZVNwZWVjaFN3aXRjaCcgKVxyXG4gICAgfSwgUHJlZmVyZW5jZXNEaWFsb2dDb25zdGFudHMuVE9HR0xFX1NXSVRDSF9PUFRJT05TICkgKTtcclxuICAgIGNvbnN0IG11dGVTcGVlY2hDb250cm9sID0gbmV3IFByZWZlcmVuY2VzQ29udHJvbCgge1xyXG4gICAgICBsYWJlbE5vZGU6IHRpdGxlVGV4dCxcclxuICAgICAgY29udHJvbE5vZGU6IG11dGVTcGVlY2hTd2l0Y2gsXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0/LmNyZWF0ZVRhbmRlbSggJ211dGVTcGVlY2hDb250cm9sJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gbGF5b3V0XHJcbiAgICBjb25zdCBsYWJlbEFsaWduR3JvdXAgPSBuZXcgQWxpZ25Hcm91cCgpO1xyXG4gICAgY29uc3QgaW5wdXRBbGlnbkdyb3VwID0gbmV3IEFsaWduR3JvdXAoKTtcclxuXHJcbiAgICBjb25zdCBvdmVydmlld1JvdyA9IG5ldyBMYWJlbEJ1dHRvblJvdyggb3ZlcnZpZXdTdHJpbmdQcm9wZXJ0eSwgcGxheU92ZXJ2aWV3U3RyaW5nUHJvcGVydHksIGxhYmVsQWxpZ25Hcm91cCwgaW5wdXRBbGlnbkdyb3VwLFxyXG4gICAgICBsb29rQW5kRmVlbCwgYWxlcnRNYW5hZ2VyLmNyZWF0ZU92ZXJ2aWV3Q29udGVudC5iaW5kKCBhbGVydE1hbmFnZXIgKSApO1xyXG4gICAgY29uc3QgZGV0YWlsc1JvdyA9IG5ldyBMYWJlbEJ1dHRvblJvdyggZGV0YWlsc1N0cmluZ1Byb3BlcnR5LCBwbGF5RGV0YWlsc1N0cmluZ1Byb3BlcnR5LCBsYWJlbEFsaWduR3JvdXAsIGlucHV0QWxpZ25Hcm91cCxcclxuICAgICAgbG9va0FuZEZlZWwsIGFsZXJ0TWFuYWdlci5jcmVhdGVEZXRhaWxzQ29udGVudC5iaW5kKCBhbGVydE1hbmFnZXIgKSApO1xyXG4gICAgY29uc3QgaGludFJvdyA9IG5ldyBMYWJlbEJ1dHRvblJvdyggaGludFN0cmluZ1Byb3BlcnR5LCBwbGF5SGludFN0cmluZ1Byb3BlcnR5LCBsYWJlbEFsaWduR3JvdXAsIGlucHV0QWxpZ25Hcm91cCxcclxuICAgICAgbG9va0FuZEZlZWwsIGFsZXJ0TWFuYWdlci5jcmVhdGVIaW50Q29udGVudC5iaW5kKCBhbGVydE1hbmFnZXIgKSApO1xyXG5cclxuICAgIHRoaXMuY2hpbGRyZW4gPSBbIG11dGVTcGVlY2hDb250cm9sLCBxdWlja0luZm9UZXh0LCBvdmVydmlld1Jvdy5jb250ZW50LCBkZXRhaWxzUm93LmNvbnRlbnQsIGhpbnRSb3cuY29udGVudCBdO1xyXG5cclxuICAgIC8vIGxheW91dFxyXG4gICAgcXVpY2tJbmZvVGV4dC5sZWZ0VG9wID0gbXV0ZVNwZWVjaENvbnRyb2wubGVmdEJvdHRvbS5wbHVzWFkoIDAsIENPTlRFTlRfVkVSVElDQUxfU1BBQ0lORyApO1xyXG4gICAgb3ZlcnZpZXdSb3cuY29udGVudC5sZWZ0VG9wID0gcXVpY2tJbmZvVGV4dC5sZWZ0Qm90dG9tLnBsdXNYWSggUVVJQ0tfSU5GTywgQ09OVEVOVF9WRVJUSUNBTF9TUEFDSU5HICk7XHJcbiAgICBkZXRhaWxzUm93LmNvbnRlbnQubGVmdFRvcCA9IG92ZXJ2aWV3Um93LmNvbnRlbnQubGVmdEJvdHRvbS5wbHVzWFkoIDAsIENPTlRFTlRfVkVSVElDQUxfU1BBQ0lORyApO1xyXG4gICAgaGludFJvdy5jb250ZW50LmxlZnRUb3AgPSBkZXRhaWxzUm93LmNvbnRlbnQubGVmdEJvdHRvbS5wbHVzWFkoIDAsIENPTlRFTlRfVkVSVElDQUxfU1BBQ0lORyApO1xyXG5cclxuICAgIGNvbnN0IHJvd3MgPSBbIG92ZXJ2aWV3Um93LCBkZXRhaWxzUm93LCBoaW50Um93IF07XHJcbiAgICBjb25zdCBwbGF5aW5nUHJvcGVydGllcyA9IFsgb3ZlcnZpZXdSb3cucGxheWluZ1Byb3BlcnR5LCBkZXRhaWxzUm93LnBsYXlpbmdQcm9wZXJ0eSwgaGludFJvdy5wbGF5aW5nUHJvcGVydHkgXTtcclxuXHJcbiAgICByb3dzLmZvckVhY2goIHJvdyA9PiB7XHJcbiAgICAgIHJvdy5wbGF5aW5nUHJvcGVydHkubGluayggcGxheWluZyA9PiB7XHJcbiAgICAgICAgcm93LnBsYXlDb250ZW50KCBwbGF5aW5nUHJvcGVydGllcyApO1xyXG4gICAgICB9ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlVm9pY2luZ1Rvb2xiYXJJdGVtID0gKCkgPT4ge1xyXG4gICAgICBxdWlja0luZm9UZXh0LmRpc3Bvc2UoKTtcclxuICAgICAgdGl0bGVUZXh0LmRpc3Bvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZVZvaWNpbmdUb29sYmFySXRlbSgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEFuIGlubmVyIGNsYXNzIHRoYXQgbWFuYWdlcyBhIGxhYmVsbGVkIFBsYXlTdG9wQnV0dG9uIGluIHRoZSBWb2ljaW5nVG9vbGJhckl0ZW0uIENyZWF0ZXMgdGhlIGxhYmVsLCBidXR0b24sXHJcbiAqIGFuZCBhZGRzIGxpc3RlbmVycyB0aGF0IGdlbmVyYXRlIHRoZSBhbGVydCB0byBiZSBWb2ljZWQgYW5kIHRvZ2dsZSB0aGUgYnV0dG9uJ3MgcGxheWluZyBzdGF0ZSB3aGVuXHJcbiAqIHRoZSB2b2ljaW5nTWFuYWdlciBzdG9wcyBzcGVha2luZy5cclxuICovXHJcbmNsYXNzIExhYmVsQnV0dG9uUm93IHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBsb29rQW5kRmVlbDogTG9va0FuZEZlZWw7XHJcblxyXG4gIC8vIEEgdW5pcXVlIFV0dGVyYW5jZSBmb3IgdGhlIG9iamVjdCByZXNwb25zZSBzbyB0aGF0IGl0IGNhbiBiZSBpbmRlcGVuZGVudGx5IGNhbmNlbGxlZCBhbmQgaGF2ZSBhIGR5bmFtaWMgUHJpb3JpdHlcclxuICAvLyBkZXBlbmRpbmcgb24gaW50ZXJhY3Rpb24gd2l0aCB0aGUgc2NyZWVuLlxyXG4gIHByaXZhdGUgcmVhZG9ubHkgb2JqZWN0UmVzcG9uc2VVdHRlcmFuY2U6IFV0dGVyYW5jZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNyZWF0ZUFsZXJ0OiAoKSA9PiBTcGVha2FibGVSZXNvbHZlZFJlc3BvbnNlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGxheVN0b3BCdXR0b246IFBsYXlTdG9wQnV0dG9uO1xyXG5cclxuICAvLyBXaGV0aGVyIHRoZSBQbGF5U3RvcEJ1dHRvbiBoYXMgYmVlbiBwcmVzc2VkIGFuZCB0aGUgdm9pY2luZ01hbmFnZXIgaXMgYWN0aXZlbHkgc3BlYWtpbmcgdGhpcyBjb250ZW50XHJcbiAgcHVibGljIHJlYWRvbmx5IHBsYXlpbmdQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG5cclxuICAvLyBUaGUgTm9kZSBvZiBjb250ZW50IHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgdmlldywgbWFuYWdpbmcgbGF5b3V0IG9mIHRoZSBsYWJlbCBhbmQgYnV0dG9uXHJcbiAgcHVibGljIHJlYWRvbmx5IGNvbnRlbnQ6IE5vZGU7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBsYWJlbFN0cmluZyAtIHRoZSB2aXN1YWxseSByZW5kZXJlZCBUZXh0IGxhYmVsIGZvciB0aGUgYnV0dG9uXHJcbiAgICogQHBhcmFtIGExMXlOYW1lIC0gdGhlIHN0cmluZyByZWFkIGluIHRoZSBQRE9NIGFuZCB3aXRoIHRoZSBWb2ljaW5nIGZlYXR1cmUgdGhhdCBsYWJlbHMgdGhpcyBCdXR0b25cclxuICAgKiBAcGFyYW0gbGFiZWxBbGlnbkdyb3VwIC0gVG8gYWxpZ24gYWxsIGxhYmVscyBpbiB0aGUgVm9pY2luZ1Rvb2xiYXJJdGVtXHJcbiAgICogQHBhcmFtIGlucHV0QWxpZ25Hcm91cCAtIFRvIGFsaWduIGFsbCBpbnB1dHMgaW4gdGhlIFZvaWNpbmdUb29sYmFySXRlbVxyXG4gICAqIEBwYXJhbSBsb29rQW5kRmVlbFxyXG4gICAqIEBwYXJhbSBjcmVhdGVBbGVydCAtIGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyB0aGUgYWxlcnQgd2hlbiB0aGUgYnV0dG9uIGlzIHByZXNzZWRcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoXHJcbiAgICBsYWJlbFN0cmluZzogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPixcclxuICAgIGExMXlOYW1lOiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+LFxyXG4gICAgbGFiZWxBbGlnbkdyb3VwOiBBbGlnbkdyb3VwLFxyXG4gICAgaW5wdXRBbGlnbkdyb3VwOiBBbGlnbkdyb3VwLFxyXG4gICAgbG9va0FuZEZlZWw6IExvb2tBbmRGZWVsLFxyXG4gICAgY3JlYXRlQWxlcnQ6ICgpID0+IFNwZWFrYWJsZVJlc29sdmVkUmVzcG9uc2VcclxuICApIHtcclxuXHJcbiAgICB0aGlzLmxvb2tBbmRGZWVsID0gbG9va0FuZEZlZWw7XHJcbiAgICB0aGlzLm9iamVjdFJlc3BvbnNlVXR0ZXJhbmNlID0gbmV3IFV0dGVyYW5jZSgpO1xyXG4gICAgdGhpcy5jcmVhdGVBbGVydCA9IGNyZWF0ZUFsZXJ0O1xyXG5cclxuICAgIHRoaXMucGxheWluZ1Byb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuXHJcbiAgICAgIC8vIFNwZWVjaCBpcyByZXF1ZXN0ZWQgZnJvbSBhIGxpc3RlbmVyIG9uIHRoZSBpc1BsYXlpbmdQcm9wZXJ0eS4gQnV0IGlmIHRoZSBicm93c2VyIGNhbm5vdCBzcGVhayBpdCBtYXlcclxuICAgICAgLy8gaW1tZWRpYXRlbHkgY2FuY2VsIHNwZWVjaCBhbmQgc2V0IHRoaXMgUHJvcGVydHkgdG8gZmFsc2UgYWdhaW4gY2F1c2luZyByZWVudHJhbmN5LlxyXG4gICAgICByZWVudHJhbnQ6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnBsYXlTdG9wQnV0dG9uID0gbmV3IFBsYXlTdG9wQnV0dG9uKCB0aGlzLnBsYXlpbmdQcm9wZXJ0eSwge1xyXG4gICAgICBzdGFydFBsYXlpbmdMYWJlbDogYTExeU5hbWUsXHJcblxyXG4gICAgICAvLyB2b2ljaW5nXHJcbiAgICAgIHZvaWNpbmdOYW1lUmVzcG9uc2U6IGExMXlOYW1lLFxyXG4gICAgICB2b2ljaW5nSWdub3JlVm9pY2luZ01hbmFnZXJQcm9wZXJ0aWVzOiB0cnVlLFxyXG5cclxuICAgICAgcmFkaXVzOiAxMixcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUX09VVFxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHRleHRMYWJlbCA9IG5ldyBUZXh0KCBsYWJlbFN0cmluZywge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIDEyICksXHJcbiAgICAgIGZpbGw6IHRoaXMubG9va0FuZEZlZWwubmF2aWdhdGlvbkJhclRleHRGaWxsUHJvcGVydHksXHJcbiAgICAgIG1heFdpZHRoOiAxMDAgLy8gaTE4biwgYnkgaW5zcGVjdGlvblxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGxhYmVsQm94ID0gbGFiZWxBbGlnbkdyb3VwLmNyZWF0ZUJveCggdGV4dExhYmVsLCB7IHhBbGlnbjogJ2xlZnQnIH0gKTtcclxuICAgIGNvbnN0IGlucHV0Qm94ID0gaW5wdXRBbGlnbkdyb3VwLmNyZWF0ZUJveCggdGhpcy5wbGF5U3RvcEJ1dHRvbiwgeyB4QWxpZ246ICdyaWdodCcgfSApO1xyXG5cclxuICAgIHRoaXMuY29udGVudCA9IG5ldyBIQm94KCB7IGNoaWxkcmVuOiBbIGxhYmVsQm94LCBpbnB1dEJveCBdLCBzcGFjaW5nOiBDT05URU5UX1ZFUlRJQ0FMX1NQQUNJTkcgfSApO1xyXG5cclxuICAgIHZvaWNpbmdNYW5hZ2VyLmVuZFNwZWFraW5nRW1pdHRlci5hZGRMaXN0ZW5lciggKCB0ZXh0LCBlbmRlZFV0dGVyYW5jZSApID0+IHtcclxuICAgICAgaWYgKCBlbmRlZFV0dGVyYW5jZSA9PT0gdGhpcy5vYmplY3RSZXNwb25zZVV0dGVyYW5jZSApIHtcclxuICAgICAgICB0aGlzLnBsYXlpbmdQcm9wZXJ0eS5zZXQoIGZhbHNlICk7XHJcblxyXG4gICAgICAgIC8vIFJlbW92ZSBpZiBsaXN0ZW5lciB3YXNuJ3QgaW50ZXJydXB0ZWQgYnkgRGlzcGxheSBpbnB1dC5cclxuICAgICAgICBpZiAoIERpc3BsYXkuaW5wdXRMaXN0ZW5lcnMuaW5jbHVkZXMoIGRpc3BsYXlMaXN0ZW5lciApICkge1xyXG4gICAgICAgICAgRGlzcGxheS5yZW1vdmVJbnB1dExpc3RlbmVyKCBkaXNwbGF5TGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBSZWR1Y2VzIHRoZSBwcmlvcml0eSBvZiB0aGlzLnV0dGVyYW5jZSBhcyBzb29uIGFzIHRoZXJlIGlzIGFuIGludGVyYWN0aW9uIHdpdGggdGhlIHNjcmVlbiBzbyB0aGF0IGl0IG1heVxyXG4gICAgLy8gYmUgaW50ZXJydXB0ZWQgYnkgc2ltdWxhdGlvbiByZXNwb25zZXMuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvam9pc3QvaXNzdWVzLzc1Mi5cclxuICAgIGNvbnN0IHJlZHVjZVByaW9yaXR5TGlzdGVuZXIgPSAoIGV2ZW50OiBTY2VuZXJ5RXZlbnQgKSA9PiB7XHJcblxyXG4gICAgICAvLyBBZnRlciBhIGRvd24gZXZlbnQgaXQgd2lsbCBiZSBwb3NzaWJsZSBmb3IgdGhpcy51dHRlcmFuY2UgdG8gYmUgaW50ZXJydXB0ZWQuIFRoYXQgd2lsbCB0dXJuIHRoZSBcIlN0b3BcIiBidXR0b25cclxuICAgICAgLy8gaW50byBhIFwiUGxheVwiIGJ1dHRvbi4gSWYgdGhlIG1vdXNlIGlzIHN0aWxsIGRvd24gaW4gdGhpcyBjYXNlIHRoZSBuZXh0IHVwIGV2ZW50IG9uIHRoZSBcIlBsYXlcIiBidXR0b24gd2lsbFxyXG4gICAgICAvLyBpbW1lZGlhdGVseSBwbGF5IGl0cyBjb250ZW50IHdoaWNoIGlzIHVuZXhwZWN0ZWQuIFdlIGdldCBhcm91bmQgdGhpcyBieSBub3QgcmVkdWNpbmcgcHJpb3JpdHkgaWYgdGhlIGV2ZW50XHJcbiAgICAgIC8vIGlzIGdvaW5nIHRvIHRoaXMgYnV0dG9uLlxyXG4gICAgICBpZiAoICFldmVudC50cmFpbC5ub2Rlcy5pbmNsdWRlcyggdGhpcy5wbGF5U3RvcEJ1dHRvbiApICkge1xyXG4gICAgICAgIERpc3BsYXkucmVtb3ZlSW5wdXRMaXN0ZW5lciggZGlzcGxheUxpc3RlbmVyICk7XHJcblxyXG4gICAgICAgIC8vIFdhaXQgdW50aWwgdGhlIGxpc3RlbmVyIGlzIHJlbW92ZWQgYmVmb3JlIHJlZHVjaW5nIHRoaXMsIHRoaXMgbWF5IGltbWVkaWF0ZWx5IGVuZCB0aGUgVXR0ZXJhbmNlIGFuZCByZW1vdmVcclxuICAgICAgICAvLyB0aGUgbGlzdGVuZXIgYWdhaW4gaW4gdGhlIGVuZFNwZWFraW5nTGlzdGVuZXIgYWJvdmUuXHJcbiAgICAgICAgdGhpcy5vYmplY3RSZXNwb25zZVV0dGVyYW5jZS5wcmlvcml0eVByb3BlcnR5LnZhbHVlID0gVXR0ZXJhbmNlLkxPV19QUklPUklUWTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBkaXNwbGF5TGlzdGVuZXIgPSB7XHJcblxyXG4gICAgICAvLyBUaGUgZXZlbnRzIHRoYXQgaW5kaWNhdGUgc29tZSBraW5kIG9mIGlucHV0IHNvIHdlIHNob3VsZCBhbGxvdyB0aGlzLnV0dGVyYW5jZSB0byBiZSBpbnRlcnJ1cHRlZC5cclxuICAgICAgZG93bjogcmVkdWNlUHJpb3JpdHlMaXN0ZW5lcixcclxuICAgICAgZm9jdXM6IHJlZHVjZVByaW9yaXR5TGlzdGVuZXJcclxuICAgIH07XHJcblxyXG4gICAgdm9pY2luZ01hbmFnZXIuc3RhcnRTcGVha2luZ0VtaXR0ZXIuYWRkTGlzdGVuZXIoICggcmVzcG9uc2UsIHV0dGVyYW5jZSApID0+IHtcclxuICAgICAgaWYgKCB1dHRlcmFuY2UgPT09IHRoaXMub2JqZWN0UmVzcG9uc2VVdHRlcmFuY2UgKSB7XHJcbiAgICAgICAgRGlzcGxheS5hZGRJbnB1dExpc3RlbmVyKCBkaXNwbGF5TGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGxheSB0aGUgVm9pY2luZyBjb250ZW50IGZvciB0aGlzIFJvdy5cclxuICAgKi9cclxuICBwdWJsaWMgcGxheUNvbnRlbnQoIHBsYXlpbmdQcm9wZXJ0aWVzOiBCb29sZWFuUHJvcGVydHlbXSApOiB2b2lkIHtcclxuXHJcbiAgICBpZiAoIHRoaXMucGxheWluZ1Byb3BlcnR5LnZhbHVlICkge1xyXG5cclxuICAgICAgLy8gd2hlbiBvbmUgYnV0dG9uIGlzIHByZXNzZWQsIGltbWVkaWF0ZWx5IHN0b3AgYW55IG90aGVyIGJ1dHRvbnMsIG9ubHkgb25lIHNob3VsZCBiZSBwbGF5aW5nIGF0IGEgdGltZVxyXG4gICAgICBjb25zdCBvdGhlclByb3BlcnRpZXMgPSBfLndpdGhvdXQoIHBsYXlpbmdQcm9wZXJ0aWVzLCB0aGlzLnBsYXlpbmdQcm9wZXJ0eSApO1xyXG4gICAgICBvdGhlclByb3BlcnRpZXMuZm9yRWFjaCggcHJvcGVydHkgPT4ge1xyXG4gICAgICAgIHByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIC8vIFRoaXMgdXR0ZXJhbmNlIGlzIHRvcCBwcmlvcml0eSBzbyB0aGF0IGl0IGRvZXMgbm90IGdldCBpbnRlcnJ1cHRlZCBkdXJpbmcgcmVzcG9uc2VzIHRoYXQgaGFwcGVuIGFzXHJcbiAgICAgIC8vIHRoZSBzaW11bGF0aW9uIGNoYW5nZXMuIEl0IHN0YXlzIHRvcCBwcmlvcml0eSB1bnRpbCB0aGVyZSBpcyBzb21lIGludGVyYWN0aW9uIHdpdGggdGhlIGRpc3BsYXkuXHJcbiAgICAgIHRoaXMub2JqZWN0UmVzcG9uc2VVdHRlcmFuY2UucHJpb3JpdHlQcm9wZXJ0eS52YWx1ZSA9IFV0dGVyYW5jZS5UT1BfUFJJT1JJVFk7XHJcbiAgICAgIHRoaXMucGxheVN0b3BCdXR0b24udm9pY2luZ1NwZWFrUmVzcG9uc2UoIHtcclxuICAgICAgICBvYmplY3RSZXNwb25zZTogdGhpcy5jcmVhdGVBbGVydCgpLFxyXG5cclxuICAgICAgICAvLyBBIHNlcHBhcmF0ZSBVdHRlcmFuY2UgZnJvbSB0aGUgZGVmYXVsdCB2b2ljaW5nVXR0ZXJhbmNlIHNvIHRoYXQgaWYgZGVmYXVsdCByZXNwb25zZXMgYXJlIGNhbmNlbGxlZCB3ZVxyXG4gICAgICAgIC8vIGRvbid0IGFsc28gY2FuY2VsIHRoaXMgY29udGVudCBpbiB0aGUgbGlzdGVuZXJzIHJlbGF0ZWQgdG8gcHJpb3JpdHlQcm9wZXJ0eSBhYm92ZS5cclxuICAgICAgICB1dHRlcmFuY2U6IHRoaXMub2JqZWN0UmVzcG9uc2VVdHRlcmFuY2VcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHZvaWNpbmdVdHRlcmFuY2VRdWV1ZS5jYW5jZWxVdHRlcmFuY2UoIHRoaXMub2JqZWN0UmVzcG9uc2VVdHRlcmFuY2UgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmpvaXN0LnJlZ2lzdGVyKCAnVm9pY2luZ1Rvb2xiYXJJdGVtJywgVm9pY2luZ1Rvb2xiYXJJdGVtICk7XHJcbmV4cG9ydCBkZWZhdWx0IFZvaWNpbmdUb29sYmFySXRlbTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0scUNBQXFDO0FBQ2pFLE9BQU9DLGNBQWMsTUFBTSxvREFBb0Q7QUFDL0UsT0FBT0MsUUFBUSxNQUFNLHNDQUFzQztBQUMzRCxTQUFTQyxVQUFVLEVBQUVDLE9BQU8sRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQWVDLHFCQUFxQixFQUFnQkMsSUFBSSxFQUFFQyxjQUFjLEVBQUVDLFdBQVcsRUFBRUMscUJBQXFCLFFBQVEsZ0NBQWdDO0FBQzVMLE9BQU9DLE1BQU0sTUFBTSw4QkFBOEI7QUFDakQsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxPQUFPQyxLQUFLLE1BQU0sYUFBYTtBQUMvQixPQUFPQyxZQUFZLE1BQU0sb0JBQW9CO0FBQzdDLE9BQU9DLGtCQUFrQixNQUFNLHNDQUFzQztBQUdyRSxPQUFPQyxTQUFTLElBQUlDLGNBQWMsUUFBMEIsb0NBQW9DO0FBSWhHLE9BQU9DLFlBQVksTUFBK0IsaUNBQWlDO0FBQ25GLE9BQU9DLDBCQUEwQixNQUFNLDhDQUE4Qzs7QUFFckY7QUFDQSxNQUFNQyx3QkFBd0IsR0FBRyxFQUFFO0FBQ25DLE1BQU1DLFVBQVUsR0FBRyxFQUFFOztBQUVyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLG1CQUFtQixHQUFHUixZQUFZLENBQUNTLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxPQUFPLENBQUNILG1CQUFtQjtBQUNqRixNQUFNSSx1QkFBdUIsR0FBR1osWUFBWSxDQUFDUyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDQyx1QkFBdUI7QUFDekYsTUFBTUMsMEJBQTBCLEdBQUdiLFlBQVksQ0FBQ1MsSUFBSSxDQUFDQyxPQUFPLENBQUNDLE9BQU8sQ0FBQ0csK0JBQStCO0FBQ3BHLE1BQU1DLDJCQUEyQixHQUFHZixZQUFZLENBQUNTLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxPQUFPLENBQUNLLGdDQUFnQztBQUN0RyxNQUFNQyxxQkFBcUIsR0FBR2pCLFlBQVksQ0FBQ1MsSUFBSSxDQUFDQyxPQUFPLENBQUNGLG1CQUFtQjtBQUMzRSxNQUFNVSwwQkFBMEIsR0FBR2xCLFlBQVksQ0FBQ1MsSUFBSSxDQUFDQyxPQUFPLENBQUNDLE9BQU8sQ0FBQ1EsK0JBQStCO0FBQ3BHLE1BQU1DLHlCQUF5QixHQUFHcEIsWUFBWSxDQUFDUyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDVSw4QkFBOEI7QUFDbEcsTUFBTUMsc0JBQXNCLEdBQUd0QixZQUFZLENBQUNTLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxPQUFPLENBQUNZLDJCQUEyQjtBQUM1RixNQUFNQyxzQkFBc0IsR0FBR3hCLFlBQVksQ0FBQ1MsSUFBSSxDQUFDQyxPQUFPLENBQUNDLE9BQU8sQ0FBQ2MsMkJBQTJCO0FBQzVGLE1BQU1DLHFCQUFxQixHQUFHMUIsWUFBWSxDQUFDUyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDZ0IsMEJBQTBCO0FBQzFGLE1BQU1DLGtCQUFrQixHQUFHNUIsWUFBWSxDQUFDUyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDa0IsdUJBQXVCO0FBS3BGLE1BQU1DLGtCQUFrQixTQUFTdkMsSUFBSSxDQUFDO0VBSTdCd0MsV0FBV0EsQ0FBRUMsWUFBd0MsRUFBRUMsV0FBd0IsRUFBRUMsZUFBMkMsRUFBRztJQUNwSSxNQUFNQyxPQUFPLEdBQUdqQyxTQUFTLENBQXNELENBQUMsQ0FBRTtNQUVoRjtNQUNBa0MsT0FBTyxFQUFFLFNBQVM7TUFDbEJDLFlBQVksRUFBRSxJQUFJO01BQ2xCQyxZQUFZLEVBQUVyQixxQkFBcUI7TUFFbkM7TUFDQXNCLHNCQUFzQixFQUFFO1FBQ3RCQyxjQUFjLEVBQUU7TUFDbEI7SUFDRixDQUFDLEVBQUVOLGVBQWdCLENBQUM7SUFFcEIsS0FBSyxDQUFFQyxPQUFRLENBQUM7SUFFaEIsTUFBTU0sZ0JBQWdCLEdBQUc7TUFDdkJDLElBQUksRUFBRSxJQUFJdkQsUUFBUSxDQUFFLEVBQUcsQ0FBQztNQUN4QndELElBQUksRUFBRVYsV0FBVyxDQUFDVyw2QkFBNkI7TUFDL0NDLFFBQVEsRUFBRSxFQUFFLENBQUM7SUFDZixDQUFDO0lBRUQsTUFBTUMsU0FBUyxHQUFHLElBQUlyRCxJQUFJLENBQUVlLG1CQUFtQixFQUFFaUMsZ0JBQWlCLENBQUM7SUFDbkUsTUFBTU0sYUFBYSxHQUFHLElBQUlwRCxXQUFXLENBQUVpQix1QkFBdUIsRUFBRTZCLGdCQUFpQixDQUFDO0lBQ2xGTSxhQUFhLENBQUNDLGNBQWMsR0FBRyxJQUFJeEQscUJBQXFCLENBQUV1RCxhQUFhLEVBQUU7TUFFdkU7TUFDQUUsV0FBVyxFQUFFO0lBQ2YsQ0FBRSxDQUFDO0lBRUgsTUFBTUMsZ0JBQWdCLEdBQUcsSUFBSTlDLFlBQVksQ0FBRVYsY0FBYyxDQUFDeUQsZ0NBQWdDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRWhELGNBQWMsQ0FBdUI7TUFDNUlpRCxRQUFRLEVBQUU1QyxtQkFBbUI7TUFDN0I2Qyx5QkFBeUIsRUFBRXhDLDBCQUEwQjtNQUNyRHlDLHdCQUF3QixFQUFFdkMsMkJBQTJCO01BQ3JEd0MsTUFBTSxFQUFFcEIsT0FBTyxDQUFDb0IsTUFBTSxFQUFFQyxZQUFZLENBQUUsa0JBQW1CO0lBQzNELENBQUMsRUFBRW5ELDBCQUEwQixDQUFDb0QscUJBQXNCLENBQUUsQ0FBQztJQUN2RCxNQUFNQyxpQkFBaUIsR0FBRyxJQUFJekQsa0JBQWtCLENBQUU7TUFDaEQwRCxTQUFTLEVBQUViLFNBQVM7TUFDcEJjLFdBQVcsRUFBRVYsZ0JBQWdCO01BQzdCSyxNQUFNLEVBQUVwQixPQUFPLENBQUNvQixNQUFNLEVBQUVDLFlBQVksQ0FBRSxtQkFBb0I7SUFDNUQsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsTUFBTUssZUFBZSxHQUFHLElBQUl6RSxVQUFVLENBQUMsQ0FBQztJQUN4QyxNQUFNMEUsZUFBZSxHQUFHLElBQUkxRSxVQUFVLENBQUMsQ0FBQztJQUV4QyxNQUFNMkUsV0FBVyxHQUFHLElBQUlDLGNBQWMsQ0FBRXhDLHNCQUFzQixFQUFFTiwwQkFBMEIsRUFBRTJDLGVBQWUsRUFBRUMsZUFBZSxFQUMxSDdCLFdBQVcsRUFBRUQsWUFBWSxDQUFDaUMscUJBQXFCLENBQUNDLElBQUksQ0FBRWxDLFlBQWEsQ0FBRSxDQUFDO0lBQ3hFLE1BQU1tQyxVQUFVLEdBQUcsSUFBSUgsY0FBYyxDQUFFdEMscUJBQXFCLEVBQUVOLHlCQUF5QixFQUFFeUMsZUFBZSxFQUFFQyxlQUFlLEVBQ3ZIN0IsV0FBVyxFQUFFRCxZQUFZLENBQUNvQyxvQkFBb0IsQ0FBQ0YsSUFBSSxDQUFFbEMsWUFBYSxDQUFFLENBQUM7SUFDdkUsTUFBTXFDLE9BQU8sR0FBRyxJQUFJTCxjQUFjLENBQUVwQyxrQkFBa0IsRUFBRU4sc0JBQXNCLEVBQUV1QyxlQUFlLEVBQUVDLGVBQWUsRUFDOUc3QixXQUFXLEVBQUVELFlBQVksQ0FBQ3NDLGlCQUFpQixDQUFDSixJQUFJLENBQUVsQyxZQUFhLENBQUUsQ0FBQztJQUVwRSxJQUFJLENBQUN1QyxRQUFRLEdBQUcsQ0FBRWIsaUJBQWlCLEVBQUVYLGFBQWEsRUFBRWdCLFdBQVcsQ0FBQ1MsT0FBTyxFQUFFTCxVQUFVLENBQUNLLE9BQU8sRUFBRUgsT0FBTyxDQUFDRyxPQUFPLENBQUU7O0lBRTlHO0lBQ0F6QixhQUFhLENBQUMwQixPQUFPLEdBQUdmLGlCQUFpQixDQUFDZ0IsVUFBVSxDQUFDQyxNQUFNLENBQUUsQ0FBQyxFQUFFckUsd0JBQXlCLENBQUM7SUFDMUZ5RCxXQUFXLENBQUNTLE9BQU8sQ0FBQ0MsT0FBTyxHQUFHMUIsYUFBYSxDQUFDMkIsVUFBVSxDQUFDQyxNQUFNLENBQUVwRSxVQUFVLEVBQUVELHdCQUF5QixDQUFDO0lBQ3JHNkQsVUFBVSxDQUFDSyxPQUFPLENBQUNDLE9BQU8sR0FBR1YsV0FBVyxDQUFDUyxPQUFPLENBQUNFLFVBQVUsQ0FBQ0MsTUFBTSxDQUFFLENBQUMsRUFBRXJFLHdCQUF5QixDQUFDO0lBQ2pHK0QsT0FBTyxDQUFDRyxPQUFPLENBQUNDLE9BQU8sR0FBR04sVUFBVSxDQUFDSyxPQUFPLENBQUNFLFVBQVUsQ0FBQ0MsTUFBTSxDQUFFLENBQUMsRUFBRXJFLHdCQUF5QixDQUFDO0lBRTdGLE1BQU1zRSxJQUFJLEdBQUcsQ0FBRWIsV0FBVyxFQUFFSSxVQUFVLEVBQUVFLE9BQU8sQ0FBRTtJQUNqRCxNQUFNUSxpQkFBaUIsR0FBRyxDQUFFZCxXQUFXLENBQUNlLGVBQWUsRUFBRVgsVUFBVSxDQUFDVyxlQUFlLEVBQUVULE9BQU8sQ0FBQ1MsZUFBZSxDQUFFO0lBRTlHRixJQUFJLENBQUNHLE9BQU8sQ0FBRUMsR0FBRyxJQUFJO01BQ25CQSxHQUFHLENBQUNGLGVBQWUsQ0FBQ0csSUFBSSxDQUFFQyxPQUFPLElBQUk7UUFDbkNGLEdBQUcsQ0FBQ0csV0FBVyxDQUFFTixpQkFBa0IsQ0FBQztNQUN0QyxDQUFFLENBQUM7SUFDTCxDQUFFLENBQUM7SUFFSCxJQUFJLENBQUNPLHlCQUF5QixHQUFHLE1BQU07TUFDckNyQyxhQUFhLENBQUNzQyxPQUFPLENBQUMsQ0FBQztNQUN2QnZDLFNBQVMsQ0FBQ3VDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JCLENBQUM7RUFDSDs7RUFFQTtBQUNGO0VBQ2tCQSxPQUFPQSxDQUFBLEVBQVM7SUFDOUIsSUFBSSxDQUFDRCx5QkFBeUIsQ0FBQyxDQUFDO0lBQ2hDLEtBQUssQ0FBQ0MsT0FBTyxDQUFDLENBQUM7RUFDakI7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTXJCLGNBQWMsQ0FBQztFQUluQjtFQUNBOztFQUtBOztFQUdBOztFQUdBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDU2pDLFdBQVdBLENBQ2hCdUQsV0FBc0MsRUFDdENsQyxRQUFtQyxFQUNuQ1MsZUFBMkIsRUFDM0JDLGVBQTJCLEVBQzNCN0IsV0FBd0IsRUFDeEJzRCxXQUE0QyxFQUM1QztJQUVBLElBQUksQ0FBQ3RELFdBQVcsR0FBR0EsV0FBVztJQUM5QixJQUFJLENBQUN1RCx1QkFBdUIsR0FBRyxJQUFJMUYsU0FBUyxDQUFDLENBQUM7SUFDOUMsSUFBSSxDQUFDeUYsV0FBVyxHQUFHQSxXQUFXO0lBRTlCLElBQUksQ0FBQ1QsZUFBZSxHQUFHLElBQUk3RixlQUFlLENBQUUsS0FBSyxFQUFFO01BRWpEO01BQ0E7TUFDQXdHLFNBQVMsRUFBRTtJQUNiLENBQUUsQ0FBQztJQUVILElBQUksQ0FBQ0MsY0FBYyxHQUFHLElBQUl4RyxjQUFjLENBQUUsSUFBSSxDQUFDNEYsZUFBZSxFQUFFO01BQzlEYSxpQkFBaUIsRUFBRXZDLFFBQVE7TUFFM0I7TUFDQXdDLG1CQUFtQixFQUFFeEMsUUFBUTtNQUM3QnlDLHFDQUFxQyxFQUFFLElBQUk7TUFFM0NDLE1BQU0sRUFBRSxFQUFFO01BRVY7TUFDQXZDLE1BQU0sRUFBRTFELE1BQU0sQ0FBQ2tHO0lBQ2pCLENBQUUsQ0FBQztJQUVILE1BQU1DLFNBQVMsR0FBRyxJQUFJdkcsSUFBSSxDQUFFNkYsV0FBVyxFQUFFO01BQ3ZDNUMsSUFBSSxFQUFFLElBQUl2RCxRQUFRLENBQUUsRUFBRyxDQUFDO01BQ3hCd0QsSUFBSSxFQUFFLElBQUksQ0FBQ1YsV0FBVyxDQUFDVyw2QkFBNkI7TUFDcERDLFFBQVEsRUFBRSxHQUFHLENBQUM7SUFDaEIsQ0FBRSxDQUFDO0lBRUgsTUFBTW9ELFFBQVEsR0FBR3BDLGVBQWUsQ0FBQ3FDLFNBQVMsQ0FBRUYsU0FBUyxFQUFFO01BQUVHLE1BQU0sRUFBRTtJQUFPLENBQUUsQ0FBQztJQUMzRSxNQUFNQyxRQUFRLEdBQUd0QyxlQUFlLENBQUNvQyxTQUFTLENBQUUsSUFBSSxDQUFDUixjQUFjLEVBQUU7TUFBRVMsTUFBTSxFQUFFO0lBQVEsQ0FBRSxDQUFDO0lBRXRGLElBQUksQ0FBQzNCLE9BQU8sR0FBRyxJQUFJbEYsSUFBSSxDQUFFO01BQUVpRixRQUFRLEVBQUUsQ0FBRTBCLFFBQVEsRUFBRUcsUUFBUSxDQUFFO01BQUVDLE9BQU8sRUFBRS9GO0lBQXlCLENBQUUsQ0FBQztJQUVsR1osY0FBYyxDQUFDNEcsa0JBQWtCLENBQUNDLFdBQVcsQ0FBRSxDQUFFQyxJQUFJLEVBQUVDLGNBQWMsS0FBTTtNQUN6RSxJQUFLQSxjQUFjLEtBQUssSUFBSSxDQUFDakIsdUJBQXVCLEVBQUc7UUFDckQsSUFBSSxDQUFDVixlQUFlLENBQUM0QixHQUFHLENBQUUsS0FBTSxDQUFDOztRQUVqQztRQUNBLElBQUtySCxPQUFPLENBQUNzSCxjQUFjLENBQUNDLFFBQVEsQ0FBRUMsZUFBZ0IsQ0FBQyxFQUFHO1VBQ3hEeEgsT0FBTyxDQUFDeUgsbUJBQW1CLENBQUVELGVBQWdCLENBQUM7UUFDaEQ7TUFDRjtJQUNGLENBQUUsQ0FBQzs7SUFFSDtJQUNBO0lBQ0EsTUFBTUUsc0JBQXNCLEdBQUtDLEtBQW1CLElBQU07TUFFeEQ7TUFDQTtNQUNBO01BQ0E7TUFDQSxJQUFLLENBQUNBLEtBQUssQ0FBQ0MsS0FBSyxDQUFDQyxLQUFLLENBQUNOLFFBQVEsQ0FBRSxJQUFJLENBQUNsQixjQUFlLENBQUMsRUFBRztRQUN4RHJHLE9BQU8sQ0FBQ3lILG1CQUFtQixDQUFFRCxlQUFnQixDQUFDOztRQUU5QztRQUNBO1FBQ0EsSUFBSSxDQUFDckIsdUJBQXVCLENBQUMyQixnQkFBZ0IsQ0FBQ0MsS0FBSyxHQUFHdEgsU0FBUyxDQUFDdUgsWUFBWTtNQUM5RTtJQUNGLENBQUM7SUFFRCxNQUFNUixlQUFlLEdBQUc7TUFFdEI7TUFDQVMsSUFBSSxFQUFFUCxzQkFBc0I7TUFDNUJRLEtBQUssRUFBRVI7SUFDVCxDQUFDO0lBRURySCxjQUFjLENBQUM4SCxvQkFBb0IsQ0FBQ2pCLFdBQVcsQ0FBRSxDQUFFa0IsUUFBUSxFQUFFQyxTQUFTLEtBQU07TUFDMUUsSUFBS0EsU0FBUyxLQUFLLElBQUksQ0FBQ2xDLHVCQUF1QixFQUFHO1FBQ2hEbkcsT0FBTyxDQUFDc0ksZ0JBQWdCLENBQUVkLGVBQWdCLENBQUM7TUFDN0M7SUFDRixDQUFFLENBQUM7RUFDTDs7RUFFQTtBQUNGO0FBQ0E7RUFDUzFCLFdBQVdBLENBQUVOLGlCQUFvQyxFQUFTO0lBRS9ELElBQUssSUFBSSxDQUFDQyxlQUFlLENBQUNzQyxLQUFLLEVBQUc7TUFFaEM7TUFDQSxNQUFNUSxlQUFlLEdBQUdDLENBQUMsQ0FBQ0MsT0FBTyxDQUFFakQsaUJBQWlCLEVBQUUsSUFBSSxDQUFDQyxlQUFnQixDQUFDO01BQzVFOEMsZUFBZSxDQUFDN0MsT0FBTyxDQUFFZ0QsUUFBUSxJQUFJO1FBQ25DQSxRQUFRLENBQUNYLEtBQUssR0FBRyxLQUFLO01BQ3hCLENBQUUsQ0FBQzs7TUFFSDtNQUNBO01BQ0EsSUFBSSxDQUFDNUIsdUJBQXVCLENBQUMyQixnQkFBZ0IsQ0FBQ0MsS0FBSyxHQUFHdEgsU0FBUyxDQUFDa0ksWUFBWTtNQUM1RSxJQUFJLENBQUN0QyxjQUFjLENBQUN1QyxvQkFBb0IsQ0FBRTtRQUN4Q0MsY0FBYyxFQUFFLElBQUksQ0FBQzNDLFdBQVcsQ0FBQyxDQUFDO1FBRWxDO1FBQ0E7UUFDQW1DLFNBQVMsRUFBRSxJQUFJLENBQUNsQztNQUNsQixDQUFFLENBQUM7SUFDTCxDQUFDLE1BQ0k7TUFDSDVGLHFCQUFxQixDQUFDdUksZUFBZSxDQUFFLElBQUksQ0FBQzNDLHVCQUF3QixDQUFDO0lBQ3ZFO0VBQ0Y7QUFDRjtBQUVBekYsS0FBSyxDQUFDcUksUUFBUSxDQUFFLG9CQUFvQixFQUFFdEcsa0JBQW1CLENBQUM7QUFDMUQsZUFBZUEsa0JBQWtCIiwiaWdub3JlTGlzdCI6W119