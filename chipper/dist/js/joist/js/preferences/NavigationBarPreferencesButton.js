// Copyright 2021-2024, University of Colorado Boulder

/**
 * Button in the NavigationBar that opens the PreferencesDialog.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import optionize from '../../../phet-core/js/optionize.js';
import { Color, Image } from '../../../scenery/js/imports.js';
import preferencesIconOnWhite_png from '../../images/preferencesIconOnWhite_png.js'; // on a white navbar
import preferencesIcon_png from '../../images/preferencesIcon_png.js'; // on a black navbar
import Dialog from '../../../sun/js/Dialog.js';
import PhetioCapsule from '../../../tandem/js/PhetioCapsule.js';
import joist from '../joist.js';
import JoistButton from '../JoistButton.js';
import JoistStrings from '../JoistStrings.js';
import PreferencesDialog from './PreferencesDialog.js';
// // empirically determined to similarly match the height of the P in PhET button, see https://github.com/phetsims/joist/issues/919
const DESIRED_ICON_HEIGHT = 18.85;
class NavigationBarPreferencesButton extends JoistButton {
  constructor(preferencesModel, backgroundColorProperty, providedOptions) {
    const options = optionize()({
      listener: () => {
        const preferencesDialog = preferencesDialogCapsule.getElement();
        preferencesDialog.show();
        preferencesDialog.focusSelectedTab();
      },
      highlightExtensionWidth: 5 + 3.6,
      highlightExtensionHeight: 10,
      // pdom
      innerContent: JoistStrings.preferences.titleStringProperty,
      positionInPDOM: true,
      // voicing
      voicingNameResponse: JoistStrings.preferences.titleStringProperty,
      visiblePropertyOptions: {
        phetioFeatured: true
      }
    }, providedOptions);
    const icon = new Image(preferencesIcon_png, {
      scale: DESIRED_ICON_HEIGHT / preferencesIcon_png.height,
      pickable: false
    });
    super(icon, backgroundColorProperty, options);
    const preferencesDialogCapsule = new PhetioCapsule(tandem => {
      return new PreferencesDialog(preferencesModel, {
        tandem: tandem,
        focusOnHideNode: this
      });
    }, [], {
      tandem: options.tandem.createTandem('preferencesDialogCapsule'),
      phetioType: PhetioCapsule.PhetioCapsuleIO(Dialog.DialogIO),
      disposeOnClear: false
    });

    // change the icon so that it is visible when the background changes from dark to light
    backgroundColorProperty.link(backgroundColor => {
      icon.image = backgroundColor.equals(Color.BLACK) ? preferencesIcon_png : preferencesIconOnWhite_png;
    });

    // pdom - Signal to screen readers that the button will open a dialog. For some reason, this also seems to
    // prevent a bug in iOS Safari where two events are dispatched to the screen on activation instead of one.
    // The result was that one press would open the dialog and the second buggy press would immediately close it.
    // Make sure that the dialog can be opened on iOS Safari before removing this.
    this.setPDOMAttribute('aria-haspopup', true);
  }
}
joist.register('NavigationBarPreferencesButton', NavigationBarPreferencesButton);
export default NavigationBarPreferencesButton;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJvcHRpb25pemUiLCJDb2xvciIsIkltYWdlIiwicHJlZmVyZW5jZXNJY29uT25XaGl0ZV9wbmciLCJwcmVmZXJlbmNlc0ljb25fcG5nIiwiRGlhbG9nIiwiUGhldGlvQ2Fwc3VsZSIsImpvaXN0IiwiSm9pc3RCdXR0b24iLCJKb2lzdFN0cmluZ3MiLCJQcmVmZXJlbmNlc0RpYWxvZyIsIkRFU0lSRURfSUNPTl9IRUlHSFQiLCJOYXZpZ2F0aW9uQmFyUHJlZmVyZW5jZXNCdXR0b24iLCJjb25zdHJ1Y3RvciIsInByZWZlcmVuY2VzTW9kZWwiLCJiYWNrZ3JvdW5kQ29sb3JQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJsaXN0ZW5lciIsInByZWZlcmVuY2VzRGlhbG9nIiwicHJlZmVyZW5jZXNEaWFsb2dDYXBzdWxlIiwiZ2V0RWxlbWVudCIsInNob3ciLCJmb2N1c1NlbGVjdGVkVGFiIiwiaGlnaGxpZ2h0RXh0ZW5zaW9uV2lkdGgiLCJoaWdobGlnaHRFeHRlbnNpb25IZWlnaHQiLCJpbm5lckNvbnRlbnQiLCJwcmVmZXJlbmNlcyIsInRpdGxlU3RyaW5nUHJvcGVydHkiLCJwb3NpdGlvbkluUERPTSIsInZvaWNpbmdOYW1lUmVzcG9uc2UiLCJ2aXNpYmxlUHJvcGVydHlPcHRpb25zIiwicGhldGlvRmVhdHVyZWQiLCJpY29uIiwic2NhbGUiLCJoZWlnaHQiLCJwaWNrYWJsZSIsInRhbmRlbSIsImZvY3VzT25IaWRlTm9kZSIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1R5cGUiLCJQaGV0aW9DYXBzdWxlSU8iLCJEaWFsb2dJTyIsImRpc3Bvc2VPbkNsZWFyIiwibGluayIsImJhY2tncm91bmRDb2xvciIsImltYWdlIiwiZXF1YWxzIiwiQkxBQ0siLCJzZXRQRE9NQXR0cmlidXRlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJOYXZpZ2F0aW9uQmFyUHJlZmVyZW5jZXNCdXR0b24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQnV0dG9uIGluIHRoZSBOYXZpZ2F0aW9uQmFyIHRoYXQgb3BlbnMgdGhlIFByZWZlcmVuY2VzRGlhbG9nLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgb3B0aW9uaXplLCB7IEVtcHR5U2VsZk9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIEltYWdlIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHByZWZlcmVuY2VzSWNvbk9uV2hpdGVfcG5nIGZyb20gJy4uLy4uL2ltYWdlcy9wcmVmZXJlbmNlc0ljb25PbldoaXRlX3BuZy5qcyc7IC8vIG9uIGEgd2hpdGUgbmF2YmFyXHJcbmltcG9ydCBwcmVmZXJlbmNlc0ljb25fcG5nIGZyb20gJy4uLy4uL2ltYWdlcy9wcmVmZXJlbmNlc0ljb25fcG5nLmpzJzsgLy8gb24gYSBibGFjayBuYXZiYXJcclxuaW1wb3J0IERpYWxvZyBmcm9tICcuLi8uLi8uLi9zdW4vanMvRGlhbG9nLmpzJztcclxuaW1wb3J0IFBoZXRpb0NhcHN1bGUgZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1BoZXRpb0NhcHN1bGUuanMnO1xyXG5pbXBvcnQgam9pc3QgZnJvbSAnLi4vam9pc3QuanMnO1xyXG5pbXBvcnQgSm9pc3RCdXR0b24sIHsgSm9pc3RCdXR0b25PcHRpb25zIH0gZnJvbSAnLi4vSm9pc3RCdXR0b24uanMnO1xyXG5pbXBvcnQgSm9pc3RTdHJpbmdzIGZyb20gJy4uL0pvaXN0U3RyaW5ncy5qcyc7XHJcbmltcG9ydCBQcmVmZXJlbmNlc0RpYWxvZyBmcm9tICcuL1ByZWZlcmVuY2VzRGlhbG9nLmpzJztcclxuaW1wb3J0IFByZWZlcmVuY2VzTW9kZWwgZnJvbSAnLi9QcmVmZXJlbmNlc01vZGVsLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcbmV4cG9ydCB0eXBlIE5hdmlnYXRpb25CYXJQcmVmZXJlbmNlc0J1dHRvbk9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxKb2lzdEJ1dHRvbk9wdGlvbnMsICd0YW5kZW0nPiAmIFBpY2s8Sm9pc3RCdXR0b25PcHRpb25zLCAncG9pbnRlckFyZWFEaWxhdGlvblgnIHwgJ3BvaW50ZXJBcmVhRGlsYXRpb25ZJz47XHJcblxyXG4vLyAvLyBlbXBpcmljYWxseSBkZXRlcm1pbmVkIHRvIHNpbWlsYXJseSBtYXRjaCB0aGUgaGVpZ2h0IG9mIHRoZSBQIGluIFBoRVQgYnV0dG9uLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2pvaXN0L2lzc3Vlcy85MTlcclxuY29uc3QgREVTSVJFRF9JQ09OX0hFSUdIVCA9IDE4Ljg1O1xyXG5cclxuY2xhc3MgTmF2aWdhdGlvbkJhclByZWZlcmVuY2VzQnV0dG9uIGV4dGVuZHMgSm9pc3RCdXR0b24ge1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByZWZlcmVuY2VzTW9kZWw6IFByZWZlcmVuY2VzTW9kZWwsIGJhY2tncm91bmRDb2xvclByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxDb2xvcj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM6IE5hdmlnYXRpb25CYXJQcmVmZXJlbmNlc0J1dHRvbk9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxOYXZpZ2F0aW9uQmFyUHJlZmVyZW5jZXNCdXR0b25PcHRpb25zLCBTZWxmT3B0aW9ucywgSm9pc3RCdXR0b25PcHRpb25zPigpKCB7XHJcblxyXG4gICAgICBsaXN0ZW5lcjogKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByZWZlcmVuY2VzRGlhbG9nID0gcHJlZmVyZW5jZXNEaWFsb2dDYXBzdWxlLmdldEVsZW1lbnQoKTtcclxuICAgICAgICBwcmVmZXJlbmNlc0RpYWxvZy5zaG93KCk7XHJcbiAgICAgICAgcHJlZmVyZW5jZXNEaWFsb2cuZm9jdXNTZWxlY3RlZFRhYigpO1xyXG4gICAgICB9LFxyXG4gICAgICBoaWdobGlnaHRFeHRlbnNpb25XaWR0aDogNSArIDMuNixcclxuICAgICAgaGlnaGxpZ2h0RXh0ZW5zaW9uSGVpZ2h0OiAxMCxcclxuXHJcbiAgICAgIC8vIHBkb21cclxuICAgICAgaW5uZXJDb250ZW50OiBKb2lzdFN0cmluZ3MucHJlZmVyZW5jZXMudGl0bGVTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgcG9zaXRpb25JblBET006IHRydWUsXHJcblxyXG4gICAgICAvLyB2b2ljaW5nXHJcbiAgICAgIHZvaWNpbmdOYW1lUmVzcG9uc2U6IEpvaXN0U3RyaW5ncy5wcmVmZXJlbmNlcy50aXRsZVN0cmluZ1Byb3BlcnR5LFxyXG5cclxuICAgICAgdmlzaWJsZVByb3BlcnR5T3B0aW9uczoge1xyXG4gICAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IGljb24gPSBuZXcgSW1hZ2UoIHByZWZlcmVuY2VzSWNvbl9wbmcsIHtcclxuICAgICAgc2NhbGU6IERFU0lSRURfSUNPTl9IRUlHSFQgLyBwcmVmZXJlbmNlc0ljb25fcG5nLmhlaWdodCxcclxuICAgICAgcGlja2FibGU6IGZhbHNlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgc3VwZXIoIGljb24sIGJhY2tncm91bmRDb2xvclByb3BlcnR5LCBvcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgcHJlZmVyZW5jZXNEaWFsb2dDYXBzdWxlID0gbmV3IFBoZXRpb0NhcHN1bGU8UHJlZmVyZW5jZXNEaWFsb2c+KCB0YW5kZW0gPT4ge1xyXG4gICAgICByZXR1cm4gbmV3IFByZWZlcmVuY2VzRGlhbG9nKCBwcmVmZXJlbmNlc01vZGVsLCB7XHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0sXHJcbiAgICAgICAgZm9jdXNPbkhpZGVOb2RlOiB0aGlzXHJcbiAgICAgIH0gKTtcclxuICAgIH0sIFtdLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncHJlZmVyZW5jZXNEaWFsb2dDYXBzdWxlJyApLFxyXG4gICAgICBwaGV0aW9UeXBlOiBQaGV0aW9DYXBzdWxlLlBoZXRpb0NhcHN1bGVJTyggRGlhbG9nLkRpYWxvZ0lPICksXHJcbiAgICAgIGRpc3Bvc2VPbkNsZWFyOiBmYWxzZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGNoYW5nZSB0aGUgaWNvbiBzbyB0aGF0IGl0IGlzIHZpc2libGUgd2hlbiB0aGUgYmFja2dyb3VuZCBjaGFuZ2VzIGZyb20gZGFyayB0byBsaWdodFxyXG4gICAgYmFja2dyb3VuZENvbG9yUHJvcGVydHkubGluayggYmFja2dyb3VuZENvbG9yID0+IHtcclxuICAgICAgaWNvbi5pbWFnZSA9IGJhY2tncm91bmRDb2xvci5lcXVhbHMoIENvbG9yLkJMQUNLICkgPyBwcmVmZXJlbmNlc0ljb25fcG5nIDogcHJlZmVyZW5jZXNJY29uT25XaGl0ZV9wbmc7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gcGRvbSAtIFNpZ25hbCB0byBzY3JlZW4gcmVhZGVycyB0aGF0IHRoZSBidXR0b24gd2lsbCBvcGVuIGEgZGlhbG9nLiBGb3Igc29tZSByZWFzb24sIHRoaXMgYWxzbyBzZWVtcyB0b1xyXG4gICAgLy8gcHJldmVudCBhIGJ1ZyBpbiBpT1MgU2FmYXJpIHdoZXJlIHR3byBldmVudHMgYXJlIGRpc3BhdGNoZWQgdG8gdGhlIHNjcmVlbiBvbiBhY3RpdmF0aW9uIGluc3RlYWQgb2Ygb25lLlxyXG4gICAgLy8gVGhlIHJlc3VsdCB3YXMgdGhhdCBvbmUgcHJlc3Mgd291bGQgb3BlbiB0aGUgZGlhbG9nIGFuZCB0aGUgc2Vjb25kIGJ1Z2d5IHByZXNzIHdvdWxkIGltbWVkaWF0ZWx5IGNsb3NlIGl0LlxyXG4gICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGRpYWxvZyBjYW4gYmUgb3BlbmVkIG9uIGlPUyBTYWZhcmkgYmVmb3JlIHJlbW92aW5nIHRoaXMuXHJcbiAgICB0aGlzLnNldFBET01BdHRyaWJ1dGUoICdhcmlhLWhhc3BvcHVwJywgdHJ1ZSApO1xyXG4gIH1cclxufVxyXG5cclxuam9pc3QucmVnaXN0ZXIoICdOYXZpZ2F0aW9uQmFyUHJlZmVyZW5jZXNCdXR0b24nLCBOYXZpZ2F0aW9uQmFyUHJlZmVyZW5jZXNCdXR0b24gKTtcclxuZXhwb3J0IGRlZmF1bHQgTmF2aWdhdGlvbkJhclByZWZlcmVuY2VzQnV0dG9uOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQTRCLG9DQUFvQztBQUNoRixTQUFTQyxLQUFLLEVBQUVDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDN0QsT0FBT0MsMEJBQTBCLE1BQU0sNENBQTRDLENBQUMsQ0FBQztBQUNyRixPQUFPQyxtQkFBbUIsTUFBTSxxQ0FBcUMsQ0FBQyxDQUFDO0FBQ3ZFLE9BQU9DLE1BQU0sTUFBTSwyQkFBMkI7QUFDOUMsT0FBT0MsYUFBYSxNQUFNLHFDQUFxQztBQUMvRCxPQUFPQyxLQUFLLE1BQU0sYUFBYTtBQUMvQixPQUFPQyxXQUFXLE1BQThCLG1CQUFtQjtBQUNuRSxPQUFPQyxZQUFZLE1BQU0sb0JBQW9CO0FBQzdDLE9BQU9DLGlCQUFpQixNQUFNLHdCQUF3QjtBQVF0RDtBQUNBLE1BQU1DLG1CQUFtQixHQUFHLEtBQUs7QUFFakMsTUFBTUMsOEJBQThCLFNBQVNKLFdBQVcsQ0FBQztFQUVoREssV0FBV0EsQ0FBRUMsZ0JBQWtDLEVBQUVDLHVCQUFpRCxFQUNyRkMsZUFBc0QsRUFBRztJQUUzRSxNQUFNQyxPQUFPLEdBQUdqQixTQUFTLENBQXlFLENBQUMsQ0FBRTtNQUVuR2tCLFFBQVEsRUFBRUEsQ0FBQSxLQUFNO1FBQ2QsTUFBTUMsaUJBQWlCLEdBQUdDLHdCQUF3QixDQUFDQyxVQUFVLENBQUMsQ0FBQztRQUMvREYsaUJBQWlCLENBQUNHLElBQUksQ0FBQyxDQUFDO1FBQ3hCSCxpQkFBaUIsQ0FBQ0ksZ0JBQWdCLENBQUMsQ0FBQztNQUN0QyxDQUFDO01BQ0RDLHVCQUF1QixFQUFFLENBQUMsR0FBRyxHQUFHO01BQ2hDQyx3QkFBd0IsRUFBRSxFQUFFO01BRTVCO01BQ0FDLFlBQVksRUFBRWpCLFlBQVksQ0FBQ2tCLFdBQVcsQ0FBQ0MsbUJBQW1CO01BQzFEQyxjQUFjLEVBQUUsSUFBSTtNQUVwQjtNQUNBQyxtQkFBbUIsRUFBRXJCLFlBQVksQ0FBQ2tCLFdBQVcsQ0FBQ0MsbUJBQW1CO01BRWpFRyxzQkFBc0IsRUFBRTtRQUN0QkMsY0FBYyxFQUFFO01BQ2xCO0lBQ0YsQ0FBQyxFQUFFaEIsZUFBZ0IsQ0FBQztJQUVwQixNQUFNaUIsSUFBSSxHQUFHLElBQUkvQixLQUFLLENBQUVFLG1CQUFtQixFQUFFO01BQzNDOEIsS0FBSyxFQUFFdkIsbUJBQW1CLEdBQUdQLG1CQUFtQixDQUFDK0IsTUFBTTtNQUN2REMsUUFBUSxFQUFFO0lBQ1osQ0FBRSxDQUFDO0lBRUgsS0FBSyxDQUFFSCxJQUFJLEVBQUVsQix1QkFBdUIsRUFBRUUsT0FBUSxDQUFDO0lBRS9DLE1BQU1HLHdCQUF3QixHQUFHLElBQUlkLGFBQWEsQ0FBcUIrQixNQUFNLElBQUk7TUFDL0UsT0FBTyxJQUFJM0IsaUJBQWlCLENBQUVJLGdCQUFnQixFQUFFO1FBQzlDdUIsTUFBTSxFQUFFQSxNQUFNO1FBQ2RDLGVBQWUsRUFBRTtNQUNuQixDQUFFLENBQUM7SUFDTCxDQUFDLEVBQUUsRUFBRSxFQUFFO01BQ0xELE1BQU0sRUFBRXBCLE9BQU8sQ0FBQ29CLE1BQU0sQ0FBQ0UsWUFBWSxDQUFFLDBCQUEyQixDQUFDO01BQ2pFQyxVQUFVLEVBQUVsQyxhQUFhLENBQUNtQyxlQUFlLENBQUVwQyxNQUFNLENBQUNxQyxRQUFTLENBQUM7TUFDNURDLGNBQWMsRUFBRTtJQUNsQixDQUFFLENBQUM7O0lBRUg7SUFDQTVCLHVCQUF1QixDQUFDNkIsSUFBSSxDQUFFQyxlQUFlLElBQUk7TUFDL0NaLElBQUksQ0FBQ2EsS0FBSyxHQUFHRCxlQUFlLENBQUNFLE1BQU0sQ0FBRTlDLEtBQUssQ0FBQytDLEtBQU0sQ0FBQyxHQUFHNUMsbUJBQW1CLEdBQUdELDBCQUEwQjtJQUN2RyxDQUFFLENBQUM7O0lBRUg7SUFDQTtJQUNBO0lBQ0E7SUFDQSxJQUFJLENBQUM4QyxnQkFBZ0IsQ0FBRSxlQUFlLEVBQUUsSUFBSyxDQUFDO0VBQ2hEO0FBQ0Y7QUFFQTFDLEtBQUssQ0FBQzJDLFFBQVEsQ0FBRSxnQ0FBZ0MsRUFBRXRDLDhCQUErQixDQUFDO0FBQ2xGLGVBQWVBLDhCQUE4QiIsImlnbm9yZUxpc3QiOltdfQ==