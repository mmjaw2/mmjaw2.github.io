// Copyright 2021-2024, University of Colorado Boulder

/**
 * Wrap the Display class in sim-specific logic. This includes fuzzing support, browser workarounds that have come up
 * over the years, and many listeners added the Display Instance.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import BooleanProperty from '../../axon/js/BooleanProperty.js';
import DynamicStringTest from './DynamicStringTest.js';
import optionize from '../../phet-core/js/optionize.js';
import { animatedPanZoomSingleton, Display, InputFuzzer, KeyboardFuzzer, Node, scenery, Utils } from '../../scenery/js/imports.js';
import '../../sherpa/lib/game-up-camera-1.0.0.js';
import Tandem from '../../tandem/js/Tandem.js';
import HighlightVisibilityController from './HighlightVisibilityController.js';
import joist from './joist.js';
import platform from '../../phet-core/js/platform.js';
export default class SimDisplay extends Display {
  // root for the simulation and the target for AnimatedPanZoomListener to support magnification since the Display rootNode
  // cannot be transformed
  simulationRoot = new Node();

  // Add a listener to the Display that controls visibility of various highlights in response to user input.

  // For consistent option defaults
  static DEFAULT_WEBGL = false;
  constructor(providedOptions) {
    const options = optionize()({
      // the default renderer for the rootNode, see #221, #184 and https://github.com/phetsims/molarity/issues/24
      rootRenderer: 'svg',
      // Sims that do not use WebGL trigger a ~ 0.5 second pause shortly after the sim starts up, so sims must opt in to
      // webgl support, see https://github.com/phetsims/scenery/issues/621
      webgl: SimDisplay.DEFAULT_WEBGL,
      // {boolean} - Whether to allow WebGL 2x scaling when antialiasing is detected. If running out of memory on
      // things like iPad 2s (e.g. https://github.com/phetsims/scenery/issues/859), this can be turned to false.
      allowBackingScaleAntialiasing: true,
      // prevent overflow that can cause iOS bugginess, see https://github.com/phetsims/phet-io/issues/341
      allowSceneOverflow: false,
      // Indicate whether webgl is allowed to facilitate testing on non-webgl platforms, see https://github.com/phetsims/scenery/issues/289
      allowWebGL: phet.chipper.queryParameters.webgl,
      assumeFullWindow: true,
      // a bit faster if we can assume no coordinate translations are needed for the display.

      forceSVGRefresh: phet.chipper.queryParameters.forceSVGRefresh,
      // pdom accessibility (interactive description)
      accessibility: phet.chipper.queryParameters.supportsInteractiveDescription,
      // phet-io
      tandem: Tandem.REQUIRED
    }, providedOptions);

    // Support for Interactive Highlights dictated by the preferences model.
    options.supportsInteractiveHighlights = options.preferencesModel.visualModel.supportsInteractiveHighlights;

    // override rootRenderer using query parameter, see #221 and #184
    options.rootRenderer = phet.chipper.queryParameters.rootRenderer || options.rootRenderer;

    // Supplied query parameters override options (but default values for non-supplied query parameters do not).
    if (QueryStringMachine.containsKey('webgl')) {
      options.webgl = phet.chipper.queryParameters.webgl;
    }
    Utils.setWebGLEnabled(options.webgl);

    // override window.open with a semi-API-compatible function, so fuzzing doesn't open new windows.
    if (phet.chipper.isFuzzEnabled()) {
      // @ts-expect-error - it isn't yet clear how to define objects to window just yet
      window.open = function () {
        return {
          focus: _.noop,
          blur: _.noop
        };
      };
    }
    const $body = $('body');

    // prevent scrollbars
    $body.css('padding', '0').css('margin', '0').css('overflow', 'hidden');

    // check to see if the sim div already exists in the DOM under the body. This is the case for https://github.com/phetsims/scenery/issues/174 (iOS offline reading list)
    if (document.getElementById('sim') && document.getElementById('sim').parentNode === document.body) {
      document.body.removeChild(document.getElementById('sim'));
    }

    // Prevents selection cursor issues in Safari, see https://github.com/phetsims/scenery/issues/476
    document.onselectstart = function () {
      return false;
    };
    super(new Node({
      renderer: options.rootRenderer
    }), options);
    this.simulationRoot = new Node();
    this.rootNode.addChild(this.simulationRoot);

    // Workaround for Chrome SVG bugs that seem to happen on pan-zoom, see https://github.com/phetsims/scenery/issues/1507
    // Done here so that we don't require continual refreshes.
    if (platform.chromium) {
      this.simulationRoot.transformEmitter.addListener(() => {
        this.refreshSVGOnNextFrame();
      });
    }

    // Seeding by default a random value for reproducible fuzzes if desired
    const fuzzerSeed = phet.chipper.queryParameters.randomSeed * Math.PI;
    this.inputFuzzer = new InputFuzzer(this, fuzzerSeed);
    this.keyboardFuzzer = new KeyboardFuzzer(this, fuzzerSeed);
    this.supportsPanAndZoomProperty = new BooleanProperty(phet.chipper.queryParameters.supportsPanAndZoom, {
      tandem: options.tandem.createTandem('supportsPanAndZoomProperty'),
      phetioFeatured: true
    });
    this.domElement.id = 'sim';
    if (phet.chipper.queryParameters.supportsInteractiveDescription) {
      // for now interactive description is only in English
      // NOTE: When translatable this will need to update with language, change to phet.chipper.local
      this.pdomRootElement.lang = 'en';
    }
    this.highlightVisibilityController = new HighlightVisibilityController(this, options.preferencesModel);
    if (phet.chipper.queryParameters.sceneryLog) {
      // @ts-expect-error - until scenery.js is converted to typescript, which is non-trivial (I tried)
      scenery.enableLogging(phet.chipper.queryParameters.sceneryLog);
    }
    if (phet.chipper.queryParameters.sceneryStringLog) {
      // @ts-expect-error - until scenery.js is converted to typescript, which is non-trivial (I tried)
      scenery.switchLogToString();
    }

    // See https://github.com/phetsims/chipper/issues/1319
    if (phet.chipper.queryParameters.stringTest === 'dynamic') {
      const dynamicStringTest = new DynamicStringTest();
      window.addEventListener('keydown', event => dynamicStringTest.handleEvent(event));
    }
    this.initializeEvents({
      tandem: Tandem.GENERAL_CONTROLLER.createTandem('input')
    }); // sets up listeners on the document with preventDefault(), and forwards those events to our scene

    window.phet.joist.rootNode = this.rootNode; // make the scene available for debugging
    window.phet.joist.display = this; // make the display available for debugging

    // Pass through query parameters to scenery for showing supplemental information
    this.setPointerDisplayVisible(phet.chipper.queryParameters.showPointers);
    this.setPointerAreaDisplayVisible(phet.chipper.queryParameters.showPointerAreas);
    this.setHitAreaDisplayVisible(phet.chipper.queryParameters.showHitAreas);
    this.setCanvasNodeBoundsVisible(phet.chipper.queryParameters.showCanvasNodeBounds);
    this.setFittedBlockBoundsVisible(phet.chipper.queryParameters.showFittedBlockBounds);

    // magnification support - always initialized for consistent PhET-iO API, but only conditionally added to Display
    animatedPanZoomSingleton.initialize(this.simulationRoot, {
      tandem: options.tandem.createTandem('panZoomListener')
    });
    const animatedPanZoomListener = animatedPanZoomSingleton.listener;
    this.supportsPanAndZoomProperty.link(supported => {
      if (supported) {
        this.addInputListener(animatedPanZoomListener);
      } else if (this.hasInputListener(animatedPanZoomListener)) {
        this.removeInputListener(animatedPanZoomListener);
      }
    });

    // If the page is loaded from the back-forward cache, then reload the page to avoid bugginess,
    // see https://github.com/phetsims/joist/issues/448
    window.addEventListener('pageshow', event => {
      if (event.persisted) {
        window.location.reload();
      }
    });
  }

  /**
   * Handle synthetic input event fuzzing
   */
  fuzzInputEvents() {
    // If fuzz parameter is used then fuzzTouch and fuzzMouse events should be fired
    const fuzzTouch = phet.chipper.queryParameters.fuzzTouch || phet.chipper.queryParameters.fuzz;
    const fuzzMouse = phet.chipper.queryParameters.fuzzMouse || phet.chipper.queryParameters.fuzz;

    // fire or synthesize input events
    if (fuzzMouse || fuzzTouch) {
      this.inputFuzzer.fuzzEvents(phet.chipper.queryParameters.fuzzRate, fuzzMouse, fuzzTouch, phet.chipper.queryParameters.fuzzPointers);
    }

    // fire or synthesize keyboard input events
    if (phet.chipper.queryParameters.fuzzBoard && document.hasFocus()) {
      assert && assert(phet.chipper.queryParameters.supportsInteractiveDescription, 'fuzzBoard can only run with interactive description enabled.');
      this.keyboardFuzzer.fuzzBoardEvents(phet.chipper.queryParameters.fuzzRate);
    }
  }
  step(dt) {
    if (this.supportsPanAndZoomProperty.value) {
      // animate the PanZoomListener, for smooth panning/scaling
      animatedPanZoomSingleton.listener.step(dt);
    }
  }
}
joist.register('SimDisplay', SimDisplay);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEeW5hbWljU3RyaW5nVGVzdCIsIm9wdGlvbml6ZSIsImFuaW1hdGVkUGFuWm9vbVNpbmdsZXRvbiIsIkRpc3BsYXkiLCJJbnB1dEZ1enplciIsIktleWJvYXJkRnV6emVyIiwiTm9kZSIsInNjZW5lcnkiLCJVdGlscyIsIlRhbmRlbSIsIkhpZ2hsaWdodFZpc2liaWxpdHlDb250cm9sbGVyIiwiam9pc3QiLCJwbGF0Zm9ybSIsIlNpbURpc3BsYXkiLCJzaW11bGF0aW9uUm9vdCIsIkRFRkFVTFRfV0VCR0wiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJyb290UmVuZGVyZXIiLCJ3ZWJnbCIsImFsbG93QmFja2luZ1NjYWxlQW50aWFsaWFzaW5nIiwiYWxsb3dTY2VuZU92ZXJmbG93IiwiYWxsb3dXZWJHTCIsInBoZXQiLCJjaGlwcGVyIiwicXVlcnlQYXJhbWV0ZXJzIiwiYXNzdW1lRnVsbFdpbmRvdyIsImZvcmNlU1ZHUmVmcmVzaCIsImFjY2Vzc2liaWxpdHkiLCJzdXBwb3J0c0ludGVyYWN0aXZlRGVzY3JpcHRpb24iLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzIiwicHJlZmVyZW5jZXNNb2RlbCIsInZpc3VhbE1vZGVsIiwiUXVlcnlTdHJpbmdNYWNoaW5lIiwiY29udGFpbnNLZXkiLCJzZXRXZWJHTEVuYWJsZWQiLCJpc0Z1enpFbmFibGVkIiwid2luZG93Iiwib3BlbiIsImZvY3VzIiwiXyIsIm5vb3AiLCJibHVyIiwiJGJvZHkiLCIkIiwiY3NzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInBhcmVudE5vZGUiLCJib2R5IiwicmVtb3ZlQ2hpbGQiLCJvbnNlbGVjdHN0YXJ0IiwicmVuZGVyZXIiLCJyb290Tm9kZSIsImFkZENoaWxkIiwiY2hyb21pdW0iLCJ0cmFuc2Zvcm1FbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJyZWZyZXNoU1ZHT25OZXh0RnJhbWUiLCJmdXp6ZXJTZWVkIiwicmFuZG9tU2VlZCIsIk1hdGgiLCJQSSIsImlucHV0RnV6emVyIiwia2V5Ym9hcmRGdXp6ZXIiLCJzdXBwb3J0c1BhbkFuZFpvb21Qcm9wZXJ0eSIsInN1cHBvcnRzUGFuQW5kWm9vbSIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb0ZlYXR1cmVkIiwiZG9tRWxlbWVudCIsImlkIiwicGRvbVJvb3RFbGVtZW50IiwibGFuZyIsImhpZ2hsaWdodFZpc2liaWxpdHlDb250cm9sbGVyIiwic2NlbmVyeUxvZyIsImVuYWJsZUxvZ2dpbmciLCJzY2VuZXJ5U3RyaW5nTG9nIiwic3dpdGNoTG9nVG9TdHJpbmciLCJzdHJpbmdUZXN0IiwiZHluYW1pY1N0cmluZ1Rlc3QiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJoYW5kbGVFdmVudCIsImluaXRpYWxpemVFdmVudHMiLCJHRU5FUkFMX0NPTlRST0xMRVIiLCJkaXNwbGF5Iiwic2V0UG9pbnRlckRpc3BsYXlWaXNpYmxlIiwic2hvd1BvaW50ZXJzIiwic2V0UG9pbnRlckFyZWFEaXNwbGF5VmlzaWJsZSIsInNob3dQb2ludGVyQXJlYXMiLCJzZXRIaXRBcmVhRGlzcGxheVZpc2libGUiLCJzaG93SGl0QXJlYXMiLCJzZXRDYW52YXNOb2RlQm91bmRzVmlzaWJsZSIsInNob3dDYW52YXNOb2RlQm91bmRzIiwic2V0Rml0dGVkQmxvY2tCb3VuZHNWaXNpYmxlIiwic2hvd0ZpdHRlZEJsb2NrQm91bmRzIiwiaW5pdGlhbGl6ZSIsImFuaW1hdGVkUGFuWm9vbUxpc3RlbmVyIiwibGlzdGVuZXIiLCJsaW5rIiwic3VwcG9ydGVkIiwiYWRkSW5wdXRMaXN0ZW5lciIsImhhc0lucHV0TGlzdGVuZXIiLCJyZW1vdmVJbnB1dExpc3RlbmVyIiwicGVyc2lzdGVkIiwibG9jYXRpb24iLCJyZWxvYWQiLCJmdXp6SW5wdXRFdmVudHMiLCJmdXp6VG91Y2giLCJmdXp6IiwiZnV6ek1vdXNlIiwiZnV6ekV2ZW50cyIsImZ1enpSYXRlIiwiZnV6elBvaW50ZXJzIiwiZnV6ekJvYXJkIiwiaGFzRm9jdXMiLCJhc3NlcnQiLCJmdXp6Qm9hcmRFdmVudHMiLCJzdGVwIiwiZHQiLCJ2YWx1ZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU2ltRGlzcGxheS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBXcmFwIHRoZSBEaXNwbGF5IGNsYXNzIGluIHNpbS1zcGVjaWZpYyBsb2dpYy4gVGhpcyBpbmNsdWRlcyBmdXp6aW5nIHN1cHBvcnQsIGJyb3dzZXIgd29ya2Fyb3VuZHMgdGhhdCBoYXZlIGNvbWUgdXBcclxuICogb3ZlciB0aGUgeWVhcnMsIGFuZCBtYW55IGxpc3RlbmVycyBhZGRlZCB0aGUgRGlzcGxheSBJbnN0YW5jZS5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVFByb3BlcnR5LmpzJztcclxuaW1wb3J0IER5bmFtaWNTdHJpbmdUZXN0IGZyb20gJy4vRHluYW1pY1N0cmluZ1Rlc3QuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCB7IGFuaW1hdGVkUGFuWm9vbVNpbmdsZXRvbiwgRGlzcGxheSwgRGlzcGxheU9wdGlvbnMsIElucHV0RnV6emVyLCBLZXlib2FyZEZ1enplciwgTm9kZSwgUmVuZGVyZXJUeXBlLCBzY2VuZXJ5LCBVdGlscyB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCAnLi4vLi4vc2hlcnBhL2xpYi9nYW1lLXVwLWNhbWVyYS0xLjAuMC5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBIaWdobGlnaHRWaXNpYmlsaXR5Q29udHJvbGxlciBmcm9tICcuL0hpZ2hsaWdodFZpc2liaWxpdHlDb250cm9sbGVyLmpzJztcclxuaW1wb3J0IGpvaXN0IGZyb20gJy4vam9pc3QuanMnO1xyXG5pbXBvcnQgUHJlZmVyZW5jZXNNb2RlbCBmcm9tICcuL3ByZWZlcmVuY2VzL1ByZWZlcmVuY2VzTW9kZWwuanMnO1xyXG5pbXBvcnQgcGxhdGZvcm0gZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3BsYXRmb3JtLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgd2ViZ2w/OiBib29sZWFuO1xyXG4gIHJvb3RSZW5kZXJlcj86IFJlbmRlcmVyVHlwZTtcclxuICBwcmVmZXJlbmNlc01vZGVsOiBQcmVmZXJlbmNlc01vZGVsO1xyXG59O1xyXG5leHBvcnQgdHlwZSBTaW1EaXNwbGF5T3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxEaXNwbGF5T3B0aW9ucywgJ3N1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTaW1EaXNwbGF5IGV4dGVuZHMgRGlzcGxheSB7XHJcblxyXG4gIC8vIHJvb3QgZm9yIHRoZSBzaW11bGF0aW9uIGFuZCB0aGUgdGFyZ2V0IGZvciBBbmltYXRlZFBhblpvb21MaXN0ZW5lciB0byBzdXBwb3J0IG1hZ25pZmljYXRpb24gc2luY2UgdGhlIERpc3BsYXkgcm9vdE5vZGVcclxuICAvLyBjYW5ub3QgYmUgdHJhbnNmb3JtZWRcclxuICBwdWJsaWMgcmVhZG9ubHkgc2ltdWxhdGlvblJvb3QgPSBuZXcgTm9kZSgpO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgaW5wdXRGdXp6ZXI6IElucHV0RnV6emVyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkga2V5Ym9hcmRGdXp6ZXI6IEtleWJvYXJkRnV6emVyO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHN1cHBvcnRzUGFuQW5kWm9vbVByb3BlcnR5OiBUUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIEFkZCBhIGxpc3RlbmVyIHRvIHRoZSBEaXNwbGF5IHRoYXQgY29udHJvbHMgdmlzaWJpbGl0eSBvZiB2YXJpb3VzIGhpZ2hsaWdodHMgaW4gcmVzcG9uc2UgdG8gdXNlciBpbnB1dC5cclxuICBwcml2YXRlIHJlYWRvbmx5IGhpZ2hsaWdodFZpc2liaWxpdHlDb250cm9sbGVyOiBIaWdobGlnaHRWaXNpYmlsaXR5Q29udHJvbGxlcjtcclxuXHJcbiAgLy8gRm9yIGNvbnNpc3RlbnQgb3B0aW9uIGRlZmF1bHRzXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBERUZBVUxUX1dFQkdMID0gZmFsc2U7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zOiBTaW1EaXNwbGF5T3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFNpbURpc3BsYXlPcHRpb25zLCBTZWxmT3B0aW9ucywgRGlzcGxheU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIHRoZSBkZWZhdWx0IHJlbmRlcmVyIGZvciB0aGUgcm9vdE5vZGUsIHNlZSAjMjIxLCAjMTg0IGFuZCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbW9sYXJpdHkvaXNzdWVzLzI0XHJcbiAgICAgIHJvb3RSZW5kZXJlcjogJ3N2ZycsXHJcblxyXG4gICAgICAvLyBTaW1zIHRoYXQgZG8gbm90IHVzZSBXZWJHTCB0cmlnZ2VyIGEgfiAwLjUgc2Vjb25kIHBhdXNlIHNob3J0bHkgYWZ0ZXIgdGhlIHNpbSBzdGFydHMgdXAsIHNvIHNpbXMgbXVzdCBvcHQgaW4gdG9cclxuICAgICAgLy8gd2ViZ2wgc3VwcG9ydCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5L2lzc3Vlcy82MjFcclxuICAgICAgd2ViZ2w6IFNpbURpc3BsYXkuREVGQVVMVF9XRUJHTCxcclxuXHJcbiAgICAgIC8vIHtib29sZWFufSAtIFdoZXRoZXIgdG8gYWxsb3cgV2ViR0wgMnggc2NhbGluZyB3aGVuIGFudGlhbGlhc2luZyBpcyBkZXRlY3RlZC4gSWYgcnVubmluZyBvdXQgb2YgbWVtb3J5IG9uXHJcbiAgICAgIC8vIHRoaW5ncyBsaWtlIGlQYWQgMnMgKGUuZy4gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzg1OSksIHRoaXMgY2FuIGJlIHR1cm5lZCB0byBmYWxzZS5cclxuICAgICAgYWxsb3dCYWNraW5nU2NhbGVBbnRpYWxpYXNpbmc6IHRydWUsXHJcblxyXG4gICAgICAvLyBwcmV2ZW50IG92ZXJmbG93IHRoYXQgY2FuIGNhdXNlIGlPUyBidWdnaW5lc3MsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcGhldC1pby9pc3N1ZXMvMzQxXHJcbiAgICAgIGFsbG93U2NlbmVPdmVyZmxvdzogZmFsc2UsXHJcblxyXG4gICAgICAvLyBJbmRpY2F0ZSB3aGV0aGVyIHdlYmdsIGlzIGFsbG93ZWQgdG8gZmFjaWxpdGF0ZSB0ZXN0aW5nIG9uIG5vbi13ZWJnbCBwbGF0Zm9ybXMsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvMjg5XHJcbiAgICAgIGFsbG93V2ViR0w6IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMud2ViZ2wsXHJcbiAgICAgIGFzc3VtZUZ1bGxXaW5kb3c6IHRydWUsIC8vIGEgYml0IGZhc3RlciBpZiB3ZSBjYW4gYXNzdW1lIG5vIGNvb3JkaW5hdGUgdHJhbnNsYXRpb25zIGFyZSBuZWVkZWQgZm9yIHRoZSBkaXNwbGF5LlxyXG5cclxuICAgICAgZm9yY2VTVkdSZWZyZXNoOiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmZvcmNlU1ZHUmVmcmVzaCxcclxuXHJcbiAgICAgIC8vIHBkb20gYWNjZXNzaWJpbGl0eSAoaW50ZXJhY3RpdmUgZGVzY3JpcHRpb24pXHJcbiAgICAgIGFjY2Vzc2liaWxpdHk6IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc3VwcG9ydHNJbnRlcmFjdGl2ZURlc2NyaXB0aW9uLFxyXG5cclxuICAgICAgLy8gcGhldC1pb1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gU3VwcG9ydCBmb3IgSW50ZXJhY3RpdmUgSGlnaGxpZ2h0cyBkaWN0YXRlZCBieSB0aGUgcHJlZmVyZW5jZXMgbW9kZWwuXHJcbiAgICBvcHRpb25zLnN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzID0gb3B0aW9ucy5wcmVmZXJlbmNlc01vZGVsLnZpc3VhbE1vZGVsLnN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzO1xyXG5cclxuICAgIC8vIG92ZXJyaWRlIHJvb3RSZW5kZXJlciB1c2luZyBxdWVyeSBwYXJhbWV0ZXIsIHNlZSAjMjIxIGFuZCAjMTg0XHJcbiAgICBvcHRpb25zLnJvb3RSZW5kZXJlciA9IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMucm9vdFJlbmRlcmVyIHx8IG9wdGlvbnMucm9vdFJlbmRlcmVyO1xyXG5cclxuICAgIC8vIFN1cHBsaWVkIHF1ZXJ5IHBhcmFtZXRlcnMgb3ZlcnJpZGUgb3B0aW9ucyAoYnV0IGRlZmF1bHQgdmFsdWVzIGZvciBub24tc3VwcGxpZWQgcXVlcnkgcGFyYW1ldGVycyBkbyBub3QpLlxyXG4gICAgaWYgKCBRdWVyeVN0cmluZ01hY2hpbmUuY29udGFpbnNLZXkoICd3ZWJnbCcgKSApIHtcclxuICAgICAgb3B0aW9ucy53ZWJnbCA9IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMud2ViZ2w7XHJcbiAgICB9XHJcblxyXG4gICAgVXRpbHMuc2V0V2ViR0xFbmFibGVkKCBvcHRpb25zLndlYmdsICk7XHJcblxyXG4gICAgLy8gb3ZlcnJpZGUgd2luZG93Lm9wZW4gd2l0aCBhIHNlbWktQVBJLWNvbXBhdGlibGUgZnVuY3Rpb24sIHNvIGZ1enppbmcgZG9lc24ndCBvcGVuIG5ldyB3aW5kb3dzLlxyXG4gICAgaWYgKCBwaGV0LmNoaXBwZXIuaXNGdXp6RW5hYmxlZCgpICkge1xyXG5cclxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIGl0IGlzbid0IHlldCBjbGVhciBob3cgdG8gZGVmaW5lIG9iamVjdHMgdG8gd2luZG93IGp1c3QgeWV0XHJcbiAgICAgIHdpbmRvdy5vcGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIGZvY3VzOiBfLm5vb3AsXHJcbiAgICAgICAgICBibHVyOiBfLm5vb3BcclxuICAgICAgICB9O1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0ICRib2R5ID0gJCggJ2JvZHknICk7XHJcblxyXG4gICAgLy8gcHJldmVudCBzY3JvbGxiYXJzXHJcbiAgICAkYm9keS5jc3MoICdwYWRkaW5nJywgJzAnICkuY3NzKCAnbWFyZ2luJywgJzAnICkuY3NzKCAnb3ZlcmZsb3cnLCAnaGlkZGVuJyApO1xyXG5cclxuICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgc2ltIGRpdiBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgRE9NIHVuZGVyIHRoZSBib2R5LiBUaGlzIGlzIHRoZSBjYXNlIGZvciBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvMTc0IChpT1Mgb2ZmbGluZSByZWFkaW5nIGxpc3QpXHJcbiAgICBpZiAoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnc2ltJyApICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnc2ltJyApIS5wYXJlbnROb2RlID09PSBkb2N1bWVudC5ib2R5ICkge1xyXG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3NpbScgKSEgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcmV2ZW50cyBzZWxlY3Rpb24gY3Vyc29yIGlzc3VlcyBpbiBTYWZhcmksIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvNDc2XHJcbiAgICBkb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gZnVuY3Rpb24oKSB7IHJldHVybiBmYWxzZTsgfTtcclxuXHJcbiAgICBzdXBlciggbmV3IE5vZGUoIHsgcmVuZGVyZXI6IG9wdGlvbnMucm9vdFJlbmRlcmVyIH0gKSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuc2ltdWxhdGlvblJvb3QgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5yb290Tm9kZS5hZGRDaGlsZCggdGhpcy5zaW11bGF0aW9uUm9vdCApO1xyXG5cclxuICAgIC8vIFdvcmthcm91bmQgZm9yIENocm9tZSBTVkcgYnVncyB0aGF0IHNlZW0gdG8gaGFwcGVuIG9uIHBhbi16b29tLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzE1MDdcclxuICAgIC8vIERvbmUgaGVyZSBzbyB0aGF0IHdlIGRvbid0IHJlcXVpcmUgY29udGludWFsIHJlZnJlc2hlcy5cclxuICAgIGlmICggcGxhdGZvcm0uY2hyb21pdW0gKSB7XHJcbiAgICAgIHRoaXMuc2ltdWxhdGlvblJvb3QudHJhbnNmb3JtRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVmcmVzaFNWR09uTmV4dEZyYW1lKCk7XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZWVkaW5nIGJ5IGRlZmF1bHQgYSByYW5kb20gdmFsdWUgZm9yIHJlcHJvZHVjaWJsZSBmdXp6ZXMgaWYgZGVzaXJlZFxyXG4gICAgY29uc3QgZnV6emVyU2VlZCA9IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMucmFuZG9tU2VlZCAqIE1hdGguUEk7XHJcblxyXG4gICAgdGhpcy5pbnB1dEZ1enplciA9IG5ldyBJbnB1dEZ1enplciggdGhpcywgZnV6emVyU2VlZCApO1xyXG4gICAgdGhpcy5rZXlib2FyZEZ1enplciA9IG5ldyBLZXlib2FyZEZ1enplciggdGhpcywgZnV6emVyU2VlZCApO1xyXG5cclxuICAgIHRoaXMuc3VwcG9ydHNQYW5BbmRab29tUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnN1cHBvcnRzUGFuQW5kWm9vbSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3N1cHBvcnRzUGFuQW5kWm9vbVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9GZWF0dXJlZDogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZG9tRWxlbWVudC5pZCA9ICdzaW0nO1xyXG5cclxuICAgIGlmICggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zdXBwb3J0c0ludGVyYWN0aXZlRGVzY3JpcHRpb24gKSB7XHJcblxyXG4gICAgICAvLyBmb3Igbm93IGludGVyYWN0aXZlIGRlc2NyaXB0aW9uIGlzIG9ubHkgaW4gRW5nbGlzaFxyXG4gICAgICAvLyBOT1RFOiBXaGVuIHRyYW5zbGF0YWJsZSB0aGlzIHdpbGwgbmVlZCB0byB1cGRhdGUgd2l0aCBsYW5ndWFnZSwgY2hhbmdlIHRvIHBoZXQuY2hpcHBlci5sb2NhbFxyXG4gICAgICB0aGlzLnBkb21Sb290RWxlbWVudCEubGFuZyA9ICdlbic7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5oaWdobGlnaHRWaXNpYmlsaXR5Q29udHJvbGxlciA9IG5ldyBIaWdobGlnaHRWaXNpYmlsaXR5Q29udHJvbGxlciggdGhpcywgb3B0aW9ucy5wcmVmZXJlbmNlc01vZGVsICk7XHJcblxyXG4gICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNjZW5lcnlMb2cgKSB7XHJcblxyXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gdW50aWwgc2NlbmVyeS5qcyBpcyBjb252ZXJ0ZWQgdG8gdHlwZXNjcmlwdCwgd2hpY2ggaXMgbm9uLXRyaXZpYWwgKEkgdHJpZWQpXHJcbiAgICAgIHNjZW5lcnkuZW5hYmxlTG9nZ2luZyggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zY2VuZXJ5TG9nICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNjZW5lcnlTdHJpbmdMb2cgKSB7XHJcblxyXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gdW50aWwgc2NlbmVyeS5qcyBpcyBjb252ZXJ0ZWQgdG8gdHlwZXNjcmlwdCwgd2hpY2ggaXMgbm9uLXRyaXZpYWwgKEkgdHJpZWQpXHJcbiAgICAgIHNjZW5lcnkuc3dpdGNoTG9nVG9TdHJpbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NoaXBwZXIvaXNzdWVzLzEzMTlcclxuICAgIGlmICggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zdHJpbmdUZXN0ID09PSAnZHluYW1pYycgKSB7XHJcbiAgICAgIGNvbnN0IGR5bmFtaWNTdHJpbmdUZXN0ID0gbmV3IER5bmFtaWNTdHJpbmdUZXN0KCk7XHJcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIGV2ZW50ID0+IGR5bmFtaWNTdHJpbmdUZXN0LmhhbmRsZUV2ZW50KCBldmVudCApICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5pbml0aWFsaXplRXZlbnRzKCB7XHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLkdFTkVSQUxfQ09OVFJPTExFUi5jcmVhdGVUYW5kZW0oICdpbnB1dCcgKVxyXG4gICAgfSApOyAvLyBzZXRzIHVwIGxpc3RlbmVycyBvbiB0aGUgZG9jdW1lbnQgd2l0aCBwcmV2ZW50RGVmYXVsdCgpLCBhbmQgZm9yd2FyZHMgdGhvc2UgZXZlbnRzIHRvIG91ciBzY2VuZVxyXG5cclxuICAgIHdpbmRvdy5waGV0LmpvaXN0LnJvb3ROb2RlID0gdGhpcy5yb290Tm9kZTsgLy8gbWFrZSB0aGUgc2NlbmUgYXZhaWxhYmxlIGZvciBkZWJ1Z2dpbmdcclxuICAgIHdpbmRvdy5waGV0LmpvaXN0LmRpc3BsYXkgPSB0aGlzOyAvLyBtYWtlIHRoZSBkaXNwbGF5IGF2YWlsYWJsZSBmb3IgZGVidWdnaW5nXHJcblxyXG4gICAgLy8gUGFzcyB0aHJvdWdoIHF1ZXJ5IHBhcmFtZXRlcnMgdG8gc2NlbmVyeSBmb3Igc2hvd2luZyBzdXBwbGVtZW50YWwgaW5mb3JtYXRpb25cclxuICAgIHRoaXMuc2V0UG9pbnRlckRpc3BsYXlWaXNpYmxlKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNob3dQb2ludGVycyApO1xyXG4gICAgdGhpcy5zZXRQb2ludGVyQXJlYURpc3BsYXlWaXNpYmxlKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNob3dQb2ludGVyQXJlYXMgKTtcclxuICAgIHRoaXMuc2V0SGl0QXJlYURpc3BsYXlWaXNpYmxlKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNob3dIaXRBcmVhcyApO1xyXG4gICAgdGhpcy5zZXRDYW52YXNOb2RlQm91bmRzVmlzaWJsZSggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zaG93Q2FudmFzTm9kZUJvdW5kcyApO1xyXG4gICAgdGhpcy5zZXRGaXR0ZWRCbG9ja0JvdW5kc1Zpc2libGUoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc2hvd0ZpdHRlZEJsb2NrQm91bmRzICk7XHJcblxyXG4gICAgLy8gbWFnbmlmaWNhdGlvbiBzdXBwb3J0IC0gYWx3YXlzIGluaXRpYWxpemVkIGZvciBjb25zaXN0ZW50IFBoRVQtaU8gQVBJLCBidXQgb25seSBjb25kaXRpb25hbGx5IGFkZGVkIHRvIERpc3BsYXlcclxuICAgIGFuaW1hdGVkUGFuWm9vbVNpbmdsZXRvbi5pbml0aWFsaXplKCB0aGlzLnNpbXVsYXRpb25Sb290LCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncGFuWm9vbUxpc3RlbmVyJyApXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBhbmltYXRlZFBhblpvb21MaXN0ZW5lciA9IGFuaW1hdGVkUGFuWm9vbVNpbmdsZXRvbi5saXN0ZW5lcjtcclxuXHJcbiAgICB0aGlzLnN1cHBvcnRzUGFuQW5kWm9vbVByb3BlcnR5LmxpbmsoIHN1cHBvcnRlZCA9PiB7XHJcbiAgICAgIGlmICggc3VwcG9ydGVkICkge1xyXG4gICAgICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggYW5pbWF0ZWRQYW5ab29tTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggdGhpcy5oYXNJbnB1dExpc3RlbmVyKCBhbmltYXRlZFBhblpvb21MaXN0ZW5lciApICkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlSW5wdXRMaXN0ZW5lciggYW5pbWF0ZWRQYW5ab29tTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIElmIHRoZSBwYWdlIGlzIGxvYWRlZCBmcm9tIHRoZSBiYWNrLWZvcndhcmQgY2FjaGUsIHRoZW4gcmVsb2FkIHRoZSBwYWdlIHRvIGF2b2lkIGJ1Z2dpbmVzcyxcclxuICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvam9pc3QvaXNzdWVzLzQ0OFxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICdwYWdlc2hvdycsIGV2ZW50ID0+IHtcclxuICAgICAgaWYgKCBldmVudC5wZXJzaXN0ZWQgKSB7XHJcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIYW5kbGUgc3ludGhldGljIGlucHV0IGV2ZW50IGZ1enppbmdcclxuICAgKi9cclxuICBwdWJsaWMgZnV6eklucHV0RXZlbnRzKCk6IHZvaWQge1xyXG5cclxuICAgIC8vIElmIGZ1enogcGFyYW1ldGVyIGlzIHVzZWQgdGhlbiBmdXp6VG91Y2ggYW5kIGZ1enpNb3VzZSBldmVudHMgc2hvdWxkIGJlIGZpcmVkXHJcbiAgICBjb25zdCBmdXp6VG91Y2ggPSBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmZ1enpUb3VjaCB8fCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmZ1eno7XHJcbiAgICBjb25zdCBmdXp6TW91c2UgPSBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmZ1enpNb3VzZSB8fCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmZ1eno7XHJcblxyXG4gICAgLy8gZmlyZSBvciBzeW50aGVzaXplIGlucHV0IGV2ZW50c1xyXG4gICAgaWYgKCBmdXp6TW91c2UgfHwgZnV6elRvdWNoICkge1xyXG4gICAgICB0aGlzLmlucHV0RnV6emVyLmZ1enpFdmVudHMoXHJcbiAgICAgICAgcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5mdXp6UmF0ZSxcclxuICAgICAgICBmdXp6TW91c2UsXHJcbiAgICAgICAgZnV6elRvdWNoLFxyXG4gICAgICAgIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuZnV6elBvaW50ZXJzXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZmlyZSBvciBzeW50aGVzaXplIGtleWJvYXJkIGlucHV0IGV2ZW50c1xyXG4gICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmZ1enpCb2FyZCAmJiBkb2N1bWVudC5oYXNGb2N1cygpICkge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnN1cHBvcnRzSW50ZXJhY3RpdmVEZXNjcmlwdGlvbiwgJ2Z1enpCb2FyZCBjYW4gb25seSBydW4gd2l0aCBpbnRlcmFjdGl2ZSBkZXNjcmlwdGlvbiBlbmFibGVkLicgKTtcclxuICAgICAgdGhpcy5rZXlib2FyZEZ1enplci5mdXp6Qm9hcmRFdmVudHMoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuZnV6elJhdGUgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgaWYgKCB0aGlzLnN1cHBvcnRzUGFuQW5kWm9vbVByb3BlcnR5LnZhbHVlICkge1xyXG5cclxuICAgICAgLy8gYW5pbWF0ZSB0aGUgUGFuWm9vbUxpc3RlbmVyLCBmb3Igc21vb3RoIHBhbm5pbmcvc2NhbGluZ1xyXG4gICAgICBhbmltYXRlZFBhblpvb21TaW5nbGV0b24ubGlzdGVuZXIuc3RlcCggZHQgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmpvaXN0LnJlZ2lzdGVyKCAnU2ltRGlzcGxheScsIFNpbURpc3BsYXkgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSxrQ0FBa0M7QUFFOUQsT0FBT0MsaUJBQWlCLE1BQU0sd0JBQXdCO0FBQ3RELE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFFdkQsU0FBU0Msd0JBQXdCLEVBQUVDLE9BQU8s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