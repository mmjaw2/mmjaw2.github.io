// Copyright 2013-2024, University of Colorado Boulder

/**
 * Displays a DOM element directly in a node, so that it can be positioned/transformed properly, and bounds are handled properly in Scenery.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Bounds2 from '../../../dot/js/Bounds2.js';
import extendDefined from '../../../phet-core/js/extendDefined.js';
import { DOMDrawable, Node, Renderer, scenery } from '../imports.js';
const DOM_OPTION_KEYS = ['element', 'preventTransform', 'allowInput'];
// User-defined type guard
const isJQueryElement = element => !!(element && element.jquery);
export default class DOM extends Node {
  // Container div that will have our main element as a child (so we can position and mutate it).
  // scenery-internal

  // jQuery selection so that we can properly determine size information

  // Flag that indicates whether we are updating/invalidating ourself due to changes to the DOM element. The flag is
  // needed so that updates to our element that we make in the update/invalidate section doesn't trigger an infinite
  // loop with another update.

  // Flag that when true won't let Scenery apply a transform directly (the client will take care of that).

  // Whether we allow input to be received by the DOM element

  /**
   * @param element - The HTML element, or a jQuery selector result.
   * @param [options] - DOM-specific options are documented in DOM_OPTION_KEYS above, and can be provided
   *                             along-side options for Node
   */
  constructor(element, options) {
    assert && assert(options === undefined || Object.getPrototypeOf(options) === Object.prototype, 'Extra prototype on Node options object is a code smell');
    assert && assert(element instanceof window.Element || element.jquery, 'DOM nodes need to be passed an HTML/DOM element or a jQuery selection like $( ... )');

    // unwrap from jQuery if that is passed in, for consistency
    if (isJQueryElement(element)) {
      element = element[0];
      assert && assert(element instanceof window.Element);
    }
    super();
    this._container = document.createElement('div');
    this._container.style.position = 'absolute';
    this._container.style.left = '0';
    this._container.style.top = '0';
    this._allowInput = false;
    this._$container = $(this._container);
    this.invalidateDOMLock = false;
    this._preventTransform = false;
    this.invalidateAllowInput(this._allowInput);

    // Have mutate() call setElement() in the proper order
    options = extendDefined({
      element: element
    }, options);

    // will set the element after initializing
    this.mutate(options);

    // Only renderer supported, no need to dynamically compute
    this.setRendererBitmask(Renderer.bitmaskDOM);
  }

  /**
   * Computes the bounds of our current DOM element (using jQuery, as replacing this with other things seems a bit
   * bug-prone and has caused issues in the past).
   *
   * The dom element needs to be attached to the DOM tree in order for this to work.
   *
   * Alternative getBoundingClientRect explored, but did not seem sufficient (possibly due to CSS transforms)?
   */
  calculateDOMBounds() {
    const $element = $(this._element);
    return new Bounds2(0, 0, $element.width(), $element.height());
  }

  /**
   * Triggers recomputation of our DOM element's bounds.
   *
   * This should be called after the DOM element's bounds may have changed, to properly update the bounding box
   * in Scenery.
   */
  invalidateDOM() {
    // prevent this from being executed as a side-effect from inside one of its own calls
    if (this.invalidateDOMLock) {
      return;
    }
    this.invalidateDOMLock = true;

    // we will place ourselves in a temporary container to get our real desired bounds
    const temporaryContainer = document.createElement('div');
    $(temporaryContainer).css({
      display: 'hidden',
      padding: '0 !important',
      margin: '0 !important',
      position: 'absolute',
      left: 0,
      top: 0,
      width: 65535,
      height: 65535
    });

    // move to the temporary container
    this._container.removeChild(this._element);
    temporaryContainer.appendChild(this._element);
    document.body.appendChild(temporaryContainer);

    // bounds computation and resize our container to fit precisely
    const selfBounds = this.calculateDOMBounds();
    this.invalidateSelf(selfBounds);
    this._$container.width(selfBounds.getWidth());
    this._$container.height(selfBounds.getHeight());

    // move back to the main container
    document.body.removeChild(temporaryContainer);
    temporaryContainer.removeChild(this._element);
    this._container.appendChild(this._element);

    // unlock
    this.invalidateDOMLock = false;
  }

  /**
   * Creates a DOM drawable for this DOM node. (scenery-internal)
   *
   * @param renderer - In the bitmask format specified by Renderer, which may contain additional bit flags.
   * @param instance - Instance object that will be associated with the drawable
   */
  createDOMDrawable(renderer, instance) {
    // @ts-expect-error Poolable
    return DOMDrawable.createFromPool(renderer, instance);
  }

  /**
   * Whether this Node itself is painted (displays something itself).
   */
  isPainted() {
    // Always true for DOM nodes
    return true;
  }

  /**
   * Changes the DOM element of this DOM node to another element.
   */
  setElement(element) {
    assert && assert(!this._element, 'We should only ever attach one DOMElement to a DOM node');
    if (this._element !== element) {
      if (this._element) {
        this._container.removeChild(this._element);
      }
      this._element = element;
      this._container.appendChild(this._element);
      this.invalidateDOM();
    }
    return this; // allow chaining
  }
  set element(value) {
    this.setElement(value);
  }
  get element() {
    return this.getElement();
  }

  /**
   * Returns the DOM element being displayed by this DOM node.
   */
  getElement() {
    return this._element;
  }

  /**
   * Sets the value of the preventTransform flag.
   *
   * When the preventTransform flag is set to true, Scenery will not reposition (CSS transform) the DOM element, but
   * instead it will be at the upper-left (0,0) of the Scenery Display. The client will be responsible for sizing or
   * positioning this element instead.
   */
  setPreventTransform(preventTransform) {
    if (this._preventTransform !== preventTransform) {
      this._preventTransform = preventTransform;
    }
  }
  set preventTransform(value) {
    this.setPreventTransform(value);
  }
  get preventTransform() {
    return this.isTransformPrevented();
  }

  /**
   * Returns the value of the preventTransform flag.
   *
   * See the setPreventTransform documentation for more information on the flag.
   */
  isTransformPrevented() {
    return this._preventTransform;
  }

  /**
   * Sets whether input is allowed for the DOM element. If false, we will disable input events with pointerEvents and
   * the usual preventDefault(). If true, we'll set a flag internally so that we don't preventDefault() on input events.
   */
  setAllowInput(allowInput) {
    if (this._allowInput !== allowInput) {
      this._allowInput = allowInput;
      this.invalidateAllowInput(allowInput);
    }
  }
  isInputAllowed() {
    return this._allowInput;
  }
  invalidateAllowInput(allowInput) {
    this._container.dataset.sceneryAllowInput = allowInput ? 'true' : 'false';
    this._container.style.pointerEvents = allowInput ? 'auto' : 'none';
  }
  set allowInput(value) {
    this.setAllowInput(value);
  }
  get allowInput() {
    return this.isInputAllowed();
  }
  mutate(options) {
    return super.mutate(options);
  }
}

/**
 * {Array.<string>} - String keys for all of the allowed options that will be set by node.mutate( options ), in the
 * order they will be evaluated in.
 *
 * NOTE: See Node's _mutatorKeys documentation for more information on how this operates, and potential special
 *       cases that may apply.
 */
DOM.prototype._mutatorKeys = DOM_OPTION_KEYS.concat(Node.prototype._mutatorKeys);
scenery.register('DOM', DOM);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiZXh0ZW5kRGVmaW5lZCIsIkRPTURyYXdhYmxlIiwiTm9kZSIsIlJlbmRlcmVyIiwic2NlbmVyeSIsIkRPTV9PUFRJT05fS0VZUyIsImlzSlF1ZXJ5RWxlbWVudCIsImVsZW1lbnQiLCJqcXVlcnkiLCJET00iLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJhc3NlcnQiLCJ1bmRlZmluZWQiLCJPYmplY3QiLCJnZXRQcm90b3R5cGVPZiIsInByb3RvdHlwZSIsIndpbmRvdyIsIkVsZW1lbnQiLCJfY29udGFpbmVyIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic3R5bGUiLCJwb3NpdGlvbiIsImxlZnQiLCJ0b3AiLCJfYWxsb3dJbnB1dCIsIl8kY29udGFpbmVyIiwiJCIsImludmFsaWRhdGVET01Mb2NrIiwiX3ByZXZlbnRUcmFuc2Zvcm0iLCJpbnZhbGlkYXRlQWxsb3dJbnB1dCIsIm11dGF0ZSIsInNldFJlbmRlcmVyQml0bWFzayIsImJpdG1hc2tET00iLCJjYWxjdWxhdGVET01Cb3VuZHMiLCIkZWxlbWVudCIsIl9lbGVtZW50Iiwid2lkdGgiLCJoZWlnaHQiLCJpbnZhbGlkYXRlRE9NIiwidGVtcG9yYXJ5Q29udGFpbmVyIiwiY3NzIiwiZGlzcGxheSIsInBhZGRpbmciLCJtYXJnaW4iLCJyZW1vdmVDaGlsZCIsImFwcGVuZENoaWxkIiwiYm9keSIsInNlbGZCb3VuZHMiLCJpbnZhbGlkYXRlU2VsZiIsImdldFdpZHRoIiwiZ2V0SGVpZ2h0IiwiY3JlYXRlRE9NRHJhd2FibGUiLCJyZW5kZXJlciIsImluc3RhbmNlIiwiY3JlYXRlRnJvbVBvb2wiLCJpc1BhaW50ZWQiLCJzZXRFbGVtZW50IiwidmFsdWUiLCJnZXRFbGVtZW50Iiwic2V0UHJldmVudFRyYW5zZm9ybSIsInByZXZlbnRUcmFuc2Zvcm0iLCJpc1RyYW5zZm9ybVByZXZlbnRlZCIsInNldEFsbG93SW5wdXQiLCJhbGxvd0lucHV0IiwiaXNJbnB1dEFsbG93ZWQiLCJkYXRhc2V0Iiwic2NlbmVyeUFsbG93SW5wdXQiLCJwb2ludGVyRXZlbnRzIiwiX211dGF0b3JLZXlzIiwiY29uY2F0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJET00udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogRGlzcGxheXMgYSBET00gZWxlbWVudCBkaXJlY3RseSBpbiBhIG5vZGUsIHNvIHRoYXQgaXQgY2FuIGJlIHBvc2l0aW9uZWQvdHJhbnNmb3JtZWQgcHJvcGVybHksIGFuZCBib3VuZHMgYXJlIGhhbmRsZWQgcHJvcGVybHkgaW4gU2NlbmVyeS5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IGV4dGVuZERlZmluZWQgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL2V4dGVuZERlZmluZWQuanMnO1xyXG5pbXBvcnQgeyBET01EcmF3YWJsZSwgRE9NU2VsZkRyYXdhYmxlLCBJbnN0YW5jZSwgTm9kZSwgTm9kZU9wdGlvbnMsIFJlbmRlcmVyLCBzY2VuZXJ5IH0gZnJvbSAnLi4vaW1wb3J0cy5qcyc7XHJcblxyXG5jb25zdCBET01fT1BUSU9OX0tFWVMgPSBbXHJcbiAgJ2VsZW1lbnQnLFxyXG4gICdwcmV2ZW50VHJhbnNmb3JtJyxcclxuICAnYWxsb3dJbnB1dCdcclxuXTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgLy8gU2V0cyB0aGUgZWxlbWVudCwgc2VlIHNldEVsZW1lbnQoKSBmb3IgbW9yZSBkb2N1bWVudGF0aW9uXHJcbiAgZWxlbWVudD86IEVsZW1lbnQ7XHJcblxyXG4gIC8vIFNldHMgd2hldGhlciBTY2VuZXJ5IGlzIGFsbG93ZWQgdG8gdHJhbnNmb3JtIHRoZSBlbGVtZW50LiBzZWUgc2V0UHJldmVudFRyYW5zZm9ybSgpIGZvciBkb2NzXHJcbiAgcHJldmVudFRyYW5zZm9ybT86IGJvb2xlYW47XHJcblxyXG4gIC8vIFdoZXRoZXIgd2UgYWxsb3cgaW5wdXQgdG8gYmUgcmVjZWl2ZWQgYnkgdGhlIERPTSBlbGVtZW50XHJcbiAgYWxsb3dJbnB1dD86IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBET01PcHRpb25zID0gU2VsZk9wdGlvbnMgJiBOb2RlT3B0aW9ucztcclxuXHJcbi8vIFVzZXItZGVmaW5lZCB0eXBlIGd1YXJkXHJcbmNvbnN0IGlzSlF1ZXJ5RWxlbWVudCA9ICggZWxlbWVudDogRWxlbWVudCB8IEpRdWVyeSApOiBlbGVtZW50IGlzIEpRdWVyeSA9PiAhISggZWxlbWVudCAmJiAoIGVsZW1lbnQgYXMgSlF1ZXJ5ICkuanF1ZXJ5ICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBET00gZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHJpdmF0ZSBfZWxlbWVudCE6IEhUTUxFbGVtZW50O1xyXG5cclxuICAvLyBDb250YWluZXIgZGl2IHRoYXQgd2lsbCBoYXZlIG91ciBtYWluIGVsZW1lbnQgYXMgYSBjaGlsZCAoc28gd2UgY2FuIHBvc2l0aW9uIGFuZCBtdXRhdGUgaXQpLlxyXG4gIHB1YmxpYyByZWFkb25seSBfY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudDsgLy8gc2NlbmVyeS1pbnRlcm5hbFxyXG5cclxuICAvLyBqUXVlcnkgc2VsZWN0aW9uIHNvIHRoYXQgd2UgY2FuIHByb3Blcmx5IGRldGVybWluZSBzaXplIGluZm9ybWF0aW9uXHJcbiAgcHJpdmF0ZSByZWFkb25seSBfJGNvbnRhaW5lcjogSlF1ZXJ5PEhUTUxEaXZFbGVtZW50PjtcclxuXHJcbiAgLy8gRmxhZyB0aGF0IGluZGljYXRlcyB3aGV0aGVyIHdlIGFyZSB1cGRhdGluZy9pbnZhbGlkYXRpbmcgb3Vyc2VsZiBkdWUgdG8gY2hhbmdlcyB0byB0aGUgRE9NIGVsZW1lbnQuIFRoZSBmbGFnIGlzXHJcbiAgLy8gbmVlZGVkIHNvIHRoYXQgdXBkYXRlcyB0byBvdXIgZWxlbWVudCB0aGF0IHdlIG1ha2UgaW4gdGhlIHVwZGF0ZS9pbnZhbGlkYXRlIHNlY3Rpb24gZG9lc24ndCB0cmlnZ2VyIGFuIGluZmluaXRlXHJcbiAgLy8gbG9vcCB3aXRoIGFub3RoZXIgdXBkYXRlLlxyXG4gIHByaXZhdGUgaW52YWxpZGF0ZURPTUxvY2s6IGJvb2xlYW47XHJcblxyXG4gIC8vIEZsYWcgdGhhdCB3aGVuIHRydWUgd29uJ3QgbGV0IFNjZW5lcnkgYXBwbHkgYSB0cmFuc2Zvcm0gZGlyZWN0bHkgKHRoZSBjbGllbnQgd2lsbCB0YWtlIGNhcmUgb2YgdGhhdCkuXHJcbiAgcHJpdmF0ZSBfcHJldmVudFRyYW5zZm9ybTogYm9vbGVhbjtcclxuXHJcbiAgLy8gV2hldGhlciB3ZSBhbGxvdyBpbnB1dCB0byBiZSByZWNlaXZlZCBieSB0aGUgRE9NIGVsZW1lbnRcclxuICBwcml2YXRlIF9hbGxvd0lucHV0OiBib29sZWFuO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gZWxlbWVudCAtIFRoZSBIVE1MIGVsZW1lbnQsIG9yIGEgalF1ZXJ5IHNlbGVjdG9yIHJlc3VsdC5cclxuICAgKiBAcGFyYW0gW29wdGlvbnNdIC0gRE9NLXNwZWNpZmljIG9wdGlvbnMgYXJlIGRvY3VtZW50ZWQgaW4gRE9NX09QVElPTl9LRVlTIGFib3ZlLCBhbmQgY2FuIGJlIHByb3ZpZGVkXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsb25nLXNpZGUgb3B0aW9ucyBmb3IgTm9kZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggZWxlbWVudDogRWxlbWVudCB8IEpRdWVyeSwgb3B0aW9ucz86IERPTU9wdGlvbnMgKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zID09PSB1bmRlZmluZWQgfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKCBvcHRpb25zICkgPT09IE9iamVjdC5wcm90b3R5cGUsXHJcbiAgICAgICdFeHRyYSBwcm90b3R5cGUgb24gTm9kZSBvcHRpb25zIG9iamVjdCBpcyBhIGNvZGUgc21lbGwnICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZWxlbWVudCBpbnN0YW5jZW9mIHdpbmRvdy5FbGVtZW50IHx8IGVsZW1lbnQuanF1ZXJ5LCAnRE9NIG5vZGVzIG5lZWQgdG8gYmUgcGFzc2VkIGFuIEhUTUwvRE9NIGVsZW1lbnQgb3IgYSBqUXVlcnkgc2VsZWN0aW9uIGxpa2UgJCggLi4uICknICk7XHJcblxyXG4gICAgLy8gdW53cmFwIGZyb20galF1ZXJ5IGlmIHRoYXQgaXMgcGFzc2VkIGluLCBmb3IgY29uc2lzdGVuY3lcclxuICAgIGlmICggaXNKUXVlcnlFbGVtZW50KCBlbGVtZW50ICkgKSB7XHJcbiAgICAgIGVsZW1lbnQgPSBlbGVtZW50WyAwIF07XHJcblxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBlbGVtZW50IGluc3RhbmNlb2Ygd2luZG93LkVsZW1lbnQgKTtcclxuICAgIH1cclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7XHJcbiAgICB0aGlzLl9jb250YWluZXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnN0eWxlLmxlZnQgPSAnMCc7XHJcbiAgICB0aGlzLl9jb250YWluZXIuc3R5bGUudG9wID0gJzAnO1xyXG4gICAgdGhpcy5fYWxsb3dJbnB1dCA9IGZhbHNlO1xyXG5cclxuICAgIHRoaXMuXyRjb250YWluZXIgPSAkKCB0aGlzLl9jb250YWluZXIgKTtcclxuXHJcbiAgICB0aGlzLmludmFsaWRhdGVET01Mb2NrID0gZmFsc2U7XHJcbiAgICB0aGlzLl9wcmV2ZW50VHJhbnNmb3JtID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5pbnZhbGlkYXRlQWxsb3dJbnB1dCggdGhpcy5fYWxsb3dJbnB1dCApO1xyXG5cclxuICAgIC8vIEhhdmUgbXV0YXRlKCkgY2FsbCBzZXRFbGVtZW50KCkgaW4gdGhlIHByb3BlciBvcmRlclxyXG4gICAgb3B0aW9ucyA9IGV4dGVuZERlZmluZWQ8RE9NT3B0aW9ucz4oIHtcclxuICAgICAgZWxlbWVudDogZWxlbWVudFxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIHdpbGwgc2V0IHRoZSBlbGVtZW50IGFmdGVyIGluaXRpYWxpemluZ1xyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBPbmx5IHJlbmRlcmVyIHN1cHBvcnRlZCwgbm8gbmVlZCB0byBkeW5hbWljYWxseSBjb21wdXRlXHJcbiAgICB0aGlzLnNldFJlbmRlcmVyQml0bWFzayggUmVuZGVyZXIuYml0bWFza0RPTSApO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXB1dGVzIHRoZSBib3VuZHMgb2Ygb3VyIGN1cnJlbnQgRE9NIGVsZW1lbnQgKHVzaW5nIGpRdWVyeSwgYXMgcmVwbGFjaW5nIHRoaXMgd2l0aCBvdGhlciB0aGluZ3Mgc2VlbXMgYSBiaXRcclxuICAgKiBidWctcHJvbmUgYW5kIGhhcyBjYXVzZWQgaXNzdWVzIGluIHRoZSBwYXN0KS5cclxuICAgKlxyXG4gICAqIFRoZSBkb20gZWxlbWVudCBuZWVkcyB0byBiZSBhdHRhY2hlZCB0byB0aGUgRE9NIHRyZWUgaW4gb3JkZXIgZm9yIHRoaXMgdG8gd29yay5cclxuICAgKlxyXG4gICAqIEFsdGVybmF0aXZlIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBleHBsb3JlZCwgYnV0IGRpZCBub3Qgc2VlbSBzdWZmaWNpZW50IChwb3NzaWJseSBkdWUgdG8gQ1NTIHRyYW5zZm9ybXMpP1xyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjYWxjdWxhdGVET01Cb3VuZHMoKTogQm91bmRzMiB7XHJcbiAgICBjb25zdCAkZWxlbWVudCA9ICQoIHRoaXMuX2VsZW1lbnQgKTtcclxuICAgIHJldHVybiBuZXcgQm91bmRzMiggMCwgMCwgJGVsZW1lbnQud2lkdGgoKSEsICRlbGVtZW50LmhlaWdodCgpISApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJpZ2dlcnMgcmVjb21wdXRhdGlvbiBvZiBvdXIgRE9NIGVsZW1lbnQncyBib3VuZHMuXHJcbiAgICpcclxuICAgKiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgdGhlIERPTSBlbGVtZW50J3MgYm91bmRzIG1heSBoYXZlIGNoYW5nZWQsIHRvIHByb3Blcmx5IHVwZGF0ZSB0aGUgYm91bmRpbmcgYm94XHJcbiAgICogaW4gU2NlbmVyeS5cclxuICAgKi9cclxuICBwdWJsaWMgaW52YWxpZGF0ZURPTSgpOiB2b2lkIHtcclxuICAgIC8vIHByZXZlbnQgdGhpcyBmcm9tIGJlaW5nIGV4ZWN1dGVkIGFzIGEgc2lkZS1lZmZlY3QgZnJvbSBpbnNpZGUgb25lIG9mIGl0cyBvd24gY2FsbHNcclxuICAgIGlmICggdGhpcy5pbnZhbGlkYXRlRE9NTG9jayApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbnZhbGlkYXRlRE9NTG9jayA9IHRydWU7XHJcblxyXG4gICAgLy8gd2Ugd2lsbCBwbGFjZSBvdXJzZWx2ZXMgaW4gYSB0ZW1wb3JhcnkgY29udGFpbmVyIHRvIGdldCBvdXIgcmVhbCBkZXNpcmVkIGJvdW5kc1xyXG4gICAgY29uc3QgdGVtcG9yYXJ5Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTtcclxuICAgICQoIHRlbXBvcmFyeUNvbnRhaW5lciApLmNzcygge1xyXG4gICAgICBkaXNwbGF5OiAnaGlkZGVuJyxcclxuICAgICAgcGFkZGluZzogJzAgIWltcG9ydGFudCcsXHJcbiAgICAgIG1hcmdpbjogJzAgIWltcG9ydGFudCcsXHJcbiAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxyXG4gICAgICBsZWZ0OiAwLFxyXG4gICAgICB0b3A6IDAsXHJcbiAgICAgIHdpZHRoOiA2NTUzNSxcclxuICAgICAgaGVpZ2h0OiA2NTUzNVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIG1vdmUgdG8gdGhlIHRlbXBvcmFyeSBjb250YWluZXJcclxuICAgIHRoaXMuX2NvbnRhaW5lci5yZW1vdmVDaGlsZCggdGhpcy5fZWxlbWVudCApO1xyXG4gICAgdGVtcG9yYXJ5Q29udGFpbmVyLmFwcGVuZENoaWxkKCB0aGlzLl9lbGVtZW50ICk7XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCB0ZW1wb3JhcnlDb250YWluZXIgKTtcclxuXHJcbiAgICAvLyBib3VuZHMgY29tcHV0YXRpb24gYW5kIHJlc2l6ZSBvdXIgY29udGFpbmVyIHRvIGZpdCBwcmVjaXNlbHlcclxuICAgIGNvbnN0IHNlbGZCb3VuZHMgPSB0aGlzLmNhbGN1bGF0ZURPTUJvdW5kcygpO1xyXG4gICAgdGhpcy5pbnZhbGlkYXRlU2VsZiggc2VsZkJvdW5kcyApO1xyXG4gICAgdGhpcy5fJGNvbnRhaW5lci53aWR0aCggc2VsZkJvdW5kcy5nZXRXaWR0aCgpICk7XHJcbiAgICB0aGlzLl8kY29udGFpbmVyLmhlaWdodCggc2VsZkJvdW5kcy5nZXRIZWlnaHQoKSApO1xyXG5cclxuICAgIC8vIG1vdmUgYmFjayB0byB0aGUgbWFpbiBjb250YWluZXJcclxuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoIHRlbXBvcmFyeUNvbnRhaW5lciApO1xyXG4gICAgdGVtcG9yYXJ5Q29udGFpbmVyLnJlbW92ZUNoaWxkKCB0aGlzLl9lbGVtZW50ICk7XHJcbiAgICB0aGlzLl9jb250YWluZXIuYXBwZW5kQ2hpbGQoIHRoaXMuX2VsZW1lbnQgKTtcclxuXHJcbiAgICAvLyB1bmxvY2tcclxuICAgIHRoaXMuaW52YWxpZGF0ZURPTUxvY2sgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBET00gZHJhd2FibGUgZm9yIHRoaXMgRE9NIG5vZGUuIChzY2VuZXJ5LWludGVybmFsKVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHJlbmRlcmVyIC0gSW4gdGhlIGJpdG1hc2sgZm9ybWF0IHNwZWNpZmllZCBieSBSZW5kZXJlciwgd2hpY2ggbWF5IGNvbnRhaW4gYWRkaXRpb25hbCBiaXQgZmxhZ3MuXHJcbiAgICogQHBhcmFtIGluc3RhbmNlIC0gSW5zdGFuY2Ugb2JqZWN0IHRoYXQgd2lsbCBiZSBhc3NvY2lhdGVkIHdpdGggdGhlIGRyYXdhYmxlXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGNyZWF0ZURPTURyYXdhYmxlKCByZW5kZXJlcjogbnVtYmVyLCBpbnN0YW5jZTogSW5zdGFuY2UgKTogRE9NU2VsZkRyYXdhYmxlIHtcclxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgUG9vbGFibGVcclxuICAgIHJldHVybiBET01EcmF3YWJsZS5jcmVhdGVGcm9tUG9vbCggcmVuZGVyZXIsIGluc3RhbmNlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXaGV0aGVyIHRoaXMgTm9kZSBpdHNlbGYgaXMgcGFpbnRlZCAoZGlzcGxheXMgc29tZXRoaW5nIGl0c2VsZikuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGlzUGFpbnRlZCgpOiBib29sZWFuIHtcclxuICAgIC8vIEFsd2F5cyB0cnVlIGZvciBET00gbm9kZXNcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hhbmdlcyB0aGUgRE9NIGVsZW1lbnQgb2YgdGhpcyBET00gbm9kZSB0byBhbm90aGVyIGVsZW1lbnQuXHJcbiAgICovXHJcbiAgcHVibGljIHNldEVsZW1lbnQoIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICk6IHRoaXMge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIXRoaXMuX2VsZW1lbnQsICdXZSBzaG91bGQgb25seSBldmVyIGF0dGFjaCBvbmUgRE9NRWxlbWVudCB0byBhIERPTSBub2RlJyApO1xyXG5cclxuICAgIGlmICggdGhpcy5fZWxlbWVudCAhPT0gZWxlbWVudCApIHtcclxuICAgICAgaWYgKCB0aGlzLl9lbGVtZW50ICkge1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5yZW1vdmVDaGlsZCggdGhpcy5fZWxlbWVudCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcclxuXHJcbiAgICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCggdGhpcy5fZWxlbWVudCApO1xyXG5cclxuICAgICAgdGhpcy5pbnZhbGlkYXRlRE9NKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7IC8vIGFsbG93IGNoYWluaW5nXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IGVsZW1lbnQoIHZhbHVlOiBIVE1MRWxlbWVudCApIHsgdGhpcy5zZXRFbGVtZW50KCB2YWx1ZSApOyB9XHJcblxyXG4gIHB1YmxpYyBnZXQgZWxlbWVudCgpOiBIVE1MRWxlbWVudCB7IHJldHVybiB0aGlzLmdldEVsZW1lbnQoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBET00gZWxlbWVudCBiZWluZyBkaXNwbGF5ZWQgYnkgdGhpcyBET00gbm9kZS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RWxlbWVudCgpOiBIVE1MRWxlbWVudCB7XHJcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIHZhbHVlIG9mIHRoZSBwcmV2ZW50VHJhbnNmb3JtIGZsYWcuXHJcbiAgICpcclxuICAgKiBXaGVuIHRoZSBwcmV2ZW50VHJhbnNmb3JtIGZsYWcgaXMgc2V0IHRvIHRydWUsIFNjZW5lcnkgd2lsbCBub3QgcmVwb3NpdGlvbiAoQ1NTIHRyYW5zZm9ybSkgdGhlIERPTSBlbGVtZW50LCBidXRcclxuICAgKiBpbnN0ZWFkIGl0IHdpbGwgYmUgYXQgdGhlIHVwcGVyLWxlZnQgKDAsMCkgb2YgdGhlIFNjZW5lcnkgRGlzcGxheS4gVGhlIGNsaWVudCB3aWxsIGJlIHJlc3BvbnNpYmxlIGZvciBzaXppbmcgb3JcclxuICAgKiBwb3NpdGlvbmluZyB0aGlzIGVsZW1lbnQgaW5zdGVhZC5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0UHJldmVudFRyYW5zZm9ybSggcHJldmVudFRyYW5zZm9ybTogYm9vbGVhbiApOiB2b2lkIHtcclxuICAgIGlmICggdGhpcy5fcHJldmVudFRyYW5zZm9ybSAhPT0gcHJldmVudFRyYW5zZm9ybSApIHtcclxuICAgICAgdGhpcy5fcHJldmVudFRyYW5zZm9ybSA9IHByZXZlbnRUcmFuc2Zvcm07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IHByZXZlbnRUcmFuc2Zvcm0oIHZhbHVlOiBib29sZWFuICkgeyB0aGlzLnNldFByZXZlbnRUcmFuc2Zvcm0oIHZhbHVlICk7IH1cclxuXHJcbiAgcHVibGljIGdldCBwcmV2ZW50VHJhbnNmb3JtKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5pc1RyYW5zZm9ybVByZXZlbnRlZCgpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBwcmV2ZW50VHJhbnNmb3JtIGZsYWcuXHJcbiAgICpcclxuICAgKiBTZWUgdGhlIHNldFByZXZlbnRUcmFuc2Zvcm0gZG9jdW1lbnRhdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGUgZmxhZy5cclxuICAgKi9cclxuICBwdWJsaWMgaXNUcmFuc2Zvcm1QcmV2ZW50ZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fcHJldmVudFRyYW5zZm9ybTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgd2hldGhlciBpbnB1dCBpcyBhbGxvd2VkIGZvciB0aGUgRE9NIGVsZW1lbnQuIElmIGZhbHNlLCB3ZSB3aWxsIGRpc2FibGUgaW5wdXQgZXZlbnRzIHdpdGggcG9pbnRlckV2ZW50cyBhbmRcclxuICAgKiB0aGUgdXN1YWwgcHJldmVudERlZmF1bHQoKS4gSWYgdHJ1ZSwgd2UnbGwgc2V0IGEgZmxhZyBpbnRlcm5hbGx5IHNvIHRoYXQgd2UgZG9uJ3QgcHJldmVudERlZmF1bHQoKSBvbiBpbnB1dCBldmVudHMuXHJcbiAgICovXHJcbiAgcHVibGljIHNldEFsbG93SW5wdXQoIGFsbG93SW5wdXQ6IGJvb2xlYW4gKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMuX2FsbG93SW5wdXQgIT09IGFsbG93SW5wdXQgKSB7XHJcbiAgICAgIHRoaXMuX2FsbG93SW5wdXQgPSBhbGxvd0lucHV0O1xyXG5cclxuICAgICAgdGhpcy5pbnZhbGlkYXRlQWxsb3dJbnB1dCggYWxsb3dJbnB1dCApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzSW5wdXRBbGxvd2VkKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5fYWxsb3dJbnB1dDsgfVxyXG5cclxuICBwcml2YXRlIGludmFsaWRhdGVBbGxvd0lucHV0KCBhbGxvd0lucHV0OiBib29sZWFuICk6IHZvaWQge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLmRhdGFzZXQuc2NlbmVyeUFsbG93SW5wdXQgPSBhbGxvd0lucHV0ID8gJ3RydWUnIDogJ2ZhbHNlJztcclxuICAgIHRoaXMuX2NvbnRhaW5lci5zdHlsZS5wb2ludGVyRXZlbnRzID0gYWxsb3dJbnB1dCA/ICdhdXRvJyA6ICdub25lJztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgYWxsb3dJbnB1dCggdmFsdWU6IGJvb2xlYW4gKSB7IHRoaXMuc2V0QWxsb3dJbnB1dCggdmFsdWUgKTsgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGFsbG93SW5wdXQoKTogYm9vbGVhbiB7IHJldHVybiB0aGlzLmlzSW5wdXRBbGxvd2VkKCk7IH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIG11dGF0ZSggb3B0aW9ucz86IERPTU9wdGlvbnMgKTogdGhpcyB7XHJcbiAgICByZXR1cm4gc3VwZXIubXV0YXRlKCBvcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICoge0FycmF5LjxzdHJpbmc+fSAtIFN0cmluZyBrZXlzIGZvciBhbGwgb2YgdGhlIGFsbG93ZWQgb3B0aW9ucyB0aGF0IHdpbGwgYmUgc2V0IGJ5IG5vZGUubXV0YXRlKCBvcHRpb25zICksIGluIHRoZVxyXG4gKiBvcmRlciB0aGV5IHdpbGwgYmUgZXZhbHVhdGVkIGluLlxyXG4gKlxyXG4gKiBOT1RFOiBTZWUgTm9kZSdzIF9tdXRhdG9yS2V5cyBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGhvdyB0aGlzIG9wZXJhdGVzLCBhbmQgcG90ZW50aWFsIHNwZWNpYWxcclxuICogICAgICAgY2FzZXMgdGhhdCBtYXkgYXBwbHkuXHJcbiAqL1xyXG5ET00ucHJvdG90eXBlLl9tdXRhdG9yS2V5cyA9IERPTV9PUFRJT05fS0VZUy5jb25jYXQoIE5vZGUucHJvdG90eXBlLl9tdXRhdG9yS2V5cyApO1xyXG5cclxuc2NlbmVyeS5yZWdpc3RlciggJ0RPTScsIERPTSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sNEJBQTRCO0FBQ2hELE9BQU9DLGFBQWEsTUFBTSx3Q0FBd0M7QUFDbEUsU0FBU0MsV0FBVyxFQUE2QkMsSUFBSSxFQUFlQyxRQUFRLEVBQUVDLE9BQU8sUUFBUSxlQUFlO0FBRTVHLE1BQU1DLGVBQWUsR0FBRyxDQUN0QixTQUFTLEVBQ1Qsa0JBQWtCLEVBQ2xCLFlBQVksQ0FDYjtBQWVEO0FBQ0EsTUFBTUMsZUFBZSxHQUFLQyxPQUF5QixJQUF5QixDQUFDLEVBQUdBLE9BQU8sSUFBTUEsT0FBTyxDQUFhQyxNQUFNLENBQUU7QUFFekgsZUFBZSxNQUFNQyxHQUFHLFNBQVNQLElBQUksQ0FBQztFQUlwQztFQUM0Qzs7RUFFNUM7O0VBR0E7RUFDQTtFQUNBOztFQUdBOztFQUdBOztFQUdBO0FBQ0Y7QUFDQTtBQUNBO0FB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