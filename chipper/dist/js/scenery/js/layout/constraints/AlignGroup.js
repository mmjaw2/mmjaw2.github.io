// Copyright 2016-2024, University of Colorado Boulder

/**
 * A group of alignment boxes that follow the constraints:
 * 1. Every box will have the same bounds, with an upper-left of (0,0)
 * 2. The box sizes will be the smallest possible to fit every box's content (with respective padding).
 * 3. Each box is responsible for positioning its content in its bounds (with customizable alignment and padding).
 *
 * Align boxes can be dynamically created and disposed, and only active boxes will be considered for the bounds.
 *
 * Since many sun components do not support resizing their contents dynamically, you may need to populate the AlignGroup
 * in the order of largest to smallest so that a fixed size container is large enough to contain the largest item.
 *
 * NOTE: Align box resizes may not happen immediately, and may be delayed until bounds of a align box's child occurs.
 *       layout updates can be forced with group.updateLayout(). If the align box's content that changed is connected
 *       to a Scenery display, its bounds will update when Display.updateDisplay() will called, so this will guarantee
 *       that the layout will be applied before it is displayed.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import arrayRemove from '../../../../phet-core/js/arrayRemove.js';
import { combineOptions, optionize3 } from '../../../../phet-core/js/optionize.js';
import { AlignBox, scenery } from '../../imports.js';
import Disposable from '../../../../axon/js/Disposable.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
let globalId = 1;
const DEFAULT_OPTIONS = {
  matchHorizontal: true,
  matchVertical: true
};
export default class AlignGroup extends Disposable {
  // Gets locked when certain layout is performed.

  /**
   * Creates an alignment group that can be composed of multiple boxes.
   *
   * Use createBox() to create alignment boxes. You can dispose() individual boxes, or call dispose() on this
   * group to dispose all of them.
   *
   * It is also possible to create AlignBox instances independently and assign their 'group' to this AlignGroup.
   */
  constructor(providedOptions) {
    assert && assert(providedOptions === undefined || Object.getPrototypeOf(providedOptions) === Object.prototype, 'Extra prototype on options object is a code smell');
    const options = optionize3()({}, DEFAULT_OPTIONS, providedOptions);
    assert && assert(typeof options.matchHorizontal === 'boolean');
    assert && assert(typeof options.matchVertical === 'boolean');
    super(options);
    this._alignBoxes = [];
    this._matchHorizontal = options.matchHorizontal;
    this._matchVertical = options.matchVertical;

    // Gets locked when certain layout is performed.
    this._resizeLock = false;
    this._maxWidthProperty = new NumberProperty(0);
    this._maxHeightProperty = new NumberProperty(0);
    this.id = globalId++;
  }

  /**
   * Returns the current maximum width of the grouped content.
   */
  getMaxWidth() {
    return this._maxWidthProperty.value;
  }
  get maxWidth() {
    return this.getMaxWidth();
  }

  /**
   * Returns the Property holding the current maximum width of the grouped content.
   */
  getMaxWidthProperty() {
    return this._maxWidthProperty;
  }
  get maxWidthProperty() {
    return this.getMaxWidthProperty();
  }

  /**
   * Returns the current maximum height of the grouped content.
   */
  getMaxHeight() {
    return this._maxHeightProperty.value;
  }
  get maxHeight() {
    return this.getMaxHeight();
  }

  /**
   * Returns the Property holding the current maximum height of the grouped content.
   */
  getMaxHeightProperty() {
    return this._maxHeightProperty;
  }
  get maxHeightProperty() {
    return this.getMaxHeightProperty();
  }
  getMaxSizeProperty(orientation) {
    return orientation === Orientation.HORIZONTAL ? this._maxWidthProperty : this._maxHeightProperty;
  }

  /**
   * Creates an alignment box with the given content and options.
   */
  createBox(content, options) {
    // Setting the group should call our addAlignBox()
    return new AlignBox(content, combineOptions({
      group: this
    }, options));
  }

  /**
   * Sets whether the widths of the align boxes should all match. If false, each box will use its preferred width
   * (usually equal to the content width + horizontal margins).
   */
  setMatchHorizontal(matchHorizontal) {
    if (this._matchHorizontal !== matchHorizontal) {
      this._matchHorizontal = matchHorizontal;

      // Update layout, since it will probably change
      this.updateLayout();
    }
    return this;
  }
  set matchHorizontal(value) {
    this.setMatchHorizontal(value);
  }
  get matchHorizontal() {
    return this.getMatchHorizontal();
  }

  /**
   * Returns whether boxes currently are horizontally matched. See setMatchHorizontal() for details.
   */
  getMatchHorizontal() {
    return this._matchHorizontal;
  }

  /**
   * Sets whether the heights of the align boxes should all match. If false, each box will use its preferred height
   * (usually equal to the content height + vertical margins).
   */
  setMatchVertical(matchVertical) {
    if (this._matchVertical !== matchVertical) {
      this._matchVertical = matchVertical;

      // Update layout, since it will probably change
      this.updateLayout();
    }
    return this;
  }
  set matchVertical(value) {
    this.setMatchVertical(value);
  }
  get matchVertical() {
    return this.getMatchVertical();
  }

  /**
   * Returns whether boxes currently are vertically matched. See setMatchVertical() for details.
   */
  getMatchVertical() {
    return this._matchVertical;
  }

  /**
   * Updates the localBounds and alignment for each alignBox.
   *
   * NOTE: Calling this will usually not be necessary outside of Scenery, but this WILL trigger bounds revalidation
   *       for every alignBox, which can force the layout code to run.
   */
  updateLayout() {
    if (this._resizeLock) {
      return;
    }
    this._resizeLock = true;
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.AlignGroup(`AlignGroup#${this.id} updateLayout`);
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.push();
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.AlignGroup('AlignGroup computing maximum dimension');
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.push();

    // Compute the maximum dimension of our alignBoxs' content
    let maxWidth = 0;
    let maxHeight = 0;
    for (let i = 0; i < this._alignBoxes.length; i++) {
      const alignBox = this._alignBoxes[i];
      const bounds = alignBox.getContentBounds();

      // Ignore bad bounds
      if (bounds.isEmpty() || !bounds.isFinite()) {
        continue;
      }
      maxWidth = Math.max(maxWidth, bounds.width);
      maxHeight = Math.max(maxHeight, bounds.height);
    }
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.pop();
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.AlignGroup('AlignGroup applying to boxes');
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.push();
    this._maxWidthProperty.value = maxWidth;
    this._maxHeightProperty.value = maxHeight;
    if (maxWidth > 0 && maxHeight > 0) {
      // Apply that maximum dimension for each alignBox
      for (let i = 0; i < this._alignBoxes.length; i++) {
        this.setBoxBounds(this._alignBoxes[i], maxWidth, maxHeight);
      }
    }
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.pop();
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.pop();
    this._resizeLock = false;
  }

  /**
   * Sets a box's bounds based on our maximum dimensions.
   */
  setBoxBounds(alignBox, maxWidth, maxHeight) {
    let alignBounds;

    // If we match both dimensions, we don't have to inspect the box's preferred size
    if (this._matchVertical && this._matchHorizontal) {
      alignBounds = new Bounds2(0, 0, maxWidth, maxHeight);
    } else {
      // Grab the preferred size
      const contentBounds = alignBox.getContentBounds();

      // Match one orientation
      if (this._matchVertical) {
        alignBounds = new Bounds2(0, 0, isFinite(contentBounds.width) ? contentBounds.width : maxWidth, maxHeight);
      } else if (this._matchHorizontal) {
        alignBounds = new Bounds2(0, 0, maxWidth, isFinite(contentBounds.height) ? contentBounds.height : maxHeight);
      }
      // If not matching anything, just use its preferred size
      else {
        alignBounds = contentBounds;
      }
    }
    alignBox.alignBounds = alignBounds;
  }

  /**
   * Lets the group know that the alignBox has had its content resized. Called by the AlignBox
   * (scenery-internal)
   */
  onAlignBoxResized(alignBox) {
    // NOTE: in the future, we could only update this specific alignBox if the others don't need updating.
    this.updateLayout();
  }

  /**
   * Adds the AlignBox to the group -- Used in AlignBox --- do NOT use in public code
   * (scenery-internal)
   */
  addAlignBox(alignBox) {
    this._alignBoxes.push(alignBox);

    // Trigger an update when a alignBox is added
    this.updateLayout();
  }

  /**
   * Removes the AlignBox from the group
   * (scenery-internal)
   */
  removeAlignBox(alignBox) {
    arrayRemove(this._alignBoxes, alignBox);

    // Trigger an update when a alignBox is removed
    this.updateLayout();
  }

  /**
   * Dispose all the boxes.
   */
  dispose() {
    for (let i = this._alignBoxes.length - 1; i >= 0; i--) {
      this._alignBoxes[i].dispose();
    }
    super.dispose();
  }
}
scenery.register('AlignGroup', AlignGroup);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIkJvdW5kczIiLCJhcnJheVJlbW92ZSIsImNvbWJpbmVPcHRpb25zIiwib3B0aW9uaXplMyIsIkFsaWduQm94Iiwic2NlbmVyeSIsIkRpc3Bvc2FibGUiLCJPcmllbnRhdGlvbiIsImdsb2JhbElkIiwiREVGQVVMVF9PUFRJT05TIiwibWF0Y2hIb3Jpem9udGFsIiwibWF0Y2hWZXJ0aWNhbCIsIkFsaWduR3JvdXAiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsImFzc2VydCIsInVuZGVmaW5lZCIsIk9iamVjdCIsImdldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwib3B0aW9ucyIsIl9hbGlnbkJveGVzIiwiX21hdGNoSG9yaXpvbnRhbCIsIl9tYXRjaFZlcnRpY2FsIiwiX3Jlc2l6ZUxvY2siLCJfbWF4V2lkdGhQcm9wZXJ0eSIsIl9tYXhIZWlnaHRQcm9wZXJ0eSIsImlkIiwiZ2V0TWF4V2lkdGgiLCJ2YWx1ZSIsIm1heFdpZHRoIiwiZ2V0TWF4V2lkdGhQcm9wZXJ0eSIsIm1heFdpZHRoUHJvcGVydHkiLCJnZXRNYXhIZWlnaHQiLCJtYXhIZWlnaHQiLCJnZXRNYXhIZWlnaHRQcm9wZXJ0eSIsIm1heEhlaWdodFByb3BlcnR5IiwiZ2V0TWF4U2l6ZVByb3BlcnR5Iiwib3JpZW50YXRpb24iLCJIT1JJWk9OVEFMIiwiY3JlYXRlQm94IiwiY29udGVudCIsImdyb3VwIiwic2V0TWF0Y2hIb3Jpem9udGFsIiwidXBkYXRlTGF5b3V0IiwiZ2V0TWF0Y2hIb3Jpem9udGFsIiwic2V0TWF0Y2hWZXJ0aWNhbCIsImdldE1hdGNoVmVydGljYWwiLCJzY2VuZXJ5TG9nIiwicHVzaCIsImkiLCJsZW5ndGgiLCJhbGlnbkJveCIsImJvdW5kcyIsImdldENvbnRlbnRCb3VuZHMiLCJpc0VtcHR5IiwiaXNGaW5pdGUiLCJNYXRoIiwibWF4Iiwid2lkdGgiLCJoZWlnaHQiLCJwb3AiLCJzZXRCb3hCb3VuZHMiLCJhbGlnbkJvdW5kcyIsImNvbnRlbnRCb3VuZHMiLCJvbkFsaWduQm94UmVzaXplZCIsImFkZEFsaWduQm94IiwicmVtb3ZlQWxpZ25Cb3giLCJkaXNwb3NlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJBbGlnbkdyb3VwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgZ3JvdXAgb2YgYWxpZ25tZW50IGJveGVzIHRoYXQgZm9sbG93IHRoZSBjb25zdHJhaW50czpcclxuICogMS4gRXZlcnkgYm94IHdpbGwgaGF2ZSB0aGUgc2FtZSBib3VuZHMsIHdpdGggYW4gdXBwZXItbGVmdCBvZiAoMCwwKVxyXG4gKiAyLiBUaGUgYm94IHNpemVzIHdpbGwgYmUgdGhlIHNtYWxsZXN0IHBvc3NpYmxlIHRvIGZpdCBldmVyeSBib3gncyBjb250ZW50ICh3aXRoIHJlc3BlY3RpdmUgcGFkZGluZykuXHJcbiAqIDMuIEVhY2ggYm94IGlzIHJlc3BvbnNpYmxlIGZvciBwb3NpdGlvbmluZyBpdHMgY29udGVudCBpbiBpdHMgYm91bmRzICh3aXRoIGN1c3RvbWl6YWJsZSBhbGlnbm1lbnQgYW5kIHBhZGRpbmcpLlxyXG4gKlxyXG4gKiBBbGlnbiBib3hlcyBjYW4gYmUgZHluYW1pY2FsbHkgY3JlYXRlZCBhbmQgZGlzcG9zZWQsIGFuZCBvbmx5IGFjdGl2ZSBib3hlcyB3aWxsIGJlIGNvbnNpZGVyZWQgZm9yIHRoZSBib3VuZHMuXHJcbiAqXHJcbiAqIFNpbmNlIG1hbnkgc3VuIGNvbXBvbmVudHMgZG8gbm90IHN1cHBvcnQgcmVzaXppbmcgdGhlaXIgY29udGVudHMgZHluYW1pY2FsbHksIHlvdSBtYXkgbmVlZCB0byBwb3B1bGF0ZSB0aGUgQWxpZ25Hcm91cFxyXG4gKiBpbiB0aGUgb3JkZXIgb2YgbGFyZ2VzdCB0byBzbWFsbGVzdCBzbyB0aGF0IGEgZml4ZWQgc2l6ZSBjb250YWluZXIgaXMgbGFyZ2UgZW5vdWdoIHRvIGNvbnRhaW4gdGhlIGxhcmdlc3QgaXRlbS5cclxuICpcclxuICogTk9URTogQWxpZ24gYm94IHJlc2l6ZXMgbWF5IG5vdCBoYXBwZW4gaW1tZWRpYXRlbHksIGFuZCBtYXkgYmUgZGVsYXllZCB1bnRpbCBib3VuZHMgb2YgYSBhbGlnbiBib3gncyBjaGlsZCBvY2N1cnMuXHJcbiAqICAgICAgIGxheW91dCB1cGRhdGVzIGNhbiBiZSBmb3JjZWQgd2l0aCBncm91cC51cGRhdGVMYXlvdXQoKS4gSWYgdGhlIGFsaWduIGJveCdzIGNvbnRlbnQgdGhhdCBjaGFuZ2VkIGlzIGNvbm5lY3RlZFxyXG4gKiAgICAgICB0byBhIFNjZW5lcnkgZGlzcGxheSwgaXRzIGJvdW5kcyB3aWxsIHVwZGF0ZSB3aGVuIERpc3BsYXkudXBkYXRlRGlzcGxheSgpIHdpbGwgY2FsbGVkLCBzbyB0aGlzIHdpbGwgZ3VhcmFudGVlXHJcbiAqICAgICAgIHRoYXQgdGhlIGxheW91dCB3aWxsIGJlIGFwcGxpZWQgYmVmb3JlIGl0IGlzIGRpc3BsYXllZC5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IGFycmF5UmVtb3ZlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9hcnJheVJlbW92ZS5qcyc7XHJcbmltcG9ydCB7IGNvbWJpbmVPcHRpb25zLCBvcHRpb25pemUzIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IEFsaWduQm94LCBOb2RlLCBzY2VuZXJ5IH0gZnJvbSAnLi4vLi4vaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IEFsaWduQm94T3B0aW9ucyB9IGZyb20gJy4uL25vZGVzL0FsaWduQm94LmpzJztcclxuaW1wb3J0IERpc3Bvc2FibGUsIHsgRGlzcG9zYWJsZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rpc3Bvc2FibGUuanMnO1xyXG5pbXBvcnQgT3JpZW50YXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL09yaWVudGF0aW9uLmpzJztcclxuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xyXG5cclxubGV0IGdsb2JhbElkID0gMTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgLy8gV2hldGhlciB0aGUgYm94ZXMgc2hvdWxkIGhhdmUgYWxsIG1hdGNoaW5nIHdpZHRocyAob3RoZXJ3aXNlIGl0IGZpdHMgdG8gc2l6ZSlcclxuICBtYXRjaEhvcml6b250YWw/OiBib29sZWFuO1xyXG5cclxuICAvLyBXaGV0aGVyIHRoZSBib3hlcyBzaG91bGQgaGF2ZSBhbGwgbWF0Y2hpbmcgaGVpZ2h0cyAob3RoZXJ3aXNlIGl0IGZpdHMgdG8gc2l6ZSlcclxuICBtYXRjaFZlcnRpY2FsPzogYm9vbGVhbjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEFsaWduR3JvdXBPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBEaXNwb3NhYmxlT3B0aW9ucztcclxuXHJcbmNvbnN0IERFRkFVTFRfT1BUSU9OUyA9IHtcclxuICBtYXRjaEhvcml6b250YWw6IHRydWUsXHJcbiAgbWF0Y2hWZXJ0aWNhbDogdHJ1ZVxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQWxpZ25Hcm91cCBleHRlbmRzIERpc3Bvc2FibGUge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9hbGlnbkJveGVzOiBBbGlnbkJveFtdO1xyXG4gIHByaXZhdGUgX21hdGNoSG9yaXpvbnRhbDogYm9vbGVhbjtcclxuICBwcml2YXRlIF9tYXRjaFZlcnRpY2FsOiBib29sZWFuO1xyXG5cclxuICAvLyBHZXRzIGxvY2tlZCB3aGVuIGNlcnRhaW4gbGF5b3V0IGlzIHBlcmZvcm1lZC5cclxuICBwcml2YXRlIF9yZXNpemVMb2NrOiBib29sZWFuO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9tYXhXaWR0aFByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9tYXhIZWlnaHRQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBpZDogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGFsaWdubWVudCBncm91cCB0aGF0IGNhbiBiZSBjb21wb3NlZCBvZiBtdWx0aXBsZSBib3hlcy5cclxuICAgKlxyXG4gICAqIFVzZSBjcmVhdGVCb3goKSB0byBjcmVhdGUgYWxpZ25tZW50IGJveGVzLiBZb3UgY2FuIGRpc3Bvc2UoKSBpbmRpdmlkdWFsIGJveGVzLCBvciBjYWxsIGRpc3Bvc2UoKSBvbiB0aGlzXHJcbiAgICogZ3JvdXAgdG8gZGlzcG9zZSBhbGwgb2YgdGhlbS5cclxuICAgKlxyXG4gICAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gY3JlYXRlIEFsaWduQm94IGluc3RhbmNlcyBpbmRlcGVuZGVudGx5IGFuZCBhc3NpZ24gdGhlaXIgJ2dyb3VwJyB0byB0aGlzIEFsaWduR3JvdXAuXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBBbGlnbkdyb3VwT3B0aW9ucyApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHByb3ZpZGVkT3B0aW9ucyA9PT0gdW5kZWZpbmVkIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZiggcHJvdmlkZWRPcHRpb25zICkgPT09IE9iamVjdC5wcm90b3R5cGUsXHJcbiAgICAgICdFeHRyYSBwcm90b3R5cGUgb24gb3B0aW9ucyBvYmplY3QgaXMgYSBjb2RlIHNtZWxsJyApO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemUzPEFsaWduR3JvdXBPcHRpb25zLCBTZWxmT3B0aW9ucywgRGlzcG9zYWJsZU9wdGlvbnM+KCkoIHt9LCBERUZBVUxUX09QVElPTlMsIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHR5cGVvZiBvcHRpb25zLm1hdGNoSG9yaXpvbnRhbCA9PT0gJ2Jvb2xlYW4nICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2Ygb3B0aW9ucy5tYXRjaFZlcnRpY2FsID09PSAnYm9vbGVhbicgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuX2FsaWduQm94ZXMgPSBbXTtcclxuXHJcbiAgICB0aGlzLl9tYXRjaEhvcml6b250YWwgPSBvcHRpb25zLm1hdGNoSG9yaXpvbnRhbDtcclxuXHJcbiAgICB0aGlzLl9tYXRjaFZlcnRpY2FsID0gb3B0aW9ucy5tYXRjaFZlcnRpY2FsO1xyXG5cclxuICAgIC8vIEdldHMgbG9ja2VkIHdoZW4gY2VydGFpbiBsYXlvdXQgaXMgcGVyZm9ybWVkLlxyXG4gICAgdGhpcy5fcmVzaXplTG9jayA9IGZhbHNlO1xyXG5cclxuICAgIHRoaXMuX21heFdpZHRoUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIDAgKTtcclxuXHJcbiAgICB0aGlzLl9tYXhIZWlnaHRQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggMCApO1xyXG5cclxuICAgIHRoaXMuaWQgPSBnbG9iYWxJZCsrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgY3VycmVudCBtYXhpbXVtIHdpZHRoIG9mIHRoZSBncm91cGVkIGNvbnRlbnQuXHJcbiAgICovXHJcbiAgcHVibGljIGdldE1heFdpZHRoKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fbWF4V2lkdGhQcm9wZXJ0eS52YWx1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgbWF4V2lkdGgoKTogbnVtYmVyIHsgcmV0dXJuIHRoaXMuZ2V0TWF4V2lkdGgoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBQcm9wZXJ0eSBob2xkaW5nIHRoZSBjdXJyZW50IG1heGltdW0gd2lkdGggb2YgdGhlIGdyb3VwZWQgY29udGVudC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TWF4V2lkdGhQcm9wZXJ0eSgpOiBUUHJvcGVydHk8bnVtYmVyPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fbWF4V2lkdGhQcm9wZXJ0eTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgbWF4V2lkdGhQcm9wZXJ0eSgpOiBUUHJvcGVydHk8bnVtYmVyPiB7IHJldHVybiB0aGlzLmdldE1heFdpZHRoUHJvcGVydHkoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IG1heGltdW0gaGVpZ2h0IG9mIHRoZSBncm91cGVkIGNvbnRlbnQuXHJcbiAgICovXHJcbiAgcHVibGljIGdldE1heEhlaWdodCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX21heEhlaWdodFByb3BlcnR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBtYXhIZWlnaHQoKTogbnVtYmVyIHsgcmV0dXJuIHRoaXMuZ2V0TWF4SGVpZ2h0KCk7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgUHJvcGVydHkgaG9sZGluZyB0aGUgY3VycmVudCBtYXhpbXVtIGhlaWdodCBvZiB0aGUgZ3JvdXBlZCBjb250ZW50LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRNYXhIZWlnaHRQcm9wZXJ0eSgpOiBUUHJvcGVydHk8bnVtYmVyPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fbWF4SGVpZ2h0UHJvcGVydHk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG1heEhlaWdodFByb3BlcnR5KCk6IFRQcm9wZXJ0eTxudW1iZXI+IHsgcmV0dXJuIHRoaXMuZ2V0TWF4SGVpZ2h0UHJvcGVydHkoKTsgfVxyXG5cclxuICBwdWJsaWMgZ2V0TWF4U2l6ZVByb3BlcnR5KCBvcmllbnRhdGlvbjogT3JpZW50YXRpb24gKTogVFByb3BlcnR5PG51bWJlcj4ge1xyXG4gICAgcmV0dXJuIG9yaWVudGF0aW9uID09PSBPcmllbnRhdGlvbi5IT1JJWk9OVEFMID8gdGhpcy5fbWF4V2lkdGhQcm9wZXJ0eSA6IHRoaXMuX21heEhlaWdodFByb3BlcnR5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhbiBhbGlnbm1lbnQgYm94IHdpdGggdGhlIGdpdmVuIGNvbnRlbnQgYW5kIG9wdGlvbnMuXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZUJveCggY29udGVudDogTm9kZSwgb3B0aW9ucz86IFN0cmljdE9taXQ8QWxpZ25Cb3hPcHRpb25zLCAnZ3JvdXAnPiApOiBBbGlnbkJveCB7XHJcblxyXG4gICAgLy8gU2V0dGluZyB0aGUgZ3JvdXAgc2hvdWxkIGNhbGwgb3VyIGFkZEFsaWduQm94KClcclxuICAgIHJldHVybiBuZXcgQWxpZ25Cb3goIGNvbnRlbnQsIGNvbWJpbmVPcHRpb25zPEFsaWduQm94T3B0aW9ucz4oIHtcclxuICAgICAgZ3JvdXA6IHRoaXNcclxuICAgIH0sIG9wdGlvbnMgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB3aGV0aGVyIHRoZSB3aWR0aHMgb2YgdGhlIGFsaWduIGJveGVzIHNob3VsZCBhbGwgbWF0Y2guIElmIGZhbHNlLCBlYWNoIGJveCB3aWxsIHVzZSBpdHMgcHJlZmVycmVkIHdpZHRoXHJcbiAgICogKHVzdWFsbHkgZXF1YWwgdG8gdGhlIGNvbnRlbnQgd2lkdGggKyBob3Jpem9udGFsIG1hcmdpbnMpLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRNYXRjaEhvcml6b250YWwoIG1hdGNoSG9yaXpvbnRhbDogYm9vbGVhbiApOiB0aGlzIHtcclxuXHJcbiAgICBpZiAoIHRoaXMuX21hdGNoSG9yaXpvbnRhbCAhPT0gbWF0Y2hIb3Jpem9udGFsICkge1xyXG4gICAgICB0aGlzLl9tYXRjaEhvcml6b250YWwgPSBtYXRjaEhvcml6b250YWw7XHJcblxyXG4gICAgICAvLyBVcGRhdGUgbGF5b3V0LCBzaW5jZSBpdCB3aWxsIHByb2JhYmx5IGNoYW5nZVxyXG4gICAgICB0aGlzLnVwZGF0ZUxheW91dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBtYXRjaEhvcml6b250YWwoIHZhbHVlOiBib29sZWFuICkgeyB0aGlzLnNldE1hdGNoSG9yaXpvbnRhbCggdmFsdWUgKTsgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG1hdGNoSG9yaXpvbnRhbCgpOiBib29sZWFuIHsgcmV0dXJuIHRoaXMuZ2V0TWF0Y2hIb3Jpem9udGFsKCk7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB3aGV0aGVyIGJveGVzIGN1cnJlbnRseSBhcmUgaG9yaXpvbnRhbGx5IG1hdGNoZWQuIFNlZSBzZXRNYXRjaEhvcml6b250YWwoKSBmb3IgZGV0YWlscy5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TWF0Y2hIb3Jpem9udGFsKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX21hdGNoSG9yaXpvbnRhbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgd2hldGhlciB0aGUgaGVpZ2h0cyBvZiB0aGUgYWxpZ24gYm94ZXMgc2hvdWxkIGFsbCBtYXRjaC4gSWYgZmFsc2UsIGVhY2ggYm94IHdpbGwgdXNlIGl0cyBwcmVmZXJyZWQgaGVpZ2h0XHJcbiAgICogKHVzdWFsbHkgZXF1YWwgdG8gdGhlIGNvbnRlbnQgaGVpZ2h0ICsgdmVydGljYWwgbWFyZ2lucykuXHJcbiAgICovXHJcbiAgcHVibGljIHNldE1hdGNoVmVydGljYWwoIG1hdGNoVmVydGljYWw6IGJvb2xlYW4gKTogdGhpcyB7XHJcblxyXG4gICAgaWYgKCB0aGlzLl9tYXRjaFZlcnRpY2FsICE9PSBtYXRjaFZlcnRpY2FsICkge1xyXG4gICAgICB0aGlzLl9tYXRjaFZlcnRpY2FsID0gbWF0Y2hWZXJ0aWNhbDtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBsYXlvdXQsIHNpbmNlIGl0IHdpbGwgcHJvYmFibHkgY2hhbmdlXHJcbiAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IG1hdGNoVmVydGljYWwoIHZhbHVlOiBib29sZWFuICkgeyB0aGlzLnNldE1hdGNoVmVydGljYWwoIHZhbHVlICk7IH1cclxuXHJcbiAgcHVibGljIGdldCBtYXRjaFZlcnRpY2FsKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5nZXRNYXRjaFZlcnRpY2FsKCk7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB3aGV0aGVyIGJveGVzIGN1cnJlbnRseSBhcmUgdmVydGljYWxseSBtYXRjaGVkLiBTZWUgc2V0TWF0Y2hWZXJ0aWNhbCgpIGZvciBkZXRhaWxzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRNYXRjaFZlcnRpY2FsKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX21hdGNoVmVydGljYWw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBsb2NhbEJvdW5kcyBhbmQgYWxpZ25tZW50IGZvciBlYWNoIGFsaWduQm94LlxyXG4gICAqXHJcbiAgICogTk9URTogQ2FsbGluZyB0aGlzIHdpbGwgdXN1YWxseSBub3QgYmUgbmVjZXNzYXJ5IG91dHNpZGUgb2YgU2NlbmVyeSwgYnV0IHRoaXMgV0lMTCB0cmlnZ2VyIGJvdW5kcyByZXZhbGlkYXRpb25cclxuICAgKiAgICAgICBmb3IgZXZlcnkgYWxpZ25Cb3gsIHdoaWNoIGNhbiBmb3JjZSB0aGUgbGF5b3V0IGNvZGUgdG8gcnVuLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVMYXlvdXQoKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMuX3Jlc2l6ZUxvY2sgKSB7IHJldHVybjsgfVxyXG4gICAgdGhpcy5fcmVzaXplTG9jayA9IHRydWU7XHJcblxyXG4gICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAgJiYgc2NlbmVyeUxvZy5BbGlnbkdyb3VwKFxyXG4gICAgICBgQWxpZ25Hcm91cCMke3RoaXMuaWR9IHVwZGF0ZUxheW91dGAgKTtcclxuICAgIHNjZW5lcnlMb2cgJiYgc2NlbmVyeUxvZy5BbGlnbkdyb3VwICYmIHNjZW5lcnlMb2cucHVzaCgpO1xyXG5cclxuICAgIHNjZW5lcnlMb2cgJiYgc2NlbmVyeUxvZy5BbGlnbkdyb3VwICYmIHNjZW5lcnlMb2cuQWxpZ25Hcm91cCggJ0FsaWduR3JvdXAgY29tcHV0aW5nIG1heGltdW0gZGltZW5zaW9uJyApO1xyXG4gICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAgJiYgc2NlbmVyeUxvZy5wdXNoKCk7XHJcblxyXG4gICAgLy8gQ29tcHV0ZSB0aGUgbWF4aW11bSBkaW1lbnNpb24gb2Ygb3VyIGFsaWduQm94cycgY29udGVudFxyXG4gICAgbGV0IG1heFdpZHRoID0gMDtcclxuICAgIGxldCBtYXhIZWlnaHQgPSAwO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5fYWxpZ25Cb3hlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgYWxpZ25Cb3ggPSB0aGlzLl9hbGlnbkJveGVzWyBpIF07XHJcblxyXG4gICAgICBjb25zdCBib3VuZHMgPSBhbGlnbkJveC5nZXRDb250ZW50Qm91bmRzKCk7XHJcblxyXG4gICAgICAvLyBJZ25vcmUgYmFkIGJvdW5kc1xyXG4gICAgICBpZiAoIGJvdW5kcy5pc0VtcHR5KCkgfHwgIWJvdW5kcy5pc0Zpbml0ZSgpICkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBtYXhXaWR0aCA9IE1hdGgubWF4KCBtYXhXaWR0aCwgYm91bmRzLndpZHRoICk7XHJcbiAgICAgIG1heEhlaWdodCA9IE1hdGgubWF4KCBtYXhIZWlnaHQsIGJvdW5kcy5oZWlnaHQgKTtcclxuICAgIH1cclxuXHJcbiAgICBzY2VuZXJ5TG9nICYmIHNjZW5lcnlMb2cuQWxpZ25Hcm91cCAmJiBzY2VuZXJ5TG9nLnBvcCgpO1xyXG4gICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAgJiYgc2NlbmVyeUxvZy5BbGlnbkdyb3VwKCAnQWxpZ25Hcm91cCBhcHBseWluZyB0byBib3hlcycgKTtcclxuICAgIHNjZW5lcnlMb2cgJiYgc2NlbmVyeUxvZy5BbGlnbkdyb3VwICYmIHNjZW5lcnlMb2cucHVzaCgpO1xyXG5cclxuICAgIHRoaXMuX21heFdpZHRoUHJvcGVydHkudmFsdWUgPSBtYXhXaWR0aDtcclxuICAgIHRoaXMuX21heEhlaWdodFByb3BlcnR5LnZhbHVlID0gbWF4SGVpZ2h0O1xyXG5cclxuICAgIGlmICggbWF4V2lkdGggPiAwICYmIG1heEhlaWdodCA+IDAgKSB7XHJcbiAgICAgIC8vIEFwcGx5IHRoYXQgbWF4aW11bSBkaW1lbnNpb24gZm9yIGVhY2ggYWxpZ25Cb3hcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5fYWxpZ25Cb3hlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICB0aGlzLnNldEJveEJvdW5kcyggdGhpcy5fYWxpZ25Cb3hlc1sgaSBdLCBtYXhXaWR0aCwgbWF4SGVpZ2h0ICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzY2VuZXJ5TG9nICYmIHNjZW5lcnlMb2cuQWxpZ25Hcm91cCAmJiBzY2VuZXJ5TG9nLnBvcCgpO1xyXG4gICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAgJiYgc2NlbmVyeUxvZy5wb3AoKTtcclxuXHJcbiAgICB0aGlzLl9yZXNpemVMb2NrID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIGEgYm94J3MgYm91bmRzIGJhc2VkIG9uIG91ciBtYXhpbXVtIGRpbWVuc2lvbnMuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRCb3hCb3VuZHMoIGFsaWduQm94OiBBbGlnbkJveCwgbWF4V2lkdGg6IG51bWJlciwgbWF4SGVpZ2h0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBsZXQgYWxpZ25Cb3VuZHM7XHJcblxyXG4gICAgLy8gSWYgd2UgbWF0Y2ggYm90aCBkaW1lbnNpb25zLCB3ZSBkb24ndCBoYXZlIHRvIGluc3BlY3QgdGhlIGJveCdzIHByZWZlcnJlZCBzaXplXHJcbiAgICBpZiAoIHRoaXMuX21hdGNoVmVydGljYWwgJiYgdGhpcy5fbWF0Y2hIb3Jpem9udGFsICkge1xyXG4gICAgICBhbGlnbkJvdW5kcyA9IG5ldyBCb3VuZHMyKCAwLCAwLCBtYXhXaWR0aCwgbWF4SGVpZ2h0ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgLy8gR3JhYiB0aGUgcHJlZmVycmVkIHNpemVcclxuICAgICAgY29uc3QgY29udGVudEJvdW5kcyA9IGFsaWduQm94LmdldENvbnRlbnRCb3VuZHMoKTtcclxuXHJcbiAgICAgIC8vIE1hdGNoIG9uZSBvcmllbnRhdGlvblxyXG4gICAgICBpZiAoIHRoaXMuX21hdGNoVmVydGljYWwgKSB7XHJcbiAgICAgICAgYWxpZ25Cb3VuZHMgPSBuZXcgQm91bmRzMiggMCwgMCwgaXNGaW5pdGUoIGNvbnRlbnRCb3VuZHMud2lkdGggKSA/IGNvbnRlbnRCb3VuZHMud2lkdGggOiBtYXhXaWR0aCwgbWF4SGVpZ2h0ICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHRoaXMuX21hdGNoSG9yaXpvbnRhbCApIHtcclxuICAgICAgICBhbGlnbkJvdW5kcyA9IG5ldyBCb3VuZHMyKCAwLCAwLCBtYXhXaWR0aCwgaXNGaW5pdGUoIGNvbnRlbnRCb3VuZHMuaGVpZ2h0ICkgPyBjb250ZW50Qm91bmRzLmhlaWdodCA6IG1heEhlaWdodCApO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIElmIG5vdCBtYXRjaGluZyBhbnl0aGluZywganVzdCB1c2UgaXRzIHByZWZlcnJlZCBzaXplXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGFsaWduQm91bmRzID0gY29udGVudEJvdW5kcztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFsaWduQm94LmFsaWduQm91bmRzID0gYWxpZ25Cb3VuZHM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMZXRzIHRoZSBncm91cCBrbm93IHRoYXQgdGhlIGFsaWduQm94IGhhcyBoYWQgaXRzIGNvbnRlbnQgcmVzaXplZC4gQ2FsbGVkIGJ5IHRoZSBBbGlnbkJveFxyXG4gICAqIChzY2VuZXJ5LWludGVybmFsKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkFsaWduQm94UmVzaXplZCggYWxpZ25Cb3g6IEFsaWduQm94ICk6IHZvaWQge1xyXG4gICAgLy8gTk9URTogaW4gdGhlIGZ1dHVyZSwgd2UgY291bGQgb25seSB1cGRhdGUgdGhpcyBzcGVjaWZpYyBhbGlnbkJveCBpZiB0aGUgb3RoZXJzIGRvbid0IG5lZWQgdXBkYXRpbmcuXHJcbiAgICB0aGlzLnVwZGF0ZUxheW91dCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkcyB0aGUgQWxpZ25Cb3ggdG8gdGhlIGdyb3VwIC0tIFVzZWQgaW4gQWxpZ25Cb3ggLS0tIGRvIE5PVCB1c2UgaW4gcHVibGljIGNvZGVcclxuICAgKiAoc2NlbmVyeS1pbnRlcm5hbClcclxuICAgKi9cclxuICBwdWJsaWMgYWRkQWxpZ25Cb3goIGFsaWduQm94OiBBbGlnbkJveCApOiB2b2lkIHtcclxuICAgIHRoaXMuX2FsaWduQm94ZXMucHVzaCggYWxpZ25Cb3ggKTtcclxuXHJcbiAgICAvLyBUcmlnZ2VyIGFuIHVwZGF0ZSB3aGVuIGEgYWxpZ25Cb3ggaXMgYWRkZWRcclxuICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmVzIHRoZSBBbGlnbkJveCBmcm9tIHRoZSBncm91cFxyXG4gICAqIChzY2VuZXJ5LWludGVybmFsKVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVBbGlnbkJveCggYWxpZ25Cb3g6IEFsaWduQm94ICk6IHZvaWQge1xyXG4gICAgYXJyYXlSZW1vdmUoIHRoaXMuX2FsaWduQm94ZXMsIGFsaWduQm94ICk7XHJcblxyXG4gICAgLy8gVHJpZ2dlciBhbiB1cGRhdGUgd2hlbiBhIGFsaWduQm94IGlzIHJlbW92ZWRcclxuICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEaXNwb3NlIGFsbCB0aGUgYm94ZXMuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICBmb3IgKCBsZXQgaSA9IHRoaXMuX2FsaWduQm94ZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7XHJcbiAgICAgIHRoaXMuX2FsaWduQm94ZXNbIGkgXS5kaXNwb3NlKCk7XHJcbiAgICB9XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5LnJlZ2lzdGVyKCAnQWxpZ25Hcm91cCcsIEFsaWduR3JvdXAgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxPQUFPQSxjQUFjLE1BQU0sdUNBQXVDO0FBQ2xFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxTQUFTQyxjQUFjLEVBQUVDLFVBQVUsUUFBUSx1Q0FBdUM7QUFDbEYsU0FBU0MsUUFBUSxFQUFR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