// Copyright 2013-2024, University of Colorado Boulder

/**
 * A radial gradient that can be passed into the 'fill' or 'stroke' parameters.
 *
 * SVG gradients, see http://www.w3.org/TR/SVG/pservers.html
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Vector2 from '../../../dot/js/Vector2.js';
import platform from '../../../phet-core/js/platform.js';
import { ColorDef, Gradient, scenery, SVGRadialGradient } from '../imports.js';
export default class RadialGradient extends Gradient {
  // (scenery-internal)

  // linear function from radius to point on the line from start to end
  // (scenery-internal)

  // (scenery-internal)

  // (scenery-internal)

  /**
   * TODO: add the ability to specify the color-stops inline. possibly [ [0,color1], [0.5,color2], [1,color3] ] https://github.com/phetsims/scenery/issues/1581
   *
   * TODO: support Vector2s as p0 and p1
   *
   * @param x0 - X coordinate of the start point (ratio 0) in the local coordinate frame
   * @param y0 - Y coordinate of the start point (ratio 0) in the local coordinate frame
   * @param r0 - Radius of the start point (ratio 0) in the local coordinate frame
   * @param x1 - X coordinate of the end point (ratio 1) in the local coordinate frame
   * @param y1 - Y coordinate of the end point (ratio 1) in the local coordinate frame
   * @param r1 - Radius of the end point (ratio 1) in the local coordinate frame
   */
  constructor(x0, y0, r0, x1, y1, r1) {
    super();
    this.start = new Vector2(x0, y0);
    this.end = new Vector2(x1, y1);

    // If we are using Safari, we need to work around incorrect gradient handling for now,
    // see https://github.com/phetsims/sun/issues/526
    if (platform.safari) {
      const x = (x0 + x1) / 2;
      const y = (y0 + y1) / 2;
      this.start.x = x;
      this.start.y = y;
      this.end.x = x;
      this.end.y = y;
    }
    this.startRadius = r0;
    this.endRadius = r1;
    this.focalPoint = this.start.plus(this.end.minus(this.start).times(this.startRadius / (this.startRadius - this.endRadius)));
    this.startIsLarger = this.startRadius > this.endRadius;
    this.largePoint = this.startIsLarger ? this.start : this.end;
    this.maxRadius = Math.max(this.startRadius, this.endRadius);
    this.minRadius = Math.min(this.startRadius, this.endRadius);

    // make sure that the focal point is in both circles. SVG doesn't support rendering outside of them
    if (this.startRadius >= this.endRadius) {
      assert && assert(this.focalPoint.minus(this.start).magnitude <= this.startRadius);
    } else {
      assert && assert(this.focalPoint.minus(this.end).magnitude <= this.endRadius);
    }
  }

  /**
   * Returns a fresh gradient given the starting parameters
   */
  createCanvasGradient() {
    // use the global scratch canvas instead of creating a new Canvas
    // @ts-expect-error TODO scenery namespace https://github.com/phetsims/scenery/issues/1581
    return scenery.scratchContext.createRadialGradient(this.start.x, this.start.y, this.startRadius, this.end.x, this.end.y, this.endRadius);
  }

  /**
   * Creates an SVG paint object for creating/updating the SVG equivalent definition.
   */
  createSVGPaint(svgBlock) {
    return SVGRadialGradient.pool.create(svgBlock, this);
  }

  /**
   * Returns stops suitable for direct SVG use.
   *
   * NOTE: SVG has certain stop requirements, so we need to remap/reverse in some cases.
   */
  getSVGStops() {
    const startIsLarger = this.startIsLarger;
    const maxRadius = this.maxRadius;
    const minRadius = this.minRadius;

    //TODO: replace with phet.dot.Utils.linear https://github.com/phetsims/scenery/issues/1581
    // maps x linearly from [a0,b0] => [a1,b1]
    function linearMap(a0, b0, a1, b1, x) {
      return a1 + (x - a0) * (b1 - a1) / (b0 - a0);
    }
    function mapStop(stop) {
      // flip the stops if the start has a larger radius
      let ratio = startIsLarger ? 1 - stop.ratio : stop.ratio;

      // scale the stops properly if the smaller radius isn't 0
      if (minRadius > 0) {
        // scales our ratio from [0,1] => [minRadius/maxRadius,0]
        ratio = linearMap(0, 1, minRadius / maxRadius, 1, ratio);
      }
      return {
        ratio: ratio,
        color: stop.color
      };
    }
    const stops = this.stops.map(mapStop);

    // switch the direction we apply stops in, so that the ratios always are increasing.
    if (startIsLarger) {
      stops.reverse();
    }
    return stops;
  }

  /**
   * Returns a string form of this object
   */
  toString() {
    let result = `new phet.scenery.RadialGradient( ${this.start.x}, ${this.start.y}, ${this.startRadius}, ${this.end.x}, ${this.end.y}, ${this.endRadius} )`;
    _.each(this.stops, stop => {
      result += `.addColorStop( ${stop.ratio}, ${ColorDef.scenerySerialize(stop.color)} )`;
    });
    return result;
  }
}
RadialGradient.prototype.isRadialGradient = true;
scenery.register('RadialGradient', RadialGradient);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwicGxhdGZvcm0iLCJDb2xvckRlZiIsIkdyYWRpZW50Iiwic2NlbmVyeSIsIlNWR1JhZGlhbEdyYWRpZW50IiwiUmFkaWFsR3JhZGllbnQiLCJjb25zdHJ1Y3RvciIsIngwIiwieTAiLCJyMCIsIngxIiwieTEiLCJyMSIsInN0YXJ0IiwiZW5kIiwic2FmYXJpIiwieCIsInkiLCJzdGFydFJhZGl1cyIsImVuZFJhZGl1cyIsImZvY2FsUG9pbnQiLCJwbHVzIiwibWludXMiLCJ0aW1lcyIsInN0YXJ0SXNMYXJnZXIiLCJsYXJnZVBvaW50IiwibWF4UmFkaXVzIiwiTWF0aCIsIm1heCIsIm1pblJhZGl1cyIsIm1pbiIsImFzc2VydCIsIm1hZ25pdHVkZSIsImNyZWF0ZUNhbnZhc0dyYWRpZW50Iiwic2NyYXRjaENvbnRleHQiLCJjcmVhdGVSYWRpYWxHcmFkaWVudCIsImNyZWF0ZVNWR1BhaW50Iiwic3ZnQmxvY2siLCJwb29sIiwiY3JlYXRlIiwiZ2V0U1ZHU3RvcHMiLCJsaW5lYXJNYXAiLCJhMCIsImIwIiwiYTEiLCJiMSIsIm1hcFN0b3AiLCJzdG9wIiwicmF0aW8iLCJjb2xvciIsInN0b3BzIiwibWFwIiwicmV2ZXJzZSIsInRvU3RyaW5nIiwicmVzdWx0IiwiXyIsImVhY2giLCJzY2VuZXJ5U2VyaWFsaXplIiwicHJvdG90eXBlIiwiaXNSYWRpYWxHcmFkaWVudCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUmFkaWFsR3JhZGllbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSByYWRpYWwgZ3JhZGllbnQgdGhhdCBjYW4gYmUgcGFzc2VkIGludG8gdGhlICdmaWxsJyBvciAnc3Ryb2tlJyBwYXJhbWV0ZXJzLlxyXG4gKlxyXG4gKiBTVkcgZ3JhZGllbnRzLCBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHL3BzZXJ2ZXJzLmh0bWxcclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHBsYXRmb3JtIGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9wbGF0Zm9ybS5qcyc7XHJcbmltcG9ydCB7IENvbG9yRGVmLCBHcmFkaWVudCwgR3JhZGllbnRTdG9wLCBzY2VuZXJ5LCBTVkdCbG9jaywgU1ZHUmFkaWFsR3JhZGllbnQsIFRDb2xvciB9IGZyb20gJy4uL2ltcG9ydHMuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmFkaWFsR3JhZGllbnQgZXh0ZW5kcyBHcmFkaWVudCB7XHJcblxyXG4gIHB1YmxpYyBzdGFydDogVmVjdG9yMjtcclxuICBwdWJsaWMgZW5kOiBWZWN0b3IyO1xyXG5cclxuICAvLyAoc2NlbmVyeS1pbnRlcm5hbClcclxuICBwdWJsaWMgc3RhcnRSYWRpdXM6IG51bWJlcjtcclxuICBwdWJsaWMgZW5kUmFkaXVzOiBudW1iZXI7XHJcblxyXG4gIC8vIGxpbmVhciBmdW5jdGlvbiBmcm9tIHJhZGl1cyB0byBwb2ludCBvbiB0aGUgbGluZSBmcm9tIHN0YXJ0IHRvIGVuZFxyXG4gIC8vIChzY2VuZXJ5LWludGVybmFsKVxyXG4gIHB1YmxpYyBmb2NhbFBvaW50OiBWZWN0b3IyO1xyXG5cclxuICAvLyAoc2NlbmVyeS1pbnRlcm5hbClcclxuICBwdWJsaWMgc3RhcnRJc0xhcmdlcjogYm9vbGVhbjtcclxuICBwdWJsaWMgbGFyZ2VQb2ludDogVmVjdG9yMjtcclxuXHJcbiAgLy8gKHNjZW5lcnktaW50ZXJuYWwpXHJcbiAgcHVibGljIG1pblJhZGl1czogbnVtYmVyO1xyXG4gIHB1YmxpYyBtYXhSYWRpdXM6IG51bWJlcjtcclxuXHJcbiAgLyoqXHJcbiAgICogVE9ETzogYWRkIHRoZSBhYmlsaXR5IHRvIHNwZWNpZnkgdGhlIGNvbG9yLXN0b3BzIGlubGluZS4gcG9zc2libHkgWyBbMCxjb2xvcjFdLCBbMC41LGNvbG9yMl0sIFsxLGNvbG9yM10gXSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvMTU4MVxyXG4gICAqXHJcbiAgICogVE9ETzogc3VwcG9ydCBWZWN0b3IycyBhcyBwMCBhbmQgcDFcclxuICAgKlxyXG4gICAqIEBwYXJhbSB4MCAtIFggY29vcmRpbmF0ZSBvZiB0aGUgc3RhcnQgcG9pbnQgKHJhdGlvIDApIGluIHRoZSBsb2NhbCBjb29yZGluYXRlIGZyYW1lXHJcbiAgICogQHBhcmFtIHkwIC0gWSBjb29yZGluYXRlIG9mIHRoZSBzdGFydCBwb2ludCAocmF0aW8gMCkgaW4gdGhlIGxvY2FsIGNvb3JkaW5hdGUgZnJhbWVcclxuICAgKiBAcGFyYW0gcjAgLSBSYWRpdXMgb2YgdGhlIHN0YXJ0IHBvaW50IChyYXRpbyAwKSBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZVxyXG4gICAqIEBwYXJhbSB4MSAtIFggY29vcmRpbmF0ZSBvZiB0aGUgZW5kIHBvaW50IChyYXRpbyAxKSBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZVxyXG4gICAqIEBwYXJhbSB5MSAtIFkgY29vcmRpbmF0ZSBvZiB0aGUgZW5kIHBvaW50IChyYXRpbyAxKSBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZVxyXG4gICAqIEBwYXJhbSByMSAtIFJhZGl1cyBvZiB0aGUgZW5kIHBvaW50IChyYXRpbyAxKSBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggeDA6IG51bWJlciwgeTA6IG51bWJlciwgcjA6IG51bWJlciwgeDE6IG51bWJlciwgeTE6IG51bWJlciwgcjE6IG51bWJlciApIHtcclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5zdGFydCA9IG5ldyBWZWN0b3IyKCB4MCwgeTAgKTtcclxuICAgIHRoaXMuZW5kID0gbmV3IFZlY3RvcjIoIHgxLCB5MSApO1xyXG5cclxuICAgIC8vIElmIHdlIGFyZSB1c2luZyBTYWZhcmksIHdlIG5lZWQgdG8gd29yayBhcm91bmQgaW5jb3JyZWN0IGdyYWRpZW50IGhhbmRsaW5nIGZvciBub3csXHJcbiAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNTI2XHJcbiAgICBpZiAoIHBsYXRmb3JtLnNhZmFyaSApIHtcclxuICAgICAgY29uc3QgeCA9ICggeDAgKyB4MSApIC8gMjtcclxuICAgICAgY29uc3QgeSA9ICggeTAgKyB5MSApIC8gMjtcclxuICAgICAgdGhpcy5zdGFydC54ID0geDtcclxuICAgICAgdGhpcy5zdGFydC55ID0geTtcclxuICAgICAgdGhpcy5lbmQueCA9IHg7XHJcbiAgICAgIHRoaXMuZW5kLnkgPSB5O1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc3RhcnRSYWRpdXMgPSByMDtcclxuICAgIHRoaXMuZW5kUmFkaXVzID0gcjE7XHJcblxyXG4gICAgdGhpcy5mb2NhbFBvaW50ID0gdGhpcy5zdGFydC5wbHVzKCB0aGlzLmVuZC5taW51cyggdGhpcy5zdGFydCApLnRpbWVzKCB0aGlzLnN0YXJ0UmFkaXVzIC8gKCB0aGlzLnN0YXJ0UmFkaXVzIC0gdGhpcy5lbmRSYWRpdXMgKSApICk7XHJcblxyXG4gICAgdGhpcy5zdGFydElzTGFyZ2VyID0gdGhpcy5zdGFydFJhZGl1cyA+IHRoaXMuZW5kUmFkaXVzO1xyXG4gICAgdGhpcy5sYXJnZVBvaW50ID0gdGhpcy5zdGFydElzTGFyZ2VyID8gdGhpcy5zdGFydCA6IHRoaXMuZW5kO1xyXG5cclxuICAgIHRoaXMubWF4UmFkaXVzID0gTWF0aC5tYXgoIHRoaXMuc3RhcnRSYWRpdXMsIHRoaXMuZW5kUmFkaXVzICk7XHJcbiAgICB0aGlzLm1pblJhZGl1cyA9IE1hdGgubWluKCB0aGlzLnN0YXJ0UmFkaXVzLCB0aGlzLmVuZFJhZGl1cyApO1xyXG5cclxuICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBmb2NhbCBwb2ludCBpcyBpbiBib3RoIGNpcmNsZXMuIFNWRyBkb2Vzbid0IHN1cHBvcnQgcmVuZGVyaW5nIG91dHNpZGUgb2YgdGhlbVxyXG4gICAgaWYgKCB0aGlzLnN0YXJ0UmFkaXVzID49IHRoaXMuZW5kUmFkaXVzICkge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmZvY2FsUG9pbnQubWludXMoIHRoaXMuc3RhcnQgKS5tYWduaXR1ZGUgPD0gdGhpcy5zdGFydFJhZGl1cyApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZm9jYWxQb2ludC5taW51cyggdGhpcy5lbmQgKS5tYWduaXR1ZGUgPD0gdGhpcy5lbmRSYWRpdXMgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGEgZnJlc2ggZ3JhZGllbnQgZ2l2ZW4gdGhlIHN0YXJ0aW5nIHBhcmFtZXRlcnNcclxuICAgKi9cclxuICBwdWJsaWMgY3JlYXRlQ2FudmFzR3JhZGllbnQoKTogQ2FudmFzR3JhZGllbnQge1xyXG4gICAgLy8gdXNlIHRoZSBnbG9iYWwgc2NyYXRjaCBjYW52YXMgaW5zdGVhZCBvZiBjcmVhdGluZyBhIG5ldyBDYW52YXNcclxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETyBzY2VuZXJ5IG5hbWVzcGFjZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvMTU4MVxyXG4gICAgcmV0dXJuIHNjZW5lcnkuc2NyYXRjaENvbnRleHQuY3JlYXRlUmFkaWFsR3JhZGllbnQoIHRoaXMuc3RhcnQueCwgdGhpcy5zdGFydC55LCB0aGlzLnN0YXJ0UmFkaXVzLCB0aGlzLmVuZC54LCB0aGlzLmVuZC55LCB0aGlzLmVuZFJhZGl1cyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhbiBTVkcgcGFpbnQgb2JqZWN0IGZvciBjcmVhdGluZy91cGRhdGluZyB0aGUgU1ZHIGVxdWl2YWxlbnQgZGVmaW5pdGlvbi5cclxuICAgKi9cclxuICBwdWJsaWMgY3JlYXRlU1ZHUGFpbnQoIHN2Z0Jsb2NrOiBTVkdCbG9jayApOiBTVkdSYWRpYWxHcmFkaWVudCB7XHJcbiAgICByZXR1cm4gU1ZHUmFkaWFsR3JhZGllbnQucG9vbC5jcmVhdGUoIHN2Z0Jsb2NrLCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHN0b3BzIHN1aXRhYmxlIGZvciBkaXJlY3QgU1ZHIHVzZS5cclxuICAgKlxyXG4gICAqIE5PVEU6IFNWRyBoYXMgY2VydGFpbiBzdG9wIHJlcXVpcmVtZW50cywgc28gd2UgbmVlZCB0byByZW1hcC9yZXZlcnNlIGluIHNvbWUgY2FzZXMuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGdldFNWR1N0b3BzKCk6IEdyYWRpZW50U3RvcFtdIHtcclxuICAgIGNvbnN0IHN0YXJ0SXNMYXJnZXIgPSB0aGlzLnN0YXJ0SXNMYXJnZXI7XHJcbiAgICBjb25zdCBtYXhSYWRpdXMgPSB0aGlzLm1heFJhZGl1cztcclxuICAgIGNvbnN0IG1pblJhZGl1cyA9IHRoaXMubWluUmFkaXVzO1xyXG5cclxuICAgIC8vVE9ETzogcmVwbGFjZSB3aXRoIHBoZXQuZG90LlV0aWxzLmxpbmVhciBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvMTU4MVxyXG4gICAgLy8gbWFwcyB4IGxpbmVhcmx5IGZyb20gW2EwLGIwXSA9PiBbYTEsYjFdXHJcbiAgICBmdW5jdGlvbiBsaW5lYXJNYXAoIGEwOiBudW1iZXIsIGIwOiBudW1iZXIsIGExOiBudW1iZXIsIGIxOiBudW1iZXIsIHg6IG51bWJlciApOiBudW1iZXIge1xyXG4gICAgICByZXR1cm4gYTEgKyAoIHggLSBhMCApICogKCBiMSAtIGExICkgLyAoIGIwIC0gYTAgKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtYXBTdG9wKCBzdG9wOiBHcmFkaWVudFN0b3AgKTogeyByYXRpbzogbnVtYmVyOyBjb2xvcjogVENvbG9yIH0ge1xyXG4gICAgICAvLyBmbGlwIHRoZSBzdG9wcyBpZiB0aGUgc3RhcnQgaGFzIGEgbGFyZ2VyIHJhZGl1c1xyXG4gICAgICBsZXQgcmF0aW8gPSBzdGFydElzTGFyZ2VyID8gMSAtIHN0b3AucmF0aW8gOiBzdG9wLnJhdGlvO1xyXG5cclxuICAgICAgLy8gc2NhbGUgdGhlIHN0b3BzIHByb3Blcmx5IGlmIHRoZSBzbWFsbGVyIHJhZGl1cyBpc24ndCAwXHJcbiAgICAgIGlmICggbWluUmFkaXVzID4gMCApIHtcclxuICAgICAgICAvLyBzY2FsZXMgb3VyIHJhdGlvIGZyb20gWzAsMV0gPT4gW21pblJhZGl1cy9tYXhSYWRpdXMsMF1cclxuICAgICAgICByYXRpbyA9IGxpbmVhck1hcCggMCwgMSwgbWluUmFkaXVzIC8gbWF4UmFkaXVzLCAxLCByYXRpbyApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHJhdGlvOiByYXRpbyxcclxuICAgICAgICBjb2xvcjogc3RvcC5jb2xvclxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0b3BzID0gdGhpcy5zdG9wcy5tYXAoIG1hcFN0b3AgKTtcclxuXHJcbiAgICAvLyBzd2l0Y2ggdGhlIGRpcmVjdGlvbiB3ZSBhcHBseSBzdG9wcyBpbiwgc28gdGhhdCB0aGUgcmF0aW9zIGFsd2F5cyBhcmUgaW5jcmVhc2luZy5cclxuICAgIGlmICggc3RhcnRJc0xhcmdlciApIHtcclxuICAgICAgc3RvcHMucmV2ZXJzZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzdG9wcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgYSBzdHJpbmcgZm9ybSBvZiB0aGlzIG9iamVjdFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSB0b1N0cmluZygpOiBzdHJpbmcge1xyXG4gICAgbGV0IHJlc3VsdCA9IGBuZXcgcGhldC5zY2VuZXJ5LlJhZGlhbEdyYWRpZW50KCAke3RoaXMuc3RhcnQueH0sICR7dGhpcy5zdGFydC55fSwgJHt0aGlzLnN0YXJ0UmFkaXVzfSwgJHt0aGlzLmVuZC54fSwgJHt0aGlzLmVuZC55fSwgJHt0aGlzLmVuZFJhZGl1c30gKWA7XHJcblxyXG4gICAgXy5lYWNoKCB0aGlzLnN0b3BzLCBzdG9wID0+IHtcclxuICAgICAgcmVzdWx0ICs9IGAuYWRkQ29sb3JTdG9wKCAke3N0b3AucmF0aW99LCAke0NvbG9yRGVmLnNjZW5lcnlTZXJpYWxpemUoIHN0b3AuY29sb3IgKX0gKWA7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc1JhZGlhbEdyYWRpZW50ITogYm9vbGVhbjtcclxufVxyXG5cclxuUmFkaWFsR3JhZGllbnQucHJvdG90eXBlLmlzUmFkaWFsR3JhZGllbnQgPSB0cnVlO1xyXG5cclxuc2NlbmVyeS5yZWdpc3RlciggJ1JhZGlhbEdyYWRpZW50JywgUmFkaWFsR3JhZGllbnQgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSw0QkFBNEI7QUFDaEQsT0FBT0MsUUFBUSxNQUFNLG1DQUFtQztBQUN4RCxTQUFTQyxRQUFRLEVBQUVDLFFBQVEsRUFBZ0JDLE9BQU8sRUFBWUMsaUJBQWlCLFFBQWdCLGVBQWU7QUFFOUcsZUFBZSxNQUFNQyxjQUFjLFNBQVNILFFBQVEsQ0FBQztFQUtuRDs7RUFJQTtFQUNBOztFQUdBOztFQUlBOztFQUlBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNTSSxXQUFXQSxDQUFFQyxFQUFVLEVBQUVDLEVBQVUsRUFBRUMsRUFBVSxFQUFFQyxFQUFVLEVBQUVDLEVBQVUsRUFBRUMsRUFB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