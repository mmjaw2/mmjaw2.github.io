// Copyright 2021-2024, University of Colorado Boulder

/**
 * ProfileColorProperty is a ColorProperty that changes its value based on the value of colorProfileProperty.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */
import arrayRemove from '../../../phet-core/js/arrayRemove.js';
import { Color, colorProfileProperty, ColorProperty, scenery, SceneryConstants } from '../imports.js';
import optionize from '../../../phet-core/js/optionize.js';

// constant
const NAME_SEPARATOR = '.';

// static instances are tracked for iframe communication with the HTML color editor
const instances = [];
export default class ProfileColorProperty extends ColorProperty {
  // values are mutated by the HTML color wrapper.
  // (scenery-internal)

  // Treat as private

  /**
   * @param namespace - namespace that this color belongs to
   * @param colorName - name of the color, unique within namespace
   * @param colorProfileMap - object literal that maps keys (profile names) to ColorDef (that should be immutable)
   * @param [providedOptions]
   */
  constructor(namespace, colorName, colorProfileMap, providedOptions) {
    const options = optionize()({
      // So that notifications won't occur when we change from different objects representing the same color.
      // We should never be mutating the Color objects used for ProfileColorProperty.
      valueComparisonStrategy: 'equalsFunction',
      // See https://github.com/phetsims/scenery/issues/1512
      tandemNameSuffix: ['ColorProperty', 'FillProperty', 'StrokeProperty']
    }, providedOptions);

    // All values are eagerly coerced to Color instances for efficiency (so it only has to be done once) and simplicity
    // (so the types are uniform)
    colorProfileMap = _.mapValues(colorProfileMap, color => {
      // Force Color values to be immutable.
      return Color.toColor(color).setImmutable();
    });
    assert && assert(colorProfileMap.hasOwnProperty(SceneryConstants.DEFAULT_COLOR_PROFILE), 'default color profile must be provided');
    assert && assert(!!colorProfileMap[SceneryConstants.DEFAULT_COLOR_PROFILE], 'default color profile must be truthy');

    // Fallback to default if a color was not supplied.
    super(Color.toColor(colorProfileMap[colorProfileProperty.value] || colorProfileMap[SceneryConstants.DEFAULT_COLOR_PROFILE]), options);
    this.colorProfileMap = colorProfileMap;

    // When the color profile name changes, select the corresponding color.
    colorProfileProperty.link(colorProfileName => {
      // fallback to default if a color not supplied
      this.value = Color.toColor(this.colorProfileMap[colorProfileName] || this.colorProfileMap[SceneryConstants.DEFAULT_COLOR_PROFILE]);
    });
    this.name = `${namespace.name}${NAME_SEPARATOR}${colorName}`;

    // On initialization and when the color changes, send a message to the parent frame identifying the color value.
    // The HTML color editor wrapper listens for these messages and displays the color values.
    this.link(color => {
      if (window.parent !== window) {
        window.parent.postMessage(JSON.stringify({
          type: 'reportColor',
          name: this.name,
          value: color.toHexString(),
          alpha: color.getAlpha()
        }), '*');
      }
    });

    // assert that names are unique
    if (assert) {
      const matches = instances.filter(e => e.name === this.name);
      assert && assert(matches.length === 0, 'cannot use the same name for two different ProfileColorProperty instances: ' + name);
    }

    // Register with the static list for the HTML color editor
    instances.push(this);
  }
  dispose() {
    arrayRemove(instances, this);
    super.dispose();
  }
}

// Listen for messages from the HTML color editor wrapper with new color values.
window.addEventListener('message', event => {
  let data;
  try {
    data = JSON.parse(event.data);
  } catch (e) {
    // We don't do anything with the caught value. If this happens, it is not JSON. This can happen with the
    // LoL wrappers, see https://github.com/phetsims/joist/issues/484.
  }
  if (data && data.type === 'setColor') {
    for (let i = 0; i < instances.length; i++) {
      const instanceProperty = instances[i];
      if (instanceProperty.name === data.name) {
        instanceProperty.colorProfileMap[colorProfileProperty.value] = new Color(data.value).withAlpha(data.alpha);
        instanceProperty.value = Color.toColor(instanceProperty.colorProfileMap[colorProfileProperty.value]);
      }
    }
  }
});
scenery.register('ProfileColorProperty', ProfileColorProperty);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhcnJheVJlbW92ZSIsIkNvbG9yIiwiY29sb3JQcm9maWxlUHJvcGVydHkiLCJDb2xvclByb3BlcnR5Iiwic2NlbmVyeSIsIlNjZW5lcnlDb25zdGFudHMiLCJvcHRpb25pemUiLCJOQU1FX1NFUEFSQVRPUiIsImluc3RhbmNlcyIsIlByb2ZpbGVDb2xvclByb3BlcnR5IiwiY29uc3RydWN0b3IiLCJuYW1lc3BhY2UiLCJjb2xvck5hbWUiLCJjb2xvclByb2ZpbGVNYXAiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwidmFsdWVDb21wYXJpc29uU3RyYXRlZ3kiLCJ0YW5kZW1OYW1lU3VmZml4IiwiXyIsIm1hcFZhbHVlcyIsImNvbG9yIiwidG9Db2xvciIsInNldEltbXV0YWJsZSIsImFzc2VydCIsImhhc093blByb3BlcnR5IiwiREVGQVVMVF9DT0xPUl9QUk9GSUxFIiwidmFsdWUiLCJsaW5rIiwiY29sb3JQcm9maWxlTmFtZSIsIm5hbWUiLCJ3aW5kb3ciLCJwYXJlbnQiLCJwb3N0TWVzc2FnZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0eXBlIiwidG9IZXhTdHJpbmciLCJhbHBoYSIsImdldEFscGhhIiwibWF0Y2hlcyIsImZpbHRlciIsImUiLCJsZW5ndGgiLCJwdXNoIiwiZGlzcG9zZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImRhdGEiLCJwYXJzZSIsImkiLCJpbnN0YW5jZVByb3BlcnR5Iiwid2l0aEFscGhhIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQcm9maWxlQ29sb3JQcm9wZXJ0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBQcm9maWxlQ29sb3JQcm9wZXJ0eSBpcyBhIENvbG9yUHJvcGVydHkgdGhhdCBjaGFuZ2VzIGl0cyB2YWx1ZSBiYXNlZCBvbiB0aGUgdmFsdWUgb2YgY29sb3JQcm9maWxlUHJvcGVydHkuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5pbXBvcnQgYXJyYXlSZW1vdmUgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL2FycmF5UmVtb3ZlLmpzJztcclxuaW1wb3J0IE5hbWVzcGFjZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvTmFtZXNwYWNlLmpzJztcclxuaW1wb3J0IHsgUHJvcGVydHlPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBjb2xvclByb2ZpbGVQcm9wZXJ0eSwgQ29sb3JQcm9wZXJ0eSwgc2NlbmVyeSwgU2NlbmVyeUNvbnN0YW50cyB9IGZyb20gJy4uL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IEVtcHR5U2VsZk9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuXHJcbi8vIGNvbnN0YW50XHJcbmNvbnN0IE5BTUVfU0VQQVJBVE9SID0gJy4nO1xyXG5cclxuLy8gc3RhdGljIGluc3RhbmNlcyBhcmUgdHJhY2tlZCBmb3IgaWZyYW1lIGNvbW11bmljYXRpb24gd2l0aCB0aGUgSFRNTCBjb2xvciBlZGl0b3JcclxuY29uc3QgaW5zdGFuY2VzOiBQcm9maWxlQ29sb3JQcm9wZXJ0eVtdID0gW107XHJcblxyXG50eXBlIENvbG9yUHJvZmlsZU1hcCA9IFJlY29yZDxzdHJpbmcsIENvbG9yIHwgc3RyaW5nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2ZpbGVDb2xvclByb3BlcnR5IGV4dGVuZHMgQ29sb3JQcm9wZXJ0eSB7XHJcblxyXG4gIC8vIHZhbHVlcyBhcmUgbXV0YXRlZCBieSB0aGUgSFRNTCBjb2xvciB3cmFwcGVyLlxyXG4gIC8vIChzY2VuZXJ5LWludGVybmFsKVxyXG4gIHB1YmxpYyByZWFkb25seSBjb2xvclByb2ZpbGVNYXA6IENvbG9yUHJvZmlsZU1hcDtcclxuXHJcbiAgLy8gVHJlYXQgYXMgcHJpdmF0ZVxyXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBuYW1lc3BhY2UgLSBuYW1lc3BhY2UgdGhhdCB0aGlzIGNvbG9yIGJlbG9uZ3MgdG9cclxuICAgKiBAcGFyYW0gY29sb3JOYW1lIC0gbmFtZSBvZiB0aGUgY29sb3IsIHVuaXF1ZSB3aXRoaW4gbmFtZXNwYWNlXHJcbiAgICogQHBhcmFtIGNvbG9yUHJvZmlsZU1hcCAtIG9iamVjdCBsaXRlcmFsIHRoYXQgbWFwcyBrZXlzIChwcm9maWxlIG5hbWVzKSB0byBDb2xvckRlZiAodGhhdCBzaG91bGQgYmUgaW1tdXRhYmxlKVxyXG4gICAqIEBwYXJhbSBbcHJvdmlkZWRPcHRpb25zXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbmFtZXNwYWNlOiBOYW1lc3BhY2UsIGNvbG9yTmFtZTogc3RyaW5nLCBjb2xvclByb2ZpbGVNYXA6IENvbG9yUHJvZmlsZU1hcCwgcHJvdmlkZWRPcHRpb25zPzogUHJvcGVydHlPcHRpb25zPENvbG9yPiApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFByb3BlcnR5T3B0aW9uczxDb2xvcj4sIEVtcHR5U2VsZk9wdGlvbnMsIFByb3BlcnR5T3B0aW9uczxDb2xvcj4+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNvIHRoYXQgbm90aWZpY2F0aW9ucyB3b24ndCBvY2N1ciB3aGVuIHdlIGNoYW5nZSBmcm9tIGRpZmZlcmVudCBvYmplY3RzIHJlcHJlc2VudGluZyB0aGUgc2FtZSBjb2xvci5cclxuICAgICAgLy8gV2Ugc2hvdWxkIG5ldmVyIGJlIG11dGF0aW5nIHRoZSBDb2xvciBvYmplY3RzIHVzZWQgZm9yIFByb2ZpbGVDb2xvclByb3BlcnR5LlxyXG4gICAgICB2YWx1ZUNvbXBhcmlzb25TdHJhdGVneTogJ2VxdWFsc0Z1bmN0aW9uJyxcclxuXHJcbiAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvMTUxMlxyXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiBbICdDb2xvclByb3BlcnR5JywgJ0ZpbGxQcm9wZXJ0eScsICdTdHJva2VQcm9wZXJ0eScgXVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gQWxsIHZhbHVlcyBhcmUgZWFnZXJseSBjb2VyY2VkIHRvIENvbG9yIGluc3RhbmNlcyBmb3IgZWZmaWNpZW5jeSAoc28gaXQgb25seSBoYXMgdG8gYmUgZG9uZSBvbmNlKSBhbmQgc2ltcGxpY2l0eVxyXG4gICAgLy8gKHNvIHRoZSB0eXBlcyBhcmUgdW5pZm9ybSlcclxuICAgIGNvbG9yUHJvZmlsZU1hcCA9IF8ubWFwVmFsdWVzKCBjb2xvclByb2ZpbGVNYXAsIGNvbG9yID0+IHtcclxuICAgICAgLy8gRm9yY2UgQ29sb3IgdmFsdWVzIHRvIGJlIGltbXV0YWJsZS5cclxuICAgICAgcmV0dXJuIENvbG9yLnRvQ29sb3IoIGNvbG9yICkuc2V0SW1tdXRhYmxlKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29sb3JQcm9maWxlTWFwLmhhc093blByb3BlcnR5KCBTY2VuZXJ5Q29uc3RhbnRzLkRFRkFVTFRfQ09MT1JfUFJPRklMRSApLCAnZGVmYXVsdCBjb2xvciBwcm9maWxlIG11c3QgYmUgcHJvdmlkZWQnICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhIWNvbG9yUHJvZmlsZU1hcFsgU2NlbmVyeUNvbnN0YW50cy5ERUZBVUxUX0NPTE9SX1BST0ZJTEUgXSwgJ2RlZmF1bHQgY29sb3IgcHJvZmlsZSBtdXN0IGJlIHRydXRoeScgKTtcclxuXHJcbiAgICAvLyBGYWxsYmFjayB0byBkZWZhdWx0IGlmIGEgY29sb3Igd2FzIG5vdCBzdXBwbGllZC5cclxuICAgIHN1cGVyKCBDb2xvci50b0NvbG9yKCBjb2xvclByb2ZpbGVNYXBbIGNvbG9yUHJvZmlsZVByb3BlcnR5LnZhbHVlIF0gfHwgY29sb3JQcm9maWxlTWFwWyBTY2VuZXJ5Q29uc3RhbnRzLkRFRkFVTFRfQ09MT1JfUFJPRklMRSBdICksIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmNvbG9yUHJvZmlsZU1hcCA9IGNvbG9yUHJvZmlsZU1hcDtcclxuXHJcbiAgICAvLyBXaGVuIHRoZSBjb2xvciBwcm9maWxlIG5hbWUgY2hhbmdlcywgc2VsZWN0IHRoZSBjb3JyZXNwb25kaW5nIGNvbG9yLlxyXG4gICAgY29sb3JQcm9maWxlUHJvcGVydHkubGluayggY29sb3JQcm9maWxlTmFtZSA9PiB7XHJcblxyXG4gICAgICAvLyBmYWxsYmFjayB0byBkZWZhdWx0IGlmIGEgY29sb3Igbm90IHN1cHBsaWVkXHJcbiAgICAgIHRoaXMudmFsdWUgPSBDb2xvci50b0NvbG9yKCB0aGlzLmNvbG9yUHJvZmlsZU1hcFsgY29sb3JQcm9maWxlTmFtZSBdIHx8IHRoaXMuY29sb3JQcm9maWxlTWFwWyBTY2VuZXJ5Q29uc3RhbnRzLkRFRkFVTFRfQ09MT1JfUFJPRklMRSBdICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5uYW1lID0gYCR7bmFtZXNwYWNlLm5hbWV9JHtOQU1FX1NFUEFSQVRPUn0ke2NvbG9yTmFtZX1gO1xyXG5cclxuICAgIC8vIE9uIGluaXRpYWxpemF0aW9uIGFuZCB3aGVuIHRoZSBjb2xvciBjaGFuZ2VzLCBzZW5kIGEgbWVzc2FnZSB0byB0aGUgcGFyZW50IGZyYW1lIGlkZW50aWZ5aW5nIHRoZSBjb2xvciB2YWx1ZS5cclxuICAgIC8vIFRoZSBIVE1MIGNvbG9yIGVkaXRvciB3cmFwcGVyIGxpc3RlbnMgZm9yIHRoZXNlIG1lc3NhZ2VzIGFuZCBkaXNwbGF5cyB0aGUgY29sb3IgdmFsdWVzLlxyXG4gICAgdGhpcy5saW5rKCBjb2xvciA9PiB7XHJcbiAgICAgIGlmICggd2luZG93LnBhcmVudCAhPT0gd2luZG93ICkge1xyXG4gICAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoIEpTT04uc3RyaW5naWZ5KCB7XHJcbiAgICAgICAgICB0eXBlOiAncmVwb3J0Q29sb3InLFxyXG4gICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICAgICAgdmFsdWU6IGNvbG9yLnRvSGV4U3RyaW5nKCksXHJcbiAgICAgICAgICBhbHBoYTogY29sb3IuZ2V0QWxwaGEoKVxyXG4gICAgICAgIH0gKSwgJyonICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBhc3NlcnQgdGhhdCBuYW1lcyBhcmUgdW5pcXVlXHJcbiAgICBpZiAoIGFzc2VydCApIHtcclxuICAgICAgY29uc3QgbWF0Y2hlcyA9IGluc3RhbmNlcy5maWx0ZXIoIGUgPT4gZS5uYW1lID09PSB0aGlzLm5hbWUgKTtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggbWF0Y2hlcy5sZW5ndGggPT09IDAsICdjYW5ub3QgdXNlIHRoZSBzYW1lIG5hbWUgZm9yIHR3byBkaWZmZXJlbnQgUHJvZmlsZUNvbG9yUHJvcGVydHkgaW5zdGFuY2VzOiAnICsgbmFtZSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlZ2lzdGVyIHdpdGggdGhlIHN0YXRpYyBsaXN0IGZvciB0aGUgSFRNTCBjb2xvciBlZGl0b3JcclxuICAgIGluc3RhbmNlcy5wdXNoKCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFycmF5UmVtb3ZlKCBpbnN0YW5jZXMsIHRoaXMgKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIExpc3RlbiBmb3IgbWVzc2FnZXMgZnJvbSB0aGUgSFRNTCBjb2xvciBlZGl0b3Igd3JhcHBlciB3aXRoIG5ldyBjb2xvciB2YWx1ZXMuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAnbWVzc2FnZScsIGV2ZW50ID0+IHtcclxuICBsZXQgZGF0YTtcclxuICB0cnkge1xyXG4gICAgZGF0YSA9IEpTT04ucGFyc2UoIGV2ZW50LmRhdGEgKTtcclxuICB9XHJcbiAgY2F0Y2goIGUgKSB7XHJcbiAgICAvLyBXZSBkb24ndCBkbyBhbnl0aGluZyB3aXRoIHRoZSBjYXVnaHQgdmFsdWUuIElmIHRoaXMgaGFwcGVucywgaXQgaXMgbm90IEpTT04uIFRoaXMgY2FuIGhhcHBlbiB3aXRoIHRoZVxyXG4gICAgLy8gTG9MIHdyYXBwZXJzLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2pvaXN0L2lzc3Vlcy80ODQuXHJcbiAgfVxyXG5cclxuICBpZiAoIGRhdGEgJiYgZGF0YS50eXBlID09PSAnc2V0Q29sb3InICkge1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgaW5zdGFuY2VzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCBpbnN0YW5jZVByb3BlcnR5ID0gaW5zdGFuY2VzWyBpIF07XHJcbiAgICAgIGlmICggaW5zdGFuY2VQcm9wZXJ0eS5uYW1lID09PSBkYXRhLm5hbWUgKSB7XHJcbiAgICAgICAgaW5zdGFuY2VQcm9wZXJ0eS5jb2xvclByb2ZpbGVNYXBbIGNvbG9yUHJvZmlsZVByb3BlcnR5LnZhbHVlIF0gPSBuZXcgQ29sb3IoIGRhdGEudmFsdWUgKS53aXRoQWxwaGEoIGRhdGEuYWxwaGEgKTtcclxuICAgICAgICBpbnN0YW5jZVByb3BlcnR5LnZhbHVlID0gQ29sb3IudG9Db2xvciggaW5zdGFuY2VQcm9wZXJ0eS5jb2xvclByb2ZpbGVNYXBbIGNvbG9yUHJvZmlsZVByb3BlcnR5LnZhbHVlIF0gKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufSApO1xyXG5cclxuc2NlbmVyeS5yZWdpc3RlciggJ1Byb2ZpbGVDb2xvclByb3BlcnR5JywgUHJvZmlsZUNvbG9yUHJvcGVydHkgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPQSxXQUFXLE1BQU0s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