// Copyright 2021-2024, University of Colorado Boulder

/**
 * Responsible for setting the provided focusProperty to null when the Focused node either
 * becomes invisible on the Display or is removed from the scene graph. It uses a
 * TrailVisibilityTracker to determine if any Node in the Trail has become invisible.
 *
 * Meant to be scenery-internal and used by FocusManager.
 *
 * @author Jesse Greenberg
 */

import { scenery, TrailVisibilityTracker } from '../imports.js';
class FocusDisplayedController {
  // last Node of the Trail that is focused, referenced so we can add and remove listeners from it
  node = null;

  // Observes the Trail to the Node and notifies when it has become invisible
  visibilityTracker = null;

  // When there is value, we will watch and update when there are changes to the displayed state of the Focus trail.

  // Bound functions that are called when the displayed state of the Node changes.

  // Handles changes to focus, adding or removing listeners

  constructor(focusProperty) {
    this.focusProperty = focusProperty;
    this.boundVisibilityListener = this.handleTrailVisibilityChange.bind(this);
    this.boundInstancesChangedListener = this.handleInstancesChange.bind(this);
    this.boundNodeDisposedListener = this.handleNodeDisposed.bind(this);
    this.boundFocusListener = this.handleFocusChange.bind(this);
    this.focusProperty.link(this.boundFocusListener);
  }

  /**
   * When Focus changes, remove any listeners that were attached from last Focus and
   * add new listeners if focus has a new value.
   */
  handleFocusChange(focus) {
    this.removeDisplayedListeners();
    if (focus) {
      this.addDisplayedListeners(focus);
    }
  }

  /**
   * When the Trail becomes invisible, Focus should be set to null.
   */
  handleTrailVisibilityChange() {
    if (this.visibilityTracker && !this.visibilityTracker.trailVisibleProperty.value) {
      this.focusProperty.value = null;
    }
  }

  /**
   * If there are no more Instances for the Node with focus it has been removed from
   * the scene graph and so Focus should be set to null.
   */
  handleInstancesChange(instance) {
    if (instance.node && instance.node.instances.length === 0) {
      this.focusProperty.value = null;
    }
  }

  /**
   * While this focus-clear is mostly covered by listening for instance changes, there is an intermediate state between
   * when a Node is disposed, and when the Instance tree is updated to reflect that disposal (during updateDisplay()).
   * This function handles that atypical case (pretty much impossible to get to in PhET sims except during fuzzing).
   */
  handleNodeDisposed() {
    this.focusProperty.value = null;
  }

  /**
   * Add listeners that watch when the Displayed state of the Node with Focus has changed,
   * including visibility of the trail and attachment to a scene graph.
   */
  addDisplayedListeners(focus) {
    assert && assert(this.visibilityTracker === null, 'creating a new TrailVisibilityTracker but the last one was not disposed');
    assert && assert(this.node === null, 'Still a reference to the previously focused Node, possible memory leak');
    this.visibilityTracker = new TrailVisibilityTracker(focus.trail);
    this.visibilityTracker.addListener(this.boundVisibilityListener);
    this.node = focus.trail.lastNode();

    // This is potentially dangerous to listen to generally, but in this case it is safe because the state we change
    // will only affect a separate display's state, not this one.
    this.node.changedInstanceEmitter.addListener(this.boundInstancesChangedListener);
    this.node.disposeEmitter.addListener(this.boundNodeDisposedListener);
  }

  /**
   * Remove any listeners that were added to observables that fire when the Node's displayed
   * state may have changed.
   */
  removeDisplayedListeners() {
    if (this.visibilityTracker) {
      this.visibilityTracker.removeListener(this.boundVisibilityListener);
      this.visibilityTracker.dispose();
      this.visibilityTracker = null;
    }
    if (this.node) {
      this.node.changedInstanceEmitter.removeListener(this.boundInstancesChangedListener);
      this.node.disposeEmitter.removeListener(this.boundNodeDisposedListener);
      this.node = null;
    }
  }
  dispose() {
    // this disposes the TrailVisibilityTracker and removes any listeners on the Node
    this.removeDisplayedListeners();
    this.focusProperty.unlink(this.boundFocusListener);
    this.node = null;
    this.visibilityTracker = null;
  }
}
scenery.register('FocusDisplayedController', FocusDisplayedController);
export default FocusDisplayedController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzY2VuZXJ5IiwiVHJhaWxWaXNpYmlsaXR5VHJhY2tlciIsIkZvY3VzRGlzcGxheWVkQ29udHJvbGxlciIsIm5vZGUiLCJ2aXNpYmlsaXR5VHJhY2tlciIsImNvbnN0cnVjdG9yIiwiZm9jdXNQcm9wZXJ0eSIsImJvdW5kVmlzaWJpbGl0eUxpc3RlbmVyIiwiaGFuZGxlVHJhaWxWaXNpYmlsaXR5Q2hhbmdlIiwiYmluZCIsImJvdW5kSW5zdGFuY2VzQ2hhbmdlZExpc3RlbmVyIiwiaGFuZGxlSW5zdGFuY2VzQ2hhbmdlIiwiYm91bmROb2RlRGlzcG9zZWRMaXN0ZW5lciIsImhhbmRsZU5vZGVEaXNwb3NlZCIsImJvdW5kRm9jdXNMaXN0ZW5lciIsImhhbmRsZUZvY3VzQ2hhbmdlIiwibGluayIsImZvY3VzIiwicmVtb3ZlRGlzcGxheWVkTGlzdGVuZXJzIiwiYWRkRGlzcGxheWVkTGlzdGVuZXJzIiwidHJhaWxWaXNpYmxlUHJvcGVydHkiLCJ2YWx1ZSIsImluc3RhbmNlIiwiaW5zdGFuY2VzIiwibGVuZ3RoIiwiYXNzZXJ0IiwidHJhaWwiLCJhZGRMaXN0ZW5lciIsImxhc3ROb2RlIiwiY2hhbmdlZEluc3RhbmNlRW1pdHRlciIsImRpc3Bvc2VFbWl0dGVyIiwicmVtb3ZlTGlzdGVuZXIiLCJkaXNwb3NlIiwidW5saW5rIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJGb2N1c0Rpc3BsYXllZENvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUmVzcG9uc2libGUgZm9yIHNldHRpbmcgdGhlIHByb3ZpZGVkIGZvY3VzUHJvcGVydHkgdG8gbnVsbCB3aGVuIHRoZSBGb2N1c2VkIG5vZGUgZWl0aGVyXHJcbiAqIGJlY29tZXMgaW52aXNpYmxlIG9uIHRoZSBEaXNwbGF5IG9yIGlzIHJlbW92ZWQgZnJvbSB0aGUgc2NlbmUgZ3JhcGguIEl0IHVzZXMgYVxyXG4gKiBUcmFpbFZpc2liaWxpdHlUcmFja2VyIHRvIGRldGVybWluZSBpZiBhbnkgTm9kZSBpbiB0aGUgVHJhaWwgaGFzIGJlY29tZSBpbnZpc2libGUuXHJcbiAqXHJcbiAqIE1lYW50IHRvIGJlIHNjZW5lcnktaW50ZXJuYWwgYW5kIHVzZWQgYnkgRm9jdXNNYW5hZ2VyLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKi9cclxuXHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgeyBGb2N1cywgSW5zdGFuY2UsIE5vZGUsIHNjZW5lcnksIFRyYWlsVmlzaWJpbGl0eVRyYWNrZXIgfSBmcm9tICcuLi9pbXBvcnRzLmpzJztcclxuXHJcbmNsYXNzIEZvY3VzRGlzcGxheWVkQ29udHJvbGxlciB7XHJcblxyXG4gIC8vIGxhc3QgTm9kZSBvZiB0aGUgVHJhaWwgdGhhdCBpcyBmb2N1c2VkLCByZWZlcmVuY2VkIHNvIHdlIGNhbiBhZGQgYW5kIHJlbW92ZSBsaXN0ZW5lcnMgZnJvbSBpdFxyXG4gIHByaXZhdGUgbm9kZTogTm9kZSB8IG51bGwgPSBudWxsO1xyXG5cclxuICAvLyBPYnNlcnZlcyB0aGUgVHJhaWwgdG8gdGhlIE5vZGUgYW5kIG5vdGlmaWVzIHdoZW4gaXQgaGFzIGJlY29tZSBpbnZpc2libGVcclxuICBwcml2YXRlIHZpc2liaWxpdHlUcmFja2VyOiBUcmFpbFZpc2liaWxpdHlUcmFja2VyIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIC8vIFdoZW4gdGhlcmUgaXMgdmFsdWUsIHdlIHdpbGwgd2F0Y2ggYW5kIHVwZGF0ZSB3aGVuIHRoZXJlIGFyZSBjaGFuZ2VzIHRvIHRoZSBkaXNwbGF5ZWQgc3RhdGUgb2YgdGhlIEZvY3VzIHRyYWlsLlxyXG4gIHByaXZhdGUgZm9jdXNQcm9wZXJ0eTogVFByb3BlcnR5PEZvY3VzIHwgbnVsbD47XHJcblxyXG4gIC8vIEJvdW5kIGZ1bmN0aW9ucyB0aGF0IGFyZSBjYWxsZWQgd2hlbiB0aGUgZGlzcGxheWVkIHN0YXRlIG9mIHRoZSBOb2RlIGNoYW5nZXMuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBib3VuZFZpc2liaWxpdHlMaXN0ZW5lcjogKCkgPT4gdm9pZDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGJvdW5kSW5zdGFuY2VzQ2hhbmdlZExpc3RlbmVyOiAoIGluc3RhbmNlOiBJbnN0YW5jZSApID0+IHZvaWQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBib3VuZE5vZGVEaXNwb3NlZExpc3RlbmVyOiAoKSA9PiB2b2lkO1xyXG5cclxuICAvLyBIYW5kbGVzIGNoYW5nZXMgdG8gZm9jdXMsIGFkZGluZyBvciByZW1vdmluZyBsaXN0ZW5lcnNcclxuICBwcml2YXRlIHJlYWRvbmx5IGJvdW5kRm9jdXNMaXN0ZW5lcjogKCBmb2N1czogRm9jdXMgfCBudWxsICkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBmb2N1c1Byb3BlcnR5OiBUUHJvcGVydHk8Rm9jdXMgfCBudWxsPiApIHtcclxuICAgIHRoaXMuZm9jdXNQcm9wZXJ0eSA9IGZvY3VzUHJvcGVydHk7XHJcblxyXG4gICAgdGhpcy5ib3VuZFZpc2liaWxpdHlMaXN0ZW5lciA9IHRoaXMuaGFuZGxlVHJhaWxWaXNpYmlsaXR5Q2hhbmdlLmJpbmQoIHRoaXMgKTtcclxuICAgIHRoaXMuYm91bmRJbnN0YW5jZXNDaGFuZ2VkTGlzdGVuZXIgPSB0aGlzLmhhbmRsZUluc3RhbmNlc0NoYW5nZS5iaW5kKCB0aGlzICk7XHJcbiAgICB0aGlzLmJvdW5kTm9kZURpc3Bvc2VkTGlzdGVuZXIgPSB0aGlzLmhhbmRsZU5vZGVEaXNwb3NlZC5iaW5kKCB0aGlzICk7XHJcblxyXG4gICAgdGhpcy5ib3VuZEZvY3VzTGlzdGVuZXIgPSB0aGlzLmhhbmRsZUZvY3VzQ2hhbmdlLmJpbmQoIHRoaXMgKTtcclxuICAgIHRoaXMuZm9jdXNQcm9wZXJ0eS5saW5rKCB0aGlzLmJvdW5kRm9jdXNMaXN0ZW5lciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiBGb2N1cyBjaGFuZ2VzLCByZW1vdmUgYW55IGxpc3RlbmVycyB0aGF0IHdlcmUgYXR0YWNoZWQgZnJvbSBsYXN0IEZvY3VzIGFuZFxyXG4gICAqIGFkZCBuZXcgbGlzdGVuZXJzIGlmIGZvY3VzIGhhcyBhIG5ldyB2YWx1ZS5cclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZUZvY3VzQ2hhbmdlKCBmb2N1czogRm9jdXMgfCBudWxsICk6IHZvaWQge1xyXG4gICAgdGhpcy5yZW1vdmVEaXNwbGF5ZWRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICBpZiAoIGZvY3VzICkge1xyXG4gICAgICB0aGlzLmFkZERpc3BsYXllZExpc3RlbmVycyggZm9jdXMgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFdoZW4gdGhlIFRyYWlsIGJlY29tZXMgaW52aXNpYmxlLCBGb2N1cyBzaG91bGQgYmUgc2V0IHRvIG51bGwuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVUcmFpbFZpc2liaWxpdHlDaGFuZ2UoKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMudmlzaWJpbGl0eVRyYWNrZXIgJiYgIXRoaXMudmlzaWJpbGl0eVRyYWNrZXIudHJhaWxWaXNpYmxlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgIHRoaXMuZm9jdXNQcm9wZXJ0eS52YWx1ZSA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJZiB0aGVyZSBhcmUgbm8gbW9yZSBJbnN0YW5jZXMgZm9yIHRoZSBOb2RlIHdpdGggZm9jdXMgaXQgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tXHJcbiAgICogdGhlIHNjZW5lIGdyYXBoIGFuZCBzbyBGb2N1cyBzaG91bGQgYmUgc2V0IHRvIG51bGwuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVJbnN0YW5jZXNDaGFuZ2UoIGluc3RhbmNlOiBJbnN0YW5jZSApOiB2b2lkIHtcclxuICAgIGlmICggaW5zdGFuY2Uubm9kZSAmJiBpbnN0YW5jZS5ub2RlLmluc3RhbmNlcy5sZW5ndGggPT09IDAgKSB7XHJcbiAgICAgIHRoaXMuZm9jdXNQcm9wZXJ0eS52YWx1ZSA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXaGlsZSB0aGlzIGZvY3VzLWNsZWFyIGlzIG1vc3RseSBjb3ZlcmVkIGJ5IGxpc3RlbmluZyBmb3IgaW5zdGFuY2UgY2hhbmdlcywgdGhlcmUgaXMgYW4gaW50ZXJtZWRpYXRlIHN0YXRlIGJldHdlZW5cclxuICAgKiB3aGVuIGEgTm9kZSBpcyBkaXNwb3NlZCwgYW5kIHdoZW4gdGhlIEluc3RhbmNlIHRyZWUgaXMgdXBkYXRlZCB0byByZWZsZWN0IHRoYXQgZGlzcG9zYWwgKGR1cmluZyB1cGRhdGVEaXNwbGF5KCkpLlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaGFuZGxlcyB0aGF0IGF0eXBpY2FsIGNhc2UgKHByZXR0eSBtdWNoIGltcG9zc2libGUgdG8gZ2V0IHRvIGluIFBoRVQgc2ltcyBleGNlcHQgZHVyaW5nIGZ1enppbmcpLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFuZGxlTm9kZURpc3Bvc2VkKCk6IHZvaWQge1xyXG4gICAgdGhpcy5mb2N1c1Byb3BlcnR5LnZhbHVlID0gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZCBsaXN0ZW5lcnMgdGhhdCB3YXRjaCB3aGVuIHRoZSBEaXNwbGF5ZWQgc3RhdGUgb2YgdGhlIE5vZGUgd2l0aCBGb2N1cyBoYXMgY2hhbmdlZCxcclxuICAgKiBpbmNsdWRpbmcgdmlzaWJpbGl0eSBvZiB0aGUgdHJhaWwgYW5kIGF0dGFjaG1lbnQgdG8gYSBzY2VuZSBncmFwaC5cclxuICAgKi9cclxuICBwcml2YXRlIGFkZERpc3BsYXllZExpc3RlbmVycyggZm9jdXM6IEZvY3VzICk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy52aXNpYmlsaXR5VHJhY2tlciA9PT0gbnVsbCwgJ2NyZWF0aW5nIGEgbmV3IFRyYWlsVmlzaWJpbGl0eVRyYWNrZXIgYnV0IHRoZSBsYXN0IG9uZSB3YXMgbm90IGRpc3Bvc2VkJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5ub2RlID09PSBudWxsLCAnU3RpbGwgYSByZWZlcmVuY2UgdG8gdGhlIHByZXZpb3VzbHkgZm9jdXNlZCBOb2RlLCBwb3NzaWJsZSBtZW1vcnkgbGVhaycgKTtcclxuXHJcbiAgICB0aGlzLnZpc2liaWxpdHlUcmFja2VyID0gbmV3IFRyYWlsVmlzaWJpbGl0eVRyYWNrZXIoIGZvY3VzLnRyYWlsICk7XHJcbiAgICB0aGlzLnZpc2liaWxpdHlUcmFja2VyLmFkZExpc3RlbmVyKCB0aGlzLmJvdW5kVmlzaWJpbGl0eUxpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5ub2RlID0gZm9jdXMudHJhaWwubGFzdE5vZGUoKTtcclxuXHJcbiAgICAvLyBUaGlzIGlzIHBvdGVudGlhbGx5IGRhbmdlcm91cyB0byBsaXN0ZW4gdG8gZ2VuZXJhbGx5LCBidXQgaW4gdGhpcyBjYXNlIGl0IGlzIHNhZmUgYmVjYXVzZSB0aGUgc3RhdGUgd2UgY2hhbmdlXHJcbiAgICAvLyB3aWxsIG9ubHkgYWZmZWN0IGEgc2VwYXJhdGUgZGlzcGxheSdzIHN0YXRlLCBub3QgdGhpcyBvbmUuXHJcbiAgICB0aGlzLm5vZGUuY2hhbmdlZEluc3RhbmNlRW1pdHRlci5hZGRMaXN0ZW5lciggdGhpcy5ib3VuZEluc3RhbmNlc0NoYW5nZWRMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5ub2RlLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCB0aGlzLmJvdW5kTm9kZURpc3Bvc2VkTGlzdGVuZXIgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZSBhbnkgbGlzdGVuZXJzIHRoYXQgd2VyZSBhZGRlZCB0byBvYnNlcnZhYmxlcyB0aGF0IGZpcmUgd2hlbiB0aGUgTm9kZSdzIGRpc3BsYXllZFxyXG4gICAqIHN0YXRlIG1heSBoYXZlIGNoYW5nZWQuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZW1vdmVEaXNwbGF5ZWRMaXN0ZW5lcnMoKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMudmlzaWJpbGl0eVRyYWNrZXIgKSB7XHJcbiAgICAgIHRoaXMudmlzaWJpbGl0eVRyYWNrZXIucmVtb3ZlTGlzdGVuZXIoIHRoaXMuYm91bmRWaXNpYmlsaXR5TGlzdGVuZXIgKTtcclxuICAgICAgdGhpcy52aXNpYmlsaXR5VHJhY2tlci5kaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMudmlzaWJpbGl0eVRyYWNrZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKCB0aGlzLm5vZGUgKSB7XHJcbiAgICAgIHRoaXMubm9kZS5jaGFuZ2VkSW5zdGFuY2VFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCB0aGlzLmJvdW5kSW5zdGFuY2VzQ2hhbmdlZExpc3RlbmVyICk7XHJcbiAgICAgIHRoaXMubm9kZS5kaXNwb3NlRW1pdHRlci5yZW1vdmVMaXN0ZW5lciggdGhpcy5ib3VuZE5vZGVEaXNwb3NlZExpc3RlbmVyICk7XHJcbiAgICAgIHRoaXMubm9kZSA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZGlzcG9zZSgpOiB2b2lkIHtcclxuXHJcbiAgICAvLyB0aGlzIGRpc3Bvc2VzIHRoZSBUcmFpbFZpc2liaWxpdHlUcmFja2VyIGFuZCByZW1vdmVzIGFueSBsaXN0ZW5lcnMgb24gdGhlIE5vZGVcclxuICAgIHRoaXMucmVtb3ZlRGlzcGxheWVkTGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLmZvY3VzUHJvcGVydHkudW5saW5rKCB0aGlzLmJvdW5kRm9jdXNMaXN0ZW5lciApO1xyXG5cclxuICAgIHRoaXMubm9kZSA9IG51bGw7XHJcbiAgICB0aGlzLnZpc2liaWxpdHlUcmFja2VyID0gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnkucmVnaXN0ZXIoICdGb2N1c0Rpc3BsYXllZENvbnRyb2xsZXInLCBGb2N1c0Rpc3BsYXllZENvbnRyb2xsZXIgKTtcclxuZXhwb3J0IGRlZmF1bHQgRm9jdXNEaXNwbGF5ZWRDb250cm9sbGVyOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLFNBQWdDQSxPQUFPLEVBQUVDLHNCQUFzQixRQUFRLGVBQWU7QUFFdEYsTUFBTUMsd0JBQXdCLENBQUM7RUFFN0I7RUFDUUMsSUFBSSxHQUFnQixJQUFJOztFQUVoQztFQUNRQyxpQkFBaUIsR0FBa0MsSUFBSTs7RUFFL0Q7O0VBR0E7O0VBS0E7O0VBR09DLFdBQVdBLENBQUVDLGFBQXNDLEVBQUc7SUFDM0QsSUFBSSxDQUFDQSxhQUFhLEdBQUdBLGFBQWE7SUFFbEMsSUFBSSxDQUFDQyx1QkFBdUIsR0FBRyxJQUFJLENBQUNDLDJCQUEyQixDQUFDQyxJQUFJLENBQUUsSUFBSyxDQUFDO0lBQzVFLElBQUksQ0FBQ0MsNkJBQTZCLEdBQUcsSUFBSSxDQUFDQyxxQkFBcUIsQ0FBQ0YsSUFBSSxDQUFFLElBQUssQ0FBQztJQUM1RSxJQUFJLENBQUNHLHlCQUF5QixHQUFHLElBQUksQ0FBQ0Msa0JBQWtCLENBQUNKLElBQUksQ0FBRSxJQUFLLENBQUM7SUFFckUsSUFBSSxDQUFDSyxrQkFBa0IsR0FBRyxJQUFJLENBQUNDLGlCQUFpQixDQUFDTixJQUFJLENBQUUsSUFBSyxDQUFDO0lBQzdELElBQUksQ0FBQ0gsYUFBYSxDQUFDVSxJQUFJLENBQUUsSUFBSSxDQUFDRixrQkFBbUIsQ0FBQztFQUNwRDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtFQUNVQyxpQkFBaUJBLENBQUVFLEtBQW1CLEVBQVM7SUFDckQsSUFBSSxDQUFDQyx3QkFBd0IsQ0FBQyxDQUFDO0lBRS9CLElBQUtELEtBQUssRUFBRztNQUNYLElBQUksQ0FBQ0UscUJBQXFCLENBQUVGLEtBQU0sQ0FBQztJQUNyQztFQUNGOztFQUVBO0FBQ0Y7QUFDQTtFQUNVVCwyQkFBMkJB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