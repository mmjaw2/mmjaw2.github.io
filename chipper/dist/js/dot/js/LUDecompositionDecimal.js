// Copyright 2021-2023, University of Colorado Boulder

/**
 * Arbitrary-precision LU Decomposition using decimal.js and copy-pasted from LUDecomposition.
 * This is a copy-paste implementation so that the performance characteristics of LUDecomposition are not disturbed.
 * This file should be maintained with LUDecomposition.js
 *
 * This module requires the presence of the preload Decimal.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Sam Reid (PhET Interactive Simulations)
 */

import dot from './dot.js';
class LUDecompositionDecimal {
  /**
   * @param matrix
   * @param {constructor} Decimal - from decimal library
   */
  constructor(matrix, Decimal) {
    let i;
    let j;
    let k;
    this.matrix = matrix;

    // TODO: size! https://github.com/phetsims/dot/issues/96
    this.LU = [];
    matrix.entries.forEach(entry => {
      this.LU.push(new Decimal(entry));
    });
    const LU = this.LU;
    this.m = matrix.getRowDimension();
    const m = this.m;
    this.n = matrix.getColumnDimension();
    const n = this.n;
    this.piv = new Uint32Array(m);
    for (i = 0; i < m; i++) {
      this.piv[i] = i;
    }
    this.pivsign = 1;
    const LUcolj = new Array(m);

    // Outer loop.

    for (j = 0; j < n; j++) {
      // Make a copy of the j-th column to localize references.
      for (i = 0; i < m; i++) {
        LUcolj[i] = new Decimal(LU[matrix.index(i, j)]);
      }

      // Apply previous transformations.

      for (i = 0; i < m; i++) {
        // Most of the time is spent in the following dot product.
        const kmax = Math.min(i, j);
        let s = new Decimal(0);
        for (k = 0; k < kmax; k++) {
          const ik = matrix.index(i, k);
          const a = new Decimal(LU[ik]);
          const b = LUcolj[k];
          s = s.plus(a.times(b));
        }
        LUcolj[i] = LUcolj[i].minus(s);
        LU[matrix.index(i, j)] = LUcolj[i];
      }

      // Find pivot and exchange if necessary.

      let p = j;
      for (i = j + 1; i < m; i++) {
        if (LUcolj[i].abs() > LUcolj[p].abs()) {
          p = i;
        }
      }
      if (p !== j) {
        for (k = 0; k < n; k++) {
          const pk = matrix.index(p, k);
          const jk = matrix.index(j, k);
          const t = LU[pk];
          LU[pk] = LU[jk];
          LU[jk] = t;
        }
        k = this.piv[p];
        this.piv[p] = this.piv[j];
        this.piv[j] = k;
        this.pivsign = -this.pivsign;
      }

      // Compute multipliers.

      if (j < m && !LU[this.matrix.index(j, j)].isZero()) {
        for (i = j + 1; i < m; i++) {
          LU[matrix.index(i, j)] = LU[matrix.index(i, j)].dividedBy(LU[matrix.index(j, j)]);
        }
      }
    }
  }

  /**
   * @public
   *
   * @returns {boolean}
   */
  isNonsingular() {
    for (let j = 0; j < this.n; j++) {
      const index = this.matrix.index(j, j);
      if (this.LU[index].isZero()) {
        return false;
      }
    }
    return true;
  }

  /**
   * @public
   *
   * @param {Matrix} matrix
   * @param {constructor} Decimal - from decimal library
   * @returns {Matrix}
   */
  solve(matrix, Decimal) {
    let i;
    let j;
    let k;
    if (matrix.getRowDimension() !== this.m) {
      throw new Error('Matrix row dimensions must agree.');
    }
    if (!this.isNonsingular()) {
      throw new Error('Matrix is singular.');
    }

    // Copy right hand side with pivoting
    const nx = matrix.getColumnDimension();
    const Xmat = matrix.getArrayRowMatrix(this.piv, 0, nx - 1);
    const entries = [];
    Xmat.entries.forEach(e => entries.push(new Decimal(e)));

    // Solve L*Y = B(piv,:)
    for (k = 0; k < this.n; k++) {
      for (i = k + 1; i < this.n; i++) {
        for (j = 0; j < nx; j++) {
          entries[Xmat.index(i, j)] = entries[Xmat.index(i, j)].minus(entries[Xmat.index(k, j)].times(this.LU[this.matrix.index(i, k)]));
        }
      }
    }

    // Solve U*X = Y;
    for (k = this.n - 1; k >= 0; k--) {
      for (j = 0; j < nx; j++) {
        entries[Xmat.index(k, j)] = entries[Xmat.index(k, j)].dividedBy(this.LU[this.matrix.index(k, k)]);
      }
      for (i = 0; i < k; i++) {
        for (j = 0; j < nx; j++) {
          entries[Xmat.index(i, j)] = entries[Xmat.index(i, j)].minus(entries[Xmat.index(k, j)].times(this.LU[this.matrix.index(i, k)]));
        }
      }
    }
    Xmat.entries = entries.map(e => e.toNumber());
    return Xmat;
  }
}
dot.register('LUDecompositionDecimal', LUDecompositionDecimal);
export default LUDecompositionDecimal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3QiLCJMVURlY29tcG9zaXRpb25EZWNpbWFsIiwiY29uc3RydWN0b3IiLCJtYXRyaXgiLCJEZWNpbWFsIiwiaSIsImoiLCJrIiwiTFUiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImVudHJ5IiwicHVzaCIsIm0iLCJnZXRSb3dEaW1lbnNpb24iLCJuIiwiZ2V0Q29sdW1uRGltZW5zaW9uIiwicGl2IiwiVWludDMyQXJyYXkiLCJwaXZzaWduIiwiTFVjb2xqIiwiQXJyYXkiLCJpbmRleCIsImttYXgiLCJNYXRoIiwibWluIiwicyIsImlrIiwiYSIsImIiLCJwbHVzIiwidGltZXMiLCJtaW51cyIsInAiLCJhYnMiLCJwayIsImprIiwidCIsImlzWmVybyIsImRpdmlkZWRCeSIsImlzTm9uc2luZ3VsYXIiLCJzb2x2ZSIsIkVycm9yIiwibngiLCJYbWF0IiwiZ2V0QXJyYXlSb3dNYXRyaXgiLCJlIiwibWFwIiwidG9OdW1iZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkxVRGVjb21wb3NpdGlvbkRlY2ltYWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQXJiaXRyYXJ5LXByZWNpc2lvbiBMVSBEZWNvbXBvc2l0aW9uIHVzaW5nIGRlY2ltYWwuanMgYW5kIGNvcHktcGFzdGVkIGZyb20gTFVEZWNvbXBvc2l0aW9uLlxyXG4gKiBUaGlzIGlzIGEgY29weS1wYXN0ZSBpbXBsZW1lbnRhdGlvbiBzbyB0aGF0IHRoZSBwZXJmb3JtYW5jZSBjaGFyYWN0ZXJpc3RpY3Mgb2YgTFVEZWNvbXBvc2l0aW9uIGFyZSBub3QgZGlzdHVyYmVkLlxyXG4gKiBUaGlzIGZpbGUgc2hvdWxkIGJlIG1haW50YWluZWQgd2l0aCBMVURlY29tcG9zaXRpb24uanNcclxuICpcclxuICogVGhpcyBtb2R1bGUgcmVxdWlyZXMgdGhlIHByZXNlbmNlIG9mIHRoZSBwcmVsb2FkIERlY2ltYWwuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgZG90IGZyb20gJy4vZG90LmpzJztcclxuXHJcbmNsYXNzIExVRGVjb21wb3NpdGlvbkRlY2ltYWwge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gbWF0cml4XHJcbiAgICogQHBhcmFtIHtjb25zdHJ1Y3Rvcn0gRGVjaW1hbCAtIGZyb20gZGVjaW1hbCBsaWJyYXJ5XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1hdHJpeCwgRGVjaW1hbCApIHtcclxuICAgIGxldCBpO1xyXG4gICAgbGV0IGo7XHJcbiAgICBsZXQgaztcclxuXHJcbiAgICB0aGlzLm1hdHJpeCA9IG1hdHJpeDtcclxuXHJcbiAgICAvLyBUT0RPOiBzaXplISBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZG90L2lzc3Vlcy85NlxyXG4gICAgdGhpcy5MVSA9IFtdO1xyXG4gICAgbWF0cml4LmVudHJpZXMuZm9yRWFjaCggZW50cnkgPT4ge1xyXG4gICAgICB0aGlzLkxVLnB1c2goIG5ldyBEZWNpbWFsKCBlbnRyeSApICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgTFUgPSB0aGlzLkxVO1xyXG4gICAgdGhpcy5tID0gbWF0cml4LmdldFJvd0RpbWVuc2lvbigpO1xyXG4gICAgY29uc3QgbSA9IHRoaXMubTtcclxuICAgIHRoaXMubiA9IG1hdHJpeC5nZXRDb2x1bW5EaW1lbnNpb24oKTtcclxuICAgIGNvbnN0IG4gPSB0aGlzLm47XHJcbiAgICB0aGlzLnBpdiA9IG5ldyBVaW50MzJBcnJheSggbSApO1xyXG4gICAgZm9yICggaSA9IDA7IGkgPCBtOyBpKysgKSB7XHJcbiAgICAgIHRoaXMucGl2WyBpIF0gPSBpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5waXZzaWduID0gMTtcclxuICAgIGNvbnN0IExVY29saiA9IG5ldyBBcnJheSggbSApO1xyXG5cclxuICAgIC8vIE91dGVyIGxvb3AuXHJcblxyXG4gICAgZm9yICggaiA9IDA7IGogPCBuOyBqKysgKSB7XHJcblxyXG4gICAgICAvLyBNYWtlIGEgY29weSBvZiB0aGUgai10aCBjb2x1bW4gdG8gbG9jYWxpemUgcmVmZXJlbmNlcy5cclxuICAgICAgZm9yICggaSA9IDA7IGkgPCBtOyBpKysgKSB7XHJcbiAgICAgICAgTFVjb2xqWyBpIF0gPSBuZXcgRGVjaW1hbCggTFVbIG1hdHJpeC5pbmRleCggaSwgaiApIF0gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQXBwbHkgcHJldmlvdXMgdHJhbnNmb3JtYXRpb25zLlxyXG5cclxuICAgICAgZm9yICggaSA9IDA7IGkgPCBtOyBpKysgKSB7XHJcbiAgICAgICAgLy8gTW9zdCBvZiB0aGUgdGltZSBpcyBzcGVudCBpbiB0aGUgZm9sbG93aW5nIGRvdCBwcm9kdWN0LlxyXG4gICAgICAgIGNvbnN0IGttYXggPSBNYXRoLm1pbiggaSwgaiApO1xyXG4gICAgICAgIGxldCBzID0gbmV3IERlY2ltYWwoIDAgKTtcclxuICAgICAgICBmb3IgKCBrID0gMDsgayA8IGttYXg7IGsrKyApIHtcclxuICAgICAgICAgIGNvbnN0IGlrID0gbWF0cml4LmluZGV4KCBpLCBrICk7XHJcbiAgICAgICAgICBjb25zdCBhID0gbmV3IERlY2ltYWwoIExVWyBpayBdICk7XHJcbiAgICAgICAgICBjb25zdCBiID0gTFVjb2xqWyBrIF07XHJcbiAgICAgICAgICBzID0gcy5wbHVzKCBhLnRpbWVzKCBiICkgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIExVY29salsgaSBdID0gTFVjb2xqWyBpIF0ubWludXMoIHMgKTtcclxuICAgICAgICBMVVsgbWF0cml4LmluZGV4KCBpLCBqICkgXSA9IExVY29salsgaSBdO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBGaW5kIHBpdm90IGFuZCBleGNoYW5nZSBpZiBuZWNlc3NhcnkuXHJcblxyXG4gICAgICBsZXQgcCA9IGo7XHJcbiAgICAgIGZvciAoIGkgPSBqICsgMTsgaSA8IG07IGkrKyApIHtcclxuICAgICAgICBpZiAoIExVY29salsgaSBdLmFicygpID4gTFVjb2xqWyBwIF0uYWJzKCkgKSB7XHJcbiAgICAgICAgICBwID0gaTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCBwICE9PSBqICkge1xyXG4gICAgICAgIGZvciAoIGsgPSAwOyBrIDwgbjsgaysrICkge1xyXG4gICAgICAgICAgY29uc3QgcGsgPSBtYXRyaXguaW5kZXgoIHAsIGsgKTtcclxuICAgICAgICAgIGNvbnN0IGprID0gbWF0cml4LmluZGV4KCBqLCBrICk7XHJcbiAgICAgICAgICBjb25zdCB0ID0gTFVbIHBrIF07XHJcbiAgICAgICAgICBMVVsgcGsgXSA9IExVWyBqayBdO1xyXG4gICAgICAgICAgTFVbIGprIF0gPSB0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBrID0gdGhpcy5waXZbIHAgXTtcclxuICAgICAgICB0aGlzLnBpdlsgcCBdID0gdGhpcy5waXZbIGogXTtcclxuICAgICAgICB0aGlzLnBpdlsgaiBdID0gaztcclxuICAgICAgICB0aGlzLnBpdnNpZ24gPSAtdGhpcy5waXZzaWduO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDb21wdXRlIG11bHRpcGxpZXJzLlxyXG5cclxuICAgICAgaWYgKCBqIDwgbSAmJiAhTFVbIHRoaXMubWF0cml4LmluZGV4KCBqLCBqICkgXS5pc1plcm8oKSApIHtcclxuICAgICAgICBmb3IgKCBpID0gaiArIDE7IGkgPCBtOyBpKysgKSB7XHJcbiAgICAgICAgICBMVVsgbWF0cml4LmluZGV4KCBpLCBqICkgXSA9IExVWyBtYXRyaXguaW5kZXgoIGksIGogKSBdLmRpdmlkZWRCeSggTFVbIG1hdHJpeC5pbmRleCggaiwgaiApIF0gKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAqL1xyXG4gIGlzTm9uc2luZ3VsYXIoKSB7XHJcbiAgICBmb3IgKCBsZXQgaiA9IDA7IGogPCB0aGlzLm47IGorKyApIHtcclxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1hdHJpeC5pbmRleCggaiwgaiApO1xyXG4gICAgICBpZiAoIHRoaXMuTFVbIGluZGV4IF0uaXNaZXJvKCkgKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7TWF0cml4fSBtYXRyaXhcclxuICAgKiBAcGFyYW0ge2NvbnN0cnVjdG9yfSBEZWNpbWFsIC0gZnJvbSBkZWNpbWFsIGxpYnJhcnlcclxuICAgKiBAcmV0dXJucyB7TWF0cml4fVxyXG4gICAqL1xyXG4gIHNvbHZlKCBtYXRyaXgsIERlY2ltYWwgKSB7XHJcbiAgICBsZXQgaTtcclxuICAgIGxldCBqO1xyXG4gICAgbGV0IGs7XHJcbiAgICBpZiAoIG1hdHJpeC5nZXRSb3dEaW1lbnNpb24oKSAhPT0gdGhpcy5tICkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoICdNYXRyaXggcm93IGRpbWVuc2lvbnMgbXVzdCBhZ3JlZS4nICk7XHJcbiAgICB9XHJcbiAgICBpZiAoICF0aGlzLmlzTm9uc2luZ3VsYXIoKSApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCAnTWF0cml4IGlzIHNpbmd1bGFyLicgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDb3B5IHJpZ2h0IGhhbmQgc2lkZSB3aXRoIHBpdm90aW5nXHJcbiAgICBjb25zdCBueCA9IG1hdHJpeC5nZXRDb2x1bW5EaW1lbnNpb24oKTtcclxuICAgIGNvbnN0IFhtYXQgPSBtYXRyaXguZ2V0QXJyYXlSb3dNYXRyaXgoIHRoaXMucGl2LCAwLCBueCAtIDEgKTtcclxuICAgIGNvbnN0IGVudHJpZXMgPSBbXTtcclxuICAgIFhtYXQuZW50cmllcy5mb3JFYWNoKCBlID0+IGVudHJpZXMucHVzaCggbmV3IERlY2ltYWwoIGUgKSApICk7XHJcblxyXG4gICAgLy8gU29sdmUgTCpZID0gQihwaXYsOilcclxuICAgIGZvciAoIGsgPSAwOyBrIDwgdGhpcy5uOyBrKysgKSB7XHJcbiAgICAgIGZvciAoIGkgPSBrICsgMTsgaSA8IHRoaXMubjsgaSsrICkge1xyXG4gICAgICAgIGZvciAoIGogPSAwOyBqIDwgbng7IGorKyApIHtcclxuICAgICAgICAgIGVudHJpZXNbIFhtYXQuaW5kZXgoIGksIGogKSBdID0gZW50cmllc1sgWG1hdC5pbmRleCggaSwgaiApIF0ubWludXMoIGVudHJpZXNbIFhtYXQuaW5kZXgoIGssIGogKSBdLnRpbWVzKCB0aGlzLkxVWyB0aGlzLm1hdHJpeC5pbmRleCggaSwgayApIF0gKSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNvbHZlIFUqWCA9IFk7XHJcbiAgICBmb3IgKCBrID0gdGhpcy5uIC0gMTsgayA+PSAwOyBrLS0gKSB7XHJcbiAgICAgIGZvciAoIGogPSAwOyBqIDwgbng7IGorKyApIHtcclxuICAgICAgICBlbnRyaWVzWyBYbWF0LmluZGV4KCBrLCBqICkgXSA9IGVudHJpZXNbIFhtYXQuaW5kZXgoIGssIGogKSBdLmRpdmlkZWRCeSggdGhpcy5MVVsgdGhpcy5tYXRyaXguaW5kZXgoIGssIGsgKSBdICk7XHJcbiAgICAgIH1cclxuICAgICAgZm9yICggaSA9IDA7IGkgPCBrOyBpKysgKSB7XHJcbiAgICAgICAgZm9yICggaiA9IDA7IGogPCBueDsgaisrICkge1xyXG4gICAgICAgICAgZW50cmllc1sgWG1hdC5pbmRleCggaSwgaiApIF0gPSBlbnRyaWVzWyBYbWF0LmluZGV4KCBpLCBqICkgXS5taW51cyggZW50cmllc1sgWG1hdC5pbmRleCggaywgaiApIF0udGltZXMoIHRoaXMuTFVbIHRoaXMubWF0cml4LmluZGV4KCBpLCBrICkgXSApICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgWG1hdC5lbnRyaWVzID0gZW50cmllcy5tYXAoIGUgPT4gZS50b051bWJlcigpICk7XHJcbiAgICByZXR1cm4gWG1hdDtcclxuICB9XHJcbn1cclxuXHJcbmRvdC5yZWdpc3RlciggJ0xVRGVjb21wb3NpdGlvbkRlY2ltYWwnLCBMVURlY29tcG9zaXRpb25EZWNpbWFsICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBMVURlY29tcG9zaXRpb25EZWNpbWFsOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsR0FBRyxNQUFNLFVBQVU7QUFFMUIsTUFBTUMsc0JBQXNCLENBQUM7RUFFM0I7QUFDRjtBQUNBO0FBQ0E7RUFDRUMsV0FBV0EsQ0FBRUMsTUFBTSxFQUFFQyxPQUFPLEVBQUc7SUFDN0IsSUFBSUMsQ0FBQztJQUNMLElBQUlDLENBQUM7SUFDTCxJQUFJQyxDQUFDO0lBRUwsSUFBSSxDQUFDSixNQUFNLEdBQUdBLE1BQU07O0lBRXBCO0lBQ0EsSUFBSSxDQUFDSyxFQUFFLEdBQUcsRUFBRTtJQUNaTCxNQUFNLENBQUNNLE9BQU8sQ0FBQ0MsT0FBTyxDQUFFQyxLQUFLLElBQUk7TUFDL0IsSUFBSSxDQUFDSCxFQUFFLENBQUNJLElBQUksQ0FBRSxJQUFJUixPQUFPLENBQUVPLEtBQU0sQ0FBRSxDQUFDO0lBQ3RDLENBQUUsQ0FBQztJQUVILE1BQU1ILEVBQUUsR0FBRyxJQUFJLENBQUNBLEVBQUU7SUFDbEIsSUFBSSxDQUFDSyxDQUFDLEdBQUdWLE1BQU0sQ0FBQ1csZUFBZSxDQUFDLENBQUM7SUFDakMsTUFBTUQsQ0FBQyxHQUFH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